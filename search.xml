<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Android-View.Post</title>
      <link href="2021/08/28/Android-View-Post/"/>
      <url>2021/08/28/Android-View-Post/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»Androidä¸­çš„åç¨‹</p><a id="more"></a><h1 id="View-Post"><a href="#View-Post" class="headerlink" title="View.Post"></a>View.Post</h1><blockquote><p>Androidæºç å‰–æ</p></blockquote><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.post&#123;</span><br><span class="line">    notifyAnimState(listener,ANIM_STATE_END)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ˜¯ä¸èƒ½è¿›è¡ŒUIæ“ä½œçš„ï¼Œé‚£ä¹ˆæƒ³è¦åœ¨å­çº¿ç¨‹ä¸­è¿›è¡ŒUIæ“ä½œï¼Œæˆ–è€…åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¸€äº›æ“ä½œæƒ³è¦å»¶è¿Ÿå¤„ç†ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ã€‚ç­”æ¡ˆå°±æ˜¯éƒ½å¯ä»¥ä½¿ç”¨Handleræ¥è§£å†³ï¼Œä½†æ˜¯è¯´å®è¯å†™Handlerè¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œè¿˜å¾—æ³¨æ„å†…å­˜æ³„æ¼é—®é¢˜ã€‚æ‰€ä»¥å°±å¯ä»¥ä½¿ç”¨<code>View.post()</code>æˆ–è€…<code>View.postDelay()</code>æ¥æ›¿ä»£Handler</p><p>ä½†æ˜¯ç”¨å½’ç”¨ï¼Œéš¾é“å°±ä¸å¥½å¥‡<code>View.post</code>ä¸ºä»€ä¹ˆå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­æ“ä½œUIï¼Œä¸ºä»€ä¹ˆå¯ä»¥è§£å†³åœ¨<code>Activity</code>çš„<code>OnCreate()</code>é‡Œè°ƒç”¨<code>View.post()</code>æ¥è§£å†³è·å–Viewé«˜å®½ä¸º0çš„é—®é¢˜ã€‚æ‰€ä»¥æ¥ä¸‹æ¥å°†é€šè¿‡æŸ¥çœ‹æºç æ¥è§£ç­”ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜</p><h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><h4 id="View"><a href="#View" class="headerlink" title="View#"></a>View#</h4><blockquote><p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewä¸­</p></blockquote><h5 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> AttachInfo attachInfo = mAttachInfo;</span><br><span class="line">    <span class="keyword">if</span> (attachInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> attachInfo.mHandler.post(action);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Postpone the runnable until we know on which thread it needs to run.</span></span><br><span class="line">    <span class="comment">// Assume that the runnable will be successfully placed after attach.</span></span><br><span class="line">    getRunQueue().post(action);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸æ˜¯å¥½å¥‡ä¸ºä»€ä¹ˆ<code>View.post()</code>å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­æ“ä½œUIå—ï¼Œå…¶å®è·Ÿæˆ‘ä»¬æƒ³çš„å·®ä¸å¤šï¼Œ<code>post</code>å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨<code>Handler</code>æ¥å®ç°çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ç»§ç»­çœ‹çœ‹Androidæ˜¯æ€ä¹ˆå°è£…çš„</p><p>posté‡Œçš„ä»£ç è¿˜æ˜¯è›®å°‘çš„ï¼Œæˆ‘ä»¬æ…¢æ…¢æ¥åˆ†æï¼š</p><ol><li><p>é¦–å…ˆå°†æˆå‘˜å˜é‡<code>mAttachInfo</code>èµ‹å€¼ç»™<code>attachInfo</code>ï¼Œå†åˆ¤æ–­<code>attachInfo</code>æ˜¯å¦ä¸ºç©º(ä¹Ÿå°±æ˜¯åˆ¤æ–­<code>mAttachInfo</code>æ˜¯å¦ä¸ºç©º)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> AttachInfo attachInfo = mAttachInfo;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœ<code>attachInfo</code>ä¸ä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨<code>Handler.post()</code>å°†<code>Runnable</code>ä¼ è¿›å»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">      <span class="keyword">if</span> (attachInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> attachInfo.mHandler.post(action);</span><br><span class="line">      &#125;</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ol><blockquote><p><code>Runnable</code>å°±æ˜¯ä¸ªæ¥å£ï¼Œå®ç°äº†<code>Runnable</code>æ¥å£çš„ç±»ï¼Œç§°ä¸º <strong>çº¿ç¨‹è¾…åŠ©ç±»</strong>ï¼›<code>Thread</code>ç±»æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹ç±»ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆè¿˜æ˜¯æƒ³è¦é€šè¿‡<code>Thread</code>æ¥åˆ›å»ºçº¿ç¨‹å¹¶æŠŠ<strong>çº¿ç¨‹è¾…åŠ©ç±»</strong>ä¼ å…¥è¿›å»</p></blockquote><ol start="3"><li><p>å¦‚æœ<code>attachInfo</code>ä¸ºç©ºçš„è¯ï¼Œåˆ™æ‰§è¡Œä»é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªå€¼æ¥æ‰§è¡Œ<code>Post</code>ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡è¿™ä¸ªé˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸ªä»€ä¹ˆé˜Ÿåˆ—ï¼Œå…ˆç»§ç»­å¾€ä¸‹çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">      getRunQueue().post(action);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li><li><p>æœ€ç»ˆè¿”å›Trueï¼Œè¡¨ç¤ºæ‰§è¡Œå®Œæˆ</p></li></ol><p><code>View.post()</code>é‡Œçš„ä»£ç å·²ç»çœ‹å®Œäº†ï¼Œä½†æ˜¯åˆå¤šå‡ºäº†å‡ ä¸ªæ–°é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯<code>mAttachInfo</code>åˆ°åº•æ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼Œéœ€è¦ä»€ä¹ˆæ¡ä»¶ã€‚<code>getRunQueue</code>åˆæ˜¯å•¥ï¼Œé‚£ä¹ˆä¹Ÿå°±åªèƒ½ç»§ç»­å¾€ä¸‹æ·±å…¥äº†</p><h5 id="mAttachInfo"><a href="#mAttachInfo" class="headerlink" title="mAttachInfo"></a>mAttachInfo</h5><p>æˆ‘ä»¬ç›´æ¥åœ¨<code>Android Studio</code>ä½¿ç”¨<code>Ctrl + F</code>æ¥è¿›è¡ŒæŸ¥æ‰¾ï¼Œåœ¨æœç´¢çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ç‚¹å°æŠ€å·§ï¼Œæœç´¢<code>mAttachInfo =</code> (ç­‰å·å‰åéƒ½æœ‰ç©ºæ ¼)ã€‚è¿™æ ·å°±å¯ä»¥ç›´æ¥æŸ¥åˆ°ä¸¤å¤„èµ‹å€¼æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchAttachedToWindow</span><span class="params">(AttachInfo info, <span class="keyword">int</span> visibility)</span> </span>&#123;</span><br><span class="line">        mAttachInfo = info;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">     mAttachInfo = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤å¤„åˆ†åˆ«å¯¹åº”äº†èµ‹å€¼å’Œç½®ç©ºï¼Œåˆšå¥½æ˜¯åœ¨å¯¹åº”çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå†…ã€‚æ¥ä¸‹æ¥å°±ç»§ç»­äº†è§£<code>dispatchAttachedToWindow</code>å’Œ<code>dispatchDetachedFromWindow</code>åˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™åœ¨å“ªé‡Œè¢«è°ƒç”¨äº†</p><p>å¥½å§ğŸ˜›ï¼Œå…¶å®å¯ä»¥å…ˆä¸ç”¨ç®¡å®ƒä»¬ä¸¤ä¸ªåœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨äº†ï¼Œè‡³å°‘åœ¨ç°åœ¨çœ‹æ¥ï¼Œåœ¨<code>Activity.onCreate()</code>çš„æ—¶å€™<code>dispatchAttachedToWindow</code>è¿˜æ˜¯æ²¡æœ‰è¢«è°ƒç”¨çš„ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨<code>onCreate()</code>é‡Œæ‰§è¡Œ<strong>View.post</strong>é‡Œçš„æ“ä½œä»ç„¶å¯ä»¥ä¿è¯æ˜¯åœ¨<code>View</code>çš„é«˜å®½è®¡ç®—å®Œæ¯•çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿé‚£ä¹ˆåŸå› åªå¯èƒ½åœ¨å¦ä¸€ä¸ª<code>return</code>é‡Œäº†<code>getRunQueue.post</code></p><h5 id="getRunQueue"><a href="#getRunQueue" class="headerlink" title="getRunQueue"></a>getRunQueue</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> HandlerActionQueue <span class="title">getRunQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mRunQueue == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mRunQueue = <span class="keyword">new</span> HandlerActionQueue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mRunQueue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>getRunQueue</code>å°±æ˜¯è¿”å›<code>HandlerActionQueue</code>ï¼Œå¤–éƒ¨ç¡®å®å°±æ˜¯è°ƒç”¨<code>HandlerActionQueue.post</code>ï¼Œç»§ç»­æ·±å…¥</p><h4 id="HandlerActionQueue"><a href="#HandlerActionQueue" class="headerlink" title="HandlerActionQueue#"></a>HandlerActionQueue#</h4><blockquote><p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºHandlerActionQueueä¸­</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerActionQueue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HandlerAction[] mActions; <span class="comment">// è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªHandlerActionæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCount; <span class="comment">// è¿˜æœ‰ä¸€ä¸ªè®¡æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">        postDelayed(action, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postDelayed</span><span class="params">(Runnable action, <span class="keyword">long</span> delayMillis)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> HandlerAction handlerAction = <span class="keyword">new</span> HandlerAction(action, delayMillis);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;<span class="comment">// åŠ é”ï¼ŒåŒæ­¥è¿›è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (mActions == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mActions = <span class="keyword">new</span> HandlerAction[<span class="number">4</span>];<span class="comment">// å¦‚æœä¸ºç©ºï¼Œåˆ™åˆ›å»ºé»˜è®¤å¤§å°ä¸º4çš„æ•°ç»„</span></span><br><span class="line">            &#125;</span><br><span class="line">            mActions = GrowingArrayUtils.append(mActions, mCount, handlerAction);</span><br><span class="line">            mCount++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>GrowingArrayUtilsï¼šä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨æ‰©å±•çš„Arrayå·¥å…·ç±»</p></blockquote><p><code>HandlerActionQueue.post</code>å†…éƒ¨åˆ™æ˜¯è°ƒç”¨äº†<code>postDelayed()</code>ï¼Œ<code>postDelayed()</code>å†…éƒ¨åˆ™æ˜¯å°†<code>Runnable</code>å’Œ<code>long</code>ä½œä¸ºå‚æ•°åˆ›å»ºä¸€ä¸ª<code>HandlerAction</code>ï¼Œä¹‹åå†æ·»åŠ åˆ°<code>mActions</code>æ•°ç»„ä¸­å»ï¼Œé‚£å°±é¡ºä¾¿çœ‹ä¸€ä¸‹<code>HandlerAction</code></p><h5 id="HandlerAction"><a href="#HandlerAction" class="headerlink" title="HandlerAction"></a>HandlerAction</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Runnable action;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> delay;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HandlerAction</span><span class="params">(Runnable action, <span class="keyword">long</span> delay)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.action = action;</span><br><span class="line">        <span class="keyword">this</span>.delay = delay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Runnable otherAction)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> otherAction == <span class="keyword">null</span> &amp;&amp; action == <span class="keyword">null</span></span><br><span class="line">                || action != <span class="keyword">null</span> &amp;&amp; action.equals(otherAction);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è›®ç®€å•çš„ä¸€ä¸ªç±»ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯æŠŠ<code>View.post</code>ä¼ å…¥çš„<code>Runnable</code>ä¿å­˜èµ·æ¥ï¼Œå¦‚æœæ˜¯<code>postDelay()</code>ï¼Œé‚£å°±ä¹ŸæŠŠå»¶è¿Ÿæ—¶é—´ç”¨<code>delay</code>ä¿å­˜èµ·æ¥</p><p>ç°åœ¨æˆ‘ä»¬å›åˆ°ä¸Šå±‚ï¼Œæ¢³ç†ä¸€ä¸‹ã€‚æˆ‘ä»¬ä¸€å¼€å§‹è°ƒç”¨çš„<code>View.post</code>ä¼ å…¥çš„<code>Runnable</code>ï¼Œåœ¨ä¼ åˆ°<code>HandlerActionQueue</code>é‡Œä¼šåŒ…è£…æˆ<code>HanlderAction</code>ï¼Œç„¶åå†ç¼“å­˜èµ·æ¥ã€‚å†<code>HanlderActionQueue</code>å†…éƒ¨åˆ›å»ºäº†ä¸ªé»˜è®¤å¤§å°ä¸º4çš„<code>HanlderAction</code>æ•°ç»„ï¼Œå½“æ•°ç»„ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡<code>GrowingArrayUtils.append()</code>æ¥è¿›è¡Œæ‰©å±•ã€‚</p><h5 id="æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š"><a href="#æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š" class="headerlink" title="æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š"></a>æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š</h5><p><code>Activity.onCreate</code> â€“&gt; è°ƒç”¨<code>View.post()</code> â€“&gt; è¿˜æ²¡è¿›è¡Œ<code>dispatchAttachedToWindow</code>  â€“&gt; <code>HandlerActionQueue</code>ä¿å­˜åˆ°æ•°ç»„ä¸­</p><p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™è¿™äº›å­˜å‚¨èµ·æ¥çš„<code>Runnable</code>æ¥ä¼šè¢«æ‰§è¡Œå‘¢ï¼Œè¿™åˆå¾—å›åˆ°<code>HandlerActionQueue</code>è¿™é‡Œäº†</p><h5 id="executeActions"><a href="#executeActions" class="headerlink" title="executeActions"></a>executeActions</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeActions</span><span class="params">(Handler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> HandlerAction[] actions = mActions;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, count = mCount; i &lt; count; i++) &#123; <span class="comment">// å…¨éƒ¨éå†å‡ºæ¥ï¼Œç„¶ååŠ åˆ°Handleré‡Œé¢å»</span></span><br><span class="line">            <span class="keyword">final</span> HandlerAction handlerAction = actions[i];</span><br><span class="line">            handler.postDelayed(handlerAction.action, handlerAction.delay);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mActions = <span class="keyword">null</span>;</span><br><span class="line">        mCount = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>HandlerActionQueue</code>é‡Œé¢ï¼Œæœ‰ä¸€ä¸ª<code>executeActions</code>çš„è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ç”¨æ¥å¤„ç†<code>HandlerAction</code>çš„ã€‚è¿˜è¦ä¸€ä¸ªä¸»è¦çš„åœ°æ–¹å°±æ˜¯è¿™äº›è¢«ç¼“å­˜çš„<code>Runnable</code>ä¹Ÿéƒ½æ˜¯è¢«<strong>Handler</strong>å¤„ç†çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª<strong>Hanlder</strong>æ˜¯å“ªé‡Œæ¥çš„å‘¢</p><h4 id="View-1"><a href="#View-1" class="headerlink" title="View#"></a>View#</h4><blockquote><p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewä¸­</p></blockquote><h5 id="dispatchAttachedToWindow"><a href="#dispatchAttachedToWindow" class="headerlink" title="dispatchAttachedToWindow"></a>dispatchAttachedToWindow</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchAttachedToWindow</span><span class="params">(AttachInfo info, <span class="keyword">int</span> visibility)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Transfer all pending runnables.</span></span><br><span class="line">       <span class="keyword">if</span> (mRunQueue != <span class="keyword">null</span>) &#123;</span><br><span class="line">           mRunQueue.executeActions(info.mHandler);</span><br><span class="line">           mRunQueue = <span class="keyword">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­å¾ˆæ¸…æ™°çš„å°±å¯ä»¥çœ‹åˆ°ï¼Œåªè¦<code>mRunQueue</code>ä¸ä¸ºç©ºï¼Œåœ¨æ‰§è¡Œ<code>dispatchAttachedToWindow</code>çš„æ—¶å€™å°±ä¼šå»è¿è¡Œ</p><h5 id="å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š"><a href="#å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š" class="headerlink" title="å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š"></a>å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š</h5><p><code>Activity.onCreate</code> â€“&gt; è°ƒç”¨<code>View.post()</code> â€“&gt; è¿˜æ²¡è¿›è¡Œ<code>dispatchAttachedToWindow</code>  â€“&gt; ä½¿ç”¨<code>HandlerActionQueue</code>å°†<code>Runnable</code>ä¿å­˜åˆ°æ•°ç»„ä¸­ â€“&gt; <code>View.dispatchAttachedToWindow</code>è¢«æ‰§è¡Œ â€“&gt; <code>mRunQueue</code>ä¸ä¸ºç©º â€“&gt; <code>mRunQueue.executeActions()</code>è¿è¡Œè¢«å‚¨å­˜çš„<code>Runnable</code> â€”&gt;ç”±äº<code>View.dispatchAttachedToWindow</code>è¢«æ‰§è¡Œï¼Œ<code>mAttachInfo</code>ä¸ä¸ºç©ºï¼Œåˆ™å‰©ä¸‹çš„éƒ½äº¤ç»™<code>mAttachInfo.mHandler</code></p><p>å›¾ç‰‡æµç¨‹ï¼š</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210730143624882.png" alt="image-20210730143624882"></p><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å›ç­”ä¸€å¼€å§‹æçš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è§£å†³åœ¨<code>Activity</code>çš„<code>OnCreate()</code>é‡Œè°ƒç”¨<code>View.post()</code>æ¥è§£å†³è·å–<code>View</code>é«˜å®½ä¸º0çš„é—®é¢˜ã€‚ç­”æ¡ˆå°±æ˜¯Viewå…ˆä¼šå°†ä¼ å…¥è¿›æ¥çš„<code>Runnable</code>éƒ½ç¼“å­˜èµ·æ¥ï¼Œç­‰åˆ°<code>dispatchAttachedToWindow</code>  æ‰§è¡Œï¼Œåœ¨å…ˆå°†ç¼“å­˜èµ·æ¥çš„<code>Runnable</code>éå†è¿è¡Œï¼Œä¹‹åçš„å°±æ­£å¸¸äº¤ç»™<code>mAttachInfo.mHandler</code>ã€‚æœ€åæˆ‘ä»¬å°±åªç”¨ææ¸…æ¥š<code>mAttachInfo</code>æ˜¯åœ¨å“ªé‡Œåˆå§‹åŒ–çš„å’Œä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨<code>dispatchAttachedToWindow</code> </p><p>é€šè¿‡æŸ¥è¯¢ï¼Œä¼šåœ¨<code>ViewRootlmpl.performTraversals()</code>å’Œ<code>ViewGroup.addViewInner()</code>é‡Œè¢«è°ƒç”¨</p><h4 id="ViewGroup"><a href="#ViewGroup" class="headerlink" title="ViewGroup#"></a>ViewGroup#</h4><blockquote><p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewGroup ä¸­</p></blockquote><p>å’±ä»¬å…ˆæ¥çœ‹<code>ViewGroup</code>ï¼Œåœ¨<code>ViewGroup</code>çš„<code>addViewInner()</code>æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨åˆ°<code>dispatchAttachedToWindow</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addViewInner</span><span class="params">(View child, <span class="keyword">int</span> index, LayoutParams params,<span class="keyword">boolean</span> preventRequestLayout)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    AttachInfo ai = mAttachInfo;</span><br><span class="line">   ...</span><br><span class="line">            child.dispatchAttachedToWindow(mAttachInfo, (mViewFlags&amp;VISIBILITY_MASK));</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>addViewInner()</code>æ˜¯<code>ViewGroup</code>åœ¨æ·»åŠ <code>View</code>æ—¶å†…éƒ¨çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å½“<code>ViewGroup.addView()</code>çš„æ—¶å€™ï¼Œå¦‚æœ<code>mAttachInfo</code>ä¸ä¸ºç©ºï¼Œåˆ™ä¼šå»è°ƒç”¨å­ç±»çš„<code>dispatchAttachedToWindow()</code>ï¼Œå¹¶å°†è‡ªèº«çš„<code>AttachInfo</code>ä¼ å…¥è¿‡å»ã€‚ç„¶åå­<code>View</code>åˆ™ä¼šå°†ä¼ é€’è¿‡æ¥çš„<code>mAttachInfo</code>èµ‹å€¼ç»™è‡ªå·±çš„<code>AttachInfo</code></p><p>é‚£ä¹ˆ<code>ViewGroup</code>çš„<code>AttachInfo</code>æ˜¯é‚£æ¥çš„å‘¢ï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥ï¼Œæœ€ç»ˆæ‰¾åˆ°çš„ç»“æœéå¸¸Amazedå•Šï¼ã€‚<code>ViewGroup</code>æ˜¯ç»§æ‰¿<code>View</code>çš„ï¼Œ<code>ViewGroup</code>ä¸­çš„<code>AttachInfo</code>æ˜¯ç›´æ¥ä½¿ç”¨<code>View</code>ä¸­<code>AttachInfo</code>ï¼Œå¯ä»¥å¾ˆç‰›ï¼Œç›´æ¥ç»•å›æ¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> <span class="keyword">implements</span> <span class="title">Drawable</span>.<span class="title">Callback</span>, <span class="title">KeyEvent</span>.<span class="title">Callback</span>,<span class="title">AccessibilityEventSource</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    AttachInfo mAttachInfo;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>ViewGroup</code>å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ª<code>dispatchAttachedToWindow</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dispatchAttachedToWindow</span><span class="params">(AttachInfo info, <span class="keyword">int</span> visibility)</span> </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">super</span>.dispatchAttachedToWindow(info, visibility);</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">          <span class="keyword">final</span> View child = children[i];</span><br><span class="line">          child.dispatchAttachedToWindow(info,</span><br><span class="line">                  combineVisibility(visibility, child.getVisibility()));</span><br><span class="line">      &#125;</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„<code>dispatchAttachedToWindow</code>ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨<code>View.dispatchAttachedToWindow</code>ï¼ˆ<code>View</code>ä¸­çš„<code>AttachInfo</code>ä¹Ÿæ˜¯åœ¨è¿™ä¸ªæ—¶å€™è¢«èµ‹å€¼çš„ï¼‰ï¼Œæ¥ç€éå†æ‰€æœ‰å­ç±»ï¼Œè°ƒç”¨å­ç±»çš„<code>dispatchAttachedToWindow</code>ï¼Œå¹¶ä¼ å…¥è‡ªèº«çš„<code>AttachInfo</code>ã€‚ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±ç›´æ¥è¿›å…¥å¾ªç¯äº†â€¦ æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å»çœ‹çœ‹<code>ViewRootlmpl</code>ï¼Œå¸Œæœ›é‚£é‡Œä¼šæœ‰ç­”æ¡ˆ</p><h4 id="ViewRootlmpl"><a href="#ViewRootlmpl" class="headerlink" title="ViewRootlmpl#"></a>ViewRootlmpl#</h4><blockquote><p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewRootlmplä¸­</p></blockquote><h5 id="performTraversals"><a href="#performTraversals" class="headerlink" title="performTraversals()"></a>performTraversals()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">performTraversals</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="keyword">final</span> View host = mView; <span class="comment">//è¿™é‡Œçš„Viewæ˜¯Activityä¸­çš„DecorView</span></span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">if</span> (mFirst) &#123;</span><br><span class="line"> ...</span><br><span class="line"> host.dispatchAttachedToWindow(mAttachInfo, <span class="number">0</span>);</span><br><span class="line"> mAttachInfo.mTreeObserver.dispatchOnWindowAttachedChange(<span class="keyword">true</span>);</span><br><span class="line"> dispatchApplyInsets(host);</span><br><span class="line"> ...</span><br><span class="line"> &#125;</span><br><span class="line"> mFirst = <span class="keyword">false</span>;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>performTraversals()</code>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥é€šçŸ¥<code>Activity</code>çš„<code>View</code>æ ‘æ¥å¼€å§‹æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ã€‚è€Œ<code>DecorView</code>å°±æ˜¯<code>Activity</code>çš„æ ¹å¸ƒå±€ï¼Œ<code>View</code>æ ‘çš„èµ·ç‚¹ï¼Œæ˜¯ä¸€ä¸ª<code>FrameLayout</code>(æ˜¯ä¸€ä¸ª<code>ViewGroup</code>)ã€‚æ‰€ä»¥å°±æ˜¯åœ¨è¿™é‡Œç¬¬ä¸€æ¬¡å°†<code>mAttachInfo</code>ä¼ ç»™äº†<code>DecorView</code>ä¸­çš„æ‰€æœ‰å­ç±»</p><p>å¯ä»¥äº†ï¼Œç°åœ¨åªç”¨æ‰¾åˆ°<code>mAttachInfo</code>æ˜¯åœ¨å“ªé‡Œè¿›è¡Œçš„åˆå§‹åŒ–å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ViewRootImpl</span><span class="params">(Context context, Display display, IWindowSession session,<span class="keyword">boolean</span> useSfChoreographer)</span> </span>&#123;</span><br><span class="line"> ...   </span><br><span class="line"> mAttachInfo = <span class="keyword">new</span> View.AttachInfo(mWindowSession, mWindow, display, <span class="keyword">this</span>, mHandler, <span class="keyword">this</span>,context);</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°äº†ï¼Œåœ¨<code>ViewRootImpl</code>çš„ä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª<code>AttachInfo</code>ã€‚æ‰€ä»¥è¯´<code>ViewRootImpl</code>æ˜¯<code>AttachInfo</code>çš„å¼€å¤´ï¼Œ<code>AttachInfo</code>æ˜¯ä»è¿™é‡Œå¼€å§‹å¾€ä¸‹ä¼ é€’çš„</p><p>ä½†åˆæœ‰ä¸€ä¸ªå°é—®é¢˜å‡ºç°äº†ï¼Œé‚£å°±æ˜¯åˆ›å»º<code>AttachInfo</code>ä¸­æ”¾å…¥çš„å‚æ•°<code>mHandler</code>ï¼Œ<code>mHandler</code>æ˜¯é‚£æ¥çš„å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ViewRootHandler mHandler = <span class="keyword">new</span> ViewRootHandler();</span><br></pre></td></tr></table></figure><p><code>mHandler</code>æ˜¯åœ¨å†…éƒ¨è¢«åˆ›å»ºçš„ï¼Œåˆå› ä¸º<code>ViewRootImpl</code>æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œåˆ›å»ºçš„<code>Handler</code>ä¼šè‡ªåŠ¨çš„è·å–å½“å‰çº¿ç¨‹çš„<code>Looper</code>ï¼Œæ‰€ä»¥ä¹Ÿå°±å¯ä»¥å›ç­”ä¸€å¼€å§‹æ‰€é—®çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨<code>View.post</code>æ¥æ›´æ–°<code>ui</code>ï¼Œå› ä¸ºå†…éƒ¨çš„<code>Handler</code>å§‹ç»ˆéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šçš„</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>å½“è°ƒç”¨<code>View.post</code>çš„æ—¶å€™ï¼Œ<code>View</code>å†…éƒ¨ä¼šå…ˆåˆ¤æ–­æ˜¯å¦è°ƒç”¨è¿‡<code>dispatchAttachedToWindow</code>ï¼Œä¹Ÿå°±æ˜¯<code>mAttachInfo</code>æ˜¯å¦ä¸ºç©ºã€‚ä¸ºç©ºçš„è¯ï¼Œåˆ™ä¼šå…ˆå°†ä¼ å…¥è¿›æ¥çš„<code>Runnable</code>é€šè¿‡è°ƒç”¨<code>HandlerActionQueue</code>å°è£…æˆ<code>HandlerAction</code>ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œç­‰å¾…<code>dispatchAttachedToWindow</code>è¢«æ‰§è¡Œã€‚å½“<code>dispatchAttachedToWindow</code>è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ™ä¼šå…ˆå°†å­˜å‚¨åœ¨<code>HandlerActionQueue</code>é‡Œçš„æ•°ç»„ä¸­çš„<code>HandlerAction</code>æå–å‡ºæ¥è¿è¡Œï¼Œä¹‹åçš„<code>Runnable</code>éƒ½å°†ç›´æ¥è°ƒç”¨<code>mAttachInfo.post()</code>æ¥è¿è¡Œ</p><p>å…³äº<code>mAttachInfo</code>çš„æµç¨‹ï¼šä¸€å¼€å§‹<code>ViewRootlmpl</code>é€šçŸ¥<code>Activity</code>æ ¹<code>View</code>å¼€å§‹æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ã€‚ä¹Ÿå°±æ˜¯é€šçŸ¥<code>Activity.DevorView</code>å»è¿›è¡Œæµ‹é‡ä¼šè°ƒç”¨<code>view.dispatchAttachedToWindow()</code>çš„æ–¹æ³•ï¼Œå°†è‡ªèº«çš„<code>mAttachInfo</code>ä¼ ç»™æ ¹<code>View</code>ã€‚è€Œæ ¹<code>View</code>(<code>DevorView</code>)æ˜¯ä¸€ä¸ª<code>ViewGroup</code>ï¼Œæ‰€ä»¥åœ¨<code>ViewGroup</code>çš„<code>dispatchAttachedToWindow</code>åˆä¼šéå†å­<code>View</code>ï¼Œé€šè¿‡è°ƒç”¨å­<code>View</code>çš„<code>dispatchAttachedToWindow</code>å°†<code>mAttachInfo</code>ä¼ é€’ç»™æ¯ä¸ªå­<code>View</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Material Design - Navigation</title>
      <link href="2021/08/28/Material-Design-Navigation/"/>
      <url>2021/08/28/Material-Design-Navigation/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»Androidä¸­çš„åç¨‹</p><a id="more"></a><h1 id="Material-Design"><a href="#Material-Design" class="headerlink" title="Material Design"></a>Material Design</h1><blockquote><p>Material Design - Navigation</p></blockquote><h3 id="Navigationå¯¼èˆªè·³è½¬"><a href="#Navigationå¯¼èˆªè·³è½¬" class="headerlink" title="Navigationå¯¼èˆªè·³è½¬"></a>Navigationå¯¼èˆªè·³è½¬</h3><p>åœ¨ Google I/O 2018 ä¸Šæ–°å‡ºç°äº†ä¸€ä¸ªå¯¼èˆªç»„ä»¶ï¼ˆNavigation Architecture Componentï¼‰ï¼Œå¯¼èˆªç»„ä»¶ç±»ä¼¼iOSå¼€å‘é‡Œçš„StoryBoardï¼Œå¯ä»¥å¯è§†åŒ–çš„ç¼–è¾‘Appé¡µé¢çš„å¯¼èˆªå…³ç³»ã€‚</p><h4 id="Navigationä¾èµ–"><a href="#Navigationä¾èµ–" class="headerlink" title="Navigationä¾èµ–"></a>Navigationä¾èµ–</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;androidx.navigation:navigation-fragment-ktx:2.3.0&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;androidx.navigation:navigation-ui-ktx:2.3.0&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="Navigationä½¿ç”¨"><a href="#Navigationä½¿ç”¨" class="headerlink" title="Navigationä½¿ç”¨"></a>Navigationä½¿ç”¨</h4><ol><li><p>å…ˆåˆ›å»º2ä¸ª<code>Fragment</code>ï¼Œç”¨äºå¯¼èˆªè·³è½¬</p><h5 id="FragmentA"><a href="#FragmentA" class="headerlink" title="FragmentA"></a>FragmentA</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FragmentA</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding: FragmentABinding <span class="keyword">by</span> lazy &#123; FragmentABinding.inflate(layoutInflater) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View &#123;</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/button&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;æŒ‰é’®&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>FragmentA</code>é‡Œé¢ä¹Ÿå°±åªæ˜¯æ”¾äº†ä¸ª<code>Button</code>ç”¨äºè·³è½¬</p><h5 id="FragmentB"><a href="#FragmentB" class="headerlink" title="FragmentB"></a>FragmentB</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FragmentB</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding: FragmentBBinding <span class="keyword">by</span> lazy &#123; FragmentBBinding.inflate(layoutInflater) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¸ƒå±€-1"><a href="#å¸ƒå±€-1" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">com.google.android.material.card.MaterialCardView</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:transitionName</span>=<span class="string">&quot;fragmentB&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/med_title&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;30dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">&quot;@color/black&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;20sp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textStyle</span>=<span class="string">&quot;bold&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:text</span>=<span class="string">&quot;æ ‡é¢˜&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/mad_author&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginEnd</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@string/ma_author&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">&quot;@color/black&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;15sp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@+id/med_title&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/mad_text&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">&quot;@dimen/dp_10&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginRight</span>=<span class="string">&quot;@dimen/dp_10&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@string/mad_text&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">&quot;@color/black&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;18sp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@+id/mad_author&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">com.google.android.material.card.MaterialCardView</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>FragmentB</code>è¿™é‡Œå°±æ”¾äº†å‡ ä¸ª<code>TextView</code>ã€‚ç›¸å½“äºæ˜¯è¯¦æƒ…é¡µï¼Œæ–¹ä¾¿åé¢è¿›è¡Œæ›´æ”¹</p></li><li><p>åœ¨<code>res</code>æ–‡ä»¶ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>navigation</code>çš„æ–‡ä»¶å¤¹</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210817140632663.png" alt="image-20210817140632663"></p></li><li><p>åœ¨<code>navigation</code>æ–‡ä»¶å¤¹ä¸‹åœ¨åˆ›å»ºä¸€ä¸ªåä¸º<code>navigation_graph</code>çš„xmlæ–‡ä»¶</p></li><li><p>åˆ›å»ºå®Œæˆä¹‹åï¼Œæ‰“å¼€<code>navigation_graph</code></p><p>åœ¨xmlæ–‡ä»¶ä¸­ç‚¹å‡»å³ä¸Šè§’çš„Designåˆ‡æ¢é¡µé¢</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210817141242213.png" alt="image-20210817141242213"></p><p>ä¹‹åå°±å¯ä»¥é€šè¿‡é¼ æ ‡ç‚¹å‡»æ¥æ“ä½œäº†ï¼Œéå¸¸ç®€å•</p><p>åœ¨ç‚¹å‡»xmlæ–‡ä»¶ä¸­å·¦ä¸Šè§’çš„+å·ï¼Œå°†åˆšåˆšåˆ›å»ºçš„2ä¸ª<code>Fragment</code>æ‹–è¿›æ¥ï¼Œä¹‹åçš„æ ·å­ä¼šæ˜¯å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210817141752272.png" alt="image-20210817141752272"></p><p>å½“ç„¶ä½ ä»¬è‚¯å®šæ˜¯è¿˜æ²¡æœ‰è¿çº¿çš„ï¼Œæ¥ä¸‹æ¥å°±å°†å®ƒä»¬è”ç³»èµ·æ¥</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210817141910247.png" alt="image-20210817141910247"></p><p>é€‰ä¸­å³è¾¹çš„ä¸€ä¾§ï¼Œæ‹–è‡³å¦ä¸€ä¸ªFrag<code>m</code>entï¼Œå°±è”ç³»ä¸Šäº†</p><p>æœ€ååœ¨<code>xml</code>æ–‡ä»¶çš„<code>Split</code>ä»£ç é¡µé¢ä¸­ï¼Œç»™ç¬¬ä¸€è¡Œçš„<code>navigation</code>æ·»åŠ ä¸Šå¼€å§‹é¡µé¢</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/navigation_graph&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">&quot;@id/homeFragment&quot;</span>&gt;</span> //ã€Š---è¿™é‡Œ</span><br><span class="line">    </span><br><span class="line">    ....</span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨<code>MainActivity</code>çš„<code>xml</code>ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª<code>FragmentContainerView</code>ï¼Œå°†ä¸Šé¢åˆ›å»ºå¥½çš„<code>navigation</code>æ·»åŠ ä¸Šå»</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.coordinatorlayout.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.fragment.app.FragmentContainerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/fragmentA&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:defaultNavHost</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:navGraph</span>=<span class="string">&quot;@navigation/navigation_graph&quot;</span> /&gt;</span> //ã€Š--è¿™é‡Œ</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.coordinatorlayout.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>NavHostFragmentæ˜¯å¯¼èˆªè§†å›¾çš„å±•ç¤ºå®¹å™¨(nameä¸ºå›ºå®šå†™æ³•ï¼Œå¿…é¡»æŒ‡æ˜ä¸º)</p><p>defaultNavHostå­—æ®µè¡¨ç¤ºæ˜¯å¦æ‹¦æˆªè¿”å›æŒ‰é”®æ“ä½œ(è‹¥ä¸ºtrueï¼Œéœ€è¦çš„Activityä¸­é‡å†™onSupportNavigateUpæ–¹æ³•ã€‚ å› ä¸ºé»˜è®¤æƒ…å†µä¸‹è¿”å›é”®æ˜¯ä¸ä¼šå›é€€fragmenté¡µé¢çš„)</p></blockquote></li><li><p>å°±å¤§åŠŸå‘Šæˆæ‹‰ï¼Œæ‰“å¼€è½¯ä»¶ï¼Œå…ˆæ˜¯ä¼šæ˜¾ç¤º<code>FragmentA</code>ã€‚ä½ å¯ä»¥åœ¨<code>FragmentA</code>ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œé€šè¿‡å¦‚ä¸‹ä»£ç è¿›è¡Œè·³è½¬</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">button.setOnClickListener &#123;</span><br><span class="line">    Navigation.findNavController(it).navigate(R.id.action_fragmentA_to_fragmentB)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„R.id.action_fragmentA_to_fragmentBæ˜¯åˆšæ‰navigationä¸­FragmentAçš„actionå®šä¹‰çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/action_fragmentA_to_fragmentB&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:destination</span>=<span class="string">&quot;@id/fragmentBB&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></blockquote><p>é€šè¿‡æŒ‡å®š<code>action</code>çš„<code>id</code>æ¥å‘Šè¯‰<code>Navigation</code>è·³è½¬çš„é€»è¾‘ã€‚å…¶ä»–é¡µé¢ä¹Ÿæ˜¯ä¸€æ ·</p></li></ol><h3 id="Materalå…±äº«å±æ€§åŠ¨ç”»"><a href="#Materalå…±äº«å±æ€§åŠ¨ç”»" class="headerlink" title="Materalå…±äº«å±æ€§åŠ¨ç”»"></a>Materalå…±äº«å±æ€§åŠ¨ç”»</h3><p>æ¥ä¸‹æ¥æ‰æ˜¯é‡ç‚¹ï¼Œåœ¨<code>Materal Design</code>ä¸­æä¾›äº†å®¹å™¨å˜æ¢ã€å…±äº«è½´æ¨¡å¼ã€æ·¡å‡ºæ·¡å…¥ã€å¼¹å‡ºè¿™äº›è½¬åœºæ¨¡å¼</p><p>è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨<code>navigaion</code>+å®¹å™¨å˜æ¢æ¥å®ç°éå¸¸ç‚«é…·çš„è½¬åœºåŠ¨ç”»</p><h4 id="Materalä¾èµ–"><a href="#Materalä¾èµ–" class="headerlink" title="Materalä¾èµ–"></a>Materalä¾èµ–</h4><p><code>Materal</code>åŠ¨ç”»æ˜¯éœ€è¦<code>Materal</code>ä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.google.android.material:material:1.4.0&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="Materalè½¬åœºåŠ¨ç”»ä½¿ç”¨"><a href="#Materalè½¬åœºåŠ¨ç”»ä½¿ç”¨" class="headerlink" title="Materalè½¬åœºåŠ¨ç”»ä½¿ç”¨"></a>Materalè½¬åœºåŠ¨ç”»ä½¿ç”¨</h4><p>æˆ‘ä»¬æ¥ç€ä¸Šé¢çš„é¡¹ç›®ç»§ç»­æ›´æ”¹</p><ol><li><p>å°†<code>FragmentA</code>ç»§ç»­å®Œå–„</p><p>å°†<code>FragmentA</code>çš„å¸ƒå±€æ”¹ä¸º<code>RecyclerView</code>ï¼Œåšæˆåˆ—è¡¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.recyclerview.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/ma_list&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ <code>navigation</code>æ’ä»¶</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;kotlin-android&#x27;</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;androidx.navigation.safeargs.kotlin&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>å®Œå–„<code>FragmentA</code>ä»£ç (å…³äºé€‚é…å™¨çš„å†…å®¹ï¼Œæˆ‘å°±ä¸ä»‹ç»äº†ï¼Œå°±åªæ˜¯åšä¸ªåˆ—è¡¨å‡ºæ¥ç”¨äºè·³è½¬è€Œå·²)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FragmentA</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding: FragmentABinding <span class="keyword">by</span> lazy &#123; FragmentABinding.inflate(layoutInflater) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> adapter: MaterialAdapter <span class="keyword">by</span> lazy &#123; MaterialAdapter() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View &#123;</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        enterTransition = MaterialFadeThrough().apply &#123;</span><br><span class="line">            duration = <span class="number">300</span>.toLong() <span class="comment">// è®¾ç½®è¿‡åº¦æ—¶é—´</span></span><br><span class="line">        &#125;</span><br><span class="line">        binding.maList.run &#123;<span class="comment">// æ­£å¸¸çš„è®¾ç½®é€‚é…å™¨</span></span><br><span class="line">            adapter = <span class="keyword">this</span><span class="symbol">@FragmentA</span>.adapter</span><br><span class="line">            layoutManager = LinearLayoutManager(context)</span><br><span class="line">        &#125;</span><br><span class="line">        adapter.run &#123;<span class="comment">// é€‚é…å™¨çš„ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">            addChildClickViewIds(R.id.ma_root)</span><br><span class="line">            setOnItemChildClickListener &#123; adapter, view, position -&gt;</span><br><span class="line">                <span class="keyword">val</span> transitionName = <span class="string">&quot;fragmentB&quot;</span><span class="comment">// å…±äº«å…ƒç´ çš„Transitionåç§°</span></span><br><span class="line">                <span class="keyword">val</span> extras = FragmentNavigatorExtras(view to transitionName)</span><br><span class="line">                <span class="keyword">val</span> directions =</span><br><span class="line">                    FragmentADirections.actionFragmentAToFragmentB((adapter.<span class="keyword">data</span>[position] <span class="keyword">as</span> <span class="built_in">Int</span>).toLong())</span><br><span class="line">                <span class="keyword">val</span> navHostFragment =</span><br><span class="line">                    activity?.supportFragmentManager?.findFragmentById(R.id.fragmentA) <span class="keyword">as</span> NavHostFragment</span><br><span class="line">                <span class="keyword">val</span> navController = navHostFragment.navController</span><br><span class="line">                navController.navigate(directions, extras)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        adapter.setList(arrayListOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>enterTransitionï¼šè¿›å…¥åˆ«çš„åœºæ™¯æ—¶çš„è¿‡åº¦</p><p>FragmentNavigatorExtrasï¼šä½¿ç”¨ç»™å®šçš„å…±äº«å…ƒç´ å®ä¾‹ </p><p>directionsï¼šåŠ¨ä½œï¼Œå°±æ˜¯è¡¨æ˜è¦è·³åˆ°å“ªé‡Œ</p><p>findNavController()ï¼šæ‰©å±•å‡½æ•°ï¼Œç”¨äºè·å–NavController</p></blockquote></li><li><p><code>FragmentB</code>ä»£ç éƒ¨åˆ†</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FragmentB</span> : <span class="type">Fragment</span></span>()&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        sharedElementEnterTransition = MaterialContainerTransform().apply &#123;</span><br><span class="line">            <span class="comment">//  drawingViewId æ˜¯è§†å›¾çš„ idï¼Œåœ¨å…¶ä¸Šæ–¹ï¼Œå®¹å™¨å˜æ¢å°†åœ¨ z è½´ç©ºé—´è¿›è¡Œ</span></span><br><span class="line">            drawingViewId = R.id.fragmentA</span><br><span class="line">            duration = resources.getInteger(R.integer.reply_motion_duration_large).toLong()</span><br><span class="line">            <span class="comment">// ç”±äºæˆ‘ä»¬ä¹Ÿæƒ³å°†åˆ—è¡¨é¡µé¢é€šè¿‡åŠ¨ç”»è½¬æ¢å‡ºè§†å›¾ï¼Œæ‰€ä»¥å°† scrimColor è®¾ç½®ä¸ºé€æ˜</span></span><br><span class="line">            scrimColor = Color.TRANSPARENT</span><br><span class="line">            setAllContainerColors(requireActivity().themeColor(R.attr.colorSurface))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>sharedElementEnterTransitionï¼šè®¾ç½®å°†ç”¨äºå…±äº«å…ƒç´ è½¬ç§»åˆ°å†…å®¹åœºæ™¯çš„è¿‡æ¸¡</p><p>è¿™é‡Œçš„R.id.fragmentAæ˜¯MainActivityå¸ƒå±€ä¸­çš„FragmentContainerView</p></blockquote></li><li><p>ä¹‹åå°±å¯ä»¥å¯åŠ¨çœ‹ä¸€ä¸‹æ•ˆæœäº†ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œæ•ˆæœä¼šäºä¸‹å›¾ä¸€è‡´(Gifå›¾çš„é€Ÿåº¦ä¼šè¿‡å¿«)</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/Material.gif" alt="Material"></p><p>å®˜æ–¹æ•ˆæœ</p><p><img src="https://codelabs.developers.google.com/codelabs/material-motion-android/img/9df2b39d5a150418.gif" alt="9df2b39d5a150418.gif"></p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Material </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Androidæ¨é€åŸç†</title>
      <link href="2021/08/28/Android%E6%8E%A8%E9%80%81%E5%8E%9F%E7%90%86/"/>
      <url>2021/08/28/Android%E6%8E%A8%E9%80%81%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>è¿™é‡Œå°†ä¼šä»‹ç»Androidä¸Šçš„æ¨é€åŸç†</p><a id="more"></a><h1 id="Androidæ¨é€åŸç†"><a href="#Androidæ¨é€åŸç†" class="headerlink" title="Androidæ¨é€åŸç†"></a>Androidæ¨é€åŸç†</h1><blockquote><p>è¿™é‡Œå°†ä¼šä»‹ç»Androidä¸Šçš„æ¨é€åŸç†</p></blockquote><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>åœ¨ç”¨æˆ·æœªæ‰“å¼€æˆ–æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨çš„å‘ç”¨æˆ·æ¨é€æœåŠ¡å™¨æœ€æ–°æ¶ˆæ¯</p><h2 id="ç³»ç»Ÿçº§åˆ«çš„æ¨é€"><a href="#ç³»ç»Ÿçº§åˆ«çš„æ¨é€" class="headerlink" title="ç³»ç»Ÿçº§åˆ«çš„æ¨é€"></a>ç³»ç»Ÿçº§åˆ«çš„æ¨é€</h2><p>ç³»ç»Ÿçº§åˆ«çš„æ¨é€å°±ä»£è¡¨ç€ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥è¿›è¡Œæ¨é€ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒä¼šè¢«ç³»ç»Ÿæ€æ­»</p><h3 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h3><h4 id="C2DM"><a href="#C2DM" class="headerlink" title="C2DM"></a>C2DM</h4><p>å…¨ç§°ï¼šCloud to Device Messaging äº‘ç«¯æ¨é€</p><p>è¿™ä¸ªæ˜¯åŸºäºPushæ–¹æ³•è¿›è¡Œè·å–æ¶ˆæ¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´C2DMæœåŠ¡è´Ÿè´£å¤„ç†ä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—ç­‰äº‹åŠ¡ï¼Œå¹¶å‘è¿è¡Œè®¾å¤‡çš„åº”ç”¨å‘é€è¿™äº›æ¶ˆæ¯</p><p><img src="https://upload-images.jianshu.io/upload_images/8421477-0402b7d5bc3096cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/593/format/webp"></p><blockquote><p>è¿™å¼ å›¾ç½‘ä¸Šå…¨éƒ½æ˜¯ğŸ˜“</p></blockquote><ul><li><p>ä¼˜ç‚¹</p><p>C2DMæä¾›äº†ä¸€ä¸ªç®€å•çš„ã€è½»é‡çº§çš„æœºåˆ¶ï¼Œå…è®¸æœåŠ¡å™¨å¯ä»¥é€šçŸ¥ç§»åŠ¨åº”ç”¨ç¨‹åºç›´æ¥ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œä»¥ä¾¿äºä»æœåŠ¡å™¨è·å–åº”ç”¨ç¨‹åºæ›´æ–°å’Œç”¨æˆ·æ•°æ®</p></li><li><p>ç¼ºç‚¹</p><p>ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦ä¾èµ–äºGoogleæœåŠ¡ï¼Œä½†æ˜¯å›½å†…å¤§éƒ¨åˆ†çš„æœºå‹éƒ½é˜‰å‰²äº†GoogleæœåŠ¡ï¼Œè¿™å°±å¯¼è‡´æ— æ³•ä½¿ç”¨ï¼Œå¹¶ä¸”è¿æ¥ä¸ŠGoogleè¿˜éœ€è¦è¿›è¡Œç½‘ç»œä»£ç†</p></li></ul><h2 id="æ¨é€çš„å‡ ç§æ–¹å¼"><a href="#æ¨é€çš„å‡ ç§æ–¹å¼" class="headerlink" title="æ¨é€çš„å‡ ç§æ–¹å¼"></a>æ¨é€çš„å‡ ç§æ–¹å¼</h2><h3 id="Push"><a href="#Push" class="headerlink" title="Push"></a>Push</h3><p>ä»å­—é¢æ„æ€å°±å¯ä»¥çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ç§æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯è¿›è¡Œå‘é€æ¶ˆæ¯çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯ä¹‹é—´ä¼šç»´æŠ¤ä¸€ä¸ªé•¿è¿æ¥</p><h3 id="Pull"><a href="#Pull" class="headerlink" title="Pull"></a>Pull</h3><p>è¿™æ˜¯ä¸€ç§ç”±å®¢æˆ·ç«¯ä¸»åŠ¨å‘æœåŠ¡ç«¯è¯·æ±‚æ¶ˆæ¯çš„æ¨¡å¼</p><ul><li>ç¼ºç‚¹<ol><li>æˆæœ¬å¤§ï¼Œéœ€è¦è‡ªå·±å®ç°ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œä¾‹å¦‚æ¶ˆæ¯æ’é˜Ÿç­‰ï¼›</li><li>å®¢æˆ·ç«¯ä¸­éœ€è¦ä¸€ç›´ä¿æŒç€è¯·æ±‚æœåŠ¡çš„å­˜æ´»ï¼Œå¹¶ä¸”è¿˜è¦é—´éš”ä¸€å®šæ—¶é—´å°±è¦å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚æ¶ˆæ¯ï¼Œè¿™æ ·ä¹Ÿä¼šå¯¼è‡´æ¶ˆæ¯ä¸èƒ½åŠæ—¶åˆ°è¾¾</li></ol></li></ul><h3 id="SMS"><a href="#SMS" class="headerlink" title="SMS"></a>SMS</h3><p>è¿™ç§æ¨¡å¼æ˜¯åŸºäºPushçš„æ–¹å¼ï¼Œå¦‚æœæœåŠ¡ç«¯ä¸Šæœ‰æ–°çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ä¼šå‘é€ä¸€ä¸ªç±»ä¼¼äºçŸ­ä¿¡çš„ä¿¡ä»¤åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥å—åˆ°ä¿¡ä»¤ä¹‹åï¼Œå°±ä¼šä¸»åŠ¨å‘æœåŠ¡ç«¯è¯·æ±‚æ¶ˆæ¯</p><ul><li>ä¼˜ç‚¹<ol><li>å®¢æˆ·ç«¯æ¶ˆè€—å°</li><li>å¯å®ç°å®Œå…¨çš„å®æ—¶æ“ä½œ</li></ol></li><li>ç¼ºç‚¹<ol><li>æˆæœ¬è¾ƒé«˜ï¼Œå› ä¸ºç›®å‰æ¥è¯´ï¼Œå¾ˆéš¾æ‰¾åˆ°å…è´¹çš„çŸ­æ¶ˆæ¯å‘é€ç½‘å…³æ¥å®ç°è¿™ç§æ–¹æ¡ˆï¼Œåªèƒ½é€šè¿‡å‘è¿è¥å•†ç¼´çº³ç›¸åº”çš„çŸ­ä¿¡è´¹ç”¨</li></ol></li></ul><h2 id="æ¨é€çš„è®¾è®¡"><a href="#æ¨é€çš„è®¾è®¡" class="headerlink" title="æ¨é€çš„è®¾è®¡"></a>æ¨é€çš„è®¾è®¡</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿›è¡Œæ¨é€æœ€å¥½çš„æ–¹å¼å°±æ˜¯ï¼šç§»åŠ¨ç½‘ç»œé•¿è¿æ¥(Push)ã€‚å› ä¸ºæ‰‹æœºå¹³å°æœ¬èº«çš„ç‰¹ç‚¹ï¼Œç”µé‡ã€ç½‘ç»œã€æµé‡çš„é™åˆ¶ç§»åŠ¨äº’è”ç½‘åº”ç”¨åœ¨è®¾è®¡ä¸Šè·Ÿä¼ ç»ŸPC ä¸Šçš„åº”ç”¨å¾ˆå¤§ä¸ä¸€æ ·ã€‚æ‰€ä»¥éœ€è¦æ ¹æ®æ‰‹æœºå¹³å°çš„ç‰¹ç‚¹ï¼Œå°½é‡èŠ‚çœæµé‡ã€ç”µé‡ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯æ•°æ®èƒ½åŠæ—¶çš„åˆ°è¾¾å®¢æˆ·ç«¯ã€‚åœ¨æ‰‹æœºå¹³å°ä¸Šï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰å¦‚ä¸‹2ç§</p><h3 id="å®šæ—¶æŸ¥è¯¢"><a href="#å®šæ—¶æŸ¥è¯¢" class="headerlink" title="å®šæ—¶æŸ¥è¯¢"></a>å®šæ—¶æŸ¥è¯¢</h3><p>è¿™ç§å°±æ˜¯ä¸Šé¢æ¨é€æ–¹æ³•æ‰€è®²çš„Pullï¼Œåœ¨æ€§èƒ½ã€ç”µé‡ç­‰å„æ–¹é¢æ¥è¯´éƒ½æ˜¯ä½¿ç”¨å®æ—¶æ¨é€(Push)ä¼šæ›´å¥½ä¸€ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸ç€é‡è®²è§£</p><h3 id="å®æ—¶æ¨é€"><a href="#å®æ—¶æ¨é€" class="headerlink" title="å®æ—¶æ¨é€"></a>å®æ—¶æ¨é€</h3><p>è¿™ç§å°±æ˜¯æ‰‹æœºå’ŒæœåŠ¡ç«¯ä¹‹é—´ç»´æŠ¤ä¸€ä¸ªTCPé•¿è¿æ¥ï¼Œå½“æœåŠ¡ç«¯æœ‰æ–°æ•°æ®çš„æ—¶å€™ï¼Œå°±å®æ—¶æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚ä½†æ˜¯Pushçš„å®ç°å’Œç»´æŠ¤æˆæœ¬éƒ½ä¼šæ¯”è¾ƒé«˜ï¼Œåœ¨ç§»åŠ¨ç½‘ç»œä¸‹é•¿è¿æ¥çš„ç»´æŠ¤ï¼Œç›¸å¯¹ä¹Ÿæœ‰ä¸€äº›æŠ€æœ¯ä¸Šçš„éš¾åº¦ã€‚ä¸‹é¢å°±æ¥è®²è®²ç§»åŠ¨ç½‘ç»œä¸‹é•¿è¿æ¥çš„ç»´æŠ¤</p><p><img src="https://img-blog.csdnimg.cn/20200826193844584.png#pic_center"></p><h4 id="ç§»åŠ¨ç½‘ç»œé•¿è¿æ¥"><a href="#ç§»åŠ¨ç½‘ç»œé•¿è¿æ¥" class="headerlink" title="ç§»åŠ¨ç½‘ç»œé•¿è¿æ¥"></a>ç§»åŠ¨ç½‘ç»œé•¿è¿æ¥</h4><p>è¿™é‡Œå°±å…ˆè¦è®²ä¸€ä¸‹ç§»åŠ¨ç½‘ç»œçš„ç‰¹ç‚¹</p><h5 id="ç§»åŠ¨ç½‘ç»œ"><a href="#ç§»åŠ¨ç½‘ç»œ" class="headerlink" title="ç§»åŠ¨ç½‘ç»œ"></a>ç§»åŠ¨ç½‘ç»œ</h5><p>ç°åœ¨ç»å¤§å¤šæ•°çš„IPåœ°å€åº”è¯¥éƒ½è¿˜æ˜¯IPV4ï¼Œä½†æ˜¯IPV4çš„IPæ•°é‡æœ‰é™ï¼Œè¿è¥å•†åˆ†é…ç»™æ‰‹æœºçš„çš„IPæ˜¯è¿è¥å•†å†…ç½‘çš„IPï¼Œæ‰‹æœºæƒ³è¦è®¿é—®äº’è”ç½‘ï¼Œå°±å¿…é¡»å¾—å…ˆé€šè¿‡è¿è¥å•†çš„ç½‘å…³ï¼Œå»åšä¸€ä¸ªç½‘ç»œåœ°å€è½¬æ¢ã€‚ç®€å•æ¥è¯´å°±æ˜¯è¿è¥å•†çš„ç½‘å…³éœ€è¦ç»´æŠ¤ä¸€ä¸ªå¤–ç½‘IPã€ç«¯å£å†…ç½‘IPã€ç«¯å£å¯¹åº”çš„å…³ç³»ï¼Œä»¥ç¡®ä¿å†…ç½‘ä¸­çš„æ‰‹æœºå¯ä»¥éšæ—¶çš„ä¸äº’è”ç½‘çš„æœåŠ¡å™¨é€šä¿¡</p><p><img src="https://img-blog.csdnimg.cn/20190409151034430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjcyNDQ2Nw==,size_16,color_FFFFFF,t_70"></p><p>ä½†æ˜¯å¤§éƒ¨åˆ†ç§»åŠ¨æ— çº¿ç½‘ç»œè¿è¥å•†éƒ½åœ¨é“¾è·¯ä¸€æ®µæ—¶é—´æ²¡æœ‰æ•°æ®é€šè®¯æ—¶ï¼Œä¼šæ·˜æ±°NAT è¡¨ä¸­çš„å¯¹åº”é¡¹ï¼Œé€ æˆé“¾è·¯ä¸­æ–­ã€‚æ‰€ä»¥è¯´è¦æƒ³ç»´æŠ¤å¥½é•¿è¿æ¥å°±å¾—é¿å…é“¾è·¯ä¸­æ–­</p><blockquote><p>NATè¡¨ï¼šNATæ˜ å°„è¡¨å­˜åœ¨åœ¨è·¯ç”±å™¨é‡Œé¢ï¼Œå®ç°çš„æ˜¯ç§æœ‰IPä¸å…¬æœ‰IPä¹‹é—´çš„è½¬æ¢ï¼›å®é™…ä¸Šå¯èƒ½æ˜¯ä½ å®¶ä¸€å°è·¯ç”±å™¨æ‹¥æœ‰ä¸€ä¸ªå…¬ç½‘IPï¼Œè€Œæ‰€æœ‰è¿åœ¨è¿™å°è·¯ç”±å™¨ä¸Šçš„æ‰€æœ‰è®¾å¤‡éƒ½å…±äº«ä¸€ä¸ªå…¬ç½‘IP</p></blockquote><h4 id="å®¢æˆ·ç«¯é•¿è¿æ¥çš„ç»´æŠ¤"><a href="#å®¢æˆ·ç«¯é•¿è¿æ¥çš„ç»´æŠ¤" class="headerlink" title="å®¢æˆ·ç«¯é•¿è¿æ¥çš„ç»´æŠ¤"></a>å®¢æˆ·ç«¯é•¿è¿æ¥çš„ç»´æŠ¤</h4><p>ä¸ºäº†ä¸è®©NATé“¾è·¯ä¸­æ–­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šæ—¶å‘é€å¿ƒè·³åŒ…ï¼Œæ¥åˆ·æ–°NATè¡¨é¡¹ï¼Œé˜²æ­¢æ·˜æ±°ã€‚åœ¨Androidä¸Šå®šæ—¶è¿è¡Œä»»åŠ¡çš„å¸¸ç”¨æ–¹æ³•æœ‰å¦‚ä¸‹ä¸¤ç§</p><h5 id="Timter-å…¶ä»–è®¡æ—¶å™¨çš„å®ç°"><a href="#Timter-å…¶ä»–è®¡æ—¶å™¨çš„å®ç°" class="headerlink" title="Timter/å…¶ä»–è®¡æ—¶å™¨çš„å®ç°"></a>Timter/å…¶ä»–è®¡æ—¶å™¨çš„å®ç°</h5><p>Timeterç±»å¯ä»¥ç”¨æ¥æ‰§è¡Œéœ€è¦å¾ªç¯æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä½†æ˜¯Timeteræœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å®ƒæ˜¯éœ€è¦ä½¿ç”¨WakeLockæ¥ä¿æŒCPUçš„å”¤é†’ï¼Œè¿™æ ·ä¼šå¤§é‡æ¶ˆè€—æ‰‹æœºç”µé‡ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•ä¸å¤ªå¯è¡Œã€‚å…¶ä»–è®¡æ—¶å™¨çš„å®ç°ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¯”å¦‚è¯´æ˜¯é€šè¿‡Whileå’ŒThread.sleepæ¥å®ç°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PushService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> url = <span class="string">&quot;ä½ è¯·æ±‚çš„ç½‘ç»œåœ°å€&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> pushThread: PushThread <span class="keyword">by</span> lazy &#123; PushThread() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        pushThread.start()</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>?)</span></span>: IBinder? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">PushThread</span> : <span class="type">Thread</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10000</span>)</span><br><span class="line">                <span class="comment">// TODO</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°±æ˜¯é€šè¿‡å¼€å¯äº†ä¸ªServiceï¼Œåœ¨onCreateä¸­å¼€å¯äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ä¸­æ¯éš”10ç§’å‘æœåŠ¡å™¨å‘é€ä¸€æ¬¡è¯·æ±‚</p><h5 id="AlarmManager"><a href="#AlarmManager" class="headerlink" title="AlarmManager"></a>AlarmManager</h5><p>è€ŒAlarmManageræ˜¯Androidç³»ç»Ÿå°è£…çš„ç”¨äºç®¡ç†RTCæ¨¡å—ï¼ŒRTC(Real Time Clock)æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ—¶é’Ÿï¼Œåœ¨CPUå¤„äºä¼‘çœ çŠ¶æ€ä¸‹ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œåœ¨é¢„å®šæ—¶é—´åˆ°è¾¾æ—¶ï¼Œä¼šä¸­æ–­CPUä¼‘çœ ï¼Œå”¤é†’CPUã€‚è¿™ä¸æ˜¯å®Œç¾ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸå—ï¼Œæ²¡è¾¾åˆ°é¢„å®šæ—¶é—´çš„æ—¶å€™CPUæ­£å¸¸ä¼‘çœ ï¼Œåˆ°è¾¾æ—¶é—´åˆ™å”¤é†’å·¥ä½œï¼Œè¿™æ ·ä¸€æ¥æ‰‹æœºçš„è€—ç”µé‡é—®é¢˜ä¹Ÿå¾—åˆ°äº†æ”¹å–„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PushManager</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> context: Context) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mAlarmMgr: AlarmManager <span class="keyword">by</span> lazy &#123; context.getSystemService(Context.ALARM_SERVICE) <span class="keyword">as</span> AlarmManager &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startRequest</span><span class="params">()</span></span> &#123;</span><br><span class="line">        cancelRequestAlarm()</span><br><span class="line">        mAlarmMgr.setRepeating(</span><br><span class="line">            AlarmManager.RTC_WAKEUP,</span><br><span class="line">            System.currentTimeMillis() + <span class="number">1000</span>,</span><br><span class="line">            <span class="number">10000</span>,</span><br><span class="line">            getOperationIntent()</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">cancelRequest</span><span class="params">()</span></span> &#123;</span><br><span class="line">        mAlarmMgr.cancel(getOperationIntent())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€å¹¿æ’­çš„æ„å›¾</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getOperationIntent</span><span class="params">()</span></span>: PendingIntent &#123;</span><br><span class="line">        <span class="keyword">val</span> intent = Intent()</span><br><span class="line">        intent.action = <span class="string">&quot;push&quot;</span></span><br><span class="line">        <span class="keyword">return</span> PendingIntent.getBroadcast(context, <span class="number">0</span>, intent, PendingIntent.FLAG_UPDATE_CURRENT)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AlarmManageræ˜¯ç³»ç»ŸæœåŠ¡ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ä¸€èˆ¬çš„æ„é€ æ–¹æ³•å»æ„é€ ï¼Œå¯ä»¥ä½¿ç”¨getSystemService()æ¥è·å–ç³»ç»Ÿçº§åˆ«çš„æœåŠ¡</p><p>æ¥ä¸‹æ¥æˆ‘å†™äº†ä¸€ä¸ªå‘èµ·è¯·æ±‚çš„æ–¹æ³•ï¼Œå†…éƒ¨æ˜¯é€šè¿‡PendingIententå»é€šçŸ¥å¹¿æ’­ï¼Œå…·ä½“çš„è¯·æ±‚åº”è¯¥åœ¨å¹¿æ’­ä¸­å¤„ç†</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">startRequest</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cancelRequestAlarm()</span><br><span class="line">    mAlarmMgr.setRepeating(</span><br><span class="line">        AlarmManager.RTC_WAKEUP,</span><br><span class="line">        System.currentTimeMillis() + <span class="number">1000</span>,</span><br><span class="line">        <span class="number">10000</span>,</span><br><span class="line">        getOperationIntent()</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡Œé¢è°ƒç”¨äº†AlarmManagerè®¾ç½®é‡å¤æ‰§è¡Œå®šæ—¶ä»»åŠ¡setRepeating()ï¼ŒsetRepeating()æ¥æ”¶4ä¸ªå‚æ•°</p><table><thead><tr><th>å‚æ•°</th><th>å±æ€§</th></tr></thead><tbody><tr><td>ç¬¬ä¸€ä¸ªå‚æ•°æ ‡è¯†é—¹é’Ÿç±»å‹</td><td>AlarmManager.ELAPSED_REALTIME_WAKEUP(ä»æ‰‹æœºå¼€æœºåçš„æ—¶é—´ï¼ŒåŒ…å«äº†æ‰‹æœºç¡çœ æ—¶é—´)/AlarmManager.RTC_WAKEUP(ä½¿ç”¨ç³»ç»Ÿè®¾ç½®ä¸­çš„æ—¶é—´)</td></tr><tr><td>ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºä»»åŠ¡çš„é¦–æ¬¡æ‰§è¡Œæ—¶é—´</td><td>è¿™é‡Œå°±ä¸ç¬¬ä¸€ä¸ªå‚æ•°ç›¸å…³äº†ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºAlarmManager.ELAPSED_REALTIME_WAKEUPï¼Œé‚£ä¹ˆå½“å‰æ—¶é—´å°±ä¸ºSystemClock.elapsedRealtime()ã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºAlarmManager.RTC_WAKEUPï¼Œé‚£ä¹ˆå½“å‰æ—¶é—´å°±ä¸ºSystem.currentTimeMillis()</td></tr><tr><td>ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºä¸¤æ¬¡ä»»åŠ¡æ‰§è¡Œçš„é—´éš”</td><td>ä¼ å…¥ä½ æƒ³è¦çš„é—´éš”æ—¶é—´</td></tr><tr><td>ç¬¬å››ä¸ªå‚æ•°ä¸ºå¯¹åº”çš„ç›¸åº”æ“ä½œ</td><td>ä¸€èˆ¬è¿™é‡Œéƒ½æ˜¯å»å‘é€å¹¿æ’­ï¼Œç„¶ååœ¨å¹¿æ’­ä¸­æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å½“ç„¶ä¹Ÿå¯ä»¥getActivity()ã€getService()</td></tr></tbody></table><p>è¿™æ ·å°±å¯ä»¥æœ€å¤§ç¨‹åº¦ä¸Šå¯ä»¥è§£å†³ç”µé‡æ¶ˆè€—é—®é¢˜å’Œå®šæ—¶å™¨è¢«ç³»ç»Ÿå›æ”¶é—®é¢˜</p><p>è‡³äºç”µé‡æ¶ˆè€—é—®é¢˜è¿˜å¯ä»¥è¿›ä¸€æ­¥çš„è§£å†³ï¼Œå¯ä»¥æ‰§è¡Œä¸€äº›ç­–ç•¥</p><ul><li>åœ¨ç§»åŠ¨ç½‘ç»œä¸‹æ¯éš”5åˆ†é’Ÿå»è¯·æ±‚ä¸€æ¬¡ä¿¡æ¯</li><li>åœ¨Wifiæƒ…å†µä¸‹æ¯éš”2åˆ†é’Ÿå»è¯·æ±‚ä¸€æ¬¡ä¿¡æ¯</li><li>åœ¨ç†„å±æƒ…å†µä¸‹åœæ­¢è¯·æ±‚</li><li>ç†„å±ä¸€åˆ†é’Ÿåˆ™æ€æ­»æ¨é€è¿›ç¨‹</li></ul><h2 id="æ¨é€æœåŠ¡æŒä¹…åŒ–"><a href="#æ¨é€æœåŠ¡æŒä¹…åŒ–" class="headerlink" title="æ¨é€æœåŠ¡æŒä¹…åŒ–"></a>æ¨é€æœåŠ¡æŒä¹…åŒ–</h2><p>æ¯”å¦‚è¯´æˆ‘ä»¬çš„æ¨é€ç›¸å…³çš„æœåŠ¡æ˜¯åœ¨Serviceä¸Šï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¦‚ä½•é˜²æ­¢ç”¨æˆ·åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹æˆ–è€…ç³»ç»Ÿæœ¬èº«çš„æ¸…ç†åå°æ€æ­»è¿›ç¨‹å‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±å¯ä»¥ç”¨åˆ°Androidä¸­çš„ActivityManagerå†…éƒ¨ç±»RunningAppProcessInfo</p><h3 id="RunningAppProcessInfo"><a href="#RunningAppProcessInfo" class="headerlink" title="RunningAppProcessInfo"></a>RunningAppProcessInfo</h3><p>RunningAppProcessInfoæ˜¯ç”¨æ¥è®°å½•å½“å‰ç³»ç»Ÿä¸­è¿›ç¨‹çŠ¶æ€çš„ç±»ï¼Œä¸‹é¢è®²ä»‹ç»ä¸€äº›å¸¸ç”¨å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this is a persistent process.</span></span><br><span class="line"><span class="comment"> * Only used when reporting to process observers.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_PERSISTENT = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this process is running the</span></span><br><span class="line"><span class="comment"> * foreground UI.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_FOREGROUND = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this process is running something</span></span><br><span class="line"><span class="comment"> * that is actively visible to the user, though not in the immediate</span></span><br><span class="line"><span class="comment"> * foreground.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_VISIBLE = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this process is running something</span></span><br><span class="line"><span class="comment"> * that is considered to be actively perceptible to the user.  An</span></span><br><span class="line"><span class="comment"> * example would be an application performing background music playback.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_PERCEPTIBLE = <span class="number">130</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this process is running an</span></span><br><span class="line"><span class="comment"> * application that can not save its state, and thus can&#x27;t be killed</span></span><br><span class="line"><span class="comment"> * while in the background.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_CANT_SAVE_STATE = <span class="number">170</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this process is contains services</span></span><br><span class="line"><span class="comment"> * that should remain running.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_SERVICE = <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this process process contains</span></span><br><span class="line"><span class="comment"> * background code that is expendable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_BACKGROUND = <span class="number">400</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constant for &#123;<span class="doctag">@link</span> #importance&#125;: this process is empty of any</span></span><br><span class="line"><span class="comment"> * actively running code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMPORTANCE_EMPTY = <span class="number">500</span>;</span><br></pre></td></tr></table></figure><ul><li><p>ä¸€èˆ¬æ•°å€¼å¤§äºIMPORTANCE_SERVICE(300)çš„è¿›ç¨‹éƒ½è¡¨ç¤ºç€ï¼Œå·²ç»é•¿æ—¶é—´æ²¡ç”¨ï¼Œæˆ–è€…ä¸ºç©ºäº†</p></li><li><p>ä¸€èˆ¬æ•°å€¼å¤§äºIMPORTANCE_VISIBLE(200)çš„è¿›ç¨‹éƒ½æ˜¯éå¯è§è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯åœ¨åå°è¿è¡Œäº†</p></li></ul><p>å¤§å¤šæ•°ç¬¬ä¸‰æ–¹çš„æ¸…ç†è½¯ä»¶éƒ½æ˜¯æ¸…ç†å¤§äºIMPORTANCE_VISIBLEçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æˆ‘ä»¬è¿›ç¨‹çš„å€¼å°äºIMPORTANCE_VISIBLE(200)ï¼Œå°±ä¸ä¼šè¢«æ¸…ç†è½¯ä»¶æ¸…ç†æ‰ã€‚åœ¨Serivceä¸­ï¼Œæœ‰ä¸€ä¸ªæ–¹æ³•å«startForeground()è¿™ä¸ªæ–¹æ³•çš„åªç”¨æ˜¯ä»¥å¯è§è¿›ç¨‹çš„æ¨¡å¼å¯åŠ¨Serivce(ä¹Ÿå°±æ˜¯è¿›ç¨‹å€¼ä¼šå°äº200)ã€‚ä½†æ˜¯è¿™æ ·ä¼šåœ¨è®¾å¤‡é€šçŸ¥æ æŒç»­æ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥ï¼Œåˆ«æ€¥è¿™ä¹Ÿæœ‰è§£å†³åŠæ³•ï¼Œåªéœ€è¦è®²idä¼ ä¸º0å³å¯é¿å…æ˜¾ç¤ºé€šçŸ¥ã€‚ç›¸åº”çš„æƒ³è¦å…³é—­Serviceä¹Ÿå¾—ç”¨å¯¹åº”çš„stopForgeround()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#Service</span><br><span class="line"><span class="comment">//å¦‚æœä½ çš„æœåŠ¡å·²ç»å¯åŠ¨(é€šè¿‡&#123;@link Context#startService(Intent)&#125;è¿è¡Œ)ï¼Œé‚£ä¹ˆ  </span></span><br><span class="line"><span class="comment">//è¿˜å¯ä»¥è®©è¿™ä¸ªæœåŠ¡åœ¨å‰å°è¿è¡Œï¼Œæä¾›æ­£åœ¨è¿›è¡Œçš„  </span></span><br><span class="line"><span class="comment">//åœ¨æ­¤çŠ¶æ€ä¸‹æ˜¾ç¤ºç»™ç”¨æˆ·çš„é€šçŸ¥ã€‚  </span></span><br><span class="line"><span class="comment">//é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯åŠ¨çš„æœåŠ¡æ˜¯åå°çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„è¿›ç¨‹ä¸ä¼šè¢«ç»™å‡º  </span></span><br><span class="line"><span class="comment">//å‰å°CPUè°ƒåº¦(é™¤éè¯¥è¿›ç¨‹ä¸­çš„å…¶ä»–ä¸œè¥¿æ˜¯å‰å°çš„)ï¼Œ  </span></span><br><span class="line"><span class="comment">//å¦‚æœç³»ç»Ÿéœ€è¦æ€æ­»å®ƒä»¬æ¥å›æ”¶æ›´å¤šçš„å†…å­˜(ä¾‹å¦‚åœ¨  </span></span><br><span class="line"><span class="comment">//ç½‘ç»œæµè§ˆå™¨)ï¼Œå®ƒä»¬å¯ä»¥è¢«æ€æ­»è€Œä¸ä¼šé€ æˆå¤ªå¤§çš„ä¼¤å®³ã€‚</span></span><br><span class="line">startForeground()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> æ¨é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Material Design - MaterialShapeDrawable</title>
      <link href="2021/08/28/Material-Design-MaterialShapeDrawable/"/>
      <url>2021/08/28/Material-Design-MaterialShapeDrawable/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»Material Designä¸‹çš„MaterialShapeDrawable</p><a id="more"></a><h1 id="Material-Design"><a href="#Material-Design" class="headerlink" title="Material Design"></a>Material Design</h1><blockquote><p>Material Design - MaterialShapeDrawable</p></blockquote><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&quot;com.google.android.material:material:1.3.0&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><blockquote><p>Googleä»‹ç»ï¼šæè´¨å½¢çŠ¶çš„åŸºæœ¬å¯ç»˜åˆ¶ç±»ï¼Œç”¨äºå¤„ç†ç”Ÿæˆè·¯å¾„çš„é˜´å½±ã€é«˜åº¦ã€æ¯”ä¾‹å’Œé¢œè‰²ã€‚</p></blockquote><p>æˆ‘çš„ç†è§£å°±æ˜¯å¯åŠ¨æ€æ”¹å˜Drawableçš„ç»˜åˆ¶è·¯å¾„</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol><li><p>åˆ›å»ºä¸€ä¸ªMaterialShapeDrawable</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> backgroundShapeDrawable: MaterialShapeDrawable <span class="keyword">by</span> lazy(LazyThreadSafetyMode.NONE) &#123;</span><br><span class="line">        MaterialShapeDrawable(<span class="keyword">this</span>,<span class="literal">null</span>,R.attr.bottomSheetStyle,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MaterialShapeDrawable()çš„æ„é€ å‡½æ•°æ¥æ”¶4ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºContextã€ç¬¬äºŒä¸ªä¸ºattrsèµ„æºå±æ€§æ–‡ä»¶ã€ç¬¬ä¸‰ä¸ªä¸ºdefStyleAttræ ·å¼ã€ç¬¬å››ä¸ªä¸ºdefStyleRes</p></li><li><p>è®¾ç½®Drawableå†…å®¹</p><p>MaterialShapeDrawableåˆ›å»ºå®Œäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹å°±è¦è®¾ç½®æ¥é‡Œé¢çš„Drawableçš„å†…å®¹äº†</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> foregroundShapeDrawable: MaterialShapeDrawable <span class="keyword">by</span> lazy(LazyThreadSafetyMode.NONE) &#123;</span><br><span class="line">        MaterialShapeDrawable(</span><br><span class="line">            <span class="keyword">this</span>,</span><br><span class="line">            <span class="literal">null</span>,</span><br><span class="line">            R.attr.bottomSheetStyle,</span><br><span class="line">            <span class="number">0</span></span><br><span class="line">        ).apply &#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®å¡«å……é¢œè‰²</span></span><br><span class="line">            fillColor = ColorStateList.valueOf(</span><br><span class="line">                ContextCompat.getColor(</span><br><span class="line">                    <span class="keyword">this</span><span class="symbol">@ListScalingActivity</span>,</span><br><span class="line">                    R.color.gray</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">// è®¾ç½®é˜´å½±å¤§å°</span></span><br><span class="line">            elevation = dpToPixel(<span class="number">16f</span>)</span><br><span class="line">            <span class="comment">// æ˜¯å¦å¯ç”¨å‡é˜´å½±</span></span><br><span class="line">            shadowCompatibilityMode = MaterialShapeDrawable.SHADOW_COMPAT_MODE_NEVER</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–Drawableå åŠ åŠŸèƒ½</span></span><br><span class="line">            initializeElevationOverlay(<span class="keyword">this</span><span class="symbol">@ListScalingActivity</span>)</span><br><span class="line">            <span class="comment">// è®¾ç½®Drawableçš„ç»˜åˆ¶è·¯å¾„</span></span><br><span class="line">            shapeAppearanceModel = shapeAppearanceModel.toBuilder()</span><br><span class="line">                .setTopEdge(<span class="comment">// åœ¨è¾¹ç¼˜å¤„ç†</span></span><br><span class="line">                    SemiCircleEdgeCutoutTreatment(<span class="comment">// ç»˜åˆ¶ä¸€ä¸ªåœ†å½¢</span></span><br><span class="line">                        dpToPixel(<span class="number">8f</span>),</span><br><span class="line">                        dpToPixel(<span class="number">24f</span>),<span class="comment">// åŠå¾„</span></span><br><span class="line">                        <span class="number">0F</span>,<span class="comment">// åœ†å½¢çš„ä½ç½®</span></span><br><span class="line">                        dpToPixel(<span class="number">32f</span>)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                .build()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä¸ºäº†æ–¹ä¾¿è®¾ç½®å±æ€§ï¼Œä½¿ç”¨äº†applyæ‰©å±•å‡½æ•°</p><blockquote><p>fillColorï¼šå¡«å……èƒŒæ™¯çš„é¢œè‰²</p><p>elevationï¼šé˜´å½±é«˜åº¦</p><p>dpToPixelï¼šè¿™ä¸ªæ˜¯æ‰©å±•å‡½æ•°ï¼Œç”¨äºå°†pxè½¬æ¢ä¸ºdp</p><p>shapeAppearanceModelï¼šDrawableç»˜åˆ¶è·¯å¾„</p><p>initializeElevationOverlay()ï¼šåˆå§‹åŒ–Drawableçš„å åŠ åŠŸèƒ½</p><p>shapeAppearanceModel.setTopEdge()ï¼šåœ¨é¡¶éƒ¨è¾¹ç¼˜ä¸Šè¿›è¡Œå¤„ç†</p><p>SemiCircleEdgeCutoutTreatment()ï¼šåœ¨è¾¹ç¼˜ä¸Šçš„ä»»æ„ä¸€ä¸ªåœ°æ–¹ç»˜åˆ¶ä¸€ä¸ªåœ†å½¢</p></blockquote></li><li><p>è®¾ç½®å®Œæˆä¹‹ååœ¨æ·»åŠ ç»™æ§ä»¶</p><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210817105344089.png" alt="image-20210817105344089"></p><p>å°†ä¼šå¾—åˆ°ä¸€ä¸ªä¸­é—´ä¸‹å‡¹çš„èƒŒæ™¯(æˆ‘åœ¨ä¸­é—´åŠ å…¥äº†ä¸€å¼ å›¾ç‰‡)</p></li><li><p>åŠ¨æ€æ”¹å˜</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>MaterialShapeDrawable.interpolation()</code>æ–¹æ³•æ¥è¿˜åŸ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foregroundShapeDrawable.interpolation = progress</span><br></pre></td></tr></table></figure><p><code>MaterialShapeDrawable.interpolation()</code>æ–¹æ³•è¡¨ç¤ºè®¾ç½®è·¯å¾„çš„æ’å€¼ï¼Œä»‹äº0-1ä¹‹é—´ï¼Œ1è¡¨ç¤ºä¸€ä¸ªå®Œå…¨æ¸²æŸ“çš„è·¯å¾„ï¼Œ0è¡¨ç¤ºä¸€ä¸ªå®Œæ•´ä¿®å¤çš„è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯æ˜¯0è¡¨ç¤ºä¸å˜ï¼Œ1è¡¨ç¤ºæ¢å¤åŸçŠ¶</p><p>ç„¶åå¯ä»¥é€šè¿‡ç›‘å¬æ»‘åŠ¨å€¼æ¥è¿›è¡ŒåŠ¨æ€æ›´æ”¹</p></li><li><p>å°†ä¼šå¾—åˆ°å¦‚ä¸‹æ•ˆæœ</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/MaterialShapeDrawable.gif" alt="MaterialShapeDrawable">è¿™é‡Œçš„æ•ˆæœæ˜¯é€šè¿‡<code>BottomSheetBehavior</code>+<code>MaterialShapeDrawable</code>+å›¾ç‰‡ç¼©æ”¾è¾¾æˆçš„ï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœéå¸¸ä¸é”™</p><p>å¦‚æœæƒ³è¦äº†è§£ä½¿ç”¨<code>BottomSheetBehavior</code>é‚£ä¹ˆå¯ä»¥å»çœ‹çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <code>Material Design - BottomSheetBehavior</code></p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Material </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Material Design - BottomSheetBehavior</title>
      <link href="2021/08/28/Material-Design-BottomSheetBehavior/"/>
      <url>2021/08/28/Material-Design-BottomSheetBehavior/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»Material Designä¸‹çš„BottomSheetBehavior</p><a id="more"></a><h1 id="Material-Design"><a href="#Material-Design" class="headerlink" title="Material Design"></a>Material Design</h1><blockquote><p>Material Design - BottomSheetBehavior</p></blockquote><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><p>BottomSheetBehavioræ˜¯åœ¨Design23.3æ¨å‡ºçš„åº•éƒ¨åŠ¨ä½œæ¡ï¼Œæ‰€ä»¥è¯´ï¼Œæƒ³è¦ç”¨ä¸ŠBottomSheetBehavioré‚£ä¹ˆå°±è¦ä¿è¯designä¾èµ–åœ¨23.3æˆ–è€…ä»¥ä¸Š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.android.support:design:26.0.0-alpha1&#x27;</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶Androidxä¹Ÿæ˜¯å¯ä»¥çš„</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;androidx.appcompat:appcompat:1.2.0&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h3><p>BottomSheetBehaviorä¸æ˜¯ä¸€ä¸ªæ§ä»¶(View)è€Œæ˜¯ä¸€ä¸ªæ˜¾ç¤ºæ§åˆ¶å™¨</p><p>åªéœ€è¦åœ¨Xmlä¸­ï¼Œå¾€éœ€è¦çš„Viewä¸­æ·»åŠ <code>app:layout_behavior=&quot;@string/bottom_sheet_behavior&quot;</code>ï¼Œç„¶åé€šè¿‡æ§åˆ¶BottomSheetBehaviorçš„çŠ¶æ€æ¥æ§åˆ¶æ˜¾ç¤º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/background_container&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:behavior_halfExpandedRatio</span>=<span class="string">&quot;0.5&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:behavior_hideable</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:behavior_skipCollapsed</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">&quot;@string/bottom_sheet_behavior&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¸ƒå±€å±æ€§"><a href="#å¸ƒå±€å±æ€§" class="headerlink" title="å¸ƒå±€å±æ€§"></a>å¸ƒå±€å±æ€§</h4><ol><li><p>behavior_halfExpandedRatio:</p><p>è®¾ç½®å±•å¼€çš„é«˜åº¦å çˆ¶ç±»é«˜åº¦çš„æ¯”ä¾‹ï¼Œæ¯”ä¾‹èŒƒå›´ä»‹äº0-1ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œè®¾ç½®ä¸º0.5å°±è¡¨ç¤ºç€BottomSheetBehaviorå±•å¼€åå çˆ¶ç±»é«˜åº¦çš„50%ï¼Œä¹Ÿå°±æ˜¯ä¸€åŠ</p></li><li><p>behavior_hideable:</p><p>è®¾ç½®BottomSheetBehavioræ˜¯å¦å¯ä»¥é€šè¿‡å‘ä¸‹æ‹–åŠ¨æ¥è¿›è¡Œéšè—ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾ä¸­çš„æ•ˆæœ</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/BottomSheetBehavior.gif" alt="BottomSheetBehavior"></p></li></ol><ol start="3"><li><p>behavior_skipCollapsed</p><p>è®¾ç½®BottomSheetBehaviorä¸€æ—¦å±•å¼€å°±è·³è¿‡æŠ˜å çŠ¶æ€ï¼Œè·³è¿‡è¿‡åº¦æ•ˆæœã€‚é™¤éå®ƒæ˜¯å¯éšè—çš„</p></li></ol><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol><li><p>å…ˆç»™æƒ³è¦æˆä¸ºBottomSheetBehaviorçš„Viewæ·»åŠ ä¸Š<code>app:layout_behavior</code></p></li><li><p>åœ¨ä»£ç ä¸­è¿›è¡Œè·å–</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> behavior: BottomSheetBehavior&lt;FrameLayout&gt; <span class="keyword">by</span> lazy(LazyThreadSafetyMode.NONE) &#123;</span><br><span class="line">        BottomSheetBehavior.from(binding.backgroundContainer)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ä½¿ç”¨äº†BottomSheetBehavior.from()æ¥å°†Viewå…³è”èµ·æ¥çš„</p></li><li><p>é€šè¿‡æ§BottomSheetBehaviorçš„çŠ¶æ€æ¥æ§åˆ¶æ˜¯å¦å±•å¼€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">behavior.state &#x3D; BottomSheetBehavior.STATE_HALF_EXPANDED</span><br></pre></td></tr></table></figure><p>BottomSheetBehaviorçš„çŠ¶æ€ç å¦‚ä¸‹</p><table><thead><tr><th>çŠ¶æ€ç </th><th>çŠ¶æ€æ•ˆæœ</th></tr></thead><tbody><tr><td>STATE_DRAGGING</td><td>æŒ‡BottomSheetå¤„äºè¢«æ‰‹æŒ‡æ‹–ç€</td></tr><tr><td>STATE_SETTLING</td><td>æŒ‡BottomSheetå¤„äºæ­£åœ¨æŠ˜å çš„è¿‡ç¨‹ä¸­</td></tr><tr><td>STATE_EXPANDED</td><td>æŒ‡BottomSheetå¤„äºå±•å¼€çš„çŠ¶æ€</td></tr><tr><td>STATE_COLLAPSED</td><td>æŒ‡BottomSheetå¤„äºæŠ˜å çš„çŠ¶æ€</td></tr><tr><td>STATE_HIDDEN</td><td>æŒ‡BottomSheetå¤„äºéšè—çš„çŠ¶æ€</td></tr><tr><td>STATE_HALF_EXPANDED</td><td>æŒ‡BottomSheetæ˜¯åŠå±•å¼€çš„(å½“mFitToContentsä¸ºfalseæ—¶ä½¿ç”¨)</td></tr></tbody></table></li><li><p>ä¹‹åBottomSheetBehaviorå°±ä¼šæ ¹æ®ç°åœ¨çš„çŠ¶æ€æ¥è‡ªåŠ¨çš„æ›´æ”¹UI</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Material </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Glideæºç å‰–æ-load</title>
      <link href="2021/08/28/Glide%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-load/"/>
      <url>2021/08/28/Glide%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-load/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†åˆ†ææºç Glide.load()æ–¹æ³•</p><a id="more"></a><h1 id="Glideæºç å‰–æ-load"><a href="#Glideæºç å‰–æ-load" class="headerlink" title="Glideæºç å‰–æ-load"></a>Glideæºç å‰–æ-load</h1><blockquote><p>å°†åˆ†ææºç Glide.load()</p></blockquote><h2 id="load"><a href="#load" class="headerlink" title="load()"></a>load()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(<span class="keyword">this</span>).load(<span class="string">&quot;å›¾ç‰‡èµ„æº&quot;</span>)</span><br></pre></td></tr></table></figure><p>load()ä¸€å…±æœ‰9ä¸ªé‡è½½æ–¹æ³•ï¼Œéƒ½è¿”å›<code>RequestBuilder&lt;Drawable&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> Object model)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> Bitmap bitmap)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> Drawable drawable)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> String string)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> Uri uri)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> File file)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@RawRes</span> <span class="meta">@DrawableRes</span> <span class="meta">@Nullable</span> Integer resourceId)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> URL url)</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> <span class="keyword">byte</span>[] model)</span></span></span><br></pre></td></tr></table></figure><p>è¿™äº›é‡è½½æ–¹æ³•å†…éƒ¨éƒ½ä¼šè°ƒç”¨<code>asDrawable().load()</code>ï¼Œè¿™é‡Œå°±æ‹¿æœ€å¸¸ç”¨çš„<code>load(String string)</code>æ¥ä½œä¸ºä¾‹å­</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹<code>asDrawable()</code></p><h3 id="asDrawable"><a href="#asDrawable" class="headerlink" title="asDrawable()"></a>asDrawable()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#RequestManager</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@CheckResult</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestBuilder&lt;Drawable&gt; <span class="title">asDrawable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> as(Drawable.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@CheckResult</span></span><br><span class="line"><span class="keyword">public</span> &lt;ResourceType&gt; <span class="function">RequestBuilder&lt;ResourceType&gt; <span class="title">as</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Class&lt;ResourceType&gt; resourceClass)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RequestBuilder&lt;&gt;(glide, <span class="keyword">this</span>, resourceClass, context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°±æ˜¯é€šè¿‡ä½¿ç”¨ä¼ é€’è¿›æ¥çš„å‚æ•°æ¥åˆ›å»ºä¸€ä¸ªRequestBuilder()ï¼Œæ‰€ä»¥<code>asDrawable()</code>æ–¹æ³•æœ€ç»ˆåˆ›å»ºäº† RequestBuilder çš„å®ä¾‹å¹¶è¿”å›ï¼ŒæŸ¥çœ‹RequestBuilderçš„æ„é€ å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="title">RequestBuilder</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@NonNull</span> Glide glide,</span></span></span><br><span class="line"><span class="function"><span class="params">      RequestManager requestManager,</span></span></span><br><span class="line"><span class="function"><span class="params">      Class&lt;TranscodeType&gt; transcodeClass,</span></span></span><br><span class="line"><span class="function"><span class="params">      Context context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.glide = glide;</span><br><span class="line">    <span class="keyword">this</span>.requestManager = requestManager;</span><br><span class="line">    <span class="keyword">this</span>.transcodeClass = transcodeClass;</span><br><span class="line">    <span class="keyword">this</span>.context = context;</span><br><span class="line">    <span class="keyword">this</span>.transitionOptions = requestManager.getDefaultTransitionOptions(transcodeClass);</span><br><span class="line">    <span class="keyword">this</span>.glideContext = glide.getGlideContext();</span><br><span class="line"></span><br><span class="line">    initRequestListeners(requestManager.getDefaultRequestListeners());</span><br><span class="line">    apply(requestManager.getDefaultRequestOptions());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°é‡Œä¹Ÿæ˜¯å°†å‚æ•°èµ‹å€¼ç»™äº†ä¸€äº›å¸¸é‡ï¼Œä¹‹ååˆå§‹åŒ–äº†è¯·æ±‚ç›‘å¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initRequestListeners(requestManager.getDefaultRequestListeners());</span><br></pre></td></tr></table></figure><p>æœ€åè°ƒç”¨äº†apply()å°†é»˜è®¤é€‰æ‹©åº”ç”¨äºè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="meta">@CheckResult</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RequestBuilder&lt;TranscodeType&gt; <span class="title">apply</span><span class="params">(<span class="meta">@NonNull</span> BaseRequestOptions&lt;?&gt; requestOptions)</span> </span>&#123;</span><br><span class="line">    Preconditions.checkNotNull(requestOptions);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.apply(requestOptions);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆå°‘ï¼Œå°±æ‰§è¡Œäº†ä¸¤ä¸ªæ“ä½œã€‚å…ˆåˆ¤æ–­ä¼ å…¥åŠæ‹¿æ¥çš„Optionsæ˜¯å¦æ˜¯ä¸ºç©ºï¼Œå…¶æ¬¡è°ƒç”¨çˆ¶ç±»çš„applyï¼Œå°†Optionsä¼ å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">#BaseRequestOptions</span><br><span class="line">  <span class="function"><span class="keyword">public</span> T <span class="title">apply</span><span class="params">(<span class="meta">@NonNull</span> BaseRequestOptions&lt;?&gt; o)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬ä¸Šå°±æ˜¯è®¾ç½®ä¸€äº›é»˜è®¤é…ç½®é¡¹</span></span><br><span class="line">    <span class="keyword">if</span> (isAutoCloneEnabled) &#123;</span><br><span class="line">      <span class="keyword">return</span> clone().apply(o);</span><br><span class="line">    &#125;</span><br><span class="line">    BaseRequestOptions&lt;?&gt; other = o;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, SIZE_MULTIPLIER)) &#123;</span><br><span class="line">      sizeMultiplier = other.sizeMultiplier;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, USE_UNLIMITED_SOURCE_GENERATORS_POOL)) &#123;</span><br><span class="line">      useUnlimitedSourceGeneratorsPool = other.useUnlimitedSourceGeneratorsPool;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, USE_ANIMATION_POOL)) &#123;</span><br><span class="line">      useAnimationPool = other.useAnimationPool;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, DISK_CACHE_STRATEGY)) &#123;</span><br><span class="line">      diskCacheStrategy = other.diskCacheStrategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, PRIORITY)) &#123;</span><br><span class="line">      priority = other.priority;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, ERROR_PLACEHOLDER)) &#123;</span><br><span class="line">      errorPlaceholder = other.errorPlaceholder;</span><br><span class="line">      errorId = <span class="number">0</span>;</span><br><span class="line">      fields &amp;= ~ERROR_ID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, ERROR_ID)) &#123;</span><br><span class="line">      errorId = other.errorId;</span><br><span class="line">      errorPlaceholder = <span class="keyword">null</span>;</span><br><span class="line">      fields &amp;= ~ERROR_PLACEHOLDER;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, PLACEHOLDER)) &#123;</span><br><span class="line">      placeholderDrawable = other.placeholderDrawable;</span><br><span class="line">      placeholderId = <span class="number">0</span>;</span><br><span class="line">      fields &amp;= ~PLACEHOLDER_ID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, PLACEHOLDER_ID)) &#123;</span><br><span class="line">      placeholderId = other.placeholderId;</span><br><span class="line">      placeholderDrawable = <span class="keyword">null</span>;</span><br><span class="line">      fields &amp;= ~PLACEHOLDER;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, IS_CACHEABLE)) &#123;</span><br><span class="line">      isCacheable = other.isCacheable;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, OVERRIDE)) &#123;</span><br><span class="line">      overrideWidth = other.overrideWidth;</span><br><span class="line">      overrideHeight = other.overrideHeight;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, SIGNATURE)) &#123;</span><br><span class="line">      signature = other.signature;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, RESOURCE_CLASS)) &#123;</span><br><span class="line">      resourceClass = other.resourceClass;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, FALLBACK)) &#123;</span><br><span class="line">      fallbackDrawable = other.fallbackDrawable;</span><br><span class="line">      fallbackId = <span class="number">0</span>;</span><br><span class="line">      fields &amp;= ~FALLBACK_ID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, FALLBACK_ID)) &#123;</span><br><span class="line">      fallbackId = other.fallbackId;</span><br><span class="line">      fallbackDrawable = <span class="keyword">null</span>;</span><br><span class="line">      fields &amp;= ~FALLBACK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, THEME)) &#123;</span><br><span class="line">      theme = other.theme;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, TRANSFORMATION_ALLOWED)) &#123;</span><br><span class="line">      isTransformationAllowed = other.isTransformationAllowed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, TRANSFORMATION_REQUIRED)) &#123;</span><br><span class="line">      isTransformationRequired = other.isTransformationRequired;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, TRANSFORMATION)) &#123;</span><br><span class="line">      transformations.putAll(other.transformations);</span><br><span class="line">      isScaleOnlyOrNoTransform = other.isScaleOnlyOrNoTransform;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isSet(other.fields, ONLY_RETRIEVE_FROM_CACHE)) &#123;</span><br><span class="line">      onlyRetrieveFromCache = other.onlyRetrieveFromCache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Applying options with dontTransform() is expected to clear our transformations.</span></span><br><span class="line">    <span class="keyword">if</span> (!isTransformationAllowed) &#123;</span><br><span class="line">      transformations.clear();</span><br><span class="line">      fields &amp;= ~TRANSFORMATION;</span><br><span class="line">      isTransformationRequired = <span class="keyword">false</span>;</span><br><span class="line">      fields &amp;= ~TRANSFORMATION_REQUIRED;</span><br><span class="line">      isScaleOnlyOrNoTransform = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fields |= other.fields;</span><br><span class="line">    options.putAll(other.options);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> selfOrThrowIfLocked();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>isSet()ï¼šå°†ä¸¤ä¸ªIntç±»å‹å‚æ•°è¿›è¡Œä¸è¿ç®—ã€‚ï¼ˆå°±æ˜¯æ¯”è¾ƒäºŒè¿›åˆ¶æ•°ï¼Œæ˜¯1ä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSet</span><span class="params">(<span class="keyword">int</span> fields, <span class="keyword">int</span> flag)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> (fields &amp; flag) != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸Šé¢åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨é…ç½®é…ç½®é¡¹ï¼ŒåŒ…æ‹¬ç£ç›˜ç¼“å­˜ç­–ç•¥ï¼ŒåŠ è½½ä¸­çš„å ä½å›¾ï¼ŒåŠ è½½å¤±è´¥çš„å ä½å›¾ç­‰ã€‚ åˆ°è¿™é‡Œ asDrawable() æ–¹æ³•å®Œæˆäº†ã€‚æ¥ä¸‹æ¥æŸ¥çœ‹loadéƒ¨åˆ†</p><h3 id="asDrawable-load"><a href="#asDrawable-load" class="headerlink" title="asDrawable().load()"></a>asDrawable().load()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@CheckResult</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RequestBuilder&lt;TranscodeType&gt; <span class="title">load</span><span class="params">(<span class="meta">@Nullable</span> String string)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> loadGeneric(string);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é‡Œé¢ä¹Ÿå°±è°ƒç”¨äº†loadGeneric()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> RequestBuilder&lt;TranscodeType&gt; <span class="title">loadGeneric</span><span class="params">(<span class="meta">@Nullable</span> Object model)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isAutoCloneEnabled()) &#123;</span><br><span class="line">      <span class="keyword">return</span> clone().loadGeneric(model);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.model = model;</span><br><span class="line">    isModelSet = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> selfOrThrowIfLocked();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol><li><p>å…ˆåˆ¤æ–­éœ€ä¸éœ€è¦è¿›è¡Œå…‹éš†ï¼Œéœ€è¦çš„è¯åˆ™ä¼šå°†å…‹éš†ä¸€ä¸ªRequestBuilderï¼ŒåŒ…æ‹¬ç›®å‰ä¸ºæ­¢çš„æ‰€æœ‰é…ç½®é¡¹</p><blockquote><p>è¿”å›æ­¤è¯·æ±‚ç”Ÿæˆå™¨çš„å‰¯æœ¬ï¼Œå…¶ä¸­åŒ…å«åˆ°ç›®å‰ä¸ºæ­¢åœ¨æ­¤ç”Ÿæˆå™¨ä¸Šæ”¾ç½®çš„æ‰€æœ‰é€‰é¡¹ã€‚  </p><p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªâ€œæ·±åº¦â€å‰¯æœ¬ï¼Œå…¶ä¸­æ‰€æœ‰éä¸å¯å˜å‚æ•°éƒ½è¢«å¤åˆ¶ï¼Œè¿™æ ·å¯¹ä¸€ä¸ªæ„å»ºå™¨çš„æ›´æ”¹ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ªæ„å»ºå™¨ã€‚ ç„¶è€Œï¼Œé™¤äº†ä¸å¯å˜å‚æ•°å¤–ï¼Œå½“å‰æ¨¡å‹ä¸ä¼šè¢«å¤åˆ¶ï¼Œå› æ­¤å¯¹æ¨¡å‹çš„æ›´æ”¹å°†å½±å“ä¸¤ä¸ªæ„å»ºå™¨ã€‚  </p><p>[^Ps]: ä»¥ä¸Šå†…å®¹æ¥è‡ªæœ‰é“ç¿»è¯‘</p></blockquote></li><li><p>å°†ä¼ å…¥è¿›æ¥çš„å›¾ç‰‡èµ„æºèµ‹å€¼ç»™æˆå‘˜å˜é‡modelï¼Œåœ¨è®¾ç½®isModelSetä¸ºtrueï¼Œä»£è¡¨ç€å·²ç»è®¾ç½®è¿‡äº†</p></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>load()æ–¹æ³•å°±æ¯”è¾ƒç®€å•äº†ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡ä¹‹å‰åˆ›å»ºçš„Glideå’ŒRequestManageræ¥æ„å»ºRequestBuilderï¼Œå°†å‚æ•°èµ‹å€¼ç»™æˆå‘˜å˜é‡modelã€‚è¿˜è¦å°±æ˜¯è®¾ç½®ä¸€äº›é»˜è®¤é…ç½®é¡¹</p>]]></content>
      
      
      
        <tags>
            
            <tag> Glide </tag>
            
            <tag> æºç å‰–æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Glideæºç å‰–æ-with</title>
      <link href="2021/08/28/Glide%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-with/"/>
      <url>2021/08/28/Glide%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-with/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†åˆ†ææºç Glide.with()æ–¹æ³•</p><a id="more"></a><h1 id="Glideæºç å‰–æ-with"><a href="#Glideæºç å‰–æ-with" class="headerlink" title="Glideæºç å‰–æ-with"></a>Glideæºç å‰–æ-with</h1><blockquote><p>å°†åˆ†ææºç Glide.with()</p></blockquote><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>Glide</code>è¿›è¡Œå›¾ç‰‡åŠ è½½æ— éå°±æ˜¯ä¸‹é¢ä¸€å¥è¯</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#Activity</span><br><span class="line">Glide.with(<span class="keyword">this</span>).load(src).into(imageView)</span><br></pre></td></tr></table></figure><p>å¯ä»¥è§å¾—<code>Glide</code>å¸®æˆ‘ä»¬åœ¨èƒŒåå®Œæˆäº†æµ·é‡çš„æ“ä½œï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°†å…ˆæŒ‰ç…§ä½¿ç”¨è€…çš„è§’åº¦æ¥è¿›è¡Œå‰–æ</p><h2 id="with"><a href="#with" class="headerlink" title="with()"></a>with()</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure><p><code>with()</code>æ˜¯<code>Glide</code>ä¸­çš„<strong>ä¸€ç»„é™æ€æ–¹æ³•</strong>ã€‚ä¸ºä»€ä¹ˆè¯´æ˜¯ä¸€ç»„å‘¢ï¼Œå› ä¸ºå®ƒæœ‰å¾ˆå¤šä¸ªé‡è½½æ–¹æ³•ã€‚åœ¨æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æ€§çš„ä¼šå¾€<code>with()</code>é‡Œä¼ é€’<code>Activity</code>ï¼Œæœ‰æ—¶ä¹Ÿä¼šä¼ é€’<code>Fragment</code>ã€‚æ‰€ä»¥<code>Glide.with()</code>æ˜¯ä¸€ç»„é™æ€æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#Glide</span><br><span class="line">...</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestManager <span class="title">with</span><span class="params">(<span class="meta">@NonNull</span> Context context)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getRetriever(context).get(context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestManager <span class="title">with</span><span class="params">(<span class="meta">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getRetriever(activity).get(activity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestManager <span class="title">with</span><span class="params">(<span class="meta">@NonNull</span> FragmentActivity activity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getRetriever(activity).get(activity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestManager <span class="title">with</span><span class="params">(<span class="meta">@NonNull</span> Fragment fragment)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getRetriever(fragment.getContext()).get(fragment);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestManager <span class="title">with</span><span class="params">(<span class="meta">@NonNull</span> android.app.Fragment fragment)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getRetriever(fragment.getActivity()).get(fragment);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestManager <span class="title">with</span><span class="params">(<span class="meta">@NonNull</span> View view)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getRetriever(view.getContext()).get(view);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ˜¯ç²¾ç®€è¿‡ä¹‹åçš„ä»£ç ã€‚å¯ä»¥è§å¾—è™½ç„¶å¾€é‡Œé¢ä¼ é€’äº†ä¸åŒçš„å‚æ•°ï¼Œä½†æœ€ç»ˆéƒ½è¿˜æ˜¯æŒ‡å‘äº†<code>getRetriever().get()</code>ï¼Œé‚£æ¥ä¸‹æ¥å°±å…ˆçœ‹çœ‹<code>getRetriever()</code>æ˜¯ä¸ªä»€ä¹ˆæ–¹æ³•æŠŠ</p><h3 id="getRetriever"><a href="#getRetriever" class="headerlink" title="getRetriever()"></a>getRetriever()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#Glide</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> RequestManagerRetriever <span class="title">getRetriever</span><span class="params">(<span class="meta">@Nullable</span> Context context)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Context could be null for other reasons (ie the user passes in null), but in practice it will</span></span><br><span class="line">    <span class="comment">// only occur due to errors with the Fragment lifecycle.</span></span><br><span class="line">    Preconditions.checkNotNull(</span><br><span class="line">        context,</span><br><span class="line">        <span class="string">&quot;You cannot start a load on a not yet attached View or a Fragment where getActivity() &quot;</span></span><br><span class="line">            + <span class="string">&quot;returns null (which usually occurs when getActivity() is called before the Fragment &quot;</span></span><br><span class="line">            + <span class="string">&quot;is attached or after the Fragment is destroyed).&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Glide.get(context).getRequestManagerRetriever();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>getRetriever()çš„ä»£ç ä¸å¤šã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åˆ†æä»¥ä¸‹</p><ol><li><p>Preconditions.checkNotNull()</p><p>Preconditions.checkNotNull()ï¼šå°±æ˜¯ä¸ªåˆ¤ç©ºå¤„ç†ï¼Œå®ƒæ¥æ”¶2ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯éœ€è¦åˆ¤ç©ºçš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯å¦‚æœä¸ºç©ºåˆ™ä¼šæŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯</p><ul><li>ä½¿ç”¨ä¼˜åŠ¿<ol><li>èŠ‚çœæ—¶é—´</li><li>ç®€å•ä½¿ç”¨ï¼Œå¦‚æœå…¨éƒ¨æ‰‹å†™ï¼Œå¯èƒ½éœ€è¦å†™åå‡ å¤„åˆ¤ç©ºçš„é€»è¾‘,è¿˜è¦å¤„ç†å¼‚å¸¸</li><li>é€‚ç”¨äºç©ºæŒ‡é’ˆå¼‚å¸¸å¤„ç†</li></ol></li></ul></li><li><p>Glide.get().getRequestManagerRetriever()</p><p>è¿™é‡Œå¯ä»¥çœ‹å‡ºå…ˆè°ƒç”¨äº†<code>Glide.get()</code>åœ¨è°ƒç”¨<code>getRequestManagerRetriever</code>()è·å–<code>RequestManagerRetriever</code>å¯¹è±¡ã€‚é‚£ä¹ˆå°±å…ˆçœ‹ä¸€ä¸‹<code>Glide.get()</code>æ–¹æ³•æŠŠ</p><h5 id="Glide-get"><a href="#Glide-get" class="headerlink" title="Glide.get()"></a>Glide.get()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#Glide</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="comment">// Double checked locking is safe here.</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;GuardedBy&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Glide <span class="title">get</span><span class="params">(<span class="meta">@NonNull</span> Context context)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (glide == <span class="keyword">null</span>) &#123;</span><br><span class="line">    GeneratedAppGlideModule annotationGeneratedModule =</span><br><span class="line">        getAnnotationGeneratedGlideModules(context.getApplicationContext());</span><br><span class="line">    <span class="keyword">synchronized</span> (Glide.class) &#123;</span><br><span class="line">      <span class="keyword">if</span> (glide == <span class="keyword">null</span>) &#123;</span><br><span class="line">        checkAndInitializeGlide(context, annotationGeneratedModule);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">return</span> glide;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å•ä¾‹æ¨¡å¼ä¸‹è·å–æœ¬èº«ã€‚è‡³äºæ˜¯å¦‚ä½•è¿›è¡Œæ„é€ çš„æˆ‘ä»¬å…ˆä¸ç”¨ç†ä¼šï¼Œè¿™é‡Œå°±åªç”¨æ˜ç™½å°±æ˜¯è·å–ä¸€ä¸ªè‡ªå·±å‡ºæ¥å³å¯</p><p>é‚£å‰©ä¸‹çš„å°±åªæœ‰<code>getRequestManagerRetriever</code>()äº†</p><h5 id="getRequestManagerRetriever"><a href="#getRequestManagerRetriever" class="headerlink" title="getRequestManagerRetriever()"></a>getRequestManagerRetriever()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#Glide</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RequestManagerRetriever requestManagerRetriever;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RequestManagerRetriever <span class="title">getRequestManagerRetriever</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> requestManagerRetriever;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å•¥ä¹Ÿæ²¡åšï¼Œå°±æ˜¯è¿”å›äº†ä¸ª<code>RequestManagerRetriever</code>å›æ¥ã€‚è‡³äºå®ƒæ˜¯åœ¨å“ªè¢«åˆå§‹åŒ–çš„ï¼Œæˆ‘ä»¬å…ˆä¹Ÿä¸å±•å¼€äº†</p></li></ol><p>å›åˆ°<code>Glide.with()</code>æˆ‘ä»¬æ¢³ç†ä¸€éï¼Œ<code>with()</code>å†…éƒ¨å…ˆè°ƒç”¨äº†<code>getRetriever()</code>å»è·å–<code>RequestManagerRetriever</code>ï¼Œåœ¨è°ƒç”¨äº†<code>.get()</code>æ–¹æ³•ï¼Œç›¸å½“äºæ˜¯ç›´æ¥è°ƒç”¨äº†<code>RequestManagerRetriever.get()</code>æ–¹æ³•ã€‚æ‰€ä»¥è¯´æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨çš„æ˜¯<code>RequestManagerRetriever.get()</code>æ–¹æ³•</p><p>é‚£æˆ‘ä»¬ä¹Ÿå°±åªèƒ½ç»§ç»­å»æŸ¥çœ‹<code>RequestManagerRetriever.get()</code>æ–¹æ³•äº†</p><h3 id="RequestManagerRetriever"><a href="#RequestManagerRetriever" class="headerlink" title="RequestManagerRetriever"></a>RequestManagerRetriever</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#RequestManagerRetriever</span><br><span class="line">...</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestManager <span class="title">get</span><span class="params">(<span class="meta">@NonNull</span> Context context)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (context == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;You cannot start a load on a null Context&quot;</span>);</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦åœ¨ä¸»çº¿ç¨‹ã€åˆ¤æ–­contextæ˜¯å¦æ˜¯Application</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Util.isOnMainThread() &amp;&amp; !(context <span class="keyword">instanceof</span> Application)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (context <span class="keyword">instanceof</span> FragmentActivity) &#123;</span><br><span class="line">      <span class="keyword">return</span> get((FragmentActivity) context);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (context <span class="keyword">instanceof</span> Activity) &#123;</span><br><span class="line">      <span class="keyword">return</span> get((Activity) context);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (context <span class="keyword">instanceof</span> ContextWrapper</span><br><span class="line">        <span class="comment">// Only unwrap a ContextWrapper if the baseContext has a non-null application context.</span></span><br><span class="line">        <span class="comment">// Context#createPackageContext may return a Context without an Application instance,</span></span><br><span class="line">        <span class="comment">// in which case a ContextWrapper may be used to attach one.</span></span><br><span class="line">        &amp;&amp; ((ContextWrapper) context).getBaseContext().getApplicationContext() != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> get(((ContextWrapper) context).getBaseContext());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> getApplicationManager(context);</span><br><span class="line">&#125; </span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªåˆ†æ</p><ol><li><p>æ–¹æ³•ä¸€å¼€å§‹å°±å…ˆè¿›è¡Œäº†åˆ¤ç©ºå¤„ç†</p></li><li><p>ä¹‹åä¼šåˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºä¸»çº¿ç¨‹ä¸­å’Œä¼ å…¥è¿›æ¥çš„<code>context</code>æ˜¯å¦æ˜¯<code>Application</code></p><ul><li>å¦‚æœä»»æ„ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä¼šç›´æ¥è°ƒç”¨getApplicationManager()</li></ul></li><li><p>æ¥ä¸‹å°±åªæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>ç¬¬ä¸€ç§å°±æ˜¯ä¼ å…¥è¿›æ¥çš„contextæ˜¯FragmentActivityï¼Œé‚£ä¹ˆä¼šè¿”å›get((FragmentActivity) context)</li><li>ç¬¬äºŒç§å°±æ˜¯ä¼ å…¥è¿›æ¥çš„contextæ˜¯Activityï¼Œé‚£ä¹ˆä¼šè¿”å›get((Activity) context)</li><li>æœ€åä¸€ç§å°±æ˜¯ä¼ å…¥è¿›æ¥çš„contextæ˜¯å±äºContextWrapperï¼Œé‚£ä¹ˆä¼šè¿”å›get(((ContextWrapper) context).getBaseContext())</li></ul><blockquote><p>ContextWrapperæ˜¯ç»§æ‰¿äºContextï¼Œè€ŒActivityã€Serviceã€Applicationä¹Ÿéƒ½æ˜¯ContextWrapperçš„ç›´æ¥æˆ–é—´æ¥å­ç±»</p></blockquote></li></ol><p>æ‰€ä»¥è¯´<code>RequestManagerRetriever.get()</code>æ–¹æ³•ä¼šæ ¹æ®ä¼ é€’è¿›æ¥çš„<code>context</code>ç±»å‹æ¥è¿”å›ä¸åŒçš„<code>RequestManager</code>ï¼Œé‚£å°±ç»§ç»­çœ‹çœ‹<code>get()</code>æ–¹æ³•æŠŠ</p><h4 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h4><p>è¿™é‡Œå°±å…ˆä»¥å‚æ•°ä¸º<code>FragmentActivity</code>ä½œä¸ºä¾‹å­ï¼Œåˆ«çš„éƒ½å¤§åŒå°å¼‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#RequestManagerRetriever</span><br><span class="line">...</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RequestManager <span class="title">get</span><span class="params">(<span class="meta">@NonNull</span> FragmentActivity activity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (Util.isOnBackgroundThread()) &#123;<span class="comment">// åˆ¤æ–­æ˜¯å¦å¤„äºå­çº¿ç¨‹ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> get(activity.getApplicationContext());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    assertNotDestroyed(activity);<span class="comment">// åˆ¤æ–­ä¼ å…¥çš„Activityæ˜¯å¦è¢«é”€æ¯</span></span><br><span class="line">    frameWaiter.registerSelf(activity);</span><br><span class="line">    FragmentManager fm = activity.getSupportFragmentManager();<span class="comment">// è·å–activityçš„FragmentManager</span></span><br><span class="line">    <span class="keyword">return</span> supportFragmentGet(activity, fm, <span class="comment">/*parentHint=*/</span> <span class="keyword">null</span>, isActivityVisible(activity));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>ä¸€å¼€å§‹å°±ç›´æ¥åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºåå°çº¿ç¨‹ï¼Œæ˜¯çš„è¯å°±ç›´æ¥è¿”å›<code>get(activity.getApplicationContext())</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Util.isOnBackgroundThread()) &#123;</span><br><span class="line">   <span class="keyword">return</span> get(activity.getApplicationContext());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Util.isOnBackgroundThread()ï¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯åå°çº¿ç¨‹ï¼Œæ˜¯è¿”å›trueï¼Œä¸æ˜¯è¿”å›false</p></blockquote></li><li><p>åˆ¤æ–­ä¼ å…¥è¿›æ¥çš„<code>activity</code>æ˜¯å¦å·²ç»è¢«é”€æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assertNotDestroyed(activity);</span><br></pre></td></tr></table></figure><h6 id="assertNotDestroyed"><a href="#assertNotDestroyed" class="headerlink" title="assertNotDestroyed"></a>assertNotDestroyed</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#RequestManagerRetriever</span><br><span class="line">  <span class="meta">@TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR1)</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">assertNotDestroyed</span><span class="params">(<span class="meta">@NonNull</span> Activity activity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1 &amp;&amp; activity.isDestroyed()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;You cannot start a load for a destroyed activity&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å°±åˆ¤æ–­ä¸€ä¸‹å½“å‰çš„SDKæ˜¯å¦å¤§äºç­‰äº17å’Œä¼ å…¥è¿›æ¥çš„<code>activity</code>æ˜¯å¦è¢«é”€æ¯</p><blockquote><p>Build.VERSION_CODES.JELLY_BEAN_MR1ï¼šAPI 17</p></blockquote></li><li><p>è·å–å½“å‰ä¼ å…¥<code>activity</code>çš„<code>FragmentManager</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FragmentManager fm = activity.getSupportFragmentManager();</span><br></pre></td></tr></table></figure></li><li><p>æœ€åè°ƒç”¨<code>supportFragmentGet()</code>ï¼Œè¿”å›<code>RequestManager</code>å‡ºå»ã€‚ğŸ˜”è¿˜æ˜¯å¾—ç»§ç»­çœ‹ä¸‹å»ï¼Œçœ‹çœ‹æ˜¯å¦‚ä½•è¿”å›<code>RequestManager</code></p></li></ol><h5 id="RequestManager"><a href="#RequestManager" class="headerlink" title="RequestManager"></a>RequestManager</h5><p>è¿™é‡Œå°±æ˜¯é‡å¤´æˆäº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#RequestManagerRetriever</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> RequestManager <span class="title">supportFragmentGet</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@NonNull</span> Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@NonNull</span> FragmentManager fm,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@Nullable</span> Fragment parentHint,// æ³¨æ„è¿™é‡Œæ˜¯å¯ä¸ºç©º</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="keyword">boolean</span> isParentVisible)</span> </span>&#123;</span><br><span class="line">    SupportRequestManagerFragment current = getSupportRequestManagerFragment(fm, parentHint);</span><br><span class="line">    RequestManager requestManager = current.getRequestManager();<span class="comment">// è¿™é‡Œä¹Ÿå¯èƒ½ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (requestManager == <span class="keyword">null</span>) &#123; <span class="comment">// å¼€å§‹åˆ¤ç©º</span></span><br><span class="line">      <span class="comment">// TODO(b/27524013): Factor out this Glide.get() call.</span></span><br><span class="line">      Glide glide = Glide.get(context); <span class="comment">// å¼€å§‹æ„å»º</span></span><br><span class="line">      requestManager = factory.build(glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);</span><br><span class="line">      <span class="comment">// This is a bit of hack, we&#x27;re going to start the RequestManager, but not the</span></span><br><span class="line">      <span class="comment">// corresponding Lifecycle. It&#x27;s safe to start the RequestManager, but starting the</span></span><br><span class="line">      <span class="comment">// Lifecycle might trigger memory leaks. See b/154405040</span></span><br><span class="line">      <span class="keyword">if</span> (isParentVisible) &#123;</span><br><span class="line">        requestManager.onStart();</span><br><span class="line">      &#125;</span><br><span class="line">      current.setRequestManager(requestManager);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> requestManager;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol><li><p>é¦–å…ˆç¬¬å…«è¡Œè·å–äº†ä¸€ä¸ªSupporRequestManagerFragmentï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªéšå½¢çš„Fragment</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SupportRequestManagerFragment current = getSupportRequestManagerFragment(fm, parentHint);</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‚æ•°FragmentManagerå’ŒFragment(å¯ç©º)æ¥åˆ›å»ºä¸€ä¸ªéšå½¢çš„Fragment</p><blockquote><p>è¿™é‡Œåˆ›å»ºä¸€ä¸ªéšå½¢çš„Fragmentçš„æ„å›¾å°±æ˜¯ï¼Œæƒ³é€šè¿‡æ·»åŠ ä¸€ä¸ªéšå½¢çš„Fragmentåˆ°Activityä¸­å»ï¼Œæ¥ç›‘å¬Fragmentçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¾¿äºæ§åˆ¶åŠ è½½</p><p>å› ä¸ºFragmentçš„ç”Ÿå‘½å‘¨æœŸæ˜¯è·Ÿéšç€Activityçš„ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®è¿™ä¸ªæ–¹æ³•æ¥ç›‘å¬åˆ°Activityçš„ç”Ÿå‘½å‘¨æœŸ</p></blockquote></li><li><p>ä¸‹é¢åˆé€šè¿‡åˆšè·å–çš„Fragmentåˆè·å–åˆ°äº†RequestManager</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestManager requestManager = current.getRequestManager();</span><br></pre></td></tr></table></figure><blockquote><p>RequestManagerï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸç®¡ç†ç±»ï¼Œç”¨æ¥åˆ¤æ–­å½“å‰çš„ç”Ÿå‘½å‘¨æœŸæ¥é€‰æ‹©æ˜¯å¦ç»§ç»­åŠ è½½å›¾ç‰‡</p></blockquote><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒGlideå°±å¯ä»¥æ ¹æ®è¿™ä¸ª Fragment çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œè¯·æ±‚ç®¡ç†äº†ã€‚</p></li><li><p>ä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œé‚£ä¹ˆè·å–åˆ°çš„RequestManagerä¼šä¸ºç©ºï¼Œå°±éœ€è¦ç»§ç»­åˆ¤ç©ºå¤„ç†ï¼Œå¦‚æœåˆšåˆšcurrent.getRequestManager()è·å–ä¸ºç©ºï¼Œåˆ™é‡æ–°åˆ›å»ºä¸€ä¸ªRequsetManager</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (requestManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="comment">// Factor out this Glide.get() call.</span></span><br><span class="line">  Glide glide = Glide.get(context);</span><br><span class="line">  <span class="comment">// è¿™æœ‰ç‚¹å°æŠ€å·§ï¼Œæˆ‘ä»¬è¦å¯åŠ¨RequestManagerï¼Œä½†ä¸æ˜¯</span></span><br><span class="line">  <span class="comment">// ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸã€‚ å¯åŠ¨RequestManageræ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯å¯åŠ¨  </span></span><br><span class="line">  <span class="comment">// ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä¼šè§¦å‘å†…å­˜æ³„æ¼</span></span><br><span class="line">  requestManager =</span><br><span class="line">      factory.build(</span><br><span class="line">          glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);</span><br><span class="line">  <span class="keyword">if</span> (isParentVisible) &#123;</span><br><span class="line">    requestManager.onStart();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†åˆ›å»ºå¥½çš„requestManageræ·»åŠ åˆ°SupportRequestManagerFragment ä¸Šå»</span></span><br><span class="line">  current.setRequestManager(requestManager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œåˆé‡æ–°è·å–äº†ä¸€æ¬¡<code>Glide</code>å•ä¾‹ï¼Œå¹¶é€šè¿‡<code>Fractory</code>å·¥å‚ç±»æ¥æ„å»º<code>RequestManager</code>ï¼Œæ„å»ºéœ€è¦ä¸‰ä¸ªå‚æ•°</p><ol><li>Glideå®ä¾‹</li><li>è¿™é‡Œçš„ current.getGlideLifecycle() å°±æ˜¯getSupportRequestManagerFragmentä¸­å®ä¾‹åŒ–çš„ ActivityFragmentLifecycleã€‚è¿™æ · RequestManager å°±ä¸ ActivityFragmentLifecycle è¿›è¡Œäº†å…³è”</li><li>Context</li></ol><p>åˆ›å»ºå®Œ<code>RequestManager</code>ä¹‹åï¼Œå°±æ ¹æ®ä¼ é€’è¿›æ¥çš„<code>isParentVisible</code>æ¥é€šçŸ¥<code>requestManager</code>æ˜¯å¦å¼€å§‹</p><blockquote><p>isParentVisibleï¼šå­—é¢æ„æ€å°±æ˜¯ä¹‹å‰ä¼ é€’è¿›æ¥çš„Fragment Activityæ˜¯å¦æ˜¾ç¤º</p></blockquote><p>æœ€åå°±æ˜¯å°† <code>RequestManager</code> è®¾ç½®åˆ° <code>SupportRequestManagerFragment</code> ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current.setRequestManager(requestManager);</span><br></pre></td></tr></table></figure></li></ol><h4 id="getApplicationContext"><a href="#getApplicationContext" class="headerlink" title="getApplicationContext()"></a>getApplicationContext()</h4><p>æ¥ä¸‹æ¥åœ¨çœ‹ä¸€ä¸ªApplicationçš„æƒ…å†µï¼Œå› ä¸ºå¤§ä½“ä¸Šå°±å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œcontextæ˜¯Applicationå’Œcontextä¸æ˜¯Application</p><p>å…ˆæ”¾å‡ºä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#RequestManagerRetriever</span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> RequestManager <span class="title">getApplicationManager</span><span class="params">(<span class="meta">@NonNull</span> Context context)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Either an application context or we&#x27;re on a background thread.</span></span><br><span class="line">    <span class="keyword">if</span> (applicationManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;<span class="comment">// ä¿è¯åŒæ­¥</span></span><br><span class="line">        <span class="keyword">if</span> (applicationManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="comment">// é€šå¸¸ï¼Œæš‚åœ/æ¢å¤æ˜¯ç”±æˆ‘ä»¬æ·»åŠ åˆ°ç‰‡æ®µæˆ–æ´»åŠ¨çš„ç‰‡æ®µæ¥å¤„ç†çš„ã€‚ ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºé™„åŠ åˆ°åº”ç”¨ç¨‹åºçš„ç®¡ç†å™¨å°†ä¸ä¼šæ¥æ”¶ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»å¼ºåˆ¶ç®¡ç†å™¨ä½¿ç”¨ApplicationLifecycleå¼€å§‹æ¢å¤ã€‚  </span></span><br><span class="line">          <span class="comment">// TODO(b/27524013): Factor out this Glide.get() call.</span></span><br><span class="line">          Glide glide = Glide.get(context.getApplicationContext());</span><br><span class="line">          applicationManager =</span><br><span class="line">              factory.build(</span><br><span class="line">                  glide,</span><br><span class="line">                  <span class="keyword">new</span> ApplicationLifecycle(),</span><br><span class="line">                  <span class="keyword">new</span> EmptyRequestManagerTreeNode(),</span><br><span class="line">                  context.getApplicationContext());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> applicationManager;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ€»ä½“ä¸ŠäºéApplicationçš„å·®ä¸äº†å¤šå°‘ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿè¿˜æ˜¯ç»§ç»­åˆ†æ</p><ol><li><p>è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå…ˆä½¿ç”¨ä¼ é€’è¿›æ¥çš„contextå»è·å–åˆ°Glideï¼Œç„¶åé€šè¿‡Glideå»åˆ›å»ºRequest Manager</p></li><li><p>åªä¸è¿‡åœ¨<code>getApplicationManager()</code>è¿™é‡Œï¼Œé€šè¿‡Factoryåˆ›å»ºRequest Managerçš„å‚æ•°å¯ä¸ä¸€æ ·ã€‚åœ¨è¿™é‡Œç¬¬ä¸€ä¸ªå‚æ•°è¿˜æ˜¯Glideï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå‚æ•°å°±å˜æˆäº†<code>ApplicationLifecycle()</code>ï¼Œä¹‹å‰æ˜¯ä¼ å…¥Fragmentçš„<code>getGlideLifecycle()</code>ä¹Ÿå°±æ˜¯Fragmentçš„ç”Ÿå‘½å‘¨æœŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplicationLifecycle</span> <span class="keyword">implements</span> <span class="title">Lifecycle</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addListener</span><span class="params">(<span class="meta">@NonNull</span> LifecycleListener listener)</span> </span>&#123;</span><br><span class="line">    listener.onStart();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeListener</span><span class="params">(<span class="meta">@NonNull</span> LifecycleListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do nothing.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡º<code>ApplicationLifecycle</code>æ˜¯ç©ºå®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œæ²¡æœ‰ä¸“é—¨åšç”Ÿå‘½å‘¨æœŸçš„å¤„ç†ï¼Œ å› ä¸º Application å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå³ä¸ºåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå›¾ç‰‡è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å’Œåº”ç”¨ç¨‹åºåŒæ­¥çš„ã€‚</p></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ‰€ä»¥è¯´ï¼Œ<code>Glide.with()</code>å°±æ˜¯æ ¹æ®ä¼ é€’è¿›æ¥çš„contextæ˜¯ä»€ä¹ˆå®ƒå°±ä¼šè¿”å›ä»€ä¹ˆæ ·çš„Request Managerå‡ºå»ï¼Œè‡³äºRequest Managerå†…éƒ¨å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªéšå½¢çš„Fragmentä¸Šå»ï¼Œé€šè¿‡è¿™ä¸ªéšå½¢çš„Fragmentæ¥ç›‘å¬Activityçš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–</p><p>ä¹Ÿå¯ä»¥è¯´æ˜¯Glideä¸ºäº†èƒ½å¤Ÿè‡ªåŠ¨çš„é…åˆç”Ÿå‘½å‘¨æœŸæ¥æ§åˆ¶å›¾ç‰‡çš„åŠ è½½å’Œæš‚åœï¼Œæ‰€ä»¥æ‰æƒ³å‡ºåˆ¤æ–­ä¼ å…¥è¿›æ¥çš„Contextæ˜¯å¦æ˜¯Applicationæ¥è€ƒè™‘æ˜¯é€šè¿‡ä¸€ä¸ªéšå½¢çš„Fragmentæ¥æ„ŸçŸ¥Activityçš„ç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯ç›´æ¥ä½¿ç”¨ApplicationLifecycle</p>]]></content>
      
      
      
        <tags>
            
            <tag> Glide </tag>
            
            <tag> æºç å‰–æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Glideæºç å‰–æ-into</title>
      <link href="2021/08/28/Glide%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-into/"/>
      <url>2021/08/28/Glide%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-into/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†åˆ†ææºç Glide.into()æ–¹æ³•</p><a id="more"></a><h1 id="Glideæºç å‰–æ-into"><a href="#Glideæºç å‰–æ-into" class="headerlink" title="Glideæºç å‰–æ-into"></a>Glideæºç å‰–æ-into</h1><blockquote><p>å°†åˆ†ææºç Glide.into()</p></blockquote><h2 id="into"><a href="#into" class="headerlink" title="into()"></a>into()</h2><p>å¯ä»¥å‘ç°ï¼Œå‰é¢ä¸¤ä¸ªæ–¹æ³•with()å’Œload()éƒ½æ²¡æœ‰æ¶‰åŠåˆ°å›¾ç‰‡çš„è¯·æ±‚ã€ç¼“å­˜ã€è§£ç ç­‰åˆ«çš„é€»è¾‘ã€‚é‚£ä¹ˆéƒ½ä¼šåœ¨into()é‡Œï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä¼šéå¸¸å¤æ‚:muscle:åŠ æ²¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(<span class="keyword">this</span>).load(<span class="string">&quot;å›¾ç‰‡èµ„æº&quot;</span>).into(image)</span><br></pre></td></tr></table></figure><h3 id="é‡è½½æ–¹æ³•"><a href="#é‡è½½æ–¹æ³•" class="headerlink" title="é‡è½½æ–¹æ³•"></a>é‡è½½æ–¹æ³•</h3><p>into()çš„é‡è½½æ–¹æ³•å’ŒViewçš„é‚£å¥—å·®ä¸å¤šï¼Œéƒ½æ˜¯å‘ä¸‹é‡å¤è°ƒç”¨é‡è½½æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> &lt;Y extends Target&lt;TranscodeType&gt;&gt; <span class="function">Y <span class="title">into</span><span class="params">(<span class="meta">@NonNull</span> Y target)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> into(target, <span class="comment">/*targetListener=*/</span> <span class="keyword">null</span>, Executors.mainThreadExecutor());</span><br><span class="line">&#125;</span><br><span class="line">---åˆ†å‰²---</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@Synthetic</span></span><br><span class="line">&lt;Y extends Target&lt;TranscodeType&gt;&gt; <span class="function">Y <span class="title">into</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Y target,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> into(target, targetListener, <span class="comment">/*options=*/</span> <span class="keyword">this</span>, callbackExecutor);</span><br><span class="line">&#125;</span><br><span class="line">---åˆ†å‰²---</span><br><span class="line"><span class="keyword">private</span> &lt;Y extends Target&lt;TranscodeType&gt;&gt; <span class="function">Y <span class="title">into</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Y target,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; options,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">  Preconditions.checkNotNull(target);</span><br><span class="line">  <span class="keyword">if</span> (!isModelSet) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;You must call #load() before calling #into()&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  Request request = buildRequest(target, targetListener, options, callbackExecutor);</span><br><span class="line"></span><br><span class="line">  Request previous = target.getRequest();</span><br><span class="line">  <span class="keyword">if</span> (request.isEquivalentTo(previous)</span><br><span class="line">      &amp;&amp; !isSkipMemoryCacheWithCompletePreviousRequest(options, previous)) &#123;</span><br><span class="line">    <span class="comment">// If the request is completed, beginning again will ensure the result is re-delivered,</span></span><br><span class="line">    <span class="comment">// triggering RequestListeners and Targets. If the request is failed, beginning again will</span></span><br><span class="line">    <span class="comment">// restart the request, giving it another chance to complete. If the request is already</span></span><br><span class="line">    <span class="comment">// running, we can let it continue running without interruption.</span></span><br><span class="line">    <span class="keyword">if</span> (!Preconditions.checkNotNull(previous).isRunning()) &#123;</span><br><span class="line">      <span class="comment">// Use the previous request rather than the new one to allow for optimizations like skipping</span></span><br><span class="line">      <span class="comment">// setting placeholders, tracking and un-tracking Targets, and obtaining View dimensions</span></span><br><span class="line">      <span class="comment">// that are done in the individual Request.</span></span><br><span class="line">      previous.begin();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> requestManager.clear(target);</span><br><span class="line"> target.setRequest(request);</span><br><span class="line"> requestManager.track(target, request);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä¼šè¿˜æ˜¯ä¼šæ¥åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">into(<span class="meta">@NonNull</span> Y target,</span><br><span class="line">     <span class="meta">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener,</span><br><span class="line">     BaseRequestOptions&lt;?&gt; options,</span><br><span class="line">     Executor callbackExecutor)&#123;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åˆ†æ</p><ol><li><p>é¦–å…ˆï¼Œä¼šåˆ¤æ–­å‰é¢æ˜¯å¦è°ƒç”¨è¿‡load()ï¼Œå› ä¸ºåªæœ‰è°ƒç”¨äº†load()ï¼ŒisMolderSetæ‰ä¼šä¸ºtrue</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="keyword">if</span> (!isModelSet) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;You must call #load() before calling #into()&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä¿è¯è°ƒç”¨é¡ºåºä¸å‘ç”Ÿé”™è¯¯</p></li><li><p>é€šè¿‡buildeRequest()æ„å»ºäº†ä¸€ä¸ªRequest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line">...</span><br><span class="line">Request request = buildRequest(target, targetListener, options, callbackExecutor); </span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é‚£å°±å…ˆç»§ç»­å»çœ‹çœ‹buildRequest()</p></li></ol><h3 id="buildRequest"><a href="#buildRequest" class="headerlink" title="buildRequest()"></a>buildRequest()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="function"><span class="keyword">private</span> Request <span class="title">buildRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Target&lt;TranscodeType&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; requestOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> buildRequestRecursive(</span><br><span class="line">      <span class="comment">/*requestLock=*/</span> <span class="keyword">new</span> Object(),</span><br><span class="line">      target,</span><br><span class="line">      targetListener,</span><br><span class="line">      <span class="comment">/*parentCoordinator=*/</span> <span class="keyword">null</span>,</span><br><span class="line">      transitionOptions,</span><br><span class="line">      requestOptions.getPriority(),</span><br><span class="line">      requestOptions.getOverrideWidth(),</span><br><span class="line">      requestOptions.getOverrideHeight(),</span><br><span class="line">      requestOptions,</span><br><span class="line">      callbackExecutor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>BaseRequestOptionsï¼šæ˜¯ä¹‹å‰load()åˆ›å»ºRequestBuilderæ—¶ï¼Œè°ƒç”¨çš„applyè®¾ç½®çš„ä¸€äº›é»˜è®¤å‚æ•°</p><p>transitionOptionsï¼šç”¨äºè®¾ç½®åŠ è½½å®Œæˆæ—¶åœ¨èµ„æºä¸Šä½¿ç”¨çš„è½¬æ¢çš„åŸºç±»</p></blockquote><p>å¯ä»¥çœ‹åˆ°å®ƒåˆå°†å‚æ•°å’Œä¸€äº›é¢å¤–å‚æ•°éƒ½ä¼ é€’è¿›äº†buildRequestRecursiveã€‚åˆ°ç›®å‰ä¸ºæ­¢éƒ½è¿˜æ²¡æœ‰çœ‹åˆ°å®é™…æ€§çš„æ„å»ºä»£ç :sweat:ï¼Œé‚£å°±åªèƒ½ç»§ç»­æ·±å…¥</p><h4 id="buildRequestRecursive"><a href="#buildRequestRecursive" class="headerlink" title="buildRequestRecursive()"></a>buildRequestRecursive()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="function"><span class="keyword">private</span> Request <span class="title">buildRequestRecursive</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Object requestLock,</span></span></span><br><span class="line"><span class="function"><span class="params">    Target&lt;TranscodeType&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestCoordinator parentCoordinator,</span></span></span><br><span class="line"><span class="function"><span class="params">    TransitionOptions&lt;?, ? <span class="keyword">super</span> TranscodeType&gt; transitionOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; requestOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Build the ErrorRequestCoordinator first if necessary so we can update parentCoordinator.</span></span><br><span class="line">  <span class="comment">// é”™è¯¯è¯·æ±‚åè°ƒè€…</span></span><br><span class="line">  ErrorRequestCoordinator errorRequestCoordinator = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (errorBuilder != <span class="keyword">null</span>) &#123;<span class="comment">// å¦‚æœæ²¡æœ‰è®¾ç½®é”™è¯¯åæ„å»ºï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šæœ‰errorBuilder</span></span><br><span class="line">    errorRequestCoordinator = <span class="keyword">new</span> ErrorRequestCoordinator(requestLock, parentCoordinator);<span class="comment">// åˆ›å»ºåè°ƒ</span></span><br><span class="line">    parentCoordinator = errorRequestCoordinator;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ„å»ºä¸»è¯·æ±‚</span></span><br><span class="line">  Request mainRequest =</span><br><span class="line">      buildThumbnailRequestRecursive(</span><br><span class="line">          requestLock,</span><br><span class="line">          target,</span><br><span class="line">          targetListener,</span><br><span class="line">          parentCoordinator,</span><br><span class="line">          transitionOptions,</span><br><span class="line">          priority,</span><br><span class="line">          overrideWidth,</span><br><span class="line">          overrideHeight,</span><br><span class="line">          requestOptions,</span><br><span class="line">          callbackExecutor);</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰è®¾ç½®errorBuilderï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿”å›mainRequest</span></span><br><span class="line">  <span class="keyword">if</span> (errorRequestCoordinator == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> mainRequest;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¸‹é¢ä¸ºè®¾ç½®äº†erroræ—¶ï¼Œè¿”å›errorRequest</span></span><br><span class="line">  <span class="keyword">int</span> errorOverrideWidth = errorBuilder.getOverrideWidth();</span><br><span class="line">  <span class="keyword">int</span> errorOverrideHeight = errorBuilder.getOverrideHeight();</span><br><span class="line">  <span class="keyword">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight) &amp;&amp; !errorBuilder.isValidOverride()) &#123;</span><br><span class="line">    errorOverrideWidth = requestOptions.getOverrideWidth();</span><br><span class="line">    errorOverrideHeight = requestOptions.getOverrideHeight();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Request errorRequest =</span><br><span class="line">      errorBuilder.buildRequestRecursive(</span><br><span class="line">          requestLock,</span><br><span class="line">          target,</span><br><span class="line">          targetListener,</span><br><span class="line">          errorRequestCoordinator,</span><br><span class="line">          errorBuilder.transitionOptions,</span><br><span class="line">          errorBuilder.getPriority(),</span><br><span class="line">          errorOverrideWidth,</span><br><span class="line">          errorOverrideHeight,</span><br><span class="line">          errorBuilder,</span><br><span class="line">          callbackExecutor);</span><br><span class="line">    <span class="comment">//å°†ä¸¤ä¸ªè¯·æ±‚éƒ½æ”¾å…¥åè°ƒä¸­</span></span><br><span class="line">  errorRequestCoordinator.setRequests(mainRequest, errorRequest);</span><br><span class="line">  <span class="keyword">return</span> errorRequestCoordinator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ErrorRequestCoordinatorï¼šä¸ºåè°ƒå™¨ï¼Œç›®çš„æ˜¯å¯ä»¥è®©errorRequestå’ŒmainRequestä¸€èµ·å·¥ä½œ</p></blockquote><p>å…³äºerrorBuilderçš„è¿™è¡Œä»£ç ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åœ¨ä¸»è¯·æ±‚å¤±è´¥æ—¶å¼€å§‹æ–°çš„è¯·æ±‚ï¼ˆå¦‚ä¸‹è®¾ç½®ï¼‰ï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šèµ°æœ€åå»é€’å½’æ„å»ºé”™è¯¯è¯·æ±‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®åœ¨ä¸»è¯·æ±‚å¤±è´¥æ—¶å¼€å§‹æ–°çš„è¯·æ±‚</span></span><br><span class="line">Glide.with(<span class="keyword">this</span>).load(url).error(Glide.with(<span class="keyword">this</span>).load(url)).into(imageView);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ²¡æœ‰è®¾ç½®erroçš„æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#buildRequestRecursive</span><br><span class="line">Request mainRequest =</span><br><span class="line">    buildThumbnailRequestRecursive(</span><br><span class="line">        requestLock,</span><br><span class="line">        target,</span><br><span class="line">        targetListener,</span><br><span class="line">        parentCoordinator,</span><br><span class="line">        transitionOptions,</span><br><span class="line">        priority,</span><br><span class="line">        overrideWidth,</span><br><span class="line">        overrideHeight,</span><br><span class="line">        requestOptions,</span><br><span class="line">        callbackExecutor);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (errorRequestCoordinator == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> mainRequest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¦‚æœæ²¡æœ‰è®¾ç½®errorï¼Œé‚£ä¹ˆerrorRequestCoordinatorä¸€å®šä¼šä¸ºç©ºï¼Œæ‰€ä»¥å°±åˆ°æ­¤ä¸ºæ­¢è¿”å›ä¸€ä¸ªbuildThumbnailRequestRecursiveå‡ºå»ã€‚é‚£ä¹ˆç»§ç»­</p><h4 id="buildThumbnailRequestRecursive"><a href="#buildThumbnailRequestRecursive" class="headerlink" title="buildThumbnailRequestRecursive()"></a>buildThumbnailRequestRecursive()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="function"><span class="keyword">private</span> Request <span class="title">buildThumbnailRequestRecursive</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Object requestLock,</span></span></span><br><span class="line"><span class="function"><span class="params">    Target&lt;TranscodeType&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">    RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestCoordinator parentCoordinator,</span></span></span><br><span class="line"><span class="function"><span class="params">    TransitionOptions&lt;?, ? <span class="keyword">super</span> TranscodeType&gt; transitionOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; requestOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰è®¾ç½®ç¼©ç•¥å›¾ï¼Œé‚£ä¹ˆthumbnailBuilderä¸ºç©º</span></span><br><span class="line">  <span class="keyword">if</span> (thumbnailBuilder != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// Recursive case: contains a potentially recursive thumbnail request builder.</span></span><br><span class="line">    <span class="keyword">if</span> (isThumbnailBuilt) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">          <span class="string">&quot;You cannot use a request as both the main request and a &quot;</span> + <span class="string">&quot;thumbnail, consider using clone() on the request(s) passed to thumbnail()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TransitionOptions&lt;?, ? <span class="keyword">super</span> TranscodeType&gt; thumbTransitionOptions =</span><br><span class="line">        thumbnailBuilder.transitionOptions;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Apply our transition by default to thumbnail requests but avoid overriding custom options</span></span><br><span class="line">    <span class="comment">// that may have been applied on the thumbnail request explicitly.</span></span><br><span class="line">    <span class="keyword">if</span> (thumbnailBuilder.isDefaultTransitionOptionsSet) &#123;</span><br><span class="line">      thumbTransitionOptions = transitionOptions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Priority thumbPriority =</span><br><span class="line">        thumbnailBuilder.isPrioritySet()</span><br><span class="line">            ? thumbnailBuilder.getPriority()</span><br><span class="line">            : getThumbnailPriority(priority);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> thumbOverrideWidth = thumbnailBuilder.getOverrideWidth();</span><br><span class="line">    <span class="keyword">int</span> thumbOverrideHeight = thumbnailBuilder.getOverrideHeight();</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†override</span></span><br><span class="line">    <span class="keyword">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight)</span><br><span class="line">        &amp;&amp; !thumbnailBuilder.isValidOverride()) &#123;</span><br><span class="line">      thumbOverrideWidth = requestOptions.getOverrideWidth();</span><br><span class="line">      thumbOverrideHeight = requestOptions.getOverrideHeight();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ç¼©ç•¥å›¾åè°ƒå™¨</span></span><br><span class="line">    ThumbnailRequestCoordinator coordinator =</span><br><span class="line">        <span class="keyword">new</span> ThumbnailRequestCoordinator(requestLock, parentCoordinator);</span><br><span class="line">    <span class="comment">// æ„å»ºåŸå›¾</span></span><br><span class="line">    Request fullRequest =</span><br><span class="line">        obtainRequest(</span><br><span class="line">            requestLock,</span><br><span class="line">            target,</span><br><span class="line">            targetListener,</span><br><span class="line">            requestOptions,</span><br><span class="line">            coordinator,</span><br><span class="line">            transitionOptions,</span><br><span class="line">            priority,</span><br><span class="line">            overrideWidth,</span><br><span class="line">            overrideHeight,</span><br><span class="line">            callbackExecutor);</span><br><span class="line">    isThumbnailBuilt = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">// Recursively generate thumbnail requests.</span></span><br><span class="line">    <span class="comment">// æ„å»ºç¼©ç•¥å›¾</span></span><br><span class="line">    Request thumbRequest =</span><br><span class="line">        thumbnailBuilder.buildRequestRecursive(</span><br><span class="line">            requestLock,</span><br><span class="line">            target,</span><br><span class="line">            targetListener,</span><br><span class="line">            coordinator,</span><br><span class="line">            thumbTransitionOptions,</span><br><span class="line">            thumbPriority,</span><br><span class="line">            thumbOverrideWidth,</span><br><span class="line">            thumbOverrideHeight,</span><br><span class="line">            thumbnailBuilder,</span><br><span class="line">            callbackExecutor);</span><br><span class="line">    isThumbnailBuilt = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// éƒ½æ·»åŠ åˆ°åè°ƒå™¨ä¸­å»</span></span><br><span class="line">    coordinator.setRequests(fullRequest, thumbRequest);</span><br><span class="line">    <span class="keyword">return</span> coordinator;</span><br><span class="line">      <span class="comment">// thumbSizeMultiplierç¼©æ”¾æ¯”ä¾‹ï¼Œæ²¡æœ‰è®¾ç½®ä¹Ÿæ˜¯ä¸ºç©º</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (thumbSizeMultiplier != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// Base case: thumbnail multiplier generates a thumbnail request, but cannot recurse.</span></span><br><span class="line">    ThumbnailRequestCoordinator coordinator =</span><br><span class="line">        <span class="keyword">new</span> ThumbnailRequestCoordinator(requestLock, parentCoordinator);</span><br><span class="line">    Request fullRequest =</span><br><span class="line">        obtainRequest(</span><br><span class="line">            requestLock,</span><br><span class="line">            target,</span><br><span class="line">            targetListener,</span><br><span class="line">            requestOptions,</span><br><span class="line">            coordinator,</span><br><span class="line">            transitionOptions,</span><br><span class="line">            priority,</span><br><span class="line">            overrideWidth,</span><br><span class="line">            overrideHeight,</span><br><span class="line">            callbackExecutor);</span><br><span class="line">    BaseRequestOptions&lt;?&gt; thumbnailOptions =</span><br><span class="line">        requestOptions.clone().sizeMultiplier(thumbSizeMultiplier);</span><br><span class="line"></span><br><span class="line">    Request thumbnailRequest =</span><br><span class="line">        obtainRequest(</span><br><span class="line">            requestLock,</span><br><span class="line">            target,</span><br><span class="line">            targetListener,</span><br><span class="line">            thumbnailOptions,</span><br><span class="line">            coordinator,</span><br><span class="line">            transitionOptions,</span><br><span class="line">            getThumbnailPriority(priority),</span><br><span class="line">            overrideWidth,</span><br><span class="line">            overrideHeight,</span><br><span class="line">            callbackExecutor);</span><br><span class="line"></span><br><span class="line">    coordinator.setRequests(fullRequest, thumbnailRequest);</span><br><span class="line">    <span class="keyword">return</span> coordinator;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸»è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">return</span> obtainRequest(</span><br><span class="line">        requestLock,</span><br><span class="line">        target,</span><br><span class="line">        targetListener,</span><br><span class="line">        requestOptions,</span><br><span class="line">        parentCoordinator,</span><br><span class="line">        transitionOptions,</span><br><span class="line">        priority,</span><br><span class="line">        overrideWidth,</span><br><span class="line">        overrideHeight,</span><br><span class="line">        callbackExecutor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€œä»£ç å¾ˆé•¿ï¼Œä½ å¿è€ä¸€ä¸‹â€æ¡ä¸»è¦çš„åˆ†ææŠŠ:collision:</p><p>è¿™é‡Œæœ‰äº›åœ°æ–¹å’Œä¸Šé¢çš„erroræœ‰ç‚¹ç±»ä¼¼ï¼Œæ¯”å¦‚è¯´ä¸€å¼€å§‹å°±åˆ¤æ–­thumbnailBuilder æ˜¯å¦ä¸ºç©º</p><blockquote><p>thumbnailBuilder ä¹Ÿå’Œerrorä¸€æ ·ï¼Œåªæœ‰è®¾ç½®äº†ç¼©ç•¥å›¾æ‰ä¼šä¸ä¸ºç©º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(<span class="keyword">this</span>).load(url).thumbnail(Glide.with(<span class="keyword">this</span>).load(thumbnailUrl)).into(imageView);</span><br></pre></td></tr></table></figure><p>thumbSizeMultiplierï¼šä¸ä¸ºç©ºï¼Œè¯´æ˜è®¾ç½®äº†ç¼©æ”¾æ¯”ä¾‹ï¼ˆå¦‚ä¸‹è®¾ç½®ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(<span class="keyword">this</span>).load(url).thumbnail(<span class="number">0.5f</span>).into(imageView);</span><br></pre></td></tr></table></figure></blockquote><p>è¿™é‡Œå°±å…ˆä¸å»ç†åˆ†æ”¯äº†ï¼Œå…ˆç›´æ¥çœ‹è·å–åŸå›¾ã€‚(å¥—ä¸ä¸‹å»äº†ï¼Œå¤ªæ·±äº†)å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ç¼©ç•¥å›¾å’Œç¼©ç•¥æ¯”ä¾‹ï¼Œé‚£ä¹ˆå°±åªä¼šè°ƒç”¨obtainRequest()</p><h4 id="obtainRequest"><a href="#obtainRequest" class="headerlink" title="obtainRequest()"></a>obtainRequest()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="function"><span class="keyword">private</span> Request <span class="title">obtainRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Object requestLock,</span></span></span><br><span class="line"><span class="function"><span class="params">    Target&lt;TranscodeType&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">    RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; requestOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    RequestCoordinator requestCoordinator,</span></span></span><br><span class="line"><span class="function"><span class="params">    TransitionOptions&lt;?, ? <span class="keyword">super</span> TranscodeType&gt; transitionOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> SingleRequest.obtain(</span><br><span class="line">      context,</span><br><span class="line">      glideContext,</span><br><span class="line">      requestLock,</span><br><span class="line">      model,</span><br><span class="line">      transcodeClass,</span><br><span class="line">      requestOptions,</span><br><span class="line">      overrideWidth,</span><br><span class="line">      overrideHeight,</span><br><span class="line">      priority,</span><br><span class="line">      target,</span><br><span class="line">      targetListener,</span><br><span class="line">      requestListeners,</span><br><span class="line">      requestCoordinator,</span><br><span class="line">      glideContext.getEngine(),</span><br><span class="line">      transitionOptions.getTransitionFactory(),</span><br><span class="line">      callbackExecutor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="SingleRequest"><a href="#SingleRequest" class="headerlink" title="SingleRequest"></a>SingleRequest</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#SingleRequest</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;R&gt; <span class="function">SingleRequest&lt;R&gt; <span class="title">obtain</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">    GlideContext glideContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    Object requestLock,</span></span></span><br><span class="line"><span class="function"><span class="params">    Object model,</span></span></span><br><span class="line"><span class="function"><span class="params">    Class&lt;R&gt; transcodeClass,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; requestOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">    Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    Target&lt;R&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">    RequestListener&lt;R&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> List&lt;RequestListener&lt;R&gt;&gt; requestListeners,</span></span></span><br><span class="line"><span class="function"><span class="params">    RequestCoordinator requestCoordinator,</span></span></span><br><span class="line"><span class="function"><span class="params">    Engine engine,</span></span></span><br><span class="line"><span class="function"><span class="params">    TransitionFactory&lt;? <span class="keyword">super</span> R&gt; animationFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> SingleRequest&lt;&gt;(</span><br><span class="line">      context,</span><br><span class="line">      glideContext,</span><br><span class="line">      requestLock,</span><br><span class="line">      model,</span><br><span class="line">      transcodeClass,</span><br><span class="line">      requestOptions,</span><br><span class="line">      overrideWidth,</span><br><span class="line">      overrideHeight,</span><br><span class="line">      priority,</span><br><span class="line">      target,</span><br><span class="line">      targetListener,</span><br><span class="line">      requestListeners,</span><br><span class="line">      requestCoordinator,</span><br><span class="line">      engine,</span><br><span class="line">      animationFactory,</span><br><span class="line">      callbackExecutor);</span><br><span class="line">&#125;</span><br><span class="line">---åˆ†å‰²---</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleRequest</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Context context,</span></span></span><br><span class="line"><span class="function"><span class="params">    GlideContext glideContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Object requestLock,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> Object model,</span></span></span><br><span class="line"><span class="function"><span class="params">    Class&lt;R&gt; transcodeClass,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; requestOptions,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideWidth,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> overrideHeight,</span></span></span><br><span class="line"><span class="function"><span class="params">    Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    Target&lt;R&gt; target,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestListener&lt;R&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> List&lt;RequestListener&lt;R&gt;&gt; requestListeners,</span></span></span><br><span class="line"><span class="function"><span class="params">    RequestCoordinator requestCoordinator,</span></span></span><br><span class="line"><span class="function"><span class="params">    Engine engine,</span></span></span><br><span class="line"><span class="function"><span class="params">    TransitionFactory&lt;? <span class="keyword">super</span> R&gt; animationFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å°†ä¼ å…¥è¿›æ¥çš„å‚æ•°éƒ½èµ‹å€¼ç»™æˆå‘˜å˜é‡</span></span><br><span class="line">  <span class="keyword">this</span>.requestLock = requestLock;</span><br><span class="line">  <span class="keyword">this</span>.context = context;</span><br><span class="line">  <span class="keyword">this</span>.glideContext = glideContext;</span><br><span class="line">  <span class="keyword">this</span>.model = model;</span><br><span class="line">  <span class="keyword">this</span>.transcodeClass = transcodeClass;</span><br><span class="line">  <span class="keyword">this</span>.requestOptions = requestOptions;</span><br><span class="line">  <span class="keyword">this</span>.overrideWidth = overrideWidth;</span><br><span class="line">  <span class="keyword">this</span>.overrideHeight = overrideHeight;</span><br><span class="line">  <span class="keyword">this</span>.priority = priority;</span><br><span class="line">  <span class="keyword">this</span>.target = target;</span><br><span class="line">  <span class="keyword">this</span>.targetListener = targetListener;</span><br><span class="line">  <span class="keyword">this</span>.requestListeners = requestListeners;</span><br><span class="line">  <span class="keyword">this</span>.requestCoordinator = requestCoordinator;</span><br><span class="line">  <span class="keyword">this</span>.engine = engine;</span><br><span class="line">  <span class="keyword">this</span>.animationFactory = animationFactory;</span><br><span class="line">  <span class="keyword">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">  status = Status.PENDING;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (requestOrigin == <span class="keyword">null</span> &amp;&amp; glideContext.getExperiments().isEnabled(LogRequestOrigins.class)) &#123;</span><br><span class="line">    requestOrigin = <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Glide request origin trace&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³ªç›®ï¼Œç»ˆäºåˆ°å¤´äº†:cry:è¿™é‡Œä¹Ÿæ˜¯å°†å‚æ•°ä¼ é€’è¿›å»ï¼Œæœ€ç»ˆæ„å»ºäº†ä¸€ä¸ªSingleRequestå‡ºæ¥ã€‚å¯æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹ä¸æ˜¯è¦çš„æ˜¯Requestå—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleRequest</span>&lt;<span class="title">R</span>&gt; <span class="keyword">implements</span> <span class="title">Request</span>, <span class="title">SizeReadyCallback</span>, <span class="title">ResourceCallback</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>SingleRequestæ˜¯Requestçš„å…·ä½“å®ç°</p><p>å›åˆ°å¼€å¤´ï¼Œç°åœ¨Requestæœ‰äº†ï¼Œæœ€ä¸Šé¢çš„ä»£ç ä¸­è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡å¤„ç†ï¼Œé‚£å°±æ˜¯track()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="keyword">private</span> &lt;Y extends Target&lt;TranscodeType&gt;&gt; <span class="function">Y <span class="title">into</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Y target,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> RequestListener&lt;TranscodeType&gt; targetListener,</span></span></span><br><span class="line"><span class="function"><span class="params">    BaseRequestOptions&lt;?&gt; options,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  Request request = buildRequest(target, targetListener, options, callbackExecutor);</span><br><span class="line">  ...</span><br><span class="line">  Request previous = target.getRequest();</span><br><span class="line"></span><br><span class="line">  requestManager.clear(target);</span><br><span class="line">  target.setRequest(request);</span><br><span class="line">  requestManager.track(target, request);<span class="comment">// ã€Š--è¿™é‡Œ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="track"><a href="#track" class="headerlink" title="track()"></a>track()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#RequestManager</span><br><span class="line"><span class="meta">@GuardedBy(&quot;this&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> TargetTracker targetTracker = <span class="keyword">new</span> TargetTracker();</span><br><span class="line"></span><br><span class="line"><span class="meta">@GuardedBy(&quot;this&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RequestTracker requestTracker;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">track</span><span class="params">(<span class="meta">@NonNull</span> Target&lt;?&gt; target, <span class="meta">@NonNull</span> Request request)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å°†ä¸€ä¸ª target åŠ å…¥ Set é›†åˆä¸­</span></span><br><span class="line">  targetTracker.track(target);</span><br><span class="line">    </span><br><span class="line">  requestTracker.runRequest(request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯å°†ä¼ å…¥è¿›æ¥çš„TargetåŠ å…¥åˆ°TargetTrackeré‡Œå»ï¼Œå†è°ƒç”¨requestTracker.runRequest()æ¥è¿è¡ŒRequest</p><h4 id="TargetTracker"><a href="#TargetTracker" class="headerlink" title="TargetTracker"></a>TargetTracker</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TargetTracker</span> <span class="keyword">implements</span> <span class="title">LifecycleListener</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Target&lt;?&gt;&gt; targets =</span><br><span class="line">      Collections.newSetFromMap(<span class="keyword">new</span> WeakHashMap&lt;Target&lt;?&gt;, Boolean&gt;());</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">track</span><span class="params">(<span class="meta">@NonNull</span> Target&lt;?&gt; target)</span> </span>&#123;</span><br><span class="line">    targets.add(target);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">untrack</span><span class="params">(<span class="meta">@NonNull</span> Target&lt;?&gt; target)</span> </span>&#123;</span><br><span class="line">    targets.remove(target);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Target&lt;?&gt; target : Util.getSnapshot(targets)) &#123;</span><br><span class="line">      target.onStart();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Target&lt;?&gt; target : Util.getSnapshot(targets)) &#123;</span><br><span class="line">      target.onStop();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (Target&lt;?&gt; target : Util.getSnapshot(targets)) &#123;</span><br><span class="line">      target.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@NonNull</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;Target&lt;?&gt;&gt; getAll() &#123;</span><br><span class="line">    <span class="keyword">return</span> Util.getSnapshot(targets);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    targets.clear();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TargetTrackerçœ‹èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œtrack()å°±æ˜¯å°†TargetåŠ å…¥ä¸€ä¸ªSeté›†åˆä¸­å»ï¼Œå…¶ä½™çš„æ“ä½œéƒ½æ˜¯å¯¹Seté›†åˆä¸­çš„æ•°æ®è¿›è¡Œéå†æ“ä½œ</p><blockquote><p> Collections.newSetFromMap()ï¼šJDK1.6å¼€å§‹æä¾›çš„ï¼Œç”¨äºå°†ç”Ÿæˆçš„MapåŒ…è£…æˆSetï¼Œè¿™æ ·è¿™ä¸ªSetå’Œè¢«åŒ…è£…çš„Mapæ‹¥æœ‰ç›¸åŒçš„keyé¡ºåºã€‚ç®€å•æ¥è¯´å°±æ˜¯ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå·¥å‚ç±»æ¥åŒ…è£…WeakHashMapæ¥ç”Ÿæˆä¸€ä¸ªWeakHashSetï¼Œå› ä¸ºæ²¡æœ‰WeakHashSetè¿™ä¸ªç°æˆçš„ç±»å¯ç”¨</p></blockquote><h4 id="RequestTracker"><a href="#RequestTracker" class="headerlink" title="RequestTracker"></a>RequestTracker</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestTracker</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;RequestTracker&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Request&gt; requests =</span><br><span class="line">      Collections.newSetFromMap(<span class="keyword">new</span> WeakHashMap&lt;Request, Boolean&gt;());</span><br><span class="line">  <span class="comment">// A set of requests that have not completed and are queued to be run again. We use this list to</span></span><br><span class="line">  <span class="comment">// maintain hard references to these requests to ensure that they are not garbage collected</span></span><br><span class="line">  <span class="comment">// before they start running or while they are paused. See #346.</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Request&gt; pendingRequests = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> isPaused;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Starts tracking the given request. */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runRequest</span><span class="params">(<span class="meta">@NonNull</span> Request request)</span> </span>&#123;</span><br><span class="line">    requests.add(request);</span><br><span class="line">    <span class="keyword">if</span> (!isPaused) &#123;</span><br><span class="line">      request.begin();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      request.clear();</span><br><span class="line">      <span class="keyword">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;</span><br><span class="line">        Log.v(TAG, <span class="string">&quot;Paused, delaying request&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      pendingRequests.add(request);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>RequestTracker.runRequest()</code>ä¹Ÿè¿˜æ˜¯è›®ç®€å•çš„ï¼Œä¸€å¼€å§‹ä¹Ÿæ˜¯å°†<code>request</code>æ·»åŠ åˆ°Seté›†åˆé‡Œå»ï¼Œä¹‹åå†åˆ¤æ–­å½“å‰æ˜¯å¦å¤„äºåœæ­¢çŠ¶æ€ï¼Œæ˜¯åˆ™æ¸…ç©ºè¯·æ±‚ï¼Œå¦åˆ™å¼€å§‹è¯·æ±‚</p><p>æˆ‘ä»¬ç»§ç»­æ·±å…¥ä¸€ä¸‹<code>RequestTracker</code>ï¼ŒæŸ¥çœ‹ä¸€ä¸‹<code>RequestTracker.begin()</code>ï¼Œç”±äºbeginæ˜¯ä¸€ä¸ªæ¥å£ï¼Œ<code>SingleRequest</code>åˆæ˜¯<code>Request</code>çš„å…·ä½“å®ç°ï¼Œé‚£æˆ‘ä»¬ç›¸å½“äºæ˜¯å»çœ‹ä¸€ä¸‹<code>SingleRequest.begin()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#SingleRequest</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">begin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">synchronized</span> (requestLock) &#123;</span><br><span class="line">    assertNotCallingCallbacks();</span><br><span class="line">    stateVerifier.throwIfRecycled();</span><br><span class="line">    startTime = LogTime.getLogTime();</span><br><span class="line">    <span class="keyword">if</span> (model == <span class="keyword">null</span>) &#123;<span class="comment">// åˆ¤æ–­å›¾ç‰‡èµ„æºæ˜¯å¦ä¸ºç©º</span></span><br><span class="line">      <span class="keyword">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight)) &#123;<span class="comment">// åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†ovreeide</span></span><br><span class="line">        width = overrideWidth;</span><br><span class="line">        height = overrideHeight;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Only log at more verbose log levels if the user has set a fallback drawable, because</span></span><br><span class="line">      <span class="comment">// fallback Drawables indicate the user expects null models occasionally.</span></span><br><span class="line">      <span class="keyword">int</span> logLevel = getFallbackDrawable() == <span class="keyword">null</span> ? Log.WARN : Log.DEBUG;</span><br><span class="line">      onLoadFailed(<span class="keyword">new</span> GlideException(<span class="string">&quot;Received null model&quot;</span>), logLevel);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (status == Status.RUNNING) &#123;<span class="comment">// åˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Cannot restart a running request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we&#x27;re restarted after we&#x27;re complete (usually via something like a notifyDataSetChanged</span></span><br><span class="line">    <span class="comment">// that starts an identical request into the same Target or View), we can simply use the</span></span><br><span class="line">    <span class="comment">// resource and size we retrieved the last time around and skip obtaining a new size, starting</span></span><br><span class="line">    <span class="comment">// a new load etc. This does mean that users who want to restart a load because they expect</span></span><br><span class="line">    <span class="comment">// that the view size has changed will need to explicitly clear the View or Target before</span></span><br><span class="line">    <span class="comment">// starting the new load.</span></span><br><span class="line">    <span class="keyword">if</span> (status == Status.COMPLETE) &#123;</span><br><span class="line">      onResourceReady(</span><br><span class="line">          resource, DataSource.MEMORY_CACHE, <span class="comment">/* isLoadedFromAlternateCacheKey= */</span> <span class="keyword">false</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Restarts for requests that are neither complete nor running can be treated as new requests</span></span><br><span class="line">    <span class="comment">// and can run again from the beginning.</span></span><br><span class="line"></span><br><span class="line">    cookie = GlideTrace.beginSectionAsync(TAG);</span><br><span class="line">    status = Status.WAITING_FOR_SIZE;<span class="comment">// ç­‰å¾…å°ºå¯¸çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight)) &#123;</span><br><span class="line">      onSizeReady(overrideWidth, overrideHeight);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      target.getSize(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((status == Status.RUNNING || status == Status.WAITING_FOR_SIZE)</span><br><span class="line">        &amp;&amp; canNotifyStatusChanged()) &#123;</span><br><span class="line">      target.onLoadStarted(getPlaceholderDrawable());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (IS_VERBOSE_LOGGABLE) &#123;</span><br><span class="line">      logV(<span class="string">&quot;finished run method in &quot;</span> + LogTime.getElapsedMillis(startTime));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>å…ˆåˆ¤æ–­CallingCallbacks()æ˜¯å¦ä¸ºç©º</p></li><li><p>å†åˆ¤æ–­åŠ è½½èµ„æºæ˜¯å¦ä¸ºç©ºï¼Œç©ºçš„è¯åˆ™è°ƒç”¨åŠ è½½å¤±è´¥çš„å›è°ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#SingleRequest</span><br><span class="line"><span class="keyword">if</span> (model == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†override</span></span><br><span class="line">        <span class="keyword">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight)) &#123;</span><br><span class="line">          width = overrideWidth;</span><br><span class="line">          height = overrideHeight;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœç”¨æˆ·è®¾ç½®äº†å›è°ƒDrawablesï¼Œåˆ™åªåœ¨æ›´è¯¦ç»†çš„æ—¥å¿—çº§åˆ«è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œå› ä¸ºå›è°ƒDrawablesè¡¨æ˜ç”¨æˆ·å¶å°”æœŸæœ›ç©ºæ¨¡å‹ã€‚</span></span><br><span class="line">        <span class="keyword">int</span> logLevel = getFallbackDrawable() == <span class="keyword">null</span> ? Log.WARN : Log.DEBUG;</span><br><span class="line">        onLoadFailed(<span class="keyword">new</span> GlideException(<span class="string">&quot;Received null model&quot;</span>), logLevel);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>å…¶æ¬¡å†åˆ¤æ–­å½“å‰çš„çŠ¶æ€ï¼Œæ˜¯å¦åœ¨è¿è¡Œä¸­ï¼Œæ˜¯å¦å®Œæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">#SingleRequest</span><br><span class="line"> <span class="keyword">if</span> (status == Status.RUNNING) &#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Cannot restart a running request&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If we&#x27;re restarted after we&#x27;re complete (usually via something like a notifyDataSetChanged</span></span><br><span class="line">      <span class="comment">// that starts an identical request into the same Target or View), we can simply use the</span></span><br><span class="line">      <span class="comment">// resource and size we retrieved the last time around and skip obtaining a new size, starting</span></span><br><span class="line">      <span class="comment">// a new load etc. This does mean that users who want to restart a load because they expect</span></span><br><span class="line">      <span class="comment">// that the view size has changed will need to explicitly clear the View or Target before</span></span><br><span class="line">      <span class="comment">// starting the new load.</span></span><br><span class="line"><span class="keyword">if</span> (status == Status.COMPLETE) &#123;</span><br><span class="line">    <span class="comment">//è°ƒç”¨èµ„æºåŠ è½½å®Œæˆ</span></span><br><span class="line">    onResourceReady(</span><br><span class="line">    resource, DataSource.MEMORY_CACHE, <span class="comment">/* isLoadedFromAlternateCacheKey= */</span> <span class="keyword">false</span>);</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†overrideWidthã€overrideHeight</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#SingleRequest</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (Util.isValidDimensions(overrideWidth, overrideHeight)) &#123;</span><br><span class="line">  onSizeReady(overrideWidth, overrideHeight);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  target.getSize(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¦‚æœè®¾ç½®äº†overrideWidthã€overrideHeightï¼Œåˆ™ä¼šç›´æ¥è°ƒç”¨onSizeRead()ï¼Œå¦åˆ™çš„è¯ï¼Œä¼šè°ƒç”¨getSize()</p><blockquote><p>è®¾ç½®override</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®åŠ è½½å›¾ç‰‡çš„å®½é«˜ä¸º 100x100 px</span></span><br><span class="line">Glide.with(<span class="keyword">this</span>).load(url).override(<span class="number">100</span>,<span class="number">100</span>).into(imageView);</span><br></pre></td></tr></table></figure></blockquote><p>é‚£å°±ç»§ç»­çœ‹ä¸€ä¸‹getSize()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#Target</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Target</span>&lt;<span class="title">R</span>&gt; <span class="keyword">extends</span> <span class="title">LifecycleListener</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">getSize</span><span class="params">(<span class="meta">@NonNull</span> SizeReadyCallback cb)</span></span>;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">---åˆ†å‰²---</span><br><span class="line">#SizeReadyCallback</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SizeReadyCallback</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">onSizeReady</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getSize()å†…éƒ¨æ˜¯é€šè¿‡ViewTreeObserveræ¥ç›‘å¬ImageViewçš„é«˜å®½ï¼Œæœ€ç»ˆä¹Ÿè¿˜æ˜¯è°ƒç”¨onSizeReady()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#SingleRequest</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSizeReady</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">  stateVerifier.throwIfRecycled();</span><br><span class="line">  <span class="keyword">synchronized</span> (requestLock) &#123;<span class="comment">// åŒæ­¥é”</span></span><br><span class="line">    <span class="keyword">if</span> (IS_VERBOSE_LOGGABLE) &#123;</span><br><span class="line">      logV(<span class="string">&quot;Got onSizeReady in &quot;</span> + LogTime.getElapsedMillis(startTime));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status != Status.WAITING_FOR_SIZE) &#123;<span class="comment">// å¦‚æœçŠ¶æ€ä¸æ˜¯ç­‰å¾…ï¼Œå°±ç›´æ¥è·³å‡º</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    status = Status.RUNNING;<span class="comment">// è®¾ç½®çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> sizeMultiplier = requestOptions.getSizeMultiplier();<span class="comment">// ä»é…ç½®ä¿¡æ¯ä¸­è·å–ç¼©ç•¥æ¯”ä¾‹</span></span><br><span class="line">    <span class="keyword">this</span>.width = maybeApplySizeMultiplier(width, sizeMultiplier);<span class="comment">// æ ¹æ®ç¼©æ”¾æ¯”ä¾‹æ¥è·å–å®½åº¦</span></span><br><span class="line">    <span class="keyword">this</span>.height = maybeApplySizeMultiplier(height, sizeMultiplier);<span class="comment">// æ ¹æ®ç¼©æ”¾æ¯”ä¾‹æ¥è·å–é«˜åº¦</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (IS_VERBOSE_LOGGABLE) &#123;</span><br><span class="line">      logV(<span class="string">&quot;finished setup for calling load in &quot;</span> + LogTime.getElapsedMillis(startTime));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¼€å§‹åŠ è½½</span></span><br><span class="line">    loadStatus =</span><br><span class="line">        engine.load(</span><br><span class="line">            glideContext,</span><br><span class="line">            model,</span><br><span class="line">            requestOptions.getSignature(),</span><br><span class="line">            <span class="keyword">this</span>.width,</span><br><span class="line">            <span class="keyword">this</span>.height,</span><br><span class="line">            requestOptions.getResourceClass(),</span><br><span class="line">            transcodeClass,</span><br><span class="line">            priority,</span><br><span class="line">            requestOptions.getDiskCacheStrategy(),</span><br><span class="line">            requestOptions.getTransformations(),</span><br><span class="line">            requestOptions.isTransformationRequired(),</span><br><span class="line">            requestOptions.isScaleOnlyOrNoTransform(),</span><br><span class="line">            requestOptions.getOptions(),</span><br><span class="line">            requestOptions.isMemoryCacheable(),</span><br><span class="line">            requestOptions.getUseUnlimitedSourceGeneratorsPool(),</span><br><span class="line">            requestOptions.getUseAnimationPool(),</span><br><span class="line">            requestOptions.getOnlyRetrieveFromCache(),</span><br><span class="line">            <span class="keyword">this</span>,</span><br><span class="line">            callbackExecutor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is a hack that&#x27;s only useful for testing right now where loads complete synchronously</span></span><br><span class="line">    <span class="comment">// even though under any executor running on any thread but the main thread, the load would</span></span><br><span class="line">    <span class="comment">// have completed asynchronously.</span></span><br><span class="line">    <span class="keyword">if</span> (status != Status.RUNNING) &#123;</span><br><span class="line">      loadStatus = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (IS_VERBOSE_LOGGABLE) &#123;</span><br><span class="line">      logV(<span class="string">&quot;finished onSizeReady in &quot;</span> + LogTime.getElapsedMillis(startTime));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>é¦–å…ˆå°†çŠ¶æ€è®¾ç½®ä¸ºè¿è¡Œä¸­</p></li><li><p>å†æ ¹æ®ç¼©ç•¥æ¯”ä¾‹æ¥è·å–å›¾ç‰‡é«˜å®½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#onSizeReady</span><br><span class="line">...</span><br><span class="line"><span class="comment">// æ ¹æ®ç¼©ç•¥æ¯”ä¾‹è·å–å›¾ç‰‡å®½é«˜</span></span><br><span class="line"><span class="keyword">float</span> sizeMultiplier = requestOptions.getSizeMultiplier();</span><br><span class="line"><span class="keyword">this</span>.width = maybeApplySizeMultiplier(width, sizeMultiplier);</span><br><span class="line"><span class="keyword">this</span>.height = maybeApplySizeMultiplier(height, sizeMultiplier);</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>æœ€åè°ƒç”¨engine.load()è¿›è¡ŒåŠ è½½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#onSizeReady</span><br><span class="line">...</span><br><span class="line">loadStatus =</span><br><span class="line">      engine.load(</span><br><span class="line">          glideContext,</span><br><span class="line">          model,</span><br><span class="line">          requestOptions.getSignature(),</span><br><span class="line">          <span class="keyword">this</span>.width,</span><br><span class="line">          <span class="keyword">this</span>.height,</span><br><span class="line">          requestOptions.getResourceClass(),</span><br><span class="line">          transcodeClass,</span><br><span class="line">          priority,</span><br><span class="line">          requestOptions.getDiskCacheStrategy(),</span><br><span class="line">          requestOptions.getTransformations(),</span><br><span class="line">          requestOptions.isTransformationRequired(),</span><br><span class="line">          requestOptions.isScaleOnlyOrNoTransform(),</span><br><span class="line">          requestOptions.getOptions(),</span><br><span class="line">          requestOptions.isMemoryCacheable(),</span><br><span class="line">          requestOptions.getUseUnlimitedSourceGeneratorsPool(),</span><br><span class="line">          requestOptions.getUseAnimationPool(),</span><br><span class="line">          requestOptions.getOnlyRetrieveFromCache(),</span><br><span class="line">          <span class="keyword">this</span>,</span><br><span class="line">          callbackExecutor);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç€é‡å…³æ³¨<code>engine.load()</code>æ–¹æ³•ï¼Œå¯ä»¥çŒœæµ‹ä¸ºæ­£åœ¨åŠ è½½çš„éƒ¨åˆ†</p></li></ol></li></ol><h3 id="Engine-load"><a href="#Engine-load" class="headerlink" title="Engine.load()"></a>Engine.load()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#Engine</span><br><span class="line"><span class="keyword">public</span> &lt;R&gt; <span class="function">LoadStatus <span class="title">load</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    GlideContext glideContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    Object model,// å›¾ç‰‡åŠ è½½èµ„æº</span></span></span><br><span class="line"><span class="function"><span class="params">    Key signature,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">    Class&lt;?&gt; resourceClass,</span></span></span><br><span class="line"><span class="function"><span class="params">    Class&lt;R&gt; transcodeClass,</span></span></span><br><span class="line"><span class="function"><span class="params">    Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    DiskCacheStrategy diskCacheStrategy,</span></span></span><br><span class="line"><span class="function"><span class="params">    Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> isTransformationRequired,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> isScaleOnlyOrNoTransform,</span></span></span><br><span class="line"><span class="function"><span class="params">    Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> isMemoryCacheable,// æ˜¯å¦ä½¿ç”¨å†…å­˜ç¼“å­˜</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> useUnlimitedSourceExecutorPool,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> useAnimationPool,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> onlyRetrieveFromCache,</span></span></span><br><span class="line"><span class="function"><span class="params">    ResourceCallback cb,// å›è°ƒ</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> startTime = VERBOSE_IS_LOGGABLE ? LogTime.getLogTime() : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  EngineKey key =</span><br><span class="line">      keyFactory.buildKey(</span><br><span class="line">          model,</span><br><span class="line">          signature,</span><br><span class="line">          width,</span><br><span class="line">          height,</span><br><span class="line">          transformations,</span><br><span class="line">          resourceClass,</span><br><span class="line">          transcodeClass,</span><br><span class="line">          options);</span><br><span class="line"></span><br><span class="line">  EngineResource&lt;?&gt; memoryResource; <span class="comment">// å†…å­˜èµ„æº</span></span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="comment">// ä»å†…å­˜ä¸­è·å–</span></span><br><span class="line">    memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (memoryResource == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> waitForExistingOrStartNewJob(</span><br><span class="line">          glideContext,</span><br><span class="line">          model,</span><br><span class="line">          signature,</span><br><span class="line">          width,</span><br><span class="line">          height,</span><br><span class="line">          resourceClass,</span><br><span class="line">          transcodeClass,</span><br><span class="line">          priority,</span><br><span class="line">          diskCacheStrategy,</span><br><span class="line">          transformations,</span><br><span class="line">          isTransformationRequired,</span><br><span class="line">          isScaleOnlyOrNoTransform,</span><br><span class="line">          options,</span><br><span class="line">          isMemoryCacheable,</span><br><span class="line">          useUnlimitedSourceExecutorPool,</span><br><span class="line">          useAnimationPool,</span><br><span class="line">          onlyRetrieveFromCache,</span><br><span class="line">          cb,</span><br><span class="line">          callbackExecutor,</span><br><span class="line">          key,</span><br><span class="line">          startTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Avoid calling back while holding the engine lock, doing so makes it easier for callers to</span></span><br><span class="line">  <span class="comment">// deadlock.</span></span><br><span class="line">  cb.onResourceReady(</span><br><span class="line">      memoryResource, DataSource.MEMORY_CACHE, <span class="comment">/* isLoadedFromAlternateCacheKey= */</span> <span class="keyword">false</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åšäº†4ä»¶äº‹æƒ…</p><ol><li><p>ä½¿ç”¨å‚æ•°æ„å»ºäº†ä¸ªEngineKey</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//load</span></span><br><span class="line">EngineKey key =</span><br><span class="line">    keyFactory.buildKey(</span><br><span class="line">        model,</span><br><span class="line">        signature,</span><br><span class="line">        width,</span><br><span class="line">        height,</span><br><span class="line">        transformations,</span><br><span class="line">        resourceClass,</span><br><span class="line">        transcodeClass,</span><br><span class="line">        options);</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨EngineKeyå»è·å–ç¼“å­˜ä¸­çš„èµ„æºï¼Œå…ˆä»å†…å­˜ä¸­è¿›è¡Œè·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//load</span></span><br><span class="line">memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™ç­‰å¾…æˆ–æ–°å¼€å¯ä¸€ä¸ªEngineJob</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//load</span></span><br><span class="line"><span class="keyword">if</span> (memoryResource == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> waitForExistingOrStartNewJob(</span><br><span class="line">      glideContext,</span><br><span class="line">      model,</span><br><span class="line">      signature,</span><br><span class="line">      width,</span><br><span class="line">      height,</span><br><span class="line">      resourceClass,</span><br><span class="line">      transcodeClass,</span><br><span class="line">      priority,</span><br><span class="line">      diskCacheStrategy,</span><br><span class="line">      transformations,</span><br><span class="line">      isTransformationRequired,</span><br><span class="line">      isScaleOnlyOrNoTransform,</span><br><span class="line">      options,</span><br><span class="line">      isMemoryCacheable,</span><br><span class="line">      useUnlimitedSourceExecutorPool,</span><br><span class="line">      useAnimationPool,</span><br><span class="line">      onlyRetrieveFromCache,</span><br><span class="line">      cb,</span><br><span class="line">      callbackExecutor,</span><br><span class="line">      key,</span><br><span class="line">      startTime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœè·å–æˆåŠŸï¼Œåˆ™è°ƒç”¨åŠ è½½æˆåŠŸçš„å›è°ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//load</span></span><br><span class="line">cb.onResourceReady(</span><br><span class="line">        memoryResource, DataSource.MEMORY_CACHE, <span class="comment">/* isLoadedFromAlternateCacheKey= */</span> <span class="keyword">false</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure></li></ol><p>æ¥ä¸‹æ¥å…ˆä¸è®²è§£ç¼“å­˜ï¼Œå…ˆç»§ç»­å°†ä¸»è¦æµç¨‹ï¼Œç¼“å­˜å°†å†ä¸‹é¢éƒ¨åˆ†å†è¿›è¡Œè®²è§£</p><h4 id="waitForExistingOrStartNewJob"><a href="#waitForExistingOrStartNewJob" class="headerlink" title="waitForExistingOrStartNewJob"></a>waitForExistingOrStartNewJob</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#Engine</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Jobs jobs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;R&gt; <span class="function">LoadStatus <span class="title">waitForExistingOrStartNewJob</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    GlideContext glideContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    Object model,</span></span></span><br><span class="line"><span class="function"><span class="params">    Key signature,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">    Class&lt;?&gt; resourceClass,</span></span></span><br><span class="line"><span class="function"><span class="params">    Class&lt;R&gt; transcodeClass,</span></span></span><br><span class="line"><span class="function"><span class="params">    Priority priority,</span></span></span><br><span class="line"><span class="function"><span class="params">    DiskCacheStrategy diskCacheStrategy,</span></span></span><br><span class="line"><span class="function"><span class="params">    Map&lt;Class&lt;?&gt;, Transformation&lt;?&gt;&gt; transformations,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> isTransformationRequired,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> isScaleOnlyOrNoTransform,</span></span></span><br><span class="line"><span class="function"><span class="params">    Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> isMemoryCacheable,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> useUnlimitedSourceExecutorPool,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> useAnimationPool,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">boolean</span> onlyRetrieveFromCache,</span></span></span><br><span class="line"><span class="function"><span class="params">    ResourceCallback cb,</span></span></span><br><span class="line"><span class="function"><span class="params">    Executor callbackExecutor,</span></span></span><br><span class="line"><span class="function"><span class="params">    EngineKey key,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">long</span> startTime)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  EngineJob&lt;?&gt; current = jobs.get(key, onlyRetrieveFromCache);</span><br><span class="line">  <span class="keyword">if</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line">    current.addCallback(cb, callbackExecutor);</span><br><span class="line">    <span class="keyword">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class="line">      logWithTimeAndKey(<span class="string">&quot;Added to existing load&quot;</span>, startTime, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LoadStatus(cb, current);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  EngineJob&lt;R&gt; engineJob =</span><br><span class="line">      engineJobFactory.build(</span><br><span class="line">          key,</span><br><span class="line">          isMemoryCacheable,</span><br><span class="line">          useUnlimitedSourceExecutorPool,</span><br><span class="line">          useAnimationPool,</span><br><span class="line">          onlyRetrieveFromCache);</span><br><span class="line"></span><br><span class="line">  DecodeJob&lt;R&gt; decodeJob =</span><br><span class="line">      decodeJobFactory.build(</span><br><span class="line">          glideContext,</span><br><span class="line">          model,</span><br><span class="line">          key,</span><br><span class="line">          signature,</span><br><span class="line">          width,</span><br><span class="line">          height,</span><br><span class="line">          resourceClass,</span><br><span class="line">          transcodeClass,</span><br><span class="line">          priority,</span><br><span class="line">          diskCacheStrategy,</span><br><span class="line">          transformations,</span><br><span class="line">          isTransformationRequired,</span><br><span class="line">          isScaleOnlyOrNoTransform,</span><br><span class="line">          onlyRetrieveFromCache,</span><br><span class="line">          options,</span><br><span class="line">          engineJob);</span><br><span class="line"></span><br><span class="line">  jobs.put(key, engineJob);</span><br><span class="line"></span><br><span class="line">  engineJob.addCallback(cb, callbackExecutor);</span><br><span class="line">  engineJob.start(decodeJob);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class="line">    logWithTimeAndKey(<span class="string">&quot;Started new load&quot;</span>, startTime, key);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LoadStatus(cb, engineJob);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>waitForExistingOrStartNewJob()åšäº†6ä»¶äº‹æƒ…</p><ol><li><p>ä»æˆå‘˜å˜é‡jobsä¸­è·å–EngineJobï¼Œå¦‚æœè·å–ä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºå½“å‰æœ‰æ­£åœ¨æ‰§è¡Œçš„EngineJobï¼Œç»™EngineJobæ·»åŠ å›è°ƒå¹¶è¿”å›æ–°åˆ›å»ºçš„LoadStatus()åŠ è½½çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//waitForExistingOrStartNewJob</span></span><br><span class="line">EngineJob&lt;?&gt; current = jobs.get(key, onlyRetrieveFromCache);</span><br><span class="line"><span class="keyword">if</span> (current != <span class="keyword">null</span>) &#123;<span class="comment">// è·å–ä¸ä¸ºç©ºçš„è¯ï¼Œè®¾ç½®å›è°ƒ</span></span><br><span class="line">  current.addCallback(cb, callbackExecutor);</span><br><span class="line">  <span class="keyword">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class="line">    logWithTimeAndKey(<span class="string">&quot;Added to existing load&quot;</span>, startTime, key);</span><br><span class="line">  &#125;<span class="comment">//å¹¶è¿”å›åŠ è½½çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LoadStatus(cb, current);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è·å–ä¸ºç©ºçš„è¯ï¼Œåˆ™é€šè¿‡EngineJobå·¥å‚ç±»æ¥åˆ›å»ºEngineJobã€‚è¯¥ç±»ä¸»è¦ç”¨æ¥ç®¡ç†åŠ è½½ä»¥åŠå½“åŠ è½½å®Œæˆæ—¶é€šçŸ¥å›è°ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//waitForExistingOrStartNewJob</span></span><br><span class="line">EngineJob&lt;R&gt; engineJob =</span><br><span class="line">    engineJobFactory.build(</span><br><span class="line">        key,</span><br><span class="line">        isMemoryCacheable,<span class="comment">// æ˜¯å¦ä½¿ç”¨å†…å­˜ç¼“å­˜</span></span><br><span class="line">        useUnlimitedSourceExecutorPool,<span class="comment">// æ˜¯å¦ä½¿ç”¨æ— é™åˆ¶çš„èµ„æºæ‰§è¡Œæ± </span></span><br><span class="line">        useAnimationPool,<span class="comment">// æ˜¯å¦ä½¿ç”¨åŠ¨ç”»æ± </span></span><br><span class="line">        onlyRetrieveFromCache);</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨DecodeJobå·¥å‚ç±»æ¥åˆ›å»ºDecodeJobã€‚è¯¥ç±»ä¸»è¦è´Ÿè´£å›¾ç‰‡çš„è§£ç ï¼Œå®ç°äº† Runnable æ¥å£ï¼Œå±äºä¸€ä¸ªä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//waitForExistingOrStartNewJob</span></span><br><span class="line">DecodeJob&lt;R&gt; decodeJob =</span><br><span class="line">    decodeJobFactory.build(</span><br><span class="line">        glideContext,</span><br><span class="line">        model,</span><br><span class="line">        key,</span><br><span class="line">        signature,</span><br><span class="line">        width,</span><br><span class="line">        height,</span><br><span class="line">        resourceClass,</span><br><span class="line">        transcodeClass,</span><br><span class="line">        priority,</span><br><span class="line">        diskCacheStrategy,</span><br><span class="line">        transformations,</span><br><span class="line">        isTransformationRequired,</span><br><span class="line">        isScaleOnlyOrNoTransform,</span><br><span class="line">        onlyRetrieveFromCache,</span><br><span class="line">        options,</span><br><span class="line">        engineJob);</span><br></pre></td></tr></table></figure></li><li><p>å°†æ–°åˆ›å»ºçš„EngineJobæ·»åŠ åˆ°æˆå‘˜å˜é‡jobsä¸­å»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//waitForExistingOrStartNewJob</span></span><br><span class="line">jobs.put(key, engineJob);</span><br></pre></td></tr></table></figure></li><li><p>ç»™æ–°åˆ›å»ºçš„EngineJobæ·»åŠ ä¸Šå›è°ƒå¹¶è°ƒç”¨start()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//waitForExistingOrStartNewJob</span></span><br><span class="line">engineJob.addCallback(cb, callbackExecutor);</span><br><span class="line">engineJob.start(decodeJob);</span><br></pre></td></tr></table></figure></li><li><p>è¿”å›åŠ è½½çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//waitForExistingOrStartNewJob</span></span><br><span class="line"><span class="keyword">if</span> (VERBOSE_IS_LOGGABLE) &#123;</span><br><span class="line">  logWithTimeAndKey(<span class="string">&quot;Started new load&quot;</span>, startTime, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> LoadStatus(cb, engineJob);</span><br></pre></td></tr></table></figure></li></ol><p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å…ˆå…³æ³¨ä¸€ä¸‹engineJob.start()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(DecodeJob&lt;R&gt; decodeJob)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.decodeJob = decodeJob;</span><br><span class="line">  GlideExecutor executor =</span><br><span class="line">      decodeJob.willDecodeFromCache() ? diskCacheExecutor : getActiveSourceExecutor();   executor.execute(decodeJob);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°±æ˜¯å°†ä¼ å…¥è¿›æ¥çš„DecodeJobæ”¾å…¥çº¿ç¨‹æ± ä¸­å»è¿è¡Œ</p><h3 id="DecodeJob"><a href="#DecodeJob" class="headerlink" title="DecodeJob"></a>DecodeJob</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// This should be much more fine grained, but since Java&#x27;s thread pool implementation silently</span></span><br><span class="line">  <span class="comment">// swallows all otherwise fatal exceptions, this will at least make it obvious to developers</span></span><br><span class="line">  <span class="comment">// that something is failing.</span></span><br><span class="line">  GlideTrace.beginSectionFormat(<span class="string">&quot;DecodeJob#run(reason=%s, model=%s)&quot;</span>, runReason, model);</span><br><span class="line">  <span class="comment">// Methods in the try statement can invalidate currentFetcher, so set a local variable here to</span></span><br><span class="line">  <span class="comment">// ensure that the fetcher is cleaned up either way.</span></span><br><span class="line">  DataFetcher&lt;?&gt; localFetcher = currentFetcher;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">      notifyFailed();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    runWrapped();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (CallbackException e) &#123;</span><br><span class="line">    <span class="comment">// If a callback not controlled by Glide throws an exception, we should avoid the Glide</span></span><br><span class="line">    <span class="comment">// specific debug logic below.</span></span><br><span class="line">    <span class="keyword">throw</span> e;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">    <span class="comment">// Catch Throwable and not Exception to handle OOMs. Throwables are swallowed by our</span></span><br><span class="line">    <span class="comment">// usage of .submit() in GlideExecutor so we&#x27;re not silently hiding crashes by doing this. We</span></span><br><span class="line">    <span class="comment">// are however ensuring that our callbacks are always notified when a load fails. Without this</span></span><br><span class="line">    <span class="comment">// notification, uncaught throwables never notify the corresponding callbacks, which can cause</span></span><br><span class="line">    <span class="comment">// loads to silently hang forever, a case that&#x27;s especially bad for users using Futures on</span></span><br><span class="line">    <span class="comment">// background threads.</span></span><br><span class="line">    <span class="keyword">if</span> (Log.isLoggable(TAG, Log.DEBUG)) &#123;</span><br><span class="line">      Log.d(</span><br><span class="line">          TAG,</span><br><span class="line">          <span class="string">&quot;DecodeJob threw unexpectedly&quot;</span> + <span class="string">&quot;, isCancelled: &quot;</span> + isCancelled + <span class="string">&quot;, stage: &quot;</span> + stage,t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// When we&#x27;re encoding we&#x27;ve already notified our callback and it isn&#x27;t safe to do so again.</span></span><br><span class="line">    <span class="keyword">if</span> (stage != Stage.ENCODE) &#123;</span><br><span class="line">      throwables.add(t);</span><br><span class="line">      notifyFailed();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isCancelled) &#123;</span><br><span class="line">      <span class="keyword">throw</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> t;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// Keeping track of the fetcher here and calling cleanup is excessively paranoid, we call</span></span><br><span class="line">    <span class="comment">// close in all cases anyway.</span></span><br><span class="line">    <span class="keyword">if</span> (localFetcher != <span class="keyword">null</span>) &#123;</span><br><span class="line">      localFetcher.cleanup();</span><br><span class="line">    &#125;</span><br><span class="line">    GlideTrace.endSection();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>åˆ¤æ–­æ˜¯å¦è¢«å–æ¶ˆï¼Œå¦‚æœå–æ¶ˆäº†åˆ™è°ƒç”¨åŠ è½½å¤±è´¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//run</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">  notifyFailed();</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//run</span></span><br><span class="line">...</span><br><span class="line">runWrapped();</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>çœŸæ­£çš„æ‰§è¡Œéƒ½åœ¨runWrappedä¸­</p></li><li><p>åˆ¤æ–­çŠ¶æ€ç æ˜¯å¦è§£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//run</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (stage != Stage.ENCODE) &#123;</span><br><span class="line">  throwables.add(t);</span><br><span class="line">  notifyFailed();</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ol><h4 id="runWrapped"><a href="#runWrapped" class="headerlink" title="runWrapped()"></a>runWrapped()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runWrapped</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (runReason) &#123;<span class="comment">// runReasonæœ‰é»˜è®¤å€¼ï¼Œæ˜¯INITIALIZEï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ä¼šç›´æ¥èµ°ç¬¬ä¸€ä¸ªåˆ†æ”¯</span></span><br><span class="line">    <span class="keyword">case</span> INITIALIZE:</span><br><span class="line">      stage = getNextStage(Stage.INITIALIZE);<span class="comment">// è·å–èµ„æºçŠ¶æ€</span></span><br><span class="line">      currentGenerator = getNextGenerator();<span class="comment">// æ ¹æ®èµ„æºçŠ¶æ€æ¥è·å–èµ„æºå¤„ç†å™¨</span></span><br><span class="line">      runGenerators();<span class="comment">// å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SWITCH_TO_SOURCE_SERVICE:</span><br><span class="line">      runGenerators();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DECODE_DATA:</span><br><span class="line">      decodeFromRetrievedData();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Unrecognized run reason: &quot;</span> + runReason);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>runReasonæ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œé»˜è®¤ä¸ºINITIALIZE</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function">DecodeJob&lt;R&gt; <span class="title">init</span><span class="params">(...)</span></span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.runReason = RunReason.INITIALIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°†ä¼šé€šè¿‡INITIALIZEæ¥è·å–èµ„æºçŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//runWrapped</span></span><br><span class="line">...</span><br><span class="line">stage = getNextStage(Stage.INITIALIZE);<span class="comment">// è·å–èµ„æºçŠ¶æ€</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h5 id="getNextStage"><a href="#getNextStage" class="headerlink" title="getNextStage()"></a>getNextStage()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function"><span class="keyword">private</span> Stage <span class="title">getNextStage</span><span class="params">(Stage current)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (current) &#123;</span><br><span class="line">    <span class="keyword">case</span> INITIALIZE:</span><br><span class="line">      <span class="keyword">return</span> diskCacheStrategy.decodeCachedResource()<span class="comment">// åˆ¤æ–­æ˜¯å¦ä½¿ç”¨å†…å­˜ç¼“å­˜</span></span><br><span class="line">          ? Stage.RESOURCE_CACHE</span><br><span class="line">          : getNextStage(Stage.RESOURCE_CACHE);</span><br><span class="line">    <span class="keyword">case</span> RESOURCE_CACHE:</span><br><span class="line">      <span class="keyword">return</span> diskCacheStrategy.decodeCachedData()<span class="comment">// åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç¡¬ç›˜ç¼“å­˜</span></span><br><span class="line">          ? Stage.DATA_CACHE</span><br><span class="line">          : getNextStage(Stage.DATA_CACHE);</span><br><span class="line">    <span class="keyword">case</span> DATA_CACHE:<span class="comment">// é…ç½®äº†ç¦ç”¨å†…å­˜ä¸ç£ç›˜ç¼“å­˜ï¼ŒgetNextStageå¾—åˆ°çš„stageä¸º SOURCE</span></span><br><span class="line">      <span class="comment">// Skip loading from source if the user opted to only retrieve the resource from cache.</span></span><br><span class="line">      <span class="keyword">return</span> onlyRetrieveFromCache ? Stage.FINISHED : Stage.SOURCE;</span><br><span class="line">    <span class="keyword">case</span> SOURCE:</span><br><span class="line">    <span class="keyword">case</span> FINISHED:</span><br><span class="line">      <span class="keyword">return</span> Stage.FINISHED;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unrecognized stage: &quot;</span> + current);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¼šå› ä¸ºä¼ é€’è¿›æ¥çš„æ˜¯INITIALIZEï¼Œæ‰€ä»¥ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªåˆ†æ”¯ã€‚å†…éƒ¨åˆ™ä¼šåˆ¤æ–­æ˜¯å¦ä½¿ç”¨å†…å­˜ç¼“å­˜ï¼Œå¦‚æœä½¿ç”¨çš„è¯ï¼Œè¿”å›çŠ¶æ€Stage.RESOURCE_CACHEã€‚ä¸ä½¿ç”¨çš„è¯ï¼Œåˆ™ç»§ç»­é€’å½’ä¼ å…¥ä¸‹ä¸€ä¸ªåˆ†æ”¯</p><p>å›åˆ°runWrapped()ï¼Œä¹‹åä¼šé€šè¿‡èµ„æºçŠ¶æ€æ¥è·å–èµ„æºæ‰§è¡Œå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//runWrapped</span></span><br><span class="line">...</span><br><span class="line">currentGenerator = getNextGenerator();</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h5 id="getNextGenerator"><a href="#getNextGenerator" class="headerlink" title="getNextGenerator()"></a>getNextGenerator()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function"><span class="keyword">private</span> DataFetcherGenerator <span class="title">getNextGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (stage) &#123;</span><br><span class="line">    <span class="keyword">case</span> RESOURCE_CACHE:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ResourceCacheGenerator(decodeHelper, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">case</span> DATA_CACHE:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> DataCacheGenerator(decodeHelper, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">case</span> SOURCE:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SourceGenerator(decodeHelper, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">case</span> FINISHED:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Unrecognized stage: &quot;</span> + stage);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç¦ç”¨äº†å†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜ï¼Œé‚£ä¹ˆè¿™é‡Œçš„<code>stage</code>ä¼šæ˜¯<code>Stage.SOURCE</code>ï¼Œåˆ™ä¼šè¿”å›<code>SourceGenerator()</code>,æ‹¿åˆ°èµ„æºæ‰§è¡Œå™¨ä¹‹åï¼Œå°±æ˜¯å¼€å§‹æ‰§è¡Œäº†ï¼Œè°ƒç”¨äº†<code>runGenerators()</code>æ–¹æ³•</p><h4 id="runGenerators"><a href="#runGenerators" class="headerlink" title="runGenerators()"></a>runGenerators()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">runGenerators</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  currentThread = Thread.currentThread();</span><br><span class="line">  startFetchTime = LogTime.getLogTime();</span><br><span class="line">  <span class="keyword">boolean</span> isStarted = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">while</span> (!isCancelled</span><br><span class="line">      &amp;&amp; currentGenerator != <span class="keyword">null</span></span><br><span class="line">      &amp;&amp; !(isStarted = currentGenerator.startNext())) &#123;</span><br><span class="line">    stage = getNextStage(stage);</span><br><span class="line">    currentGenerator = getNextGenerator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (stage == Stage.SOURCE) &#123;</span><br><span class="line">      reschedule();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// We&#x27;ve run out of stages and generators, give up.</span></span><br><span class="line">  <span class="keyword">if</span> ((stage == Stage.FINISHED || isCancelled) &amp;&amp; !isStarted) &#123;</span><br><span class="line">    notifyFailed();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Otherwise a generator started a new load and we expect to be called back in</span></span><br><span class="line">  <span class="comment">// onDataFetcherReady.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>whileæ¡ä»¶ä¸­è°ƒç”¨äº†<code>currentGenerator.startNext()</code>ï¼Œç”±è¿™é‡Œçš„<code>currentGenerator</code>æ˜¯<code>SourceGenerator</code>ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨<code>SourceGenerator.starNext()</code></p><h3 id="SourceGenerator"><a href="#SourceGenerator" class="headerlink" title="SourceGenerator"></a>SourceGenerator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (dataToCache != <span class="keyword">null</span>) &#123;</span><br><span class="line">    Object data = dataToCache;</span><br><span class="line">    dataToCache = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">boolean</span> isDataInCache = cacheData(data);</span><br><span class="line">      <span class="comment">// If we failed to write the data to cache, the cacheData method will try to decode the</span></span><br><span class="line">      <span class="comment">// original data directly instead of going through the disk cache. Since cacheData has</span></span><br><span class="line">      <span class="comment">// already called our callback at this point, there&#x27;s nothing more to do but return.</span></span><br><span class="line">      <span class="keyword">if</span> (!isDataInCache) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// If we were able to write the data to cache successfully, we now need to proceed to call</span></span><br><span class="line">      <span class="comment">// the sourceCacheGenerator below to load the data from cache.</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="comment">// An IOException means we weren&#x27;t able to write data to cache or we weren&#x27;t able to rewind</span></span><br><span class="line">      <span class="comment">// it after a disk cache write failed. In either case we can just move on and try the next</span></span><br><span class="line">      <span class="comment">// fetch below.</span></span><br><span class="line">      <span class="keyword">if</span> (Log.isLoggable(TAG, Log.DEBUG)) &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Failed to properly rewind or write data to cache&quot;</span>, e);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sourceCacheGenerator != <span class="keyword">null</span> &amp;&amp; sourceCacheGenerator.startNext()) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  sourceCacheGenerator = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  loadData = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">boolean</span> started = <span class="keyword">false</span>;</span><br><span class="line">  <span class="keyword">while</span> (!started &amp;&amp; hasNextModelLoader()) &#123;</span><br><span class="line">      <span class="comment">// é€šè¿‡hepler.getLoadData()æ¥è·å–LoadDataé›†åˆï¼Œç„¶åå†é€šè¿‡ç´¢å¼•æ¥è·å–å¯¹åº”çš„loadData</span></span><br><span class="line">    loadData = helper.getLoadData().get(loadDataListIndex++);</span><br><span class="line">      <span class="comment">// åˆ¤ç©º</span></span><br><span class="line">    <span class="keyword">if</span> (loadData != <span class="keyword">null</span></span><br><span class="line">        &amp;&amp; (helper.getDiskCacheStrategy().isDataCacheable(loadData.fetcher.getDataSource())</span><br><span class="line">            || helper.hasLoadPath(loadData.fetcher.getDataClass()))) &#123;</span><br><span class="line">      started = <span class="keyword">true</span>;</span><br><span class="line">      <span class="comment">// å¼€å§‹åŠ è½½</span></span><br><span class="line">      startNextLoad(loadData);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> started;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…ˆæ˜¯ä½¿ç”¨äº†<code>helper.getLoadData.get()</code>æ¥è·å–<code>loadData</code>ï¼Œå†è¿›è¡Œåˆ¤ç©ºï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™è°ƒç”¨<code>startNextLoad()</code></p><h4 id="helper-getLoadData-get"><a href="#helper-getLoadData-get" class="headerlink" title="helper.getLoadData.get()"></a>helper.getLoadData.get()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#DecodeHelper</span><br><span class="line">List&lt;LoadData&lt;?&gt;&gt; getLoadData() &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isLoadDataSet) &#123;</span><br><span class="line">    isLoadDataSet = <span class="keyword">true</span>;</span><br><span class="line">    loadData.clear();</span><br><span class="line">    List&lt;ModelLoader&lt;Object, ?&gt;&gt; modelLoaders = glideContext.getRegistry().getModelLoaders(model);</span><br><span class="line">    <span class="comment">//noinspection ForLoopReplaceableByForEach to improve perf</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = modelLoaders.size(); i &lt; size; i++) &#123;</span><br><span class="line">      ModelLoader&lt;Object, ?&gt; modelLoader = modelLoaders.get(i);</span><br><span class="line">      <span class="comment">// é€šè¿‡ ModelLoader å¯¹è±¡çš„ buildLoadData() æ–¹æ³•è·å–çš„ LoadData</span></span><br><span class="line">      <span class="comment">// ä»ç½‘ç»œåŠ è½½æ•°æ®ï¼Œè¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯ com.bumptech.glide.load.model.stream HttpGlideUrlLoader#buildLoadData()</span></span><br><span class="line">      LoadData&lt;?&gt; current = modelLoader.buildLoadData(model, width, height, options);</span><br><span class="line">      <span class="keyword">if</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line">        loadData.add(current);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> loadData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>å…ˆé€šè¿‡æˆå‘˜å˜é‡<code>modelLoaders</code>ï¼Œè·å–ä¸€ä¸ª<code>ModelLoader</code>å‡ºæ¥</p></li><li><p>å†è°ƒç”¨<code>buildLoadData</code>æ¥æ„å»ºä¸€ä¸ª<code>LoadData</code></p><blockquote><p><code>buildLoadData</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”±äºæˆ‘ä»¬å½“å‰çš„æ˜¯<code>SourceGenerator</code>ï¼Œä¹Ÿå°±æ˜¯åªæ˜¯ç½‘ç»œåŠ è½½ï¼Œæ‰€ä»¥è¿™é‡Œçš„<code>buildLoadData</code>å®é™…ä¸Šæ˜¯<code>HttpGlideUrlLoader.buildLoadData()</code></p></blockquote></li></ol><h5 id="HttpGlideUrlLoader-buildLoadData"><a href="#HttpGlideUrlLoader-buildLoadData" class="headerlink" title="HttpGlideUrlLoader.buildLoadData()"></a>HttpGlideUrlLoader.buildLoadData()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#HttpGlideUrlLoader</span><br><span class="line"><span class="function"><span class="keyword">public</span> LoadData&lt;InputStream&gt; <span class="title">buildLoadData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> GlideUrl model, <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="meta">@NonNull</span> Options options)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// GlideUrls memoize parsed URLs so caching them saves a few object instantiations and time</span></span><br><span class="line">  <span class="comment">// spent parsing urls.</span></span><br><span class="line">  GlideUrl url = model;<span class="comment">// å°†å›¾ç‰‡èµ„æºèµ‹å€¼ç»™å±€éƒ¨å˜é‡</span></span><br><span class="line">  <span class="keyword">if</span> (modelCache != <span class="keyword">null</span>) &#123;<span class="comment">// å¦‚æœmodelCacheä¸ä¸ºç©ºï¼Œåˆ™å°†å€¼è·å–å‡ºæ¥</span></span><br><span class="line">    url = modelCache.get(model, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (url == <span class="keyword">null</span>) &#123;<span class="comment">// å¦‚æœè·å–å‡ºæ¥ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºç¬¬ä¸€æ¬¡æ·»åŠ ï¼Œå°†æ·»åŠ åˆ°modelCacheä¸­å»</span></span><br><span class="line">      modelCache.put(model, <span class="number">0</span>, <span class="number">0</span>, model);</span><br><span class="line">      url = model;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> timeout = options.get(TIMEOUT);</span><br><span class="line">  <span class="comment">// å®ä¾‹åŒ– LoadData çš„æ—¶å€™é¡ºå¸¦å®ä¾‹åŒ–äº† HttpUrlFetcher</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LoadData&lt;&gt;(url, <span class="keyword">new</span> HttpUrlFetcher(url, timeout));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="startNextLoad"><a href="#startNextLoad" class="headerlink" title="startNextLoad"></a>startNextLoad</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#SourceGenerator</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startNextLoad</span><span class="params">(<span class="keyword">final</span> LoadData&lt;?&gt; toStart)</span> </span>&#123;</span><br><span class="line">  loadData.fetcher.loadData(</span><br><span class="line">      helper.getPriority(),</span><br><span class="line">      <span class="keyword">new</span> DataCallback&lt;Object&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDataReady</span><span class="params">(<span class="meta">@Nullable</span> Object data)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (isCurrentRequest(toStart)) &#123;</span><br><span class="line">            onDataReadyInternal(toStart, data);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadFailed</span><span class="params">(<span class="meta">@NonNull</span> Exception e)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (isCurrentRequest(toStart)) &#123;</span><br><span class="line">            onLoadFailedInternal(toStart, e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>loadData.fetcherå…¶å®å°±æ˜¯åˆšåˆšè¿”å›LoadDataçš„æ—¶å€™é¡ºä¾¿å®ä¾‹åŒ–çš„HttpUrlFetcher</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># interface ModelLoader</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LoadData</span><span class="params">(<span class="meta">@NonNull</span> Key sourceKey, <span class="meta">@NonNull</span> DataFetcher&lt;Data&gt; fetcher)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>(sourceKey, Collections.&lt;Key&gt;emptyList(), fetcher);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œæ˜¯è°ƒç”¨HttpUrlFetcher.loadData()</p></li></ol><h5 id="HttpUrlFetcher-loadData"><a href="#HttpUrlFetcher-loadData" class="headerlink" title="HttpUrlFetcher.loadData()"></a>HttpUrlFetcher.loadData()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Priority priority, <span class="meta">@NonNull</span> DataCallback&lt;? <span class="keyword">super</span> InputStream&gt; callback)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> startTime = LogTime.getLogTime();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡é‡å®šå‘åŠ è½½æ•°æ®</span></span><br><span class="line">    InputStream result = loadDataWithRedirects(glideUrl.toURL(), <span class="number">0</span>, <span class="keyword">null</span>, glideUrl.getHeaders());</span><br><span class="line">    <span class="comment">// åŠ è½½æˆåŠŸï¼Œå°†ç»“æœé€šè¿‡å›è°ƒä¼ é€’ç»™ä¸Šå±‚çš„currentGeneratorï¼Œä¹Ÿå°±æ˜¯SourceGenerator</span></span><br><span class="line">    callback.onDataReady(result);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (Log.isLoggable(TAG, Log.DEBUG)) &#123;</span><br><span class="line">      Log.d(TAG, <span class="string">&quot;Failed to load data for url&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    callback.onLoadFailed(e);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;</span><br><span class="line">      Log.v(TAG, <span class="string">&quot;Finished http url fetcher fetch in &quot;</span> + LogTime.getElapsedMillis(startTime));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HttpUrlFetcher.loadData()ä¸­ï¼Œè¦å…³æ³¨ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯loadDataWithRedirects()ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯callback.onDataReady()</p><ul><li><p>loadDataWithRedirects()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#HttpUrlFetcher</span><br><span class="line"><span class="keyword">private</span> HttpURLConnection urlConnection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> InputStream stream;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">private</span> InputStream <span class="title">loadDataWithRedirects</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    URL url, <span class="keyword">int</span> redirects, URL lastUrl, Map&lt;String, String&gt; headers)</span> <span class="keyword">throws</span> HttpException </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (redirects &gt;= MAXIMUM_REDIRECTS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(</span><br><span class="line">        <span class="string">&quot;Too many (&gt; &quot;</span> + MAXIMUM_REDIRECTS + <span class="string">&quot;) redirects!&quot;</span>, INVALID_STATUS_CODE);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Comparing the URLs using .equals performs additional network I/O and is generally broken.</span></span><br><span class="line">    <span class="comment">// See http://michaelscharf.blogspot.com/2006/11/javaneturlequals-and-hashcode-make.html.</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (lastUrl != <span class="keyword">null</span> &amp;&amp; url.toURI().equals(lastUrl.toURI())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="string">&quot;In re-direct loop&quot;</span>, INVALID_STATUS_CODE);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</span><br><span class="line">      <span class="comment">// Do nothing, this is best effort.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å°†urlå’Œå¤´éƒ¨ä¿¡æ¯ä¸€èµ·æ„å»ºä¸€ä¸ªHttpURLConnection</span></span><br><span class="line">  urlConnection = buildAndConfigureConnection(url, headers);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// æ˜ç¡®è¿æ¥ä»¥é¿å…è¿æ¥å¤±è´¥æ—¶è§£ç å™¨å‡ºç°é”™è¯¯ã€‚</span></span><br><span class="line">    <span class="comment">// å‘èµ·è¿æ¥</span></span><br><span class="line">    urlConnection.connect();</span><br><span class="line"><span class="comment">// è·å–è¾“å…¥æµ</span></span><br><span class="line">    stream = urlConnection.getInputStream();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(</span><br><span class="line">        <span class="string">&quot;Failed to connect or obtain data&quot;</span>, getHttpStatusCodeOrInvalid(urlConnection), e);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è·å–è¯·æ±‚çŠ¶æ€ç </span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> statusCode = getHttpStatusCodeOrInvalid(urlConnection);</span><br><span class="line">  <span class="keyword">if</span> (isHttpOk(statusCode)) &#123;<span class="comment">// åˆ¤æ–­æ˜¯å¦è¯·æ±‚æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">return</span> getStreamForSuccessfulRequest(urlConnection);<span class="comment">// è·å– InputStream</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isHttpRedirect(statusCode)) &#123;</span><br><span class="line">    String redirectUrlString = urlConnection.getHeaderField(REDIRECT_HEADER_FIELD);<span class="comment">// ä¼°è®¡æ˜¯è·å–å¤±è´¥ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> (TextUtils.isEmpty(redirectUrlString)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="string">&quot;Received empty or null redirect url&quot;</span>, statusCode);</span><br><span class="line">    &#125;</span><br><span class="line">    URL redirectUrl;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      redirectUrl = <span class="keyword">new</span> URL(url, redirectUrlString);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="string">&quot;Bad redirect url: &quot;</span> + redirectUrlString, statusCode, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç‰¹åˆ«éœ€è¦å…³é—­æµä»¥é¿å…é¢å¤–æ³„æ¼responsebody  </span></span><br><span class="line">    <span class="comment">// æ–­å¼€ä¸‹é¢çš„urlè¿æ¥</span></span><br><span class="line">    cleanup();</span><br><span class="line">    <span class="comment">// ç»§ç»­é€’å½’è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> loadDataWithRedirects(redirectUrl, redirects + <span class="number">1</span>, url, headers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (statusCode == INVALID_STATUS_CODE) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(statusCode);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(urlConnection.getResponseMessage(), statusCode);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="string">&quot;Failed to get a response message&quot;</span>, statusCode, e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°Glideå†…éƒ¨æ˜¯é€‰ç”¨äº†HttpURLConnectionæ¥è¿›è¡Œç½‘ç»œè¯·æ±‚çš„ï¼Œè¯·æ±‚æˆåŠŸä¹‹åè¿”å›äº†InputStream</p></li><li><p>callback.onDataReady()</p><p>callback.onDataReadyåˆ™æ˜¯å°†ç»“æœè¿”å›ç»™currentGenerator</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#SourceGenerator</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startNextLoad</span><span class="params">(<span class="keyword">final</span> LoadData&lt;?&gt; toStart)</span> </span>&#123;</span><br><span class="line">  loadData.fetcher.loadData(</span><br><span class="line">      helper.getPriority(),</span><br><span class="line">      <span class="keyword">new</span> DataCallback&lt;Object&gt;() &#123;<span class="comment">// ã€Š--è¿™é‡Œ</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDataReady</span><span class="params">(<span class="meta">@Nullable</span> Object data)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (isCurrentRequest(toStart)) &#123;</span><br><span class="line">            onDataReadyInternal(toStart, data);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadFailed</span><span class="params">(<span class="meta">@NonNull</span> Exception e)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (isCurrentRequest(toStart)) &#123;</span><br><span class="line">            onLoadFailedInternal(toStart, e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æˆ‘ä»¬ç»§ç»­é¡ºç€ä¸‹å»ï¼Œå»çœ‹ä¸€ä¸‹onDataReadyInternal()</p><h3 id="onDataReadyInternal"><a href="#onDataReadyInternal" class="headerlink" title="onDataReadyInternal"></a>onDataReadyInternal</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#SourceGenerator</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> FetcherReadyCallback cb;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Synthetic</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">onDataReadyInternal</span><span class="params">(LoadData&lt;?&gt; loadData, Object data)</span> </span>&#123;</span><br><span class="line">  DiskCacheStrategy diskCacheStrategy = helper.getDiskCacheStrategy();</span><br><span class="line">  <span class="keyword">if</span> (data != <span class="keyword">null</span> &amp;&amp; diskCacheStrategy.isDataCacheable(loadData.fetcher.getDataSource())) &#123;</span><br><span class="line">    dataToCache = data;</span><br><span class="line">    <span class="comment">// We might be being called back on someone else&#x27;s thread. Before doing anything, we should</span></span><br><span class="line">    <span class="comment">// reschedule to get back onto Glide&#x27;s thread.</span></span><br><span class="line">    cb.reschedule();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cb.onDataFetcherReady(</span><br><span class="line">        loadData.sourceKey,</span><br><span class="line">        data,</span><br><span class="line">        loadData.fetcher,</span><br><span class="line">        loadData.fetcher.getDataSource(),</span><br><span class="line">        originalKey);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹è¿˜æ˜¯ä¸€å¦‚æ—¢å¾€çš„è¿›è¡Œåˆ¤ç©ºå’Œä¸€äº›åˆ«çš„åˆ¤æ–­ï¼Œä¹‹åå°±æ˜¯è°ƒç”¨äº†FetcherReadyCallback.onDataFetcherReady</p><blockquote><p>FetcherReadyCallbackæ˜¯ä¸ªæ¥å£ï¼Œåªæœ‰SourceGeneratorå’ŒDecodeJobå®ç°äº†ã€‚æ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯è°ƒç”¨DecodeJob.onDataFetcherReady()</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDataFetcherReady</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Key sourceKey, Object data, DataFetcher&lt;?&gt; fetcher, DataSource dataSource, Key attemptedKey)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.currentSourceKey = sourceKey;</span><br><span class="line">  <span class="keyword">this</span>.currentData = data;</span><br><span class="line">  <span class="keyword">this</span>.currentFetcher = fetcher;</span><br><span class="line">  <span class="keyword">this</span>.currentDataSource = dataSource;</span><br><span class="line">  <span class="keyword">this</span>.currentAttemptingKey = attemptedKey;</span><br><span class="line">  <span class="keyword">this</span>.isLoadingFromAlternateCacheKey = sourceKey != decodeHelper.getCacheKeys().get(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯æŒ‡å®šçš„çº¿ç¨‹</span></span><br><span class="line">  <span class="keyword">if</span> (Thread.currentThread() != currentThread) &#123;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬åœ¨ä¸€ä¸ªä¸å±äºæˆ‘ä»¬çš„çº¿ç¨‹ä¸Šæ£€ç´¢äº†ä¸€äº›æ•°æ®ï¼Œå¹¶å¸Œæœ›åˆ‡æ¢å›æˆ‘ä»¬çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº›æ•°æ®ã€‚  </span></span><br><span class="line">    runReason = RunReason.DECODE_DATA;</span><br><span class="line">    callback.reschedule(<span class="keyword">this</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    GlideTrace.beginSection(<span class="string">&quot;DecodeJob.decodeFromRetrievedData&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// å¼€å§‹è§£ç </span></span><br><span class="line">      decodeFromRetrievedData();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      GlideTrace.endSection();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹æ³¨æ„decodeFromRetrievedData()ï¼Œç»è¿‡äº†è¿™ä¹ˆå¤šçš„è·³è½¬ï¼Œç»ˆäºè¦å¼€å§‹è§£ç äº†</p><h3 id="decodeFromRetrievedData"><a href="#decodeFromRetrievedData" class="headerlink" title="decodeFromRetrievedData()"></a>decodeFromRetrievedData()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="keyword">private</span> DataFetcher&lt;?&gt; currentFetcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object currentData;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> DataSource currentDataSource;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">decodeFromRetrievedData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;<span class="comment">// è¾“å‡ºæ—¥å¿—ä¿¡æ¯</span></span><br><span class="line">    logWithTimeAndKey(</span><br><span class="line">        <span class="string">&quot;Retrieved data&quot;</span>,</span><br><span class="line">        startFetchTime,</span><br><span class="line">        <span class="string">&quot;data: &quot;</span></span><br><span class="line">            + currentData</span><br><span class="line">            + <span class="string">&quot;, cache key: &quot;</span></span><br><span class="line">            + currentSourceKey</span><br><span class="line">            + <span class="string">&quot;, fetcher: &quot;</span></span><br><span class="line">            + currentFetcher);</span><br><span class="line">  &#125;</span><br><span class="line">  Resource&lt;R&gt; resource = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å¼€å§‹è§£ç </span></span><br><span class="line">    resource = decodeFromData(currentFetcher, currentData, currentDataSource);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (GlideException e) &#123;</span><br><span class="line">    e.setLoggingDetails(currentAttemptingKey, currentDataSource);</span><br><span class="line">    throwables.add(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (resource != <span class="keyword">null</span>) &#123;</span><br><span class="line">    notifyEncodeAndRelease(resource, currentDataSource, isLoadingFromAlternateCacheKey);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    runGenerators();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ«çš„æˆ‘ä»¬éƒ½å…ˆä¸ç®¡äº†ï¼Œå…ˆæŠŠä¸»æµç¨‹èµ°ä¸€éï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼ŒdecodeFromData(è§£ç )ã€notifyEncodeAndRelease(è§£ç å®Œæ¯•ï¼Œè¿›è¡Œé€šçŸ¥)</p><h4 id="decodeFromData"><a href="#decodeFromData" class="headerlink" title="decodeFromData"></a>decodeFromData</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="keyword">private</span> &lt;Data&gt; <span class="function">Resource&lt;R&gt; <span class="title">decodeFromData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    DataFetcher&lt;?&gt; fetcher, Data data, DataSource dataSource)</span> <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">long</span> startTime = LogTime.getLogTime();</span><br><span class="line">    <span class="comment">// ç»§ç»­è°ƒç”¨decodeFromFetcher</span></span><br><span class="line">    Resource&lt;R&gt; result = decodeFromFetcher(data, dataSource);</span><br><span class="line">    <span class="keyword">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;</span><br><span class="line">      logWithTimeAndKey(<span class="string">&quot;Decoded result &quot;</span> + result, startTime);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    fetcher.cleanup();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="decodeFromFetcher"><a href="#decodeFromFetcher" class="headerlink" title="decodeFromFetcher"></a>decodeFromFetcher</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="keyword">private</span> &lt;Data&gt; <span class="function">Resource&lt;R&gt; <span class="title">decodeFromFetcher</span><span class="params">(Data data, DataSource dataSource)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–è§£ç å™¨ï¼Œè§£ç å™¨é‡Œé¢å°è£…äº† DecodePathï¼Œå®ƒå°±æ˜¯ç”¨æ¥è§£ç è½¬ç çš„</span></span><br><span class="line">  LoadPath&lt;Data, ?, R&gt; path = decodeHelper.getLoadPath((Class&lt;Data&gt;) data.getClass());</span><br><span class="line">  <span class="comment">// é€šè¿‡è§£ç å™¨è§£ææ•°æ®</span></span><br><span class="line">  <span class="keyword">return</span> runLoadPath(data, dataSource, path);</span><br><span class="line">&#125;</span><br><span class="line">---åˆ†å‰²---</span><br><span class="line"><span class="keyword">private</span> &lt;Data, ResourceType&gt; <span class="function">Resource&lt;R&gt; <span class="title">runLoadPath</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Data data, DataSource dataSource, LoadPath&lt;Data, ResourceType, R&gt; path)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">  Options options = getOptionsWithHardwareConfig(dataSource);</span><br><span class="line">  <span class="comment">// è¿™é‡Œç›¸å½“äºæ˜¯åˆ›å»ºäº†ä¸ªä»»åŠ¡çš„ä¼ é€å¸¦</span></span><br><span class="line">  DataRewinder&lt;Data&gt; rewinder = glideContext.getRegistry().getRewinder(data);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ResourceType in DecodeCallback below is required for compilation to work with gradle.</span></span><br><span class="line">    <span class="comment">// æœ€åè¿˜æ˜¯å°†ä»»åŠ¡ä¼ é€’ç»™äº†path.load()</span></span><br><span class="line">    <span class="keyword">return</span> path.load(</span><br><span class="line">        rewinder, options, width, height, <span class="keyword">new</span> DecodeCallback&lt;ResourceType&gt;(dataSource));</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    rewinder.cleanup();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¿˜æ˜¯å°†ä»»åŠ¡ä¼ é€’ç»™äº†<code>path.load()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#LoadPath</span><br><span class="line"><span class="function"><span class="keyword">public</span> Resource&lt;Transcode&gt; <span class="title">load</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    DataRewinder&lt;Data&gt; rewinder,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">    DecodePath.DecodeCallback&lt;ResourceType&gt; decodeCallback)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">    <span class="comment">// ä»æ± ä¸­å–å‡ºæœ€åä¸€ä¸ªå®ä¾‹å‡ºæ¥å¹¶è¿›è¡Œåˆ¤ç©ºå¼‚å¸¸å¤„ç†</span></span><br><span class="line">  List&lt;Throwable&gt; throwables = Preconditions.checkNotNull(listPool.acquire());</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> loadWithExceptionList(rewinder, options, width, height, decodeCallback, throwables);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// æœ€åå°†è¿™äº›å®ä¾‹éƒ½é‡Šæ”¾æ‰</span></span><br><span class="line">    listPool.release(throwables);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">---åˆ†å‰²---</span><br><span class="line"><span class="function"><span class="keyword">private</span> Resource&lt;Transcode&gt; <span class="title">loadWithExceptionList</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    DataRewinder&lt;Data&gt; rewinder,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">    DecodePath.DecodeCallback&lt;ResourceType&gt; decodeCallback,</span></span></span><br><span class="line"><span class="function"><span class="params">    List&lt;Throwable&gt; exceptions)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">  Resource&lt;Transcode&gt; result = <span class="keyword">null</span>;</span><br><span class="line">  <span class="comment">//noinspection ForLoopReplaceableByForEach to improve perf</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = decodePaths.size(); i &lt; size; i++) &#123;</span><br><span class="line">    DecodePath&lt;Data, ResourceType, Transcode&gt; path = decodePaths.get(i);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      result = path.decode(rewinder, width, height, options, decodeCallback);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (GlideException e) &#123;</span><br><span class="line">      exceptions.add(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> GlideException(failureMessage, <span class="keyword">new</span> ArrayList&lt;&gt;(exceptions));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å°†è§£ç çš„ä»»åŠ¡äº¤ç»™äº†Decode Pathæ¥å®Œæˆï¼Œæ‰€ä»¥<code>DecodePath.decode()</code>æ‰æ˜¯çœŸæ­£å¼€å§‹è§£ææ•°æ®çš„</p><h5 id="DecodePath"><a href="#DecodePath" class="headerlink" title="DecodePath"></a>DecodePath</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#DecodePath</span><br><span class="line"><span class="function"><span class="keyword">public</span> Resource&lt;Transcode&gt; <span class="title">decode</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    DataRewinder&lt;DataType&gt; rewinder,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">    DecodeCallback&lt;ResourceType&gt; callback)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">  Resource&lt;ResourceType&gt; decoded = decodeResource(rewinder, width, height, options);</span><br><span class="line">  Resource&lt;ResourceType&gt; transformed = callback.onResourceDecoded(decoded);</span><br><span class="line">  <span class="keyword">return</span> transcoder.transcode(transformed, options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>å°†å›¾ç‰‡èµ„æºè¿›è¡Œè§£ç æˆåŸå§‹å›¾ç‰‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Resource&lt;ResourceType&gt; decoded = decodeResource(rewinder, width, height, options);</span><br></pre></td></tr></table></figure><h4 id="decodeResource"><a href="#decodeResource" class="headerlink" title="decodeResource"></a>decodeResource</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">#DecodePath</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Resource&lt;ResourceType&gt; <span class="title">decodeResource</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    DataRewinder&lt;DataType&gt; rewinder, <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="meta">@NonNull</span> Options options)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">  List&lt;Throwable&gt; exceptions = Preconditions.checkNotNull(listPool.acquire());</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> decodeResourceWithList(rewinder, width, height, options, exceptions);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    listPool.release(exceptions);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Resource&lt;ResourceType&gt; <span class="title">decodeResourceWithList</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    DataRewinder&lt;DataType&gt; rewinder,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> width,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">int</span> height,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Options options,</span></span></span><br><span class="line"><span class="function"><span class="params">    List&lt;Throwable&gt; exceptions)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> GlideException </span>&#123;</span><br><span class="line">  Resource&lt;ResourceType&gt; result = <span class="keyword">null</span>;</span><br><span class="line">  <span class="comment">//noinspection ForLoopReplaceableByForEach to improve perf</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = decoders.size(); i &lt; size; i++) &#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çš„èµ„æºè§£ç å™¨</span></span><br><span class="line">    ResourceDecoder&lt;DataType, ResourceType&gt; decoder = decoders.get(i);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      DataType data = rewinder.rewindAndGet();</span><br><span class="line">      <span class="keyword">if</span> (decoder.handles(data, options)) &#123;</span><br><span class="line">        data = rewinder.rewindAndGet();</span><br><span class="line">        <span class="comment">// å†è°ƒç”¨å¯¹åº”çš„è§£ç å™¨æ¥è¿›è¡Œè§£ç </span></span><br><span class="line">        result = decoder.decode(data, width, height, options);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Some decoders throw unexpectedly. If they do, we shouldn&#x27;t fail the entire load path, but</span></span><br><span class="line">      <span class="comment">// instead log and continue. See #2406 for an example.</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException | RuntimeException | OutOfMemoryError e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (Log.isLoggable(TAG, Log.VERBOSE)) &#123;</span><br><span class="line">        Log.v(TAG, <span class="string">&quot;Failed to decode data for &quot;</span> + decoder, e);</span><br><span class="line">      &#125;</span><br><span class="line">      exceptions.add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> GlideException(failureMessage, <span class="keyword">new</span> ArrayList&lt;&gt;(exceptions));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œéå†æ‹¿åˆ°å¯ä»¥è§£ç å½“å‰æ•°æ®çš„èµ„æºè§£ç å™¨ï¼Œç„¶åè°ƒç”¨ decode() æ–¹æ³•è¿›è¡Œè§£ç ã€‚</p><p>å› ä¸ºå½“å‰æ•°æ®æ˜¯ Input Streamï¼Œæ‰€ä»¥è¿™é‡Œéå†æ‹¿åˆ°çš„ Resource Decoder å…¶å®æ˜¯ StreamBitmapDecoderï¼Œæ‰€ä»¥è°ƒç”¨çš„æ˜¯ <code>StreamBitmapDecoder.decode()</code>StreamBitmapDecoderçš„å†…éƒ¨æ˜¯è°ƒç”¨<code>Downsampler.decode()</code>å°†è¾“å…¥æµè§£ç å˜æˆBitmapï¼Œæœ€åå°†BitmapåŒ…è£…æˆResourceè¿”å›</p></li><li><p>å°†åŸå§‹å›¾ç‰‡é€šè¿‡å›è°ƒé€šçŸ¥Decode Job</p><p>å›è°ƒæœ€ç»ˆä¼šå›åˆ°<code>DecodeJob.onResourceDecoded()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;Z&gt; <span class="function">Resource&lt;Z&gt; <span class="title">onResourceDecoded</span><span class="params">(DataSource dataSource, <span class="meta">@NonNull</span> Resource&lt;Z&gt; decoded)</span> </span>&#123;</span><br><span class="line">  <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">  Class&lt;Z&gt; resourceSubClass = (Class&lt;Z&gt;) decoded.get().getClass();</span><br><span class="line">  Transformation&lt;Z&gt; appliedTransformation = <span class="keyword">null</span>;</span><br><span class="line">  Resource&lt;Z&gt; transformed = decoded;</span><br><span class="line">  <span class="comment">// è¿™é‡Œåˆ¤æ–­èµ„æºæ˜¯å¦æ˜¯ä»ç¡¬ç›˜ä¸­è·å–çš„ï¼Œå¦‚æœä¸æ˜¯åˆ™éœ€è¦è¿›è¡Œè½¬æ¢</span></span><br><span class="line">  <span class="keyword">if</span> (dataSource != DataSource.RESOURCE_DISK_CACHE) &#123;</span><br><span class="line">    appliedTransformation = decodeHelper.getTransformation(resourceSubClass);</span><br><span class="line">    transformed = appliedTransformation.transform(glideContext, decoded, width, height);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Make this the responsibility of the Transformation.</span></span><br><span class="line">  <span class="keyword">if</span> (!decoded.equals(transformed)) &#123;</span><br><span class="line">    decoded.recycle();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> EncodeStrategy encodeStrategy;</span><br><span class="line">  <span class="keyword">final</span> ResourceEncoder&lt;Z&gt; encoder;</span><br><span class="line">  <span class="keyword">if</span> (decodeHelper.isResourceEncoderAvailable(transformed)) &#123;</span><br><span class="line">    encoder = decodeHelper.getResultEncoder(transformed);</span><br><span class="line">    encodeStrategy = encoder.getEncodeStrategy(options);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    encoder = <span class="keyword">null</span>;</span><br><span class="line">    encodeStrategy = EncodeStrategy.NONE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç¼“å­˜ç›¸å…³</span></span><br><span class="line">  Resource&lt;Z&gt; result = transformed;</span><br><span class="line">  <span class="keyword">boolean</span> isFromAlternateCacheKey = !decodeHelper.isSourceKey(currentSourceKey);</span><br><span class="line">  <span class="keyword">if</span> (diskCacheStrategy.isResourceCacheable(</span><br><span class="line">      isFromAlternateCacheKey, dataSource, encodeStrategy)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (encoder == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Registry.NoResultEncoderAvailableException(transformed.get().getClass());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> Key key;</span><br><span class="line">    <span class="keyword">switch</span> (encodeStrategy) &#123;</span><br><span class="line">      <span class="keyword">case</span> SOURCE:</span><br><span class="line">        key = <span class="keyword">new</span> DataCacheKey(currentSourceKey, signature);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> TRANSFORMED:</span><br><span class="line">        key =</span><br><span class="line">            <span class="keyword">new</span> ResourceCacheKey(</span><br><span class="line">                decodeHelper.getArrayPool(),</span><br><span class="line">                currentSourceKey,</span><br><span class="line">                signature,</span><br><span class="line">                width,</span><br><span class="line">                height,</span><br><span class="line">                appliedTransformation,</span><br><span class="line">                resourceSubClass,</span><br><span class="line">                options);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unknown strategy: &quot;</span> + encodeStrategy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LockedResource&lt;Z&gt; lockedResult = LockedResource.obtain(transformed);</span><br><span class="line">    deferredEncodeManager.init(key, encoder, lockedResult);</span><br><span class="line">    result = lockedResult;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯è¿›è¡Œèµ„æºè½¬æ¢çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬è®¾ç½®äº†center Cropä¹‹ç±»çš„ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œå¯¹åº”çš„è½¬æ¢ï¼Œæœ€åå°†ç»“æœè¿”å›å‡ºå»</p></li><li><p>è°ƒç”¨ <code>BitmapDrawableTranscoder.transcode()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Resource&lt;BitmapDrawable&gt; <span class="title">transcode</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Resource&lt;Bitmap&gt; toTranscode, <span class="meta">@NonNull</span> Options options)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> LazyBitmapDrawableResource.obtain(resources, toTranscode);</span><br><span class="line">&#125;</span><br><span class="line">---------</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Resource&lt;BitmapDrawable&gt; <span class="title">obtain</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Resources resources, <span class="meta">@Nullable</span> Resource&lt;Bitmap&gt; bitmapResource)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (bitmapResource == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> LazyBitmapDrawableResource(resources, bitmapResource);</span><br><span class="line">&#125;</span><br><span class="line">---------</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">LazyBitmapDrawableResource</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@NonNull</span> Resources resources, <span class="meta">@NonNull</span> Resource&lt;Bitmap&gt; bitmapResource)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.resources = Preconditions.checkNotNull(resources);</span><br><span class="line">  <span class="keyword">this</span>.bitmapResource = Preconditions.checkNotNull(bitmapResource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±æ˜¯å°†ä¼ å…¥è¿›æ¥çš„Bitmapå°è£…å†Resourceé‡Œé¢ï¼Œé¡ºä¾¿å†è¿›è¡Œä¸€ä¸‹åˆ¤ç©ºå¤„ç†</p></li></ol><h4 id="notifyEncodeAndRelease"><a href="#notifyEncodeAndRelease" class="headerlink" title="notifyEncodeAndRelease"></a>notifyEncodeAndRelease</h4><p>è§£ç éƒ¨åˆ†å®Œæˆäº†ï¼Œå‰©ä¸‹å°±æ˜¯è¦å°†ç»“æœé€šçŸ¥å‡ºå»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyEncodeAndRelease</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Resource&lt;R&gt; resource, DataSource dataSource, <span class="keyword">boolean</span> isLoadedFromAlternateCacheKey)</span> </span>&#123;</span><br><span class="line">  GlideTrace.beginSection(<span class="string">&quot;DecodeJob.notifyEncodeAndRelease&quot;</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resource <span class="keyword">instanceof</span> Initializable) &#123;</span><br><span class="line">      ((Initializable) resource).initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Resource&lt;R&gt; result = resource;</span><br><span class="line">    LockedResource&lt;R&gt; lockedResource = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (deferredEncodeManager.hasResourceToEncode()) &#123;</span><br><span class="line">      lockedResource = LockedResource.obtain(resource);</span><br><span class="line">      result = lockedResource;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é€šçŸ¥å®Œæˆ</span></span><br><span class="line">    notifyComplete(result, dataSource, isLoadedFromAlternateCacheKey);</span><br><span class="line"></span><br><span class="line">    stage = Stage.ENCODE;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (deferredEncodeManager.hasResourceToEncode()) &#123;</span><br><span class="line">        deferredEncodeManager.encode(diskCacheProvider, options);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (lockedResource != <span class="keyword">null</span>) &#123;</span><br><span class="line">        lockedResource.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Call onEncodeComplete outside the finally block so that it&#x27;s not called if the encode</span></span><br><span class="line">    <span class="comment">// process</span></span><br><span class="line">    <span class="comment">// throws.</span></span><br><span class="line">    <span class="comment">// é‡Šæ”¾å„ç§èµ„æº</span></span><br><span class="line">    onEncodeComplete();</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    GlideTrace.endSection();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé€šè¿‡<code>notifyComplete()</code>è¿›ä¸€æ­¥çš„å°†ç»“æœé€šçŸ¥ç»™å¤–éƒ¨ï¼ŒnotifyComleteå†…éƒ¨ä½¿ç”¨é€šè¿‡<code>callback.onResourceReady()</code>æ¥è¿›è¡Œå›è°ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#DecodeJob</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">notifyComplete</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Resource&lt;R&gt; resource, DataSource dataSource, <span class="keyword">boolean</span> isLoadedFromAlternateCacheKey)</span> </span>&#123;</span><br><span class="line">  setNotifiedOrThrow();</span><br><span class="line">  <span class="comment">// é€šçŸ¥ç»“æœå›è°ƒ</span></span><br><span class="line">  callback.onResourceReady(resource, dataSource, isLoadedFromAlternateCacheKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå®ç°äº†callbackçš„åªæœ‰Engine Jobä¸€ä¸ªï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯å°†ç»“æœè¿”å›ç»™äº†Engine Job</p><h3 id="EnginJob"><a href="#EnginJob" class="headerlink" title="EnginJob"></a>EnginJob</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    Resource&lt;R&gt; resource, DataSource dataSource, <span class="keyword">boolean</span> isLoadedFromAlternateCacheKey)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.resource = resource;</span><br><span class="line">    <span class="keyword">this</span>.dataSource = dataSource;</span><br><span class="line">    <span class="keyword">this</span>.isLoadedFromAlternateCacheKey = isLoadedFromAlternateCacheKey;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é€šçŸ¥ç»“æœå›è°ƒ</span></span><br><span class="line">  notifyCallbacksOfResult();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Synthetic</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">notifyCallbacksOfResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ResourceCallbacksAndExecutors copy;</span><br><span class="line">  Key localKey;</span><br><span class="line">  EngineResource&lt;?&gt; localResource;</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    stateVerifier.throwIfRecycled();</span><br><span class="line">    <span class="comment">// å¦‚æœå–æ¶ˆï¼Œåˆ™å›æ”¶å’Œé‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">if</span> (isCancelled) &#123;</span><br><span class="line">      resource.recycle();</span><br><span class="line">      release();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cbs.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Received a resource without any callbacks to notify&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hasResource) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Already have resource&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    engineResource = engineResourceFactory.build(resource, isCacheable, key, resourceListener);</span><br><span class="line">      </span><br><span class="line">    hasResource = <span class="keyword">true</span>;</span><br><span class="line">    copy = cbs.copy();</span><br><span class="line">    incrementPendingCallbacks(copy.size() + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    localKey = key;</span><br><span class="line">    localResource = engineResource;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¿™é‡Œè¡¨ç¤º EngineJob å®Œæˆäº†ï¼Œå›è°ƒç»™ Engine</span></span><br><span class="line">  engineJobListener.onEngineJobComplete(<span class="keyword">this</span>, localKey, localResource);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//éå† copy åæ‹¿åˆ°äº†çº¿ç¨‹æ± çš„æ‰§è¡Œå™¨ï¼ˆentry.executorï¼‰</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">final</span> ResourceCallbackAndExecutor entry : copy) &#123;</span><br><span class="line">    entry.executor.execute(<span class="keyword">new</span> CallResourceReady(entry.cb));</span><br><span class="line">  &#125;</span><br><span class="line">  decrementPendingCallbacks();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦éƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>engineJobListener.onEngineJobComplete()</code>ã€ç¬¬äºŒä¸ªä¸º<code>entry.executor.execute()</code></p><ul><li><p><code>engineJobListener.onEngineJobComplete()</code></p><p>å†…éƒ¨ä¸»è¦åˆ¤æ–­æ˜¯å¦é…ç½®äº†å†…å­˜ç¼“å­˜ï¼Œå¦‚æœæœ‰ï¼Œåˆ™è¿›è¡Œå†…å­˜ç¼“å­˜</p></li><li><p><code>entry.executor.execute()</code></p><p>è¿™é‡Œçš„executorå…¶å®å°±æ˜¯æœ€ä¸Šæ–¹çš„ä¼ å…¥è¿›æ¥çš„<code>Executors.mainThreadExecutor()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#RequestBuilder</span><br><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="keyword">public</span> &lt;Y extends Target&lt;TranscodeType&gt;&gt; <span class="function">Y <span class="title">into</span><span class="params">(<span class="meta">@NonNull</span> Y target)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> into(target, <span class="comment">/*targetListener=*/</span> <span class="keyword">null</span>, Executors.mainThreadExecutor());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Executors</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Executors</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">Executors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Utility class.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor MAIN_THREAD_EXECUTOR =</span><br><span class="line">      <span class="keyword">new</span> Executor() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="meta">@NonNull</span> Runnable command)</span> </span>&#123;</span><br><span class="line">          Util.postOnUiThread(command);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor DIRECT_EXECUTOR =</span><br><span class="line">      <span class="keyword">new</span> Executor() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="meta">@NonNull</span> Runnable command)</span> </span>&#123;</span><br><span class="line">          command.run();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Posts executions to the main thread. */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Executor <span class="title">mainThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> MAIN_THREAD_EXECUTOR;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Immediately calls &#123;<span class="doctag">@link</span> Runnable#run()&#125; on the current thread. */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Executor <span class="title">directExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> DIRECT_EXECUTOR;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@VisibleForTesting</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shutdownAndAwaitTermination</span><span class="params">(ExecutorService pool)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> shutdownSeconds = <span class="number">5</span>;</span><br><span class="line">    pool.shutdownNow();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!pool.awaitTermination(shutdownSeconds, TimeUnit.SECONDS)) &#123;</span><br><span class="line">        pool.shutdownNow();</span><br><span class="line">        <span class="keyword">if</span> (!pool.awaitTermination(shutdownSeconds, TimeUnit.SECONDS)) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Failed to shutdown&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">      pool.shutdownNow();</span><br><span class="line">      Thread.currentThread().interrupt();</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Executors.mainThreadExecutor()</code>å…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸ªExecutorså®ä¾‹ï¼Œç„¶åå†…éƒ¨é‡å†™äº†execute()æ–¹æ³•ï¼Œè¿˜æ˜¯ä½¿ç”¨Handleræ¥postä¸€ä¸ªä¸€ä¸ªä»»åŠ¡å¹¶åˆ‡æ¢åˆ°äº†ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥ç°åœ¨åªç”¨å»æŸ¥çœ‹<code>CallResourceReady.run()</code>å³å¯</p><h4 id="CallResourceReady"><a href="#CallResourceReady" class="headerlink" title="CallResourceReady"></a>CallResourceReady</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#EngineJob</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">CallResourceReady</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ResourceCallback cb;</span><br><span class="line"></span><br><span class="line">  CallResourceReady(ResourceCallback cb) &#123;</span><br><span class="line">    <span class="keyword">this</span>.cb = cb;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (cb.getLock()) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (EngineJob.<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cbs.contains(cb)) &#123;</span><br><span class="line">          <span class="comment">// Acquire for this particular callback.</span></span><br><span class="line">          engineResource.acquire();</span><br><span class="line">          callCallbackOnResourceReady(cb);</span><br><span class="line">          removeCallback(cb);</span><br><span class="line">        &#125;</span><br><span class="line">        decrementPendingCallbacks();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">callCallbackOnResourceReady</span><span class="params">(ResourceCallback cb)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// èµ„æºå‡†å¤‡å®Œæˆåï¼Œè¿˜æ˜¯é€šè¿‡å›è°ƒï¼Œä¼ é€’ç»™ä¸Šä¸€å±‚</span></span><br><span class="line">    cb.onResourceReady(engineResource, dataSource);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> CallbackException(t);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œçš„<code>cb.onResourceReady()</code>æ˜¯ç›´æ¥å›è°ƒç»™äº†<code>SingleRequest.onResourceReady()</code>ï¼Œ<code>SingleRequest.onResourceReady()</code>å†…éƒ¨ä¸»è¦æ˜¯å¤„ç†ä¸€äº›åŠ è½½å¤±è´¥çš„åˆ¤æ–­ï¼Œç„¶åè°ƒç”¨é‡è½½æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//onResourceReady()</span></span><br><span class="line">onResourceReady(</span><br><span class="line">    (Resource&lt;R&gt;) resource, (R) received, dataSource, isLoadedFromAlternateCacheKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="onResourceReady"><a href="#onResourceReady" class="headerlink" title="onResourceReady"></a>onResourceReady</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">     Resource&lt;R&gt; resource, R result, DataSource dataSource, <span class="keyword">boolean</span> isAlternateCacheKey)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// We must call isFirstReadyResource before setting status.</span></span><br><span class="line">   <span class="keyword">boolean</span> isFirstResource = isFirstReadyResource();</span><br><span class="line">   status = Status.COMPLETE;</span><br><span class="line">   <span class="keyword">this</span>.resource = resource;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (glideContext.getLogLevel() &lt;= Log.DEBUG) &#123;</span><br><span class="line">     Log.d( GLIDE_TAG,  <span class="string">&quot;...â€œ);</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   isCallingCallbacks = true;</span></span><br><span class="line"><span class="string">   try &#123;</span></span><br><span class="line"><span class="string">     boolean anyListenerHandledUpdatingTarget = false;</span></span><br><span class="line"><span class="string">     if (requestListeners != null) &#123;</span></span><br><span class="line"><span class="string">       for (RequestListener&lt;R&gt; listener : requestListeners) &#123;</span></span><br><span class="line"><span class="string">         anyListenerHandledUpdatingTarget |=</span></span><br><span class="line"><span class="string">             listener.onResourceReady(result, model, target, dataSource, isFirstResource);</span></span><br><span class="line"><span class="string">       &#125;</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string">     anyListenerHandledUpdatingTarget |=</span></span><br><span class="line"><span class="string">         targetListener != null</span></span><br><span class="line"><span class="string">             &amp;&amp; targetListener.onResourceReady(result, model, target, dataSource, isFirstResource);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     if (!anyListenerHandledUpdatingTarget) &#123;</span></span><br><span class="line"><span class="string">       Transition&lt;? super R&gt; animation = animationFactory.build(dataSource, isFirstResource);</span></span><br><span class="line"><span class="string">       // è¿™é‡Œçš„targetæ˜¯ImageViewTargetï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ç›´æ¥å›è°ƒç»™ImageViewTarget</span></span><br><span class="line"><span class="string">       target.onResourceReady(result, animation);</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string">   &#125; finally &#123;</span></span><br><span class="line"><span class="string">     isCallingCallbacks = false;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">   // é€šçŸ¥åŠ è½½æˆåŠŸ</span></span><br><span class="line"><span class="string">   notifyLoadSuccess();</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>æœ€åå†<code>ImageViewTarget.onResourceReady()</code>å†…éƒ¨ä¼šåˆ¤æ–­ä¼ å…¥çš„animationæ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºçš„è¯å°±ä¼šç›´æ¥è®¾ç½®å›¾ç‰‡ã€‚ä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™ä¼šè°ƒç”¨animation</p><p>animationä¸ºç©º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#ImageViewTarget</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setResourceInternal</span><span class="params">(<span class="meta">@Nullable</span> Z resource)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Order matters here. Set the resource first to make sure that the Drawable has a valid and</span></span><br><span class="line">  <span class="comment">// non-null Callback before starting it.</span></span><br><span class="line">  setResource(resource);</span><br><span class="line">  maybeUpdateAnimatable(resource);</span><br><span class="line">&#125;</span><br><span class="line">---------</span><br><span class="line">#BitmapImageViewTarget</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setResource</span><span class="params">(Bitmap resource)</span> </span>&#123;</span><br><span class="line">  view.setImageBitmap(resource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå°†å›¾ç‰‡è®¾ç½®åˆ°Image Viewä¸Šå»</p><p>animationä¸ä¸ºç©º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#ImageViewTarget</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">maybeUpdateAnimatable</span><span class="params">(<span class="meta">@Nullable</span> Z resource)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (resource <span class="keyword">instanceof</span> Animatable) &#123;</span><br><span class="line">    animatable = (Animatable) resource;</span><br><span class="line">    animatable.start();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    animatable = <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>into()æ–¹æ³•ååˆ†å¤æ‚ï¼Œä¸»è¦å°±æ˜¯å…ˆä»å†…å­˜ä¸­è¿›è¡Œè·å–ï¼Œæ²¡æœ‰çš„è¯ï¼Œå†å»ç¡¬ç›˜ä¸­è·å–ï¼Œéƒ½æ²¡æœ‰åˆ™é€šè¿‡HttpURLconnectionæ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œå…¶æ¬¡åœ¨å°†ç»“æœç»™Decode Pathè¿›è¡Œè§£ç ï¼Œè§£ç å®Œæˆå°†ç»“æœå°è£…æˆResourceé€šè¿‡å›è°ƒå±‚å±‚ä¼ é€’ï¼Œä¸­é—´é¡ºä¾¿åˆ¤æ–­æ˜¯å¦éœ€è¦ç¼“å­˜åˆ°ç¡¬ç›˜ã€å†…å­˜ã€æ˜¯å¦éœ€è¦è¿›è¡Œå½¢çŠ¶å˜åŒ–ã€‚æœ€ç»ˆå°†ç»“æœè®¾ç½®åˆ°Image Viewä¸Šå»</p>]]></content>
      
      
      
        <tags>
            
            <tag> Glide </tag>
            
            <tag> æºç å‰–æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Androidè·¨è¿›ç¨‹é€šä¿¡-AIDL(ä½¿ç”¨)</title>
      <link href="2021/08/28/Android%E8%B7%A8%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1-AIDL-%E4%BD%BF%E7%94%A8/"/>
      <url>2021/08/28/Android%E8%B7%A8%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1-AIDL-%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»è¿›ç¨‹é—´é€šä¿¡(IPC)æœºåˆ¶-AIDL</p><a id="more"></a><h1 id="Androidè·¨è¿›ç¨‹é€šä¿¡-AIDL-ä½¿ç”¨"><a href="#Androidè·¨è¿›ç¨‹é€šä¿¡-AIDL-ä½¿ç”¨" class="headerlink" title="Androidè·¨è¿›ç¨‹é€šä¿¡-AIDL(ä½¿ç”¨)"></a>Androidè·¨è¿›ç¨‹é€šä¿¡-AIDL(ä½¿ç”¨)</h1><blockquote><p>æœ¬æ–‡å°†ä»‹ç»è¿›ç¨‹é—´é€šä¿¡(IPC)æœºåˆ¶-AIDL</p></blockquote><h2 id="AIDLä»‹ç»"><a href="#AIDLä»‹ç»" class="headerlink" title="AIDLä»‹ç»"></a>AIDLä»‹ç»</h2><p>ADILæ˜¯Androidä¸­è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒå®šä¹‰å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡çš„ç¼–ç¨‹æ¥å£</p><p>åœ¨Androidä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹æ˜¯æ— æ³•è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³è¿›ç¨‹é—´é€šè®¯çš„é—®é¢˜ï¼ŒAndroidä½¿ç”¨ä¸€ç§æ¥å£å®šä¹‰è¯­è¨€æ¥å…¬å¼€æœåŠ¡çš„<strong>æ¥å£</strong>ï¼Œæœ¬è´¨ä¸Šï¼ŒAIDLéå¸¸åƒä¸€ä¸ªæ¥å£ï¼Œé€šè¿‡å…¬å¼€æ¥å£ï¼Œè®©åˆ«çš„è¿›ç¨‹è°ƒç”¨è¯¥æ¥å£ï¼Œä»è€Œå®ç°è¿›ç¨‹é—´çš„é€šè®¯ã€‚</p><h2 id="ä½¿ç”¨AIDL"><a href="#ä½¿ç”¨AIDL" class="headerlink" title="ä½¿ç”¨AIDL"></a>ä½¿ç”¨AIDL</h2><h3 id="æ•°æ®å®ä½“ç±»"><a href="#æ•°æ®å®ä½“ç±»" class="headerlink" title="æ•°æ®å®ä½“ç±»"></a>æ•°æ®å®ä½“ç±»</h3><p>é¦–å…ˆå…ˆåˆ›å»ºä¸€ä¸ªå®ä½“æ•°æ®ç±»ï¼Œç”¨æ¥è¿›ç¨‹é—´è¿›è¡Œé€šä¿¡</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(</span><br><span class="line">    <span class="keyword">val</span> name: String?,</span><br><span class="line">    <span class="keyword">val</span> age: <span class="built_in">Int</span></span><br><span class="line">) : Parcelable &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(parcel: Parcel) : <span class="keyword">this</span>(</span><br><span class="line">        parcel.readString(),</span><br><span class="line">        parcel.readInt()</span><br><span class="line">    ) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">writeToParcel</span><span class="params">(parcel: <span class="type">Parcel</span>, flags: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        parcel.writeString(name)</span><br><span class="line">        parcel.writeInt(age)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">describeContents</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> CREATOR : Parcelable.Creator&lt;Person&gt; &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createFromParcel</span><span class="params">(parcel: <span class="type">Parcel</span>)</span></span>: Person &#123;</span><br><span class="line">            <span class="keyword">return</span> Person(parcel)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">newArray</span><span class="params">(size: <span class="type">Int</span>)</span></span>: Array&lt;Person?&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> arrayOfNulls(size)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼è¿™é‡Œçš„Personçš„ç›®å½•ç»“æ„å¿…é¡»è¦å’Œä¸‹æ–¹åˆ›å»ºçš„aidlæ–‡ä»¶ç›®å½•ç»“æ„ä¸€è‡´</p><p>ä»€ä¹ˆæ„æ€å‘¢ï¼Œå°±æ˜¯è¯´è¿™é‡Œåˆ›å»ºçš„Personç±»æ˜¯ç›´æ¥æ”¾åœ¨javaä¸‹çš„ï¼Œé‚£ä¹ˆç­‰ä¸‹åˆ›å»ºçš„aidlæ–‡ä»¶ä¹Ÿå¿…é¡»æ˜¯åœ¨æœ€å¤–å±‚</p></blockquote><p>è¿™ä¸ªç±»è¿˜éœ€è¦å®ç°Parcelableæ¥å£ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºAIDLåªæ”¯æŒå‡ ç§æ•°æ®ç±»å‹</p><ol><li>javaåŸºæœ¬ç±»å‹</li><li>Listã€Map</li><li>å®ç°äº†Parcelableæ¥å£</li></ol><p>æ‰€ä»¥è¯´è¿™é‡Œéœ€è¦ç»§æ‰¿Parcelable</p><h3 id="AIDLæ¥å£"><a href="#AIDLæ¥å£" class="headerlink" title="AIDLæ¥å£"></a>AIDLæ¥å£</h3><blockquote><p>åœ¨Android Studioé«˜ç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡å³é”®åˆ›å»ºçš„.aidlæ–‡ä»¶éƒ½ä¼šè¢«Android Studioå¼ºåˆ¶æ”¾åˆ°mainä¸‹çš„aidlæ–‡ä»¶å¤¹ä¸­</p><p>è¿™é‡Œçš„aidlæ–‡ä»¶æ˜¯æ”¾åœ¨æœ€å¤–å±‚çš„ï¼Œé‚£ä¹ˆåˆšåˆšåˆ›å»ºçš„Personæ–‡ä»¶ä¹Ÿæ˜¯éœ€è¦æ”¾åœ¨javaä¸‹çš„æœ€å¤–å±‚</p></blockquote><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210826194036950.png" alt="image-20210826194036950"></p><p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨aidlæ–‡ä»¶å¤¹ä¸‹åœ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—ä¸ºåŒ…åå³å¯</p><p>ä¹‹åï¼Œé¦–å…ˆå…ˆåˆ›å»ºä¸€ä¸ªåå­—ä¸ºPerson.aidlç±»ï¼Œæ˜¯çš„ï¼Œè¿™é‡Œçš„åå­—ä¸ä¸Šé¢åˆ›å»ºçš„æ•°æ®å®ä½“ç±»çš„åç§°ç›¸åŒ</p><blockquote><p>è¿™é‡Œçš„ Person æˆ‘ç†è§£çš„æ˜¯ Person.aidlï¼Œç„¶åé€šè¿‡ Person.aidl åˆæ‰¾åˆ°çœŸæ­£çš„å®ä½“ Person ç±»ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Person.aidl</span></span><br><span class="line"><span class="keyword">package</span> com.example.studynode;</span><br><span class="line"></span><br><span class="line">parcelable Person;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†è‡ªå®šä¹‰Parcelableå¯¹è±¡ï¼Œæ¥ç€æˆ‘ä»¬å»å®šä¹‰ä¸ªæ¥å£ç”¨æ¥é€šä¿¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IMyAidl.aidl</span></span><br><span class="line"><span class="keyword">package</span> com.example.studynode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.studynode.Person;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IMyAidl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addPerson</span><span class="params">(in Person person)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Person&gt; <span class="title">getPersonList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥æ·»åŠ æ•°æ®ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥è·å–æ€»å…±çš„æ•°æ®ã€‚ä¹‹åå°±åªéœ€ç‚¹ä¸€ä¸‹æœ‰å³ä¸Šè§’çš„å°é”¤å­(Make Project)å°±okäº†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨çš„ç”Ÿæˆä¸€ä¸ªjavaæ–‡ä»¶</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><p>è¿™é‡Œå°±ä½¿ç”¨Serviceæ¥è¿›è¡Œè·¨è¿›ç¨‹é€šä¿¡ï¼Œæ‰€ä»¥å°±å…ˆåˆ›å»ºä¸€ä¸ªService</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AidlService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mPersons: ArrayList&lt;Person&gt;? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mInBinder: IBinder = <span class="keyword">object</span> : IMyAidl.Stub() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">addPerson</span><span class="params">(person: <span class="type">Person</span>)</span></span> &#123;</span><br><span class="line">            mPersons?.add(person)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getPersonList</span><span class="params">()</span></span>: MutableList&lt;Person&gt;? &#123;</span><br><span class="line">            <span class="keyword">return</span> mPersons</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>?)</span></span>: IBinder &#123;</span><br><span class="line">        mPersons = ArrayList()</span><br><span class="line">        <span class="keyword">return</span> mInBinder</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ€»å…±åˆ›å»ºäº†ä¸¤ä¸ªä¸œè¥¿</p><ol><li>åˆ›å»ºäº†ä¸€ä¸ªArrayListï¼Œç”¨æ¥å­˜æ”¾æ•°æ®</li><li>ä¸ºäº†å®ç°æ¥è‡ª.aidlæ–‡ä»¶ç”Ÿæˆçš„æ¥å£ï¼Œéœ€è¦ç»§æ‰¿Binderæ¥å£ï¼ˆä¾‹å¦‚Ibinderæ¥å£),å¹¶ä¸”å®ç°ä».aidlæ–‡ä»¶ä¸­ç»§æ‰¿æ³•ï¼Œåœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œä½¿ç”¨åŒ¿åå®ä¾‹å®ç°ä¸€ä¸ªå«IMyAidlï¼ˆå®šä¹‰åœ¨IMyAidl.aidlä¸­ï¼‰çš„æ¥å£ï¼Œå®ç°äº†ä¸¤ä¸ªæ–¹æ³•ï¼ŒaddPersonå’ŒgetPersonList</li></ol><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AidlActivity</span> : <span class="type">BaseSimpleActivity</span>&lt;<span class="type">ActivityAidlBinding</span>&gt;</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> binding: ActivityAidlBinding <span class="keyword">by</span> lazy &#123; ActivityAidlBinding.inflate(layoutInflater) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> iMyAidl: IMyAidl? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> adapter: AidlAdapter <span class="keyword">by</span> lazy &#123; AidlAdapter() &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> serviceConnection: ServiceConnection = <span class="keyword">object</span> : ServiceConnection &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceConnected</span><span class="params">(name: <span class="type">ComponentName</span>?, service: <span class="type">IBinder</span>?)</span></span> &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;AIDL&quot;</span>, <span class="string">&quot;onServiceConnected: ç»‘å®šServiceæˆåŠŸ&quot;</span>)</span><br><span class="line">            iMyAidl = IMyAidl.Stub.asInterface(service)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceDisconnected</span><span class="params">(name: <span class="type">ComponentName</span>?)</span></span> &#123;</span><br><span class="line">            iMyAidl = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        binding.aidlList.apply &#123;</span><br><span class="line">            layoutManager =</span><br><span class="line">                LinearLayoutManager(<span class="keyword">this</span><span class="symbol">@AidlActivity</span>)</span><br><span class="line">            adapter = <span class="keyword">this</span><span class="symbol">@AidlActivity</span>.adapter</span><br><span class="line">        &#125;</span><br><span class="line">        binding.aidlButton1.setOnClickListener &#123;</span><br><span class="line">            iMyAidl?.addPerson(Person(<span class="string">&quot;Tom&quot;</span>, Random.nextInt(<span class="number">10</span>)))</span><br><span class="line">        &#125;</span><br><span class="line">        binding.aidlButton2.setOnClickListener &#123;</span><br><span class="line">            iMyAidl?.personList?.let &#123;</span><br><span class="line">                adapter.setList(it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">initData</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> intent = Intent().apply &#123;</span><br><span class="line">            component = ComponentName(</span><br><span class="line">                <span class="string">&quot;com.example.studynode&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.example.studynode.aidl.service.AidlService&quot;</span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œä¸»è¦å°±æ˜¯ç»‘å®šäº†Serviceï¼Œè‡³äºIMyAidlè¿™ä¸ªç±»å°±æ˜¯ç³»ç»Ÿä¸ºæˆ‘ä»¬åˆšåˆšå†™çš„aidlæ¥å£è‡ªåŠ¨åˆ›å»ºçš„ç±»ã€‚ç„¶åæˆ‘ä»¬åœ¨ç»‘å®šæœåŠ¡ä¸­æ‹¿åˆ°äº†Binderå¹¶è½¬æ¢æˆäº†AIDLï¼Œæœ€åé€šè¿‡æŒ‰é’®æ¥è¿›è¡Œé€šä¿¡ï¼ŒæŒ‰ä¸‹æŒ‰é’®å°±å‘Servlceå¤šæ·»åŠ ç»„æ•°æ®ï¼Œç„¶åä½¿ç”¨Recyclerå±•ç¤ºå‡ºæ¥</p><blockquote><p>ComponentNameï¼šè¿™ä¸ªç±»ä¸»è¦ç”¨æ¥å®šä¹‰å¯è§ä¸€ä¸ªåº”ç”¨ç¨‹åºç»„ä»¶ï¼Œä¾‹å¦‚ï¼šActivityï¼ŒServiceï¼ŒBroadcastReceiveræˆ–è€…ContentProviderã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨ComponentNameæ¥å¯åŠ¨å››å¤§ç»„ä»¶</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> IPC </tag>
            
            <tag> è·¨è¿›ç¨‹é€šä¿¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kotlin - åç¨‹</title>
      <link href="2021/07/08/Kotlin-%E5%8D%8F%E7%A8%8B/"/>
      <url>2021/07/08/Kotlin-%E5%8D%8F%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»Androidä¸­çš„åç¨‹</p><a id="more"></a><h1 id="Kotlin-åç¨‹"><a href="#Kotlin-åç¨‹" class="headerlink" title="Kotlin - åç¨‹"></a>Kotlin - åç¨‹</h1><blockquote><p>å¼‚æ­¥ç¼–ç¨‹ ä¹‹ä¸€ åç¨‹</p></blockquote><h3 id="åç¨‹çš„åŸºæœ¬ä»‹ç»"><a href="#åç¨‹çš„åŸºæœ¬ä»‹ç»" class="headerlink" title="åç¨‹çš„åŸºæœ¬ä»‹ç»"></a>åç¨‹çš„åŸºæœ¬ä»‹ç»</h3><p>åç¨‹å°±éå¸¸è½»é‡çº§çš„çº¿ç¨‹ï¼Œçº¿ç¨‹æ˜¯ç”±ç³»ç»Ÿè°ƒåº¦çš„ã€‚çº¿ç¨‹å®ƒåœ¨è¿›è¡Œåˆ‡æ¢æˆ–é€ æˆé˜»å¡çš„æ—¶å€™å¼€é”€éƒ½å¾ˆå¤§ï¼Œè€Œåç¨‹å®ƒæ˜¯æœ‰å¼€å‘è€…æ¥è¿›è¡Œæ§åˆ¶çš„ï¼Œä¹Ÿæ˜¯ä¾èµ–äºçº¿ç¨‹çš„ï¼Œä½†æ˜¯åç¨‹æŒ‚èµ·çš„æ—¶å€™æ˜¯ä¸éœ€è¦é˜»å¡çº¿ç¨‹çš„ï¼Œå‡ ä¹æ˜¯æ— ä»£ä»·çš„ã€‚æ‰€ä»¥åç¨‹ä¹Ÿæƒ³ç”¨æˆ·çŠ¶æ€ä¸‹çš„çº¿ç¨‹ï¼Œéå¸¸è½»é‡çº§</p><p><strong>åç¨‹</strong>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯å½“å®ƒ<code>æŒ‚èµ·</code>çš„æ—¶å€™ï¼Œå®ƒæ˜¯ä¸ä¼šé˜»å¡çº¿ç¨‹çš„ã€‚å®ƒçš„åº•å±‚å®ç°å°±æ˜¯å¼‚æ­¥å¤„ç†é˜»å¡ä»»åŠ¡</p><blockquote><p>æŒ‚èµ·ï¼šæŒ‚èµ·å…¶å®å°±æ˜¯ç”¨ suspendæ¥ä¿®é¥°ä¸€ä¸ªå‡½æ•°ã€‚è¢«suspendä¿®é¥°çš„å‡½æ•°ç§°ä¸ºæŒ‚èµ·å‡½æ•°</p></blockquote><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯æ·»åŠ ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.1.1&quot;</span></span><br></pre></td></tr></table></figure><h4 id="GlobalScope"><a href="#GlobalScope" class="headerlink" title="GlobalScope"></a>GlobalScope</h4><p>Kotlinä¸­GlobalScope ç±»æä¾›äº†å‡ ä¸ªåç¨‹æ„é€ å‡½æ•°</p><ol><li><p><strong>launch</strong></p><h5 id="æ¥æ”¶å‚æ•°"><a href="#æ¥æ”¶å‚æ•°" class="headerlink" title="æ¥æ”¶å‚æ•°"></a>æ¥æ”¶å‚æ•°</h5><p>launchæ˜¯CoroutineScopeçš„æ‰©å±•å‡½æ•°ï¼Œæ¥å—3ä¸ªå‚æ•°ï¼Œå‰é¢ä¸¤ä¸ªéƒ½æ˜¯å¸¸è§„å‚æ•°ï¼Œæœ€åä¸€ä¸ªæ˜¯å¯¹è±¡å¼å‡½æ•°ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> CoroutineScope.<span class="title">launch</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    context: <span class="type">CoroutineContext</span> = EmptyCoroutineContext,</span></span></span><br><span class="line"><span class="function"><span class="params">    start: <span class="type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span></span><br><span class="line"><span class="function"><span class="params">    block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.() -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: Job</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯å°±å¯ä»¥é‡‡ç”¨é—­åŒ…çš„å†™æ³•ï¼š() é‡Œé¢å†™å¸¸è§„å‚æ•°ï¼Œ{} é‡Œé¢å†™å‡½æ•°å¼å¯¹è±¡çš„å®ç°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GlobalScope.launch(Dispatchers.Unconfined) &#123;...&#125;</span><br></pre></td></tr></table></figure><ol><li><p>ç¬¬ä¸€ä¸ªå‚æ•°CoroutineContext</p><p>ç½‘ä¸Šæœ‰è¯´å¯ä»¥ç†è§£ä¸ºåç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œä½†æŒ‰åŠŸèƒ½æ¥è¯´ï¼Œå®ƒå°±æ˜¯åç¨‹çš„çº¿ç¨‹è°ƒåº¦å™¨ï¼Œæœ‰4ç§çº¿ç¨‹æ¨¡å¼ï¼Œç”¨æ¥æŒ‡å®šè¿è¡Œçº¿ç¨‹ï¼š</p><ul><li><p>Dispatchers.Main</p><blockquote><p>ä½¿ç”¨è¿™ä¸ªè°ƒåº¦å™¨åœ¨Androidä¸»çº¿ç¨‹ä¸Šè¿è¡Œä¸€ä¸ªåç¨‹ï¼Œå¯ä»¥ç”¨æ¥æ›´æ–°UI</p></blockquote></li><li><p>Dispatchres.IO</p><blockquote><p>ä½¿ç”¨è¿™ä¸ªè°ƒåº¦å™¨å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–æ‰§è¡Œç£ç›˜æˆ–ç½‘ç»œI/Oï¼Œåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œ</p></blockquote></li><li><p>Dispatchres.Default</p><blockquote><p>ä½¿ç”¨è¿™ä¸ªè°ƒåº¦å™¨å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¹‹æ‰§è¡ŒCPUå¯†é›†å‹çš„å·¥ä½œï¼Œåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œ</p></blockquote></li><li><p>Dispatchres.Unconfined</p><blockquote><p>ç›´æ¥åœ¨è°ƒç”¨è€…çš„çº¿ç¨‹æ‰§è¡Œ</p></blockquote></li></ul></li><li><p>ç¬¬äºŒä¸ªå‚æ•°CoroutineStart</p><p>è¿™ä¸ªå°±æ˜¯å¯åŠ¨æ¨¡å¼ï¼Œé€šè¿‡æ›´æ”¹å¯åŠ¨æ¨¡å¼å¯ä»¥è¾¾åˆ°ä½ éœ€è¦å®ƒçš„æ—¶å€™ï¼Œå†è°ƒç”¨å¯åŠ¨(ä½¿ç”¨LAZY)</p><ul><li><p>DEAFAULT </p><blockquote><p>é»˜è®¤çš„æ¨¡å¼ï¼Œç«‹å³æ‰§è¡Œåç¨‹ä½“</p></blockquote></li><li><p>ATOMIC </p><blockquote><p>ç«‹å³æ‰§è¡Œåç¨‹ä½“ï¼Œä½†åœ¨å¼€å§‹è¿è¡Œä¹‹å‰æ— æ³•å–æ¶ˆ</p></blockquote></li><li><p>UNDISPATCHED</p><blockquote><p>ç«‹å³åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œåç¨‹ä½“ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ª suspend è°ƒç”¨</p></blockquote></li><li><p>LAZY</p><blockquote><p>åªæœ‰åœ¨éœ€è¦çš„æƒ…å†µä¸‹è¿è¡Œ</p></blockquote></li></ul></li><li><p>block</p><p>è¿™ä¸ªå°±æ˜¯é—­åŒ…çš„æ–¹æ³•ä½“ï¼Œç”¨æ¥å®šä¹‰åç¨‹å†…éƒ¨éœ€è¦æ‰§è¡Œçš„æ“ä½œ</p></li></ol><h5 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h5><ol><li><p>Job</p><p>åç¨‹æ„é€ å‡½æ•°çš„è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥æŠŠJobçœ‹æˆåç¨‹å¯¹è±¡æœ¬èº«ï¼Œåç¨‹çš„æ“ä½œéƒ½åœ¨Jobèº«ä¸Šäº†</p><ul><li><p>Job.start</p><blockquote><p>å¯åŠ¨åç¨‹ï¼Œä½†é™¤äº†å°†åç¨‹è®¾ç½®ä¸ºLazyå¤–ï¼Œéƒ½ä¸ç”¨æ‰‹åŠ¨å¯åŠ¨</p></blockquote></li><li><p>Job.join</p><blockquote><p>ç­‰å¾…åç¨‹æ‰§è¡Œå®Œæ¯•</p></blockquote></li><li><p>Job.cancel</p><blockquote><p>å–æ¶ˆä¸€ä¸ªåç¨‹</p></blockquote></li><li><p>Job.cancelAndJoin</p><blockquote><p>ç­‰åç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åå†å–æ¶ˆ</p></blockquote></li></ul></li></ol><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">priavte <span class="keyword">val</span> TAG = <span class="string">&quot;test&quot;</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    setContentView(R.layout.activity_main)</span><br><span class="line">    Log.e(TAG, <span class="string">&quot;ä¸»çº¿ç¨‹idï¼š<span class="subst">$&#123;mainLooper.thread.id&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> job = GlobalScope.launch &#123;</span><br><span class="line">        delay(<span class="number">5000</span>)</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;åç¨‹æ‰§è¡Œç»“æŸ -- çº¿ç¨‹idï¼š<span class="subst">$&#123;Thread.currentThread().id&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    Log.e(TAG, <span class="string">&quot;ä¸»çº¿ç¨‹æ‰§è¡Œç»“æŸ&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">//Jobä¸­çš„æ–¹æ³•</span></span><br><span class="line">job.isActive</span><br><span class="line">job.isCancelled</span><br><span class="line">job.isCompleted</span><br><span class="line">job.cancel()</span><br><span class="line">jon.join()</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><p><img src="https://upload-images.jianshu.io/upload_images/1797490-e9c404941aafcb87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/398/format/webp" alt="img"></p><h5 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h5><p>åœ¨ä¸Šé¢çš„launchä¸­ï¼Œæˆ‘æ·»åŠ äº†ç­‰å¾…5ç§’ï¼Œä½†ä¸»çº¿ç¨‹è¿˜æ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ä¹Ÿå°±å¯ä»¥çœ‹å‡ºï¼Œlaunchæ˜¯ä¸ä¼šé˜»æ–­ä¸»çº¿ç¨‹çš„</p></li><li><p><strong>async</strong></p><p><strong>async</strong>ä¸<strong>launch</strong>çš„ç”¨æ³•åŸºæœ¬ä¸€è‡´åŒºåˆ«åœ¨äºï¼šasyncçš„è¿”å›å€¼æ˜¯Deferredã€‚asyncå¯ä»¥æ”¯æŒå¹¶å‘ï¼Œä¸€èˆ¬ä¸awaitä¸€åŒä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> TAG = <span class="string">&quot;async&quot;</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        GlobalScope.launch &#123;</span><br><span class="line">            <span class="keyword">val</span> toDayTime = GlobalScope.async &#123;</span><br><span class="line">                getThisTime()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">val</span> yesTerDay = GlobalScope.async &#123;</span><br><span class="line">                getYesterdayTime()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">val</span> time = toDayTime.await() + yesTerDay.await()</span><br><span class="line">            Log.e(TAG, <span class="string">&quot;æ˜¨å¤©æ—¶é—´ å’Œ ä»Šå¤©æ—¶é—´ä¸º --&gt; <span class="variable">$time</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getThisTime</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        delay(<span class="number">3000</span>)</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;getThisTime: è¿™é‡Œå·²ç»æ‰§è¡Œå®Œæ¯•&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;3-&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getYesterdayTime</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        delay(<span class="number">5000</span>)</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;getYesterdayTime: è¿™é‡Œä¹Ÿå·²ç»æ‰§è¡Œå®Œæ¯•&quot;</span> )</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;7&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210705110146134.png" alt="image-20210705110146134"></p><p>è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºasyncæ˜¯ä¸é˜»å¡çº¿ç¨‹çš„ï¼Œä¹Ÿå°±æ˜¯æ˜¯getThisTime()å’ŒgetYestertdayTime()æ˜¯åŒæ—¶è¿›è¡Œçš„.æ‰€ä»¥è·å–åˆ°<code>time</code>çš„æ—¶é—´æ˜¯5sï¼Œè€Œä¸æ˜¯8sã€‚</p><blockquote><p>launch æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´è¿”å›åªæ˜¯ job ï¼Œèƒ½å¤ŸçŸ¥é“ä»»åŠ¡çš„çŠ¶æ€ï¼Œå´ä¸èƒ½æºå¸¦è¿”å›ç»“æœã€‚async æœ‰è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯è¿”å›çš„æ˜¯ Deferred ,å®ƒæ˜¯ç»§æ‰¿çš„ job ï¼Œæ‰€æœ‰jobæœ‰çš„ï¼Œå®ƒéƒ½æœ‰ï¼Œè¿˜å…·å¤‡äº†jobæ²¡æœ‰çš„æºå¸¦æ•°æ®å›æ¥çš„èƒ½åŠ›ã€‚<br>æ‰€ä»¥ï¼Œ launch å¯ä»¥ç”¨æ¥è¿è¡Œä¸éœ€è¦æ“ä½œç»“æœçš„åç¨‹ï¼ˆå¦‚æ–‡ä»¶åˆ é™¤ï¼Œåˆ›å»ºç­‰ï¼‰ï¼Œ async å¯ä»¥ç”¨æ¥è¿è¡Œå¼‚æ­¥è€—æ—¶ä»»åŠ¡å¹¶ä¸”éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ï¼ˆç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®åº“æ“ä½œï¼Œæ–‡ä»¶è¯»å†™ç­‰ï¼‰ã€‚</p></blockquote></li><li><p>withContext</p><p>withContextè¿™ä¸ªå‡½æ•°ä¸»è¦ç”¨æ¥åˆ‡æ¢åˆ°æŒ‡å®šçš„çº¿ç¨‹ï¼Œå¹¶ä¸”å†withContexté—­åŒ…ç»“æŸä¹‹åå†åˆ‡æ¢å›ä¹‹å‰çš„çº¿ç¨‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">coroutineScope.launch(Dispatchers.Main) &#123;      <span class="comment">//  åœ¨ UI çº¿ç¨‹å¼€å§‹</span></span><br><span class="line">    <span class="keyword">val</span> image = withContext(Dispatchers.IO) &#123;  <span class="comment">// åˆ‡æ¢åˆ° IO çº¿ç¨‹ï¼Œå¹¶åœ¨æ‰§è¡Œå®Œæˆååˆ‡å› UI çº¿ç¨‹</span></span><br><span class="line">        getImage(imageId)                      <span class="comment">// å°†ä¼šè¿è¡Œåœ¨ IO çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    avatarIv.setImageBitmap(image)             <span class="comment">// å›åˆ° UI çº¿ç¨‹æ›´æ–° UI</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li></ol><h4 id="éGlobalScopeçš„API"><a href="#éGlobalScopeçš„API" class="headerlink" title="éGlobalScopeçš„API"></a>éGlobalScopeçš„API</h4><ol><li><p><strong>runBlocking</strong></p><p>runBlockingä¸launchçš„åŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒåœ¨äºrunBlockingæ˜¯ä¼šé˜»å¡çº¿ç¨‹çš„(å’ŒThread.sleep()ä¸€æ ·)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> TAG = <span class="string">&quot;runBlocking&quot;</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        runBlocking &#123;</span><br><span class="line">            <span class="keyword">val</span> a = await()</span><br><span class="line">            Log.e(TAG, <span class="string">&quot;onCreate: --&gt; <span class="variable">$a</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        repeat(<span class="number">8</span>) &#123;</span><br><span class="line">            Log.e(TAG, <span class="string">&quot;ä¸»çº¿ç¨‹æ‰§è¡Œ<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">await</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        delay(<span class="number">2000</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç­‰å¾…æ—¶é—´å·²è¿‡æœŸ&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210705115001967.png" alt="image-20210705115001967"></p></li></ol><h3 id="åç¨‹ä½“-æŒ‚èµ·å‡½æ•°"><a href="#åç¨‹ä½“-æŒ‚èµ·å‡½æ•°" class="headerlink" title="åç¨‹ä½“(æŒ‚èµ·å‡½æ•°)"></a>åç¨‹ä½“(æŒ‚èµ·å‡½æ•°)</h3><p>åç¨‹ä½“æ˜¯ä¸€ä¸ªç”¨suspendå…³é”®å­—ä¿®é¥°çš„ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æŒ‚èµ·å‡½æ•°ã€‚æ³¨æ„ï¼šæŒ‚èµ·å‡½æ•°åªèƒ½åœ¨åç¨‹ä¸­æˆ–å…¶ä»–æŒ‚èµ·å‡½æ•°ä¸­ä½¿ç”¨ï¼Œè€Œä¸”å®ƒæ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œä¸‹é¢å°†æ¼”ç¤ºä¸€ä¸‹é¡ºåºæ‰§è¡Œ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> TAG: String = <span class="string">&quot;launch&quot;</span></span><br><span class="line">overrid <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    GlobalScope.launch&#123;</span><br><span class="line">        <span class="keyword">val</span> name = getName()</span><br><span class="line">        <span class="keyword">val</span> userInfo = getUserInfo(name)</span><br><span class="line">        Log.e(TAG,<span class="string">&quot;userInfo --&gt; <span class="subst">$&#123;userInfo&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    repeat(<span class="number">8</span>)&#123;</span><br><span class="line">        Log.e(TAG,<span class="string">&quot;åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ --&gt; <span class="variable">$it</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getName</span><span class="params">()</span></span>: String&#123;</span><br><span class="line">    delay(<span class="number">2000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Tom&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getUserInfo</span><span class="params">(name: <span class="type">String</span>)</span></span>: String&#123;</span><br><span class="line">    delay(<span class="number">2000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;userInfo.Name --&gt; <span class="variable">$token</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><p><img src="C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20210705104310480.png" alt="image-20210705104310480"></p><h4 id="æŒ‚èµ·ä¸æ¢å¤"><a href="#æŒ‚èµ·ä¸æ¢å¤" class="headerlink" title="æŒ‚èµ·ä¸æ¢å¤"></a>æŒ‚èµ·ä¸æ¢å¤</h4><p>åç¨‹ä¹‹å¤–çº¿ç¨‹é‡Œè‚¯å®šè¿˜æœ‰éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å‰é¢çš„ä»£ç åœ¨æŒ‚èµ·åä½•æ—¶æ‰èƒ½æ¢å¤æ‰§è¡Œã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getToken</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">  delay(<span class="number">1</span>)</span><br><span class="line">  Log.d(TAG, <span class="string">&quot;getToken å¼€å§‹æ‰§è¡Œï¼Œæ—¶é—´:  <span class="subst">$&#123;System.currentTimeMillis()&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;ask&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getResponse</span><span class="params">(token: <span class="type">String</span>)</span></span>: String &#123;</span><br><span class="line">  delay(<span class="number">2</span>)</span><br><span class="line">  Log.d(TAG, <span class="string">&quot;getResponse å¼€å§‹æ‰§è¡Œï¼Œæ—¶é—´:  <span class="subst">$&#123;System.currentTimeMillis()&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;response&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setText</span><span class="params">(response: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">  Log.d(TAG, <span class="string">&quot;setText æ‰§è¡Œï¼Œæ—¶é—´:  <span class="subst">$&#123;System.currentTimeMillis()&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GlobalScope.launch(Dispatchers.Unconfined) &#123;</span><br><span class="line">  Log.d(TAG, <span class="string">&quot;åç¨‹ å¼€å§‹æ‰§è¡Œï¼Œæ—¶é—´:  <span class="subst">$&#123;System.currentTimeMillis()&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">val</span> token = getToken()</span><br><span class="line">  <span class="keyword">val</span> response = getResponse(token)</span><br><span class="line">  setText(response)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span>) &#123;</span><br><span class="line">  Log.d(TAG, <span class="string">&quot;ä¸»çº¿ç¨‹æ‰“å°ç¬¬<span class="variable">$i</span> æ¬¡ï¼Œæ—¶é—´:  <span class="subst">$&#123;System.currentTimeMillis()&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><p><img src="https://upload-images.jianshu.io/upload_images/1785445-d23383aef9745388.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/406/format/webp" alt="img"></p><p>åç¨‹æŒ‚èµ·åï¼Œè™½ç„¶å»¶è¿Ÿçš„æ—¶é—´åˆ°äº†ï¼Œä½†æ˜¯è¿˜å¾—ç­‰åˆ°çº¿ç¨‹ç©ºé—²æ—¶æ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œåç¨‹å¯æ²¡æœ‰ç«äº‰ CPU æ—¶é—´æ®µï¼Œåç¨‹æŒ‚èµ·åå³ä¾¿å¯ä»¥æ¢å¤æ‰§è¡Œäº†ä¹Ÿä¸æ˜¯é©¬ä¸Šå°±èƒ½æ¢å¤æ‰§è¡Œã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åç¨‹æŒ‚èµ·ä¹‹åæƒ³è¦æ¢å¤ï¼Œå¿…é¡»å¾—ç­‰åˆ°çº¿ç¨‹ç©ºé—²äº†æ‰å¯ä»¥ç»§ç»­ï¼Œä¸ç„¶ç»§ç»­ç­‰</p><h3 id="åç¨‹ç”Ÿå‘½å‘¨æœŸ"><a href="#åç¨‹ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="åç¨‹ç”Ÿå‘½å‘¨æœŸ"></a>åç¨‹ç”Ÿå‘½å‘¨æœŸ</h3><p>è¿™é‡Œå¯ä»¥å°†æ‰€æœ‰æœ‰ç”Ÿå‘½å‘¨æœŸçš„ç±»ç»§æ‰¿CoroutineSocpeï¼Œè¿™æ ·å°±å¯ä»¥è®©å…¨éƒ¨åç¨‹è·Ÿç€ç”Ÿå‘½å‘¨æœŸç»“æŸ</p><ul><li><p>å¦‚åœ¨activityé‡Œé¢ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MainActivity : AppCompatActivity(), CoroutineScope <span class="keyword">by</span> MainScope()&#123;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestory()</span><br><span class="line">        cancel()</span><br><span class="line">     &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></li><li><p>åœ¨å…¶ä»–UIé€»è¾‘ç±»ä¸­ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivityFacede</span> : <span class="type">CoroutineScope &#123;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> job = Job()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> coroutineContext: CoroutineContext</span><br><span class="line">        <span class="keyword">get</span>() = Dispatchers.Main + job</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">destroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        job.cancel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç éƒ½ä¼šåœ¨è°ƒç”¨ destroy çš„æ—¶å€™å–æ¶ˆè¿™ä¸ªä½œç”¨åŸŸä¸­çš„åç¨‹è¿è¡Œ</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Kotlin </tag>
            
            <tag> åç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›è°ƒåœ°ç‹±</title>
      <link href="2021/07/07/%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1/"/>
      <url>2021/07/07/%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±</p><a id="more"></a><h1 id="å›è°ƒåœ°ç‹±"><a href="#å›è°ƒåœ°ç‹±" class="headerlink" title="å›è°ƒåœ°ç‹±"></a>å›è°ƒåœ°ç‹±</h1><blockquote><p>å¼‚æ­¥ç¼–ç¨‹ ä¹‹ä¸€ å›è°ƒåœ°ç‹±</p></blockquote><p>å¯¹äºå›è°ƒåœ°ç‹±ï¼ˆCallback hellï¼‰ï¼Œæƒ³å¿…å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œä½†æ˜¯åœ¨RxJavaã€Reactorç­‰ååº”å¼ç¼–ç¨‹æ¡†æ¶å…´èµ·ä¹‹åï¼Œå¯¹äºå›è°ƒåœ°ç‹±åªæ˜¯å¬å¾—å¤šï¼Œä½†æ˜¯è§å¾—çš„å°‘ã€‚æ‰€ä»¥æ¥ä¸‹æ¥å°†ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±</p><h3 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h3><p>è¦äº†è§£ä»€ä¹ˆæ˜¯å›è°ƒåœ°ç‹±ï¼Œé‚£å°±å¾—å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å›è°ƒã€‚ç®€å•æ¥è¯´å›è°ƒå°±æ˜¯ï¼šè°ƒç”¨è€…åœ¨è°ƒç”¨è¢«è°ƒç”¨è€…åï¼Œè¢«è°ƒç”¨è€…è¿›è¡Œæ“ä½œå¹¶å°†ç»“æœåé¦ˆç»™è°ƒç”¨è€…ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å›è°ƒ</p><p><img src="https://oscimg.oschina.net/oscnet/acb0cacf7f26f2967cf5fdd25543e5726c7.jpg"></p><h3 id="ä»£ç è®²è§£"><a href="#ä»£ç è®²è§£" class="headerlink" title="ä»£ç è®²è§£"></a>ä»£ç è®²è§£</h3><h4 id="æ™®é€šå›è°ƒ"><a href="#æ™®é€šå›è°ƒ" class="headerlink" title="æ™®é€šå›è°ƒ"></a>æ™®é€šå›è°ƒ</h4><ol><li><p>å›è°ƒå˜›ï¼Œå¾—å…ˆåˆ›å»ºä¸ªCallbackæ¥å£ï¼Œç”¨æ¥å›è°ƒ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Callback</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰ä¸€ä¸ªå›è°ƒçš„æ¥å£ï¼Œæ–¹ä¾¿ä¸‹é¢çš„å®ç°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">callback</span><span class="params">(value: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å·²å·¥ä½œä¸­ä¸Šå¸å’Œä¸‹å±æ¥ä½œä¸ºä¾‹å­ã€‚åˆ›å»ºä¸Šå¸</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸Šå¸è‚¯å®šè¦æœ‰ä¸‹å±å˜›ï¼Œæ‰€ä»¥å¾—å°±å°†ä¸‹å±ä¼ è¿›æ¥</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boss</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> subordinate: Subordinate) : Callback&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">callback</span><span class="params">(value: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;ä¸Šå¸æ”¶åˆ°é€šçŸ¥ï¼šå·¥ä½œ<span class="subst">$&#123;value&#125;</span>å·²å®Œæˆ&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Bosså®‰æ’ä»»åŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">arrangeWorker</span><span class="params">(worker: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;ä¸Šå¸å¼€å§‹å®‰æ’ä»»åŠ¡&quot;</span>)</span><br><span class="line">        Thread&#123; <span class="comment">// å¼€å¯äº†ä¸ªæ–°çº¿ç¨‹æ¥é€šçŸ¥ä¸‹å±å»å·¥ä½œ</span></span><br><span class="line">            subordinate.work(worker, <span class="keyword">this</span>)</span><br><span class="line">        &#125;.start()</span><br><span class="line">        println(<span class="string">&quot;è€æ¿ä¸‹ç­^^&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€æ¿åˆ†é…å·¥ä½œï¼Œå‘˜å·¥å»å®Œæˆï¼Œå¦‚æœ<strong>å®Œæˆè¿‡ç¨‹æ˜¯å¼‚æ­¥</strong>ï¼Œåˆ™æ˜¯<code>å¼‚æ­¥è°ƒç”¨</code>ï¼Œ<strong>å¦‚æœæ˜¯åŒæ­¥çš„</strong>ï¼Œåˆ™æ˜¯<code>åŒæ­¥å›è°ƒ</code>ï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨å¼‚æ­¥æ–¹å¼ã€‚</p></li><li><p>åˆ›å»ºä¸‹å±</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subordinate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">work</span><span class="params">(worker: <span class="type">String</span>, callback: <span class="type">Callback</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;ä¸‹å±æ¥åˆ°æŒ‡ä»¤ï¼Œå¼€å§‹å¤„ç†å·¥ä½œ<span class="subst">$&#123;worker&#125;</span>&quot;</span>) <span class="comment">// å¤„ç†å·¥ä½œ</span></span><br><span class="line">        callback.callback(<span class="string">&quot;<span class="subst">$&#123;worker&#125;</span>å·²å®Œæˆ&quot;</span>)<span class="comment">// å°†ä»»åŠ¡å®Œæˆç»“æœåé¦ˆç»™ä¸Šå¸</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹å±ç±»å¾ˆç®€å•ï¼Œå°±åªæ¥å—ä»»åŠ¡å°±è¡Œäº†(æ‰“å·¥äººå†²ï¼)</p></li><li><p>æ¥ä¸‹æ¥å°±å¼€å§‹å›è°ƒ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Boss(Subordinate()).run &#123;</span><br><span class="line">        arrangeWorker(<span class="string">&quot;æ‰«åœ°&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœä¸º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šå¸å¼€å§‹å®‰æ’ä»»åŠ¡</span><br><span class="line">ä¸Šå¸ä¸‹ç­^^</span><br><span class="line">ä¸‹å±æ¥åˆ°æŒ‡ä»¤ï¼Œå¼€å§‹å¤„ç†å·¥ä½œæ‰«åœ°</span><br><span class="line">ä¸Šå¸æ”¶åˆ°é€šçŸ¥ï¼šå·¥ä½œæ‰«åœ°å·²å®Œæˆå·²å®Œæˆ</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°å¼‚æ­¥å›è°ƒæ˜¯ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼Œä¸Šå¸åœ¨ä»»åŠ¡å‘å¸ƒå®Œä¹‹åå°±ä¸‹ç­äº†ï¼Œä¹‹åä¸‹å±å®Œæˆä»»åŠ¡ä¹‹åå†é€šè¿‡å¦ä¸€ä¸ªçº¿ç¨‹é€šçŸ¥ä¸Šå¸</p></li></ol><h4 id="åœ°ç‹±"><a href="#åœ°ç‹±" class="headerlink" title="åœ°ç‹±"></a>åœ°ç‹±</h4><p>æ—¢ç„¶è¦å±•ç¤ºåœ°ç‹±ï¼Œé‚£è‚¯å®šè¦å†åµŒå¥—ä¸€å±‚ã€‚è®¾è®¡å¦‚ä¸‹</p><p><img src="https://oscimg.oschina.net/oscnet/cb5bb8167743c0286697d117b4e707b47cf.jpg"></p><ol><li><p>ç°åœ¨è€æ¿éœ€è¦äº§å“ç»ç†æ¥è®¾è®¡äº§å“å¹¶è·å¾—è®¾è®¡å¥½çš„äº§å“</p><p>æ›´æ”¹ä¸€ä¸‹arrangeWorkeré‡Œé¢çš„å†…å®¹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boss</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> subordinate: Subordinate) : Callback&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">arrangeWorker</span><span class="params">(worker: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;è€æ¿é€šçŸ¥äº§å“ç»ç†è¿›è¡Œè®¾è®¡&quot;</span>)</span><br><span class="line">        Thread &#123;</span><br><span class="line">            subordinate.work(worker, <span class="keyword">this</span>)</span><br><span class="line">        &#125;.start()</span><br><span class="line">        println(<span class="string">&quot;è€æ¿ä¸‹ç­^^&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é€šçŸ¥å®Œäº§å“ç»ç†ï¼Œæ”¶åˆ°å›è°ƒåï¼Œé‚£å°±å¾—è®©å¼€å‘æ¥è¿›è¡Œå¼€å‘äº†å˜›</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boss</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> subordinate: Subordinate) : Callback&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">callback</span><span class="params">(value: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;è€æ¿é€šçŸ¥ï¼šäº§å“ç»ç†å·²å°†<span class="subst">$&#123;value&#125;</span>è®¾è®¡å¥½äº†&quot;</span>)</span><br><span class="line">        <span class="keyword">val</span> newWork = <span class="string">&quot;<span class="variable">$value</span> ç³»ç»Ÿ&quot;</span></span><br><span class="line">        println(<span class="string">&quot;äº§å“ç»ç†è®¾è®¡å®Œæˆï¼Œå†å°†ä»»åŠ¡äº¤ç»™å¼€å‘&quot;</span>)</span><br><span class="line">        Subordinate().work(newWork, <span class="keyword">object</span> : Callback&lt;String&gt; &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">callback</span><span class="params">(value: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">                println(<span class="string">&quot;å¼€å‘ï¼šå¼€å‘<span class="subst">$&#123;value&#125;</span>å®Œæ¯•&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">arrangeWorker</span><span class="params">(worker: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;è€æ¿é€šçŸ¥äº§å“ç»ç†è¿›è¡Œè®¾è®¡&quot;</span>)</span><br><span class="line">        Thread &#123;</span><br><span class="line">            subordinate.work(worker, <span class="keyword">this</span>)</span><br><span class="line">        &#125;.start()</span><br><span class="line">        println(<span class="string">&quot;è€æ¿ä¸‹ç­^^&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºæ˜¯å†è€æ¿çš„å›è°ƒä¸­ï¼Œå†åˆ›å»ºä¸€ä¸ªå¼€å‘å¹¶å¼€ä¸€ä¸ªæ–°çš„å›è°ƒ</p></li><li><p>è¿è¡Œçœ‹ä¸€ä¸‹æŠŠï¼Œè¾“å…¥Ios</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è€æ¿é€šçŸ¥äº§å“ç»ç†è¿›è¡Œè®¾è®¡</span><br><span class="line">è€æ¿ä¸‹ç­^^</span><br><span class="line">ä¸‹å±æ¥åˆ°æŒ‡ä»¤ï¼Œå¼€å§‹å¤„ç†å·¥ä½œIos</span><br><span class="line">è€æ¿é€šçŸ¥ï¼šäº§å“ç»ç†å·²å°†Iosè®¾è®¡å¥½äº†</span><br><span class="line">äº§å“ç»ç†è®¾è®¡å®Œæˆï¼Œå†å°†ä»»åŠ¡äº¤ç»™å¼€å‘</span><br><span class="line">ä¸‹å±æ¥åˆ°æŒ‡ä»¤ï¼Œå¼€å§‹å¤„ç†å·¥ä½œIos ç³»ç»Ÿ</span><br><span class="line">å¼€å‘ï¼šå¼€å‘Ios ç³»ç»Ÿå®Œæ¯•</span><br></pre></td></tr></table></figure></li></ol><p>å¥½å•¦ï¼Œä¸€ä¸ªç®€å•çš„å›è°ƒåœ°ç‹±å°±å®Œæˆäº†ï¼Œå…¶å®å›è°ƒåœ°ç‹±å°±æ˜¯å›è°ƒåµŒå¥—å›è°ƒï¼Œä½†æ˜¯å¦‚æœåµŒå¥—å±‚æ•°è¿‡å¤šï¼Œä»¿ä½›æ‰å…¥åœ°ç‹±ï¼Œäºæ˜¯æœ‰äº†å›è°ƒåœ°ç‹±çš„è¯´æ³•ã€‚</p><h4 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h4><blockquote><p>é‚£è¿™æœ‰å•¥ä¼˜ç‚¹å˜›ï¼Ÿ</p></blockquote><ul><li>ä¼˜ç‚¹è¿˜æ˜¯æœ‰çš„ï¼šå›è°ƒåœ°ç‹±ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆï¼Ÿäº‹å®ä¸Šï¼Œ<strong>å›è°ƒçš„ä»£ç å¦‚åŒç®¡é“ä¸€æ ·</strong>ï¼Œ<strong>æ¥æ”¶è¾“å…¥ï¼Œå¹¶å°†å¤„ç†åçš„å†…å®¹è¾“å‡ºè‡³ä¸‹ä¸€æ­¥</strong>ã€‚è€Œå›è°ƒåœ°ç‹±ï¼Œåˆ™æ˜¯å¤šä¸ªç®¡é“è¿æ¥ï¼Œå½¢æˆçš„ä¸€ä¸ªæµç¨‹ï¼Œè€Œå„ä¸ªå­æµç¨‹ï¼ˆç®¡é“ï¼‰ç›¸äº’ç‹¬ç«‹ã€‚</li></ul><h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><blockquote><p>ç¼ºç‚¹å¾ˆæ˜æ˜¾</p></blockquote><ul><li>å½“ç„¶ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼šå›è°ƒçš„æ–¹æ³•è™½ç„¶å°†å­è¿‡ç¨‹è§£è€¦ï¼Œä½†æ˜¯å›è°ƒä»£ç çš„å¯è¯»æ€§é™ä½ã€å¤æ‚æ€§å¤§å¤§å¢åŠ ã€‚çœ‹å¾—æˆ‘å¤´æ™•ï¼ŒçœŸçš„</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Anroid </tag>
            
            <tag> Callback </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼‚æ­¥æ“ä½œ(äºŒ)</title>
      <link href="2021/07/07/%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C-%E4%BA%8C/"/>
      <url>2021/07/07/%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†è®²è§£Androidå¤œé—´æ¨¡å¼ï¼Œç”¨æ·»åŠ è’™ç‰ˆçš„æ–¹å¼æ¥å®ç°</p><a id="more"></a><h1 id="å¼‚æ­¥æ“ä½œ"><a href="#å¼‚æ­¥æ“ä½œ" class="headerlink" title="å¼‚æ­¥æ“ä½œ"></a>å¼‚æ­¥æ“ä½œ</h1><blockquote><p>å¼‚æ­¥ç¼–ç¨‹ ä¹‹ä¸€ å¼‚æ­¥æ“ä½œ+Rxjava</p></blockquote><p>è®²åˆ°å¼‚æ­¥ç¼–ç¨‹é‚£å°±å¾—å…ˆä»‹ç»ä¸€ä¸‹Androidå½“å‰çš„æ¶æ„</p><h2 id="Androidå½“å‰æ¶æ„"><a href="#Androidå½“å‰æ¶æ„" class="headerlink" title="Androidå½“å‰æ¶æ„"></a>Androidå½“å‰æ¶æ„</h2><p>åœ¨Androidæ“ä½œç³»ç»Ÿå¯åŠ¨ä¹‹åï¼Œä¼šå¯åŠ¨ä¸€ä¸ªåä¸º<strong>Zygote</strong>çš„è¿›ç¨‹ï¼Œ<strong>Zygote</strong>æ˜¯è´Ÿè´£åˆ›å»ºå…¶å®ƒå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºè¿›ç¨‹çš„ä¸€ä¸ªè¿›ç¨‹ã€‚<strong>Zygote</strong>è¿›ç¨‹å¯åŠ¨ã€åŠ è½½æ ¸å¿ƒç¨‹åºåº“å’Œæ•°æ®ç»“æ„åˆ°å†…å­˜åä¼šåˆ›å»ºä¸€ä¸ªDalvikè™šæ‹Ÿæœºï¼ˆDVMï¼‰è¿›ç¨‹(<strong>SystemServer</strong>)ï¼Œè¿™ä¸ªè¿›ç¨‹åŒ…å«äº†å¤§éƒ¨åˆ†çš„ç³»ç»ŸæœåŠ¡(åŒ…æ‹¬ä¸Šé¢ç®¡ç†Activityï¼Œä¹Ÿå°±æ˜¯ActivityManagerService)ä¹‹å<strong>Zygote</strong>ä¼šä¸ºè¿™ä¸ªappåˆ›å»ºä¸€ä¸ªDVMï¼Œåœ¨ç›´æ¥forkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™ç§æ¶æ„çš„å¥½å¤„æ˜¯åŒæ—¶å¯åŠ¨å¤šä¸ªApp æ—¶ï¼Œå¤šä¸ªAppè¿›ç¨‹å¯ä»¥è®¿é—®å…±äº«å†…å­˜ã€‚</p><blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå…ˆåˆ›å»ºZygoteï¼Œåœ¨é€šè¿‡Zygoteåˆ›å»ºSystemServerè¿›è¡Œ(ç³»ç»ŸæœåŠ¡è¿›ç¨‹)ï¼Œæœ€ååœ¨è¦åˆ›å»ºçš„Appåˆ›å»ºDalvikè™šæ‹Ÿæœº</p></blockquote><blockquote><p>Zygoteæ˜¯Androidç³»ç»Ÿåˆ›å»ºè¿›ç¨‹çš„æ ¸å¿ƒè¿›ç¨‹ï¼Œè´Ÿè´£å¯åŠ¨Dalvikè™šæ‹Ÿæœºï¼ŒåŠ è½½ä¸€äº›å¿…è¦çš„ç³»ç»Ÿèµ„æºå’Œç³»ç»Ÿç±»ï¼Œé¡ºä¾¿å¯åŠ¨SystemServerè¿›è¡Œï¼Œæœ€ååœ¨ç­‰å¾…å¹¶å¤„ç†Appåˆ›å»ºè¯·æ±‚</p></blockquote><h2 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h2><p>å…ˆæ¥è®²è®²Androidä¸­æœ€å¸¸è§çš„å¼‚æ­¥æ–¹å¼</p><h3 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h3><blockquote><p>AsyncTaskåœ¨Kotlinä¸­å·²è¢«åç¨‹æ›¿ä»£(å¯å»&lt;å¼‚æ­¥ç¼–ç¨‹(ä¸‰)&gt;äº†è§£è¯¦æƒ…)ï¼Œæ‰€ä»¥ä¸‹æ–¹å°†ä¼šç”¨Javaæ¥è¿›è¡Œè®²è§£</p></blockquote><h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>AsyncTaskæ˜¯Androidä¸­è‡ªå¸¦çš„ä¸€ä¸ªè½»é‡çº§å¼‚æ­¥ç±»ï¼Œå¯ä»¥é€šè¿‡å®ƒè½»æ¾çš„å®ç°å·¥ä½œçº¿ç¨‹å’ŒUIçº¿ç¨‹ä¹‹é—´çš„é€šè®¯æˆ–åˆ‡æ¢</p><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>AsyncTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæƒ³è¦ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆå°±å¾—å…ˆåˆ›å»ºä¸€ä¸ªç±»æ¥ç»§æ‰¿å®ƒï¼Œåœ¨é‡å†™å®ƒçš„4ä¸ªæ–¹æ³•(ä¸€èˆ¬åªç”¨é‡å†™4ä¸ªæ–¹æ³•)</p><ul><li><p>éœ€è¦é‡å†™çš„4ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™ä¸ªå°±æ˜¯è¦åœ¨åå°åšçš„å·¥ä½œ,ä»–å°†è¿è¡Œåœ¨åå°å·¥ä½œçº¿ç¨‹ä¸Š</span></span><br><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Result <span class="title">doInBackground</span><span class="params">(Params... params)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™ä¸ªæ—¶å¼€å§‹æ‰§è¡Œå‰çš„æ“ä½œï¼Œè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Š</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPreExecute</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//doInBackgroundå®Œæˆåè°ƒç”¨</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Result result)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®æ—¶æ›´æ–°ï¼Œé€šè¿‡åœ¨doInBackgroundä¸­è°ƒç”¨publishProgress()æ–¹æ³•</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Progress... values)</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTaskDome</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ProgressDialog progressDialog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_async_task_dome); </span><br><span class="line">        progressDialog = <span class="keyword">new</span> ProgressDialog(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">new</span> Download().execute(<span class="string">&quot;ä¸‹è½½åœ°å€&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">-----------------------------------------------</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Download</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>, <span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPreExecute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            progressDialog.show();</span><br><span class="line">            <span class="comment">//åˆå§‹åŒ–è¿›åº¦æ¡</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Boolean <span class="title">doInBackground</span><span class="params">(String... strings)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œå‡è£…åœ¨è¿›è¡Œä¸‹è½½</span></span><br><span class="line">            Uri uri = Uri.parse(strings[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Integer... integers)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œå¯¹è¿›åº¦æ¡è¿›è¡Œæ›´æ–°è¿›åº¦</span></span><br><span class="line">            progressDialog.setMessage(String.valueOf(integers[<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šæ–¹çš„ä»£ç ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªDownloadç±»ç”¨æ¥ç»§æ‰¿AsyncTaskï¼Œå¹¶é‡å†™äº†å®ƒçš„4ä¸ªæ–¹æ³•ã€‚ä¹‹åå°±åªéœ€è¦åœ¨Activityä¸­åˆ›å»ºä¸€ä¸ªDownloadå¯¹è±¡ï¼Œç„¶åæ‰§è¡Œexecuteæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å»</p></li></ul><h3 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h3><h4 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>Rxjavaæ˜¯ä¸€ä¸ªç”¨æ¥å®ç°å¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶çš„ç¬¬ä¸‰æ–¹åº“(å°±æŠŠå®ƒç†è§£æˆAndroid Handler çš„å‡çº§ç‰ˆå°±è¡Œäº†)</p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹Rxjavaçš„æ¦‚å¿µ</p><ul><li>RxJavaçš„å¼‚æ­¥å®ç°ï¼Œå°±æ˜¯é€šè¿‡ä¸€ç§æ‰©å±•çš„è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°çš„</li><li>Observable (å¯è§‚å¯Ÿè€…ï¼Œå³è¢«è§‚å¯Ÿè€…)ã€ Observer (è§‚å¯Ÿè€…)ã€ subscribe (è®¢é˜…)ã€äº‹ä»¶ã€‚Observable å’Œ Observer é€šè¿‡ subscribe() æ–¹æ³•å®ç°è®¢é˜…å…³ç³»ï¼Œä»è€Œ Observable å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™å‘å‡ºäº‹ä»¶æ¥é€šçŸ¥ Observer</li></ul><h4 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><ol><li><p>å…ˆåˆ›å»ºä¸€ä¸ªObserverè§‚å¯Ÿè€…</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> : Observer&lt;String?&gt; &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNext</span><span class="params">(t: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;onNext --&gt; <span class="variable">$t</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e: <span class="type">Throwable</span>)</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;on error --&gt; <span class="variable">$e</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSubscribe</span><span class="params">(d: <span class="type">Disposable</span>)</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;onSubscribe --&gt; <span class="variable">$d</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onComplete</span><span class="params">()</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;onComplete&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>å†åˆ›å»º Observable è¢«è§‚å¯Ÿè€…</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> observable: Observable&lt;String&gt; = Observable.create&#123;</span><br><span class="line">        it.onNext(<span class="string">&quot;continue!&quot;</span>)</span><br><span class="line">        it.onComplete()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>æœ€åå†è¿›è¡Œå…³è”</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">observable.subscribe(observer)</span><br></pre></td></tr></table></figure></li><li><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨é“¾å¼è°ƒç”¨æ¥å†™</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable.create(ObservableOnSubscribe&lt;String&gt; &#123;</span><br><span class="line">        it.onNext(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">        it.onNext(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">        it.onNext(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">        it.onNext(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">        it.onComplete()</span><br><span class="line">    &#125;).subscribe(<span class="keyword">object</span> : Observer&lt;String?&gt; &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNext</span><span class="params">(t: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;onNext --&gt; <span class="variable">$t</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(e: <span class="type">Throwable</span>)</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;on error --&gt; <span class="variable">$e</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSubscribe</span><span class="params">(d: <span class="type">Disposable</span>)</span></span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onComplete</span><span class="params">()</span></span> &#123;</span><br><span class="line">            println(<span class="string">&quot;perform !&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></li></ol><h4 id="Scheduler-çº¿ç¨‹åˆ‡æ¢"><a href="#Scheduler-çº¿ç¨‹åˆ‡æ¢" class="headerlink" title="Scheduler (çº¿ç¨‹åˆ‡æ¢)"></a>Scheduler (çº¿ç¨‹åˆ‡æ¢)</h4><p>åœ¨ä¸æŒ‡å®šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œ RxJava éµå¾ªçš„æ˜¯çº¿ç¨‹ä¸å˜çš„åŸåˆ™ï¼Œå³ï¼šåœ¨å“ªä¸ªçº¿ç¨‹è°ƒç”¨ subscribe()ï¼Œå°±åœ¨å“ªä¸ªçº¿ç¨‹ç”Ÿäº§äº‹ä»¶ï¼›åœ¨å“ªä¸ªçº¿ç¨‹ç”Ÿäº§äº‹ä»¶ï¼Œå°±åœ¨å“ªä¸ªçº¿ç¨‹æ¶ˆè´¹äº‹ä»¶ã€‚å¦‚æœéœ€è¦åˆ‡æ¢çº¿ç¨‹ï¼Œå°±éœ€è¦ç”¨åˆ° Scheduler ï¼ˆè°ƒåº¦å™¨ï¼‰</p><p>åœ¨RxJavaå†…éƒ¨å·²ç»å†…ç½®äº†å‡ ä¸ªSchedulerï¼Œä¸‹é¢å°†ä¼šè¿›è¡Œä»‹ç»</p><ul><li><p>Schedulers.newThread()</p><p>å¼€å¯ä¸€ä¸ªæ–°çº¿ç¨‹å¹¶ä½¿ç”¨</p></li><li><p>Schedulers.io()</p><p>åˆ‡æ¢åˆ°<strong>I/O</strong>çº¿ç¨‹ï¼Œè¿›è¡Œæ“ä½œ</p><blockquote><p>I/O æ“ä½œï¼ˆè¯»å†™æ–‡ä»¶ã€è¯»å†™æ•°æ®åº“ã€ç½‘ç»œä¿¡æ¯äº¤äº’ç­‰ï¼‰æ‰€ä½¿ç”¨çš„ Schedulerã€‚è¡Œä¸ºæ¨¡å¼å’Œ newThread() å·®ä¸å¤šï¼ŒåŒºåˆ«åœ¨äº io() çš„å†…éƒ¨å®ç°æ˜¯æ˜¯ç”¨ä¸€ä¸ªæ— æ•°é‡ä¸Šé™çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥é‡ç”¨ç©ºé—²çš„çº¿ç¨‹ï¼Œå› æ­¤å¤šæ•°æƒ…å†µä¸‹ io() æ¯” newThread() æ›´æœ‰æ•ˆç‡ã€‚ä¸è¦æŠŠè®¡ç®—å·¥ä½œæ”¾åœ¨ io() ä¸­ï¼Œå¯ä»¥é¿å…åˆ›å»ºä¸å¿…è¦çš„çº¿ç¨‹</p></blockquote></li><li><p>Schedulers.computation()</p><p>åˆ‡æ¢åˆ°è®¡ç®—è€Œæ‰€ä½¿ç”¨çš„çº¿ç¨‹</p><blockquote><p>è¿™ä¸ªè®¡ç®—æŒ‡çš„æ˜¯ CPU å¯†é›†å‹è®¡ç®—ï¼Œå³ä¸ä¼šè¢« I/O ç­‰æ“ä½œé™åˆ¶æ€§èƒ½çš„æ“ä½œï¼Œä¾‹å¦‚å›¾å½¢çš„è®¡ç®—ã€‚è¿™ä¸ª Scheduler ä½¿ç”¨çš„å›ºå®šçš„çº¿ç¨‹æ± ï¼Œå¤§å°ä¸º CPU æ ¸æ•°ã€‚ä¸è¦æŠŠ I/O æ“ä½œæ”¾åœ¨ computation() ä¸­ï¼Œå¦åˆ™ I/O æ“ä½œçš„ç­‰å¾…æ—¶é—´ä¼šæµªè´¹ CPU</p></blockquote></li><li><p>AndroidSchedulers.mainThread()</p><p>åˆ‡æ¢å›å½“å‰æ‰€åœ¨çš„ä¸»çº¿ç¨‹</p></li><li><p>subscribeOn()</p><p>è¯´äººè¯å°±æ˜¯æ•°æ®å¤„ç†æ‰€åœ¨çš„çº¿ç¨‹</p></li><li><p>observeOn()</p><p>ç»“æœè¿”å›æ‰€åœ¨çš„çº¿ç¨‹</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Thread </tag>
            
            <tag> Android </tag>
            
            <tag> RxJava </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤œé—´æ¨¡å¼</title>
      <link href="2021/07/07/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F/"/>
      <url>2021/07/07/%E5%A4%9C%E9%97%B4%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†è®²è§£Androidå¤œé—´æ¨¡å¼ï¼Œç”¨æ·»åŠ è’™ç‰ˆçš„æ–¹å¼æ¥å®ç°</p><a id="more"></a><h1 id="å¤œé—´æ¨¡å¼"><a href="#å¤œé—´æ¨¡å¼" class="headerlink" title="å¤œé—´æ¨¡å¼"></a>å¤œé—´æ¨¡å¼</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä½œä¸ºä¸»è¦è¯­è¨€</p></blockquote><p>åœ¨Androidä¸­å¤œé—´æ¨¡å¼ç®—æ˜¯ä¸€ä¸ªå¿…ä¸å¯å°‘ã€ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªåŠŸèƒ½ã€‚å¤œé—´æ¨¡å¼çš„å®ç°é€šå¸¸æ¥è¯´æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯é€šè¿‡æ›´æ¢ä¸»é¢˜é¢œè‰²æ¥å®ç°å¤œé—´æ¨¡å¼ã€ç¬¬äºŒç§æ˜¯åœ¨æ‰€æœ‰ç•Œé¢ä¸Šéƒ½æ·»åŠ ä¸€å±‚ç°è‰²è’™ç‰ˆã€‚ä¸‹é¢å°†å¤§æ¦‚è®²è§£è’™ç‰ˆæ–¹å¼</p><h3 id="ä¸»é¢˜æ–¹å¼"><a href="#ä¸»é¢˜æ–¹å¼" class="headerlink" title="ä¸»é¢˜æ–¹å¼"></a>ä¸»é¢˜æ–¹å¼</h3><p>ä¸»é¢˜æ–¹å¼ç®€å•æ¥è¯´å°±æ˜¯å°†å…¨å±€XMLæ–‡ä»¶ä¸­çš„é¢œè‰²éƒ½è®¾ç½®ä¸ºä¸»é¢˜é¢œè‰²ï¼Œç„¶åå†è®¾è®¡ä¸€å¥—å¤œé—´æ¨¡å¼ä¸‹çš„ä¸»é¢˜é¢œè‰²ã€‚é€šè¿‡æ›´æ¢ä¸»é¢˜æ¥è¾¾åˆ°åˆ‡æ¢å¤œé—´æ¨¡å¼çš„æ•ˆæœ</p><h3 id="è’™ç‰ˆæ–¹å¼"><a href="#è’™ç‰ˆæ–¹å¼" class="headerlink" title="è’™ç‰ˆæ–¹å¼"></a>è’™ç‰ˆæ–¹å¼</h3><p>æ—¢ç„¶æ˜¯æ·»åŠ è’™ç‰ˆäº†ï¼Œé‚£å…ˆå¾—è€ƒè™‘ä¸€ä¸‹å°†è’™ç‰ˆæ·»åŠ åˆ°å“ªé‡Œï¼Œå‰©ä¸‹çš„å¾…ä¼šå†è¯´</p><ul><li><p>è’™ç‰ˆæ·»åŠ ä½ç½®</p><p>è¿™é‡Œæˆ‘ä»¬å°†è’™ç‰ˆæ·»åŠ åˆ°Activityçª—å£çš„æ ¹è§†å›¾ï¼Œä¹Ÿå°±æ˜¯DecorViewï¼Œä¸‹é¢ä¸ºDecorViewè§†å›¾ç»“æ„</p><p><img src="https://upload-images.jianshu.io/upload_images/7010367-4969918bb6d51d75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/530/format/webp" alt="img"></p><blockquote><p>è€ŒPhoneWindowæ˜¯Windowç±»çš„å…·ä½“å®ç°ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡è¯¥ç±»å»ç»˜åˆ¶çª—å£ï¼Œæ˜¯Activityå’Œæ•´ä¸ªViewç³»ç»Ÿäº¤äº’çš„æ¥å£ï¼Œæ‰€ä»¥æ²¡å¿…è¦æ”¾åœ¨è¿™é‡Œ</p></blockquote></li></ul><p>æ—¢ç„¶ä½ç½®æ‰¾å¥½äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è·å–DecorViewï¼Œæ¯•ç«Ÿæ˜¯éœ€è¦å‘é‡Œé¢æ·»åŠ ä¸€ä¸ªè’™ç‰ˆï¼Œæ‰€ä»¥ç°åœ¨æ˜¯è¦è·å–DecorViewã€‚</p><blockquote><p>DecorViewæ˜¯ä¸€ä¸ªFrameLayoutï¼ŒDecorViewå†…éƒ¨åˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ActionBarï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ContentParentï¼Œå³activityåœ¨setContentViewå¯¹åº”çš„å¸ƒå±€</p></blockquote><ul><li><p>è·å–DecorView</p><p>åœ¨Activityè¿˜åœ¨å±•ç¤ºçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è¿›è¡Œè·å–</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getMDecorView</span><span class="params">(activity: <span class="type">Activity</span>)</span></span>: FrameLayout? &#123;</span><br><span class="line">    <span class="comment">// ä¸ºäº†å¤„ç†åœ¨apiå°äº17çš„æ—¶å€™isDestroyedæ— æ³•ä½¿ç”¨çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!activity.isFinishing &amp;&amp; !activity.isDestroyed) <span class="keyword">return</span> activity.window?.decorView <span class="keyword">as</span>? FrameLayout</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!activity.isFinishing) <span class="keyword">return</span> activity.window?.decorView <span class="keyword">as</span>? FrameLayout</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œå†™æˆæ‰©å±•å‡½æ•°ï¼Œæ–¹ä¾¿åé¢çš„ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> Activity.decorView: FrameLayout?</span><br><span class="line">       <span class="keyword">get</span>() = (takeIf &#123;</span><br><span class="line">           <span class="comment">// ä¸ºäº†å¤„ç†åœ¨apiå°äº17çš„æ—¶å€™isDestroyedæ— æ³•ä½¿ç”¨çš„æƒ…å†µ</span></span><br><span class="line">           <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN_MR1) &#123;</span><br><span class="line">               !isFinishing &amp;&amp; !isDestroyed</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               !isFinishing</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;?.window?.decorView) <span class="keyword">as</span>? FrameLayout</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œéœ€è¦å¼ºè½¬ä¸€ä¸‹ï¼ŒgetDecorViewè¿”å›çš„ç±»å‹æ˜¯View (å¼ºè½¬è¦ç”¨ as? ä»¥å…å¼ºè½¬å¤±è´¥è€Œå´©æºƒ)</p></blockquote></li></ul><p>æ¥ä¸‹æ¥å°±æ˜¯å‘DecorViewä¸­æ·»åŠ è’™ç‰ˆViewäº†ï¼Œä½†æ˜¯æ·»åŠ çš„æ—¶æœºä¹Ÿæ˜¯éå¸¸é‡è¦çš„ã€‚è¦æ˜¯æ·»åŠ æ—¶æœºæ™šäº†ï¼Œåœ¨è¿›å…¥æ–°é¡µé¢æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªâ€<strong>é—ªä¸€ä¸‹</strong>â€œçš„è¿‡ç¨‹</p><ul><li><p>æ·»åŠ è’™ç‰ˆæ—¶æœº</p><p>ä¸ºäº†é¿å…å‡ºç°â€<strong>é—ªä¸€ä¸‹</strong>â€œçš„é—®é¢˜ï¼Œè¿™é‡Œé€šè¿‡Handler.postAtFrontOfQueue()å°†æ·»åŠ è’™ç‰ˆViewä»»åŠ¡æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œè¿›è¡Œä¼˜å…ˆå¤„ç†</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> handler = Handler(Looper.getMainLooper())</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®æ˜¯å¦ä¸ºå¤œé—´æ¨¡å¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nightMode</span><span class="params">(activity: <span class="type">AppCompatActivity</span>, lightOff: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">    <span class="comment">// ä¸ºäº†é¿å…ç•Œé¢å±•ç¤ºå‡ºæ¥åé»‘ä¸€ä¸‹ï¼Œæ‰€ä»¥å°†â€œæ·»åŠ è’™ç‰ˆâ€ä»»åŠ¡æ·»åŠ åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œä¼˜å…ˆå¤„ç†</span></span><br><span class="line">handler.postAtFrontOfQueue &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ è’™ç‰ˆView</p><p>æ·»åŠ çš„æ—¶æœºä¹Ÿè§£å†³äº†ï¼Œå‰©ä¸‹çš„è‡ªç„¶å°±æ˜¯æ·»åŠ Viewäº†ã€‚è¿™é‡Œæ·»åŠ Viewæ˜¯ä½¿ç”¨çš„<strong>åŠ¨æ€æ„å»ºå¸ƒå±€</strong>ï¼ŒåŠ¨æ€çš„è¿›è¡Œæ·»åŠ å’Œç§»é™¤</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> handler = Handler(Looper.getMainLooper())</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¤œé—´æ¨¡æ¿ç»Ÿä¸€Layout_id</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> mId = <span class="string">&quot;darkMask&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> match_parent = ViewGroup.LayoutParams.MATCH_PARENT</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> wrap_content = ViewGroup.LayoutParams.WRAP_CONTENT</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> parent_id = <span class="string">&quot;0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®æ˜¯å¦ä¸ºå¤œé—´æ¨¡å¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nightMode</span><span class="params">(activity: <span class="type">AppCompatActivity</span>, lightOff: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> (lightOff) &#123;</span><br><span class="line">            <span class="comment">// ä¸ºäº†é¿å…ç•Œé¢å±•ç¤ºå‡ºæ¥åé»‘ä¸€ä¸‹ï¼Œæ‰€ä»¥å°†â€œæ·»åŠ è’™ç‰ˆâ€ä»»åŠ¡æ·»åŠ åˆ°ä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œä¼˜å…ˆå¤„ç†</span></span><br><span class="line">            handler.postAtFrontOfQueue &#123;</span><br><span class="line">                <span class="keyword">val</span> maskView = activity.View &#123;</span><br><span class="line">                    layout_id = mId <span class="comment">// å°†LayoutIdéƒ½æŒ‡å®šä¸ºç»Ÿä¸€çš„id</span></span><br><span class="line">                    layout_width = match_parent</span><br><span class="line">                    layout_height = match_parent</span><br><span class="line">                    background_color = getColors(R.color.ui_status_dark_color)</span><br><span class="line">                &#125;</span><br><span class="line">                activity.decorView?.apply &#123;</span><br><span class="line">                    <span class="comment">// åˆ¤æ–­Viewæ˜¯å¦å·²ç»æ·»åŠ </span></span><br><span class="line">                    <span class="keyword">val</span> view = findViewById&lt;View&gt;(mId.toLayoutId())</span><br><span class="line">                    <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">                        addView(maskView)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è‹¥ä¸æ˜¯å¤œé—´æ¨¡å¼ï¼Œåˆ™ç§»é™¤View</span></span><br><span class="line">            activity.decorView?.apply &#123;</span><br><span class="line">                find&lt;View&gt;(mId)?.let &#123; removeView(it) &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><p>è’™ç‰ˆçš„èƒŒæ™¯è¿™é‡Œæ˜¯ç”¨çš„ <strong>60%</strong> é€æ˜åº¦çš„é»‘è‰²èƒŒæ™¯(é¢œè‰²å€¼ä¸ºï¼š#99000000)</p></blockquote><p>è¿™é‡Œçš„æ·»åŠ å’Œç§»é™¤éƒ½æ˜¯å¯¹ç›¸åŒLayoutIdçš„Viewè¿›è¡Œçš„æ“ä½œï¼Œé¿å…å‡ºé”™</p></li><li><p>å†…è”+æ‰©å±•å‡½æ•°</p><p>ä¸Šæ–¹çš„layout_idã€layout_widthã€layout_heightç­‰éƒ½æ˜¯ä½¿ç”¨äº†æ‰©å±•å‡½æ•°ï¼Œæ–¹ä¾¿ä½¿ç”¨å’Œæå‡å¯è¯»æ€§</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> Context.<span class="title">View</span><span class="params">(<span class="keyword">init</span>: <span class="type">View</span>.() -&gt; <span class="type">Unit</span>)</span></span> =</span><br><span class="line">       View(<span class="keyword">this</span>).apply(<span class="keyword">init</span>)</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">inline</span> <span class="keyword">var</span> View.layout_id: String</span><br><span class="line">       <span class="keyword">get</span>() &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">set</span>(value) &#123;</span><br><span class="line">           id = value.toLayoutId()</span><br><span class="line">       &#125;</span><br><span class="line">   <span class="keyword">inline</span> <span class="keyword">var</span> View.layout_width: <span class="built_in">Int</span></span><br><span class="line">       <span class="keyword">get</span>() &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">set</span>(value) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">inline</span> <span class="keyword">var</span> View.layout_height: <span class="built_in">Int</span></span><br><span class="line">       <span class="keyword">get</span>() &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">set</span>(value) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">inline</span> <span class="keyword">var</span> View.background_color: <span class="built_in">Int</span></span><br><span class="line">       <span class="keyword">get</span>() &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">set</span>(value) &#123;</span><br><span class="line">           setBackgroundColor(value)</span><br><span class="line">       &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">inline</span> <span class="keyword">var</span> View.layout_visibility: <span class="built_in">Int</span></span><br><span class="line">       <span class="keyword">get</span>() &#123;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">set</span>(value) &#123;</span><br><span class="line">           visibility = value</span><br><span class="line">       &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">fun</span> String.<span class="title">toLayoutId</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">       <span class="keyword">var</span> id = java.lang.String(<span class="keyword">this</span>).bytes.sum()</span><br><span class="line">       <span class="keyword">if</span> (id == <span class="number">48</span>) id = <span class="number">0</span></span><br><span class="line">       <span class="keyword">return</span> id</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : View&gt;</span> View.<span class="title">find</span><span class="params">(id: <span class="type">String</span>)</span></span>: T? = findViewById(id.toLayoutId())</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šå°±å®Œæˆäº†ï¼Œå‰©ä¸‹çš„å¯ä»¥åˆ›å»ºä¸€ä¸ªActivityçš„åŸºç±»ï¼Œå°†æ·»åŠ è’™ç‰ˆæ–¹æ³•æ”¾å…¥å…¶ä¸­ï¼Œæ¥è¿›è¡Œç»Ÿä¸€ç®¡ç†</p><blockquote><p>è‡³äºä¸Šæ–¹çš„String.toLayoutId()ï¼š</p><p><code>View.setId(int id)</code>æ¥æ”¶ int ç±»å‹çš„å€¼ï¼Œä½† int å€¼æ²¡æœ‰è¯­ä¹‰ï¼Œèµ·ä¸åˆ°æ ‡è®°æ§ä»¶çš„ä½œç”¨ï¼Œæ‰€ä»¥æ‰©å±•å±æ€§<code>layout_id</code>æ˜¯ String ç±»å‹çš„ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="keyword">var</span> View.layout_id: String</span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span>(value) &#123;</span><br><span class="line">        id = value.toLayoutId()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x27;å°†Stringè½¬åŒ–æˆå¯¹åº”çš„Intå€¼&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">toLayoutId</span><span class="params">()</span></span>:<span class="built_in">Int</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> id = java.lang.String(<span class="keyword">this</span>).bytes.sum()</span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">48</span>) id = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>String å¿…é¡»è½¬åŒ–æˆ Int æ‰èƒ½è°ƒç”¨<code>View.setId()</code>ï¼Œé‡‡ç”¨çš„æ–¹æ³•æ˜¯ï¼šå…ˆå°† String è½¬åŒ–æˆ byte æ•°ç»„ï¼Œç„¶åå¯¹æ•°ç»„ç´¯åŠ ã€‚ä½† Kotlin ä¸­çš„ String æ²¡æœ‰<code>getBytes()</code>ï¼Œæ‰€ä»¥åªèƒ½æ˜¾ç¤ºåœ°æ„é€ <code>java.lang.String</code>ã€‚</p></blockquote></li></ul><h3 id="åŠ¨ç”»æ•ˆæœ"><a href="#åŠ¨ç”»æ•ˆæœ" class="headerlink" title="åŠ¨ç”»æ•ˆæœ"></a>åŠ¨ç”»æ•ˆæœ</h3><p>è‡³äºåŠ¨ç”»æ•ˆæœå˜›ï¼Œå¯ä»¥åœ¨æ·»åŠ è’™ç‰ˆViewçš„æ—¶å€™å…ˆå°†é€æ˜åº¦è®¾ç½®ä¸º0fï¼Œåœ¨ä½¿ç”¨å±æ€§åŠ¨ç”»ä½¿æ¸æ˜¾ç¤ºã€‚ç§»é™¤çš„æ—¶å€™ä¹Ÿå¯ä»¥å…ˆä½¿ç”¨åŠ¨ç”»è¿›è¡Œéšè—å†ç§»é™¤</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nightAnimMode</span><span class="params">(activity: <span class="type">AppCompatActivity</span>, lightOff: <span class="type">Boolean</span>, animTime: <span class="type">Long</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lightOff) &#123;</span><br><span class="line">            handler.postAtFrontOfQueue &#123;</span><br><span class="line">                <span class="keyword">val</span> maskView = activity.View &#123;</span><br><span class="line">                    layout_id = mId</span><br><span class="line">                    layout_width = match_parent</span><br><span class="line">                    layout_height = match_parent</span><br><span class="line">                    background_color = getColors(R.color.ui_status_dark_color)</span><br><span class="line">                    <span class="comment">// å…ˆå°†é€æ˜åº¦è®¾ç½®ä¸º0fï¼Œä¹Ÿå°±æ˜¯å…ˆéšè—ï¼Œåé€šè¿‡åŠ¨ç”»æ¥æ˜¾ç¤º</span></span><br><span class="line">                    <span class="keyword">this</span>.alpha = <span class="number">0f</span></span><br><span class="line">                &#125;</span><br><span class="line">                activity.decorView?.apply &#123;</span><br><span class="line">                    <span class="keyword">val</span> view = findViewById&lt;View&gt;(mId.toLayoutId())</span><br><span class="line">                    <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.addView(maskView).let &#123;</span><br><span class="line">                            <span class="comment">// æ·»åŠ å®ŒViewä¹‹åï¼Œå†è·å–Viewæ¥è¿›è¡Œå±æ€§åŠ¨ç”»</span></span><br><span class="line">                            find&lt;View&gt;(mId)?.let &#123;</span><br><span class="line">                                <span class="keyword">val</span> animation = AlphaAnimation(<span class="number">0f</span>, <span class="number">1.0f</span>)</span><br><span class="line">                                animation.duration = animTime</span><br><span class="line">                                it.startAnimation(animation)</span><br><span class="line">                                it.alpha = <span class="number">1.0f</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            activity.decorView?.apply &#123;</span><br><span class="line">                find&lt;View&gt;(mId)?.let &#123;</span><br><span class="line">                    <span class="comment">// å…ˆéšè—ï¼Œåç§»é™¤</span></span><br><span class="line">                    <span class="keyword">val</span> animation = AlphaAnimation(<span class="number">1.0f</span>, <span class="number">0f</span>)</span><br><span class="line">                    animation.duration = animTime</span><br><span class="line">                    it.startAnimation(animation)</span><br><span class="line">                    removeView(it)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Theme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Androidäº‹ä»¶åˆ†å‘æœºåˆ¶(äºŒ)</title>
      <link href="2021/07/07/Android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6-%E4%BA%8C/"/>
      <url>2021/07/07/Android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<p>Androidäº‹ä»¶åˆ†å‘æœºåˆ¶ç†è§£ä¸æè¿°çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦æ˜¯å…ˆä»‹ç»äº‹ä»¶åˆ†å‘çš„æµç¨‹</p><a id="more"></a><h1 id="Androidäº‹ä»¶åˆ†å‘æœºåˆ¶-äºŒ"><a href="#Androidäº‹ä»¶åˆ†å‘æœºåˆ¶-äºŒ" class="headerlink" title="Androidäº‹ä»¶åˆ†å‘æœºåˆ¶(äºŒ)"></a>Androidäº‹ä»¶åˆ†å‘æœºåˆ¶(äºŒ)</h1><blockquote><p>æœ¬ç¯‡æ˜¯ä¸ªäººå¯¹Androidäº‹ä»¶åˆ†å‘æœºåˆ¶ç†è§£ä¸æè¿°çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦æ˜¯å…ˆä»‹ç»äº‹ä»¶åˆ†å‘çš„æµç¨‹</p></blockquote><p>ä¸‹é¢å°†é€šè¿‡Androidæºç æ¥è®²è§£äº‹ä»¶åˆ†å‘æµç¨‹</p><h3 id="äº‹ä»¶åˆ†å‘æµç¨‹"><a href="#äº‹ä»¶åˆ†å‘æµç¨‹" class="headerlink" title="äº‹ä»¶åˆ†å‘æµç¨‹"></a>äº‹ä»¶åˆ†å‘æµç¨‹</h3><h4 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h4><p>äº‹ä»¶æœ€å¼€å§‹ä¼šç”±ç³»ç»Ÿåˆ†å‘ç»™Activityã€‚æ¥è°ƒç”¨Activity.dispatchTouchEvent(MotionEvent e)</p><blockquote><p>æ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯è¿˜æ²¡æœ‰è¿›å…¥<code>æ§ä»¶</code>é—´çš„äº‹ä»¶åˆ†å‘ã€‚è¿™æ˜¯å› ä¸ºActivityä¸æ˜¯ä¸€ä¸ªViewï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªViewGroup</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Activity.dispatchTouchEvent</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123; </span><br><span class="line">        onUserInteraction(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span> (getWindow().superDispatchTouchEvent(ev)) &#123;<span class="comment">// åˆ†å‘äº†è¿™ä¸ªäº‹ä»¶ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> onTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>Activity.DispathcTouchEven()</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹è§ï¼ŒActivityé€šè¿‡<code>getWindow</code>è·å–<code>Window</code>æŠ½è±¡ç±»ï¼Œä¹Ÿå°±æ˜¯è·å–<code>PhoneWindow</code>ï¼Œåœ¨è°ƒç”¨<code>PhoneWindow.superDispatchTouchEvent()</code>çš„æ–¹æ³•ç»§ç»­å°†äº‹ä»¶åˆ†å‘ä¸‹å»ï¼Œä½†æ˜¯PhoneWindowä»ç„¶è¿˜ä¸æ˜¯ä¸ªViewæˆ–ViewGroupï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦ç»§ç»­æ·±å…¥ä¸‹å»</p><blockquote><p>getWindow()è¿”å›çš„æ˜¯ä¸€ä¸ªWindowæŠ½è±¡ç±»ï¼Œåœ¨Androidä¸­ï¼Œå”¯ä¸€ç»§æ‰¿äº†Windowçš„ç±»å°±æ˜¯PhoneWindowï¼Œæ‰€ä»¥åœ¨è¿™é‡ŒActivityå°±æ˜¯åœ¨è°ƒç”¨PhoneWindow.superDispatchTouchEvent(MotionEvent e)</p></blockquote><h4 id="PhoneWindow"><a href="#PhoneWindow" class="headerlink" title="PhoneWindow"></a>PhoneWindow</h4><p><code>PhoneWindow</code>æ˜¯<code>Android</code>ä¸­æœ€åŸºæœ¬çš„çª—å£ç³»ç»Ÿï¼Œæ¯ä¸€ä¸ª<code>Activity</code>éƒ½ä¼šåˆ›å»º<code>PhoneWindow</code>å¯¹è±¡ï¼Œæ˜¯<code>Activity</code>å’Œæ•´ä¸ª<code>View</code>ç³»ç»Ÿäº¤äº’çš„æ¥å£ã€‚ä½†æ˜¯åœ¨äº‹ä»¶åˆ†å‘ä¸­ï¼Œå®ƒå°±åªæ˜¯æ‰®æ¼”ä¸€ä¸ªä¸­é—´è§’è‰²ï¼Œè¿›è¡Œä¼ é€’äº‹ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸ä¼šå¤ªå…³å¿ƒPhoneWindow</p><p>ä¸‹é¢å°±å…ˆæ¥çœ‹çœ‹<code>PhoneWindow.superDispatchTouchEvent(MotionEvent e)</code>è¿™ä¸ªæ–¹æ³•å§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PhoneWindow.java</span></span><br><span class="line"><span class="keyword">private</span> DecorView mDecor;</span><br><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> mDecor.superDispatchTouchEvent(event);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// PhoneWindow.DecorView å†…éƒ¨ç±»</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DecorView</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> <span class="keyword">implements</span> <span class="title">RootViewSurfaceTaker</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">superDispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>PhoneWindow.superDispatchTouchEvent(MotionEvent event)</code>çš„å†…éƒ¨ï¼Œæ˜¯è°ƒç”¨äº†ä¸€ä¸ª<code>mDecor.superDispatchTouchEvent(event)</code>ã€‚è¿™ä¸ª<code>mDecor</code>å…¶å®æ˜¯<code>Window</code>ä¸‹é¢çš„<code>DecorView</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>PhoneWindow</code>å†…éƒ¨æ˜¯è°ƒç”¨äº†<code>DecorView.superDispatchTouchEvent(MotionEvent event)</code></p><blockquote><p>è¿™é‡Œå†æ¢³ç†ä¸€éï¼Œé¦–å…ˆç³»ç»Ÿå°†äº‹ä»¶åˆ†å‘ç»™åˆ°äº†Activityï¼ŒActivityå†å°†äº‹ä»¶åˆ†å‘ç»™PhoneWindowï¼ŒPhoneWindowå†å°†äº‹ä»¶åˆ†å‘ç»™åˆ°äº†DecorViewã€‚è€ŒDecorViewæ˜¯ä¸€ä¸ªViewGroup(ä¸€ä¸ªç»§æ‰¿ä¸FrameLayoutçš„ViewGroup)ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯å±äºæ§ä»¶é—´çš„äº‹ä»¶åˆ†å‘äº†</p></blockquote><p>æ‰€ä»¥<code>PhoneWindow</code>ç»§ç»­å°†äº‹ä»¶ä¼ é€’åˆ°äº†<code>DecorView</code>ï¼Œç»ˆäºä¼ é€’åˆ°<code>ViewGroup</code>ä¸Šäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å±äºæ§ä»¶é—´çš„äº‹ä»¶åˆ†å‘äº†</p><h4 id="ViewGroup"><a href="#ViewGroup" class="headerlink" title="ViewGroup"></a>ViewGroup</h4><p>ä»ä¸Šé¢å°±å¯ä»¥çŸ¥é“ï¼Œç¬¬ä¸€ä¸ªæ¥å—åˆ°äº‹ä»¶çš„å°±æ˜¯<code>DecorView</code>ï¼Œè€Œ<code>DecorView</code>æ˜¯ç»§æ‰¿<code>FrameLayout</code>ï¼Œè€Œ<code>DecorView</code>å†…éƒ¨ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨äº†<code>super.dispatchTouchEvent(event)</code></p><p>æ‰€ä»¥æ§ä»¶é—´äº‹ä»¶ä¼ é€’çš„èµ·å§‹æ–¹æ³•å°±æ˜¯<code>ViewGroup.dispatchTouchEvent(MotionEvent event)</code>ï¼Œä¸‹é¢å°†è®²è§£å®ƒæ˜¯å¦‚ä½•æŠŠäº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ§ä»¶çš„ï¼Œæ˜¯å¦‚ä½•åˆ¤æ–­è¿”å›å€¼æ ‡è¯†äº‹ä»¶æ˜¯å¦è¢«æ¶ˆè´¹</p><ul><li><h5 id="ä¼ é€’è§„åˆ™"><a href="#ä¼ é€’è§„åˆ™" class="headerlink" title="ä¼ é€’è§„åˆ™"></a>ä¼ é€’è§„åˆ™</h5><p>å› ä¸ºæƒ³è¦å°†äº‹ä»¶ç»§ç»­åˆ†å‘ä¸‹å»ï¼Œæ‰€ä»¥å†ViewGroupä¸­è‚¯å®šå…ˆè¦éå†ä¸€éå­View</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="comment">// å…è®¸ä¿®æ”¹é»˜è®¤çš„childè·å–è§„åˆ™, ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ä¼šè·å–</span></span><br><span class="line">    <span class="comment">// å…ˆåˆ¤æ–­preorderedListä¸­æ˜¯å¦å·²ç»å­˜æœ‰å­Viewï¼Œæœ‰çš„è¯å°±ç›´æ¥åœ¨é‡Œé¢å–å‡ºï¼Œæ²¡æœ‰çš„è¯å°±ä»childern[]ä¸­å–</span></span><br><span class="line">    children[childIndex] <span class="keyword">final</span> View child = (preorderedList == <span class="keyword">null</span>) ? children[childIndex] : preorderedList.get(childIndex); </span><br><span class="line">    <span class="comment">// çœç•¥é€šå¸¸ä¸ä¼šå½±å“æµç¨‹çš„ä»£ç  </span></span><br><span class="line">    <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="keyword">false</span>, child, idBitsToAssign)) &#123;<span class="comment">// å…³é”®æ–¹æ³• </span></span><br><span class="line">        <span class="comment">// ... </span></span><br><span class="line">        newTouchTarget = addTouchTarget(child, idBitsToAssign);<span class="comment">// å…³é”®æ–¹æ³• </span></span><br><span class="line">        <span class="comment">// ... break; </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢ä»£ç éå†çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªå…³é”®åˆ¤æ–­æ‰§è¡Œäº†<code>ViewGroup.dispathTransformedTouchEvent()</code>è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­ä¼ å…¥è¿›æ¥çš„<code>child</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºçš„è¯ï¼Œå°±æ‰§è¡Œ<code>super.dispatchTouchEvent(event)</code>ï¼Œä¸ä¸ºç©ºçš„è¯å°±æ‰§è¡Œ<code>child.dispatchTouchEvent(event)</code>ã€‚æ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯ä¸ä¸ºç©ºçš„ï¼Œæ‰€ä»¥å°±æ˜¯åœ¨è¿™é‡Œå°†äº‹ä»¶ä¼ é€’ç»™äº†å­<code>View</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">dispatchTransformedTouchEvent</span><span class="params">(MotionEvent event, <span class="keyword">boolean</span> cancel,</span></span></span><br><span class="line"><span class="function"><span class="params">           View child, <span class="keyword">int</span> desiredPointerIdBits)</span> </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">           <span class="keyword">if</span> (child == <span class="keyword">null</span>) &#123;</span><br><span class="line">               handled = <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               handled = child.dispatchTouchEvent(event);</span><br><span class="line">           &#125;</span><br><span class="line">...</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ é€’ç»™å­Viewä¹‹åï¼Œè¿”å›Trueå°±è¡¨ç¤ºå­æ§ä»¶æ¥æ”¶åˆ°äº†è¿™ä¸ªäº‹ä»¶ï¼Œæ³¨æ„åœ¨è¿™ä¸ªæ–¹æ³•ä¸‹é¢è¿˜è¦ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯<code>newTouchTarget = addTouchTarget(child, idBitsToAssign)</code>è¿™ä¸ªæ–¹æ³•åªä¼šåœ¨è¿”å›ä¸ºTrueï¼Œä¹Ÿå°±æ˜¯å­æ§ä»¶æ¥å—åˆ°äº†äº‹ä»¶çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯æŠŠå½“å‰è¿™ä¸ªæ¥æ”¶äº‹ä»¶çš„å­æ§ä»¶è½¬æ¢æˆäº†<code>TouchTarget</code>å¯¹è±¡å¹¶èµ‹å€¼ç»™äº†<code>mFirstTouchTarget</code></p><p>è‡³äºä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Œé‚£æ˜¯å› ä¸ºï¼Œåœ¨è¿™ä¸ªå¾ªç¯çš„å¤–é¢æœ‰å‡ å±‚è¿™æ ·çš„åˆ¤æ–­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN) || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123; </span><br><span class="line">        <span class="comment">// ... </span></span><br><span class="line">        <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; childrenCount != <span class="number">0</span>) &#123; </span><br><span class="line">            <span class="comment">// éå†ä»£ç  </span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å±‚åˆ¤æ–­æ˜¯åˆ¤æ–­<code>ACTION_CANCEL</code>äº‹ä»¶å’Œè¢«å½“å‰æ§ä»¶æ‹¦æˆªäº‹ä»¶ã€‚ç¬¬äºŒå±‚åˆ¤æ–­æ˜¯é™åˆ¶äº†äº‹ä»¶åªèƒ½æ˜¯<code>ACTION_DOWN</code>ï¼Œåªæœ‰äº‹ä»¶æ˜¯<code>ACTION_DOWN</code>çš„æ—¶å€™æ‰ä¼šç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´<code>ACTION_MOVE</code>ç­‰ä¸­é—´äº‹ä»¶ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œéå†ä»£ç çš„ã€‚ç¬¬ä¸‰å±‚åˆ¤æ–­æ˜¯åªæœ‰ä¹‹å‰èƒ½æ¥æ”¶åˆ°äº‹ä»¶çš„æ§ä»¶æ‰ä¼šç»§ç»­æ¥æ”¶äº‹ä»¶ï¼Œä¹‹å‰ä¸èƒ½æ¥æ”¶åˆ°äº‹ä»¶çš„æ§ä»¶æ˜¯ä¸ä¼šåˆ†å‘äº‹ä»¶çš„</p><blockquote><p>ç®€å•ç‚¹æ¥è¯´å°±æ˜¯ViewGroupç¬¬ä¸€æ¬¡ä¼šéå†æ‰€æœ‰æ§ä»¶å¹¶åˆ†å‘äº‹ä»¶ï¼Œæ¥æ”¶åˆ°äº‹ä»¶çš„Viewå°±ä¼šè¢«è½¬æˆTouchTargetè®°å½•èµ·æ¥ã€‚ä¹‹åçš„ä¸­é—´äº‹ä»¶(ACTION_MOVEç­‰â€¦)éƒ½åªä¼šä¼ é€’ç»™TouchTarget</p></blockquote><blockquote><p>è€ŒmFirstTouchTargetå…¶å®æ˜¯ä¸€ä¸ªé“¾è¡¨, ä¼šæŠŠäº‹ä»¶åˆ†å‘ç»™é“¾è¡¨ä¸­çš„æ‰€æœ‰å­æ§ä»¶, è¿™æ˜¯é’ˆå¯¹å¤šç‚¹è§¦æ§çš„å¤„ç†, ä¸æ˜¯æœ¬æ–‡å…³æ³¨çš„é—®é¢˜, ä¸ä½œåˆ†æ, åªéœ€è¦çŸ¥é“å…¶ä»–é<code>ACTION_DOWN</code>äº‹ä»¶çš„ä¼ é€’ä¸ä¼šé‡æ–°éå†æ‰€æœ‰å­æ§ä»¶, <code>ACTION_DOWN</code>æ˜¯æ•´ä¸ªæ“ä½œ(ä¸€ç³»åˆ—äº‹ä»¶)çš„èµ·ç‚¹, åœ¨è¿™æ—¶å€™å°±å·²ç»ç¡®å®šåç»­äº‹ä»¶éœ€è¦ä¼ é€’çš„å­æ§ä»¶äº†</p></blockquote></li></ul><h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>åˆ†æåˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»çŸ¥é“äº‹ä»¶åˆ†å‘æœºåˆ¶æ˜¯æ€æ ·åœ¨æ§ä»¶é—´ä¼ é€’äº‹ä»¶çš„äº†ã€‚</p><p>çˆ¶æ§ä»¶éå†å­æ§ä»¶, è¯¢é—®æ‰€æœ‰å­æ§ä»¶æ˜¯å¦æ¥æ”¶<code>ACTION_DOWN</code>äº‹ä»¶, ç„¶åä¿å­˜æ¥æ”¶äº‹ä»¶çš„å­æ§ä»¶åˆ°é“¾è¡¨, ç¡®å®šåç»­äº‹ä»¶çš„åˆ†å‘å¯¹è±¡, å½“å…¶ä»–äº‹ä»¶ä¼ é€’ç»™çˆ¶æ§ä»¶æ—¶ç›´æ¥ä¼ é€’äº‹ä»¶ç»™é“¾è¡¨ä¸­çš„å­æ§ä»¶. å½“æ²¡æœ‰å­æ§ä»¶æ¥æ”¶<code>ACTION_DOWN</code>æ—¶æ‰§è¡Œ<code>View.dispatchTouchEvent</code>ï¼Œä¸‹ä¸€ç¯‡å°†ä¸“é—¨åˆ†æ<code>View</code>ç±»</p><h3 id="æ‹¦æˆª"><a href="#æ‹¦æˆª" class="headerlink" title="æ‹¦æˆª"></a>æ‹¦æˆª</h3><h4 id="Activityå¤„æ‹¦æˆª"><a href="#Activityå¤„æ‹¦æˆª" class="headerlink" title="Activityå¤„æ‹¦æˆª"></a>Activityå¤„æ‹¦æˆª</h4><p>å› ä¸ºActivity.dispatchTouchEvent(MotionEvent e)æ˜¯æ•´ä¸ªäº‹ä»¶åˆ†å‘çš„èµ·ç‚¹ç«™ï¼Œæ‰€ä»¥ä¸»è¦é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œä¸è°ƒç”¨<code>PhoneWindow.superDispatchTouchEvent(MotionEvent ev)</code>å°±å¯ä»¥ä½¿å¾—æ•´ä¸ªActivityå†…çš„æ§ä»¶æ”¶ä¸åˆ°ä»»ä½•äº‹ä»¶</p><h4 id="ViewGroupå¤„æ‹¦æˆª"><a href="#ViewGroupå¤„æ‹¦æˆª" class="headerlink" title="ViewGroupå¤„æ‹¦æˆª"></a>ViewGroupå¤„æ‹¦æˆª</h4><p>å¯ä»¥é€šè¿‡<code>ViewGroup.onInterceptTouchEvent</code>æ¥æ‹¦æˆªç‰¹å®šçš„äº‹ä»¶</p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> äº‹ä»¶åˆ†å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Androidäº‹ä»¶åˆ†å‘æœºåˆ¶(ä¸€)</title>
      <link href="2021/07/07/Android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6-%E4%B8%80/"/>
      <url>2021/07/07/Android%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6-%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<p>Androidäº‹ä»¶åˆ†å‘æœºåˆ¶ç†è§£ä¸æè¿°çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦æ˜¯å…ˆä»‹ç»äº‹ä»¶åˆ†å‘æœºåˆ¶çš„æ¦‚å¿µ</p><a id="more"></a><h1 id="Androidäº‹ä»¶åˆ†å‘æœºåˆ¶-ä¸€"><a href="#Androidäº‹ä»¶åˆ†å‘æœºåˆ¶-ä¸€" class="headerlink" title="Androidäº‹ä»¶åˆ†å‘æœºåˆ¶(ä¸€)"></a>Androidäº‹ä»¶åˆ†å‘æœºåˆ¶(ä¸€)</h1><blockquote><p>æœ¬ç¯‡æ˜¯ä¸ªäººå¯¹Androidäº‹ä»¶åˆ†å‘æœºåˆ¶ç†è§£ä¸æè¿°çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦æ˜¯å…ˆä»‹ç»äº‹ä»¶åˆ†å‘æœºåˆ¶çš„æ¦‚å¿µ</p></blockquote><h3 id="æ„ä¹‰"><a href="#æ„ä¹‰" class="headerlink" title="æ„ä¹‰"></a>æ„ä¹‰</h3><p>ä»»ä½•å¯¹æ‰‹æœºå±å¹•çš„æ“ä½œéƒ½ç¦»ä¸å¼€äº‹ä»¶åˆ†å‘æœºåˆ¶ï¼Œæ¸…æ¥šäº‹ä»¶åˆ†å‘æœºåˆ¶å¯ä»¥æ›´å¥½çš„å»å®ç°å¤æ‚äº¤äº’</p><blockquote><p>äº‹ä»¶åˆ†å‘æœºåˆ¶ç”¨æ¥è§£å†³çš„é—®é¢˜éƒ½æ˜¯åœ¨Androidæ§ä»¶ä¹‹é—´ä¼ é€’ç”¨æˆ·å¯¹å±å¹•çš„æ“ä½œï¼Œå¦‚æ»‘åŠ¨ç­‰</p></blockquote><h3 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h3><p>åœ¨Androidä¸­ï¼Œç³»ç»Ÿä¸ä¼šå°†ç”¨æˆ·æ“ä½œè¿™ä¸€æ•´ä¸ª<strong>æ“ä½œ</strong>éƒ½ä¼ é€’ä¸‹æ¥ï¼Œè€Œæ˜¯ä¼šåˆ†æˆå¤šä¸ª<strong>äº‹ä»¶</strong>ä¸€ä¸ªä¸€ä¸ªä¸‹å‘</p><blockquote><p>ç³»ç»Ÿä¼šæŠŠç”¨æˆ·çš„æ“ä½œåˆ†è§£æˆä¸€ç³»åˆ—çš„äº‹ä»¶, ç„¶åé€ä¸ªä¼ é€’è¿™äº›äº‹ä»¶. äº‹ä»¶å¯ä»¥çœ‹ä½œæ˜¯ç”¨æˆ·æ“ä½œè¿‡ç¨‹çš„èŠ‚ç‚¹, æ¯æ¬¡åˆ†å‘åªä¼šåˆ†å‘ä¸€ä¸ªäº‹ä»¶.</p></blockquote><p>æ¯”å¦‚è¯´ï¼Œç”¨æˆ·æ»‘åŠ¨äº†ä¸€ä¸‹å±å¹•ï¼Œé‚£ä¹ˆç³»ç»Ÿå°†ä¼šä¼ é€’-æ‰‹æŒ‡æ¥è§¦å±å¹• â€“&gt; ç§»åŠ¨æ‰‹æŒ‡(æˆ–è€…å¤šä¸ª) â€“&gt; æ‰‹æŒ‡ç¦»å¼€å±å¹•. Androidäº‹ä»¶åˆ†å‘æœºåˆ¶æ‰€ä¼ é€’çš„å°±æ˜¯è¿™äº›åˆ†è§£ä¹‹åçš„äº‹ä»¶(æ‰‹æŒ‡æ¥è§¦å±å¹•, ç§»åŠ¨æ‰‹æŒ‡, æ‰‹æŒ‡ç¦»å¼€å±å¹•).</p><p>åœ¨Androidè¿™äº›æ“ä½œéƒ½æ˜¯ç”¨<code>MotionEvent</code>ç±»æ¥ä»£è¡¨ã€‚å¤§éƒ¨åˆ†äº‹ä»¶åˆ†å‘æœºåˆ¶ä¸­æ¶‰åŠçš„æ–¹æ³•é‡Œé¢éƒ½åŒ…å«ä¸€ä¸ª<code>MotionEvent</code>å®ä¾‹ï¼Œä¸‹é¢å°†ä»‹ç»ä¸€ä¸‹<code>MotionEvent</code>æœ‰é‚£äº›ç±»å‹</p><ul><li><code>ACTION_DOWN</code>ï¼šä»£è¡¨ç€æ‰‹æŒ‡é¦–æ¬¡æ¥è§¦å±å¹•ï¼Œæ˜¯æ‰€æœ‰æ“ä½œçš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¼ é€’äº‹ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€ä»¥äº‹ä»¶åˆ†å‘çš„ç¬¬ä¸€ä¸ªäº‹ä»¶æ€»æ˜¯<code>ACTION_DOWN</code></li><li><code>ACTION_MOVE</code>ï¼šä»£è¡¨ç€æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨ï¼Œä¸»è¦æ˜¯ç”¨æ¥åŒºåˆ†ç‚¹å‡»è¿˜æ˜¯æ»‘åŠ¨</li><li><code>ACTION_UP</code>ï¼šä»£è¡¨ç€æ‰‹æŒ‡ä»å±å¹•ä¸Šç§»å¼€ï¼Œæ˜¯æ‰€æœ‰æ“ä½œçš„æœ€åä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯æ˜¯åœ¨äº‹ä»¶ä¼ é€’ä¸­ï¼Œæ‰€ä»¥äº‹ä»¶åºåˆ—é‡Œé¢æœ€åä¸€ä¸ªäº‹ä»¶åˆ†å‘çš„æ€»æ˜¯<code>ACTION_UP</code></li><li><code>ACTION_CANCEL</code>ï¼šä»£è¡¨ç€äº‹ä»¶ä¼ é€’è¢«ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹ä»¶è¢«æ¶ˆè´¹äº†ï¼Œæ¶ˆè´¹æ¦‚å¿µå°†åœ¨ä¸‹é¢ä»‹ç»</li><li><code>ACTION_POINTER_DOWN</code>ï¼šä»£è¡¨ç€åˆæœ‰æ–°çš„æ‰‹æŒ‡æ¥è§¦å±å¹•</li><li><code>ACTION_POINTER_UP</code>ï¼šä»£è¡¨åˆæœ‰åˆ«çš„æ‰‹æŒ‡ç¦»å¼€å±å¹•</li></ul><h3 id="æ¶ˆè´¹"><a href="#æ¶ˆè´¹" class="headerlink" title="æ¶ˆè´¹"></a>æ¶ˆè´¹</h3><p>åœ¨Androidä¸­äº‹ä»¶æ˜¯å±‚å±‚ä¼ é€’çš„ï¼Œå…ˆä¼ ç»™æœ€ä¸Šæ–¹çš„æ§ä»¶ï¼Œåœ¨ç”±æœ€ä¸Šæ–¹çš„æ§ä»¶å†³å®šè¦ä¸è¦ä½¿ç”¨æ‰è¿™ä¸ªäº‹ä»¶(ä¹Ÿå°±æ˜¯é”€æ¯æ‰äº‹ä»¶ï¼Œè‡ªå·±æ¥å¤„ç†)æ¥æ˜¯å¦ç»§ç»­ä¼ é€’äº‹ä»¶ã€‚æ¶ˆè´¹çš„æ„æ€æ˜¯æŒ‡è¢«æ§ä»¶æ¶ˆè€—æ‰äº†ã€‚</p><h3 id="åˆ†å‘"><a href="#åˆ†å‘" class="headerlink" title="åˆ†å‘"></a>åˆ†å‘</h3><p>äº‹ä»¶åˆ†å‘æœºåˆ¶çš„ç›®çš„æ˜¯åœ¨æ§ä»¶é—´ä¼ é€’äº‹ä»¶, é‚£ä¹ˆåˆ†å‘çš„å¯¹è±¡è‡ªç„¶æ˜¯æ§ä»¶äº†</p><blockquote><p>æ§ä»¶å³æ˜¯åˆ†å‘è€…ä¹Ÿæ˜¯åˆ†å‘å¯¹è±¡.</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> äº‹ä»¶åˆ†å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»‹ç»MVP,MVVMæ¡†æ¶æ¨¡å¼</title>
      <link href="2021/04/26/%E4%BB%8B%E7%BB%8DMVP-MVVM%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%BC%8F/"/>
      <url>2021/04/26/%E4%BB%8B%E7%BB%8DMVP-MVVM%E6%A1%86%E6%9E%B6%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>ä»‹ç»MVPå’ŒMVVMçš„ä¼˜åŠ£ï¼Œä»¥åŠä½¿ç”¨åœºæ™¯</p><a id="more"></a><h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>ç®€å•æ¥è¯´å°±æ˜¯æ•°æ®é©±åŠ¨é¡µé¢</p><p>MVVMæ˜¯ç”±3éƒ¨åˆ†ç»„æˆï¼ˆModelï¼ŒViewï¼ŒViewModelï¼‰</p><ul><li><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul><li>ä½¿ç”¨MVVMå¯ä»¥ä½¿å¼€å‘è€…ä¸ç”¨ä¸“æ³¨äºæ›´æ–°è§†å›¾ï¼Œåªéœ€è¦å»ä¸“æ³¨å®ç°é€»è¾‘</li></ul></li><li><h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li>ç”±äºViewä¸ViewModelçš„ç»‘å®šï¼Œä½¿å¾—è¿½è¸ªå¼‚å¸¸å˜å¾—ååˆ†ä¸æ–¹ä¾¿</li><li>æ•°æ®åŒå‘ç»‘å®šä¸åˆ©äºä»£ç çš„é‡ç”¨ï¼Œæ¯ä¸€ä¸ªä¸åŒçš„Viewéƒ½éœ€è¦ä¸€ä¸ªä¸åŒçš„ViewModel</li></ul></li><li><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul><li>åœ¨é¡µé¢å¤æ‚ã€é€»è¾‘è¾ƒå¤šã€æ•°æ®é¢‘ç¹æ›´æ–°çš„åœºæ™¯ï¼Œå°±å¯ä»¥ä½¿ç”¨MVVMï¼ŒActivity/Fragmentåªç”¨å°†æ•°æ®å±•ç¤ºåˆ°æ§ä»¶ä¸Šå»</li></ul></li></ul><h2 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h2><p>MVPæœ¬è´¨ä¸Šå°±æ˜¯ä¸ºäº†è§£è€¦è€Œäº§ç”Ÿçš„ï¼Œåˆ†ä¸º3éƒ¨åˆ†ï¼ˆModel(ç®¡ç†æ•°æ®)ï¼ŒView(å±•ç¤ºæ•°æ®)ï¼ŒPresenter(ä¸šåŠ¡é€»è¾‘)ï¼‰</p><ul><li><h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul><li>å°†æ¨¡å‹ä¸è§†å›¾åˆ†ç¦»ï¼Œæé«˜äº†ç»´æŠ¤æ€§</li><li>å®¹æ˜“æµ‹è¯•ï¼Œå°†ä¸šåŠ¡é€»è¾‘ä»Activity/Fragmentä¸­æŠ½å–å‡ºæ¥ã€‚å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå•å…ƒæµ‹è¯•</li></ul></li><li><h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul><li>ç”±äºå¯¹è§†å›¾çš„æ¸²æŸ“éƒ½æ”¾åœ¨Presenterä¸­ï¼Œè¿™ä¼šå¯¼è‡´è§†å›¾é¢‘ç¹çš„ä¸Presenterè¿›è¡Œäº¤äº’ï¼Œä¸€æ—¦è§†å›¾å‘ç°äº†é”™è¯¯ï¼Œéœ€è¦æ›´æ”¹ï¼Œé‚£ä¹ˆæ›´å®ƒè¿ç€çš„Presenterä¹Ÿéœ€è¦è¿›è¡Œæ›´æ”¹</li></ul></li><li><h3 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul><li>åœ¨æ•°æ®å•ä¸€ï¼Œé€»è¾‘ç®€å•çš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨MVPæ›´å¥½</li></ul></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Model </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç±»å‹ä»‹ç»</title>
      <link href="2021/04/26/%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D/"/>
      <url>2021/04/26/%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»ä¸€äº›å¸¸ç”¨ç±»å‹äºå®ƒçš„åŒ…è£…ç±»çš„åˆ›å»ºäºä½¿ç”¨</p><a id="more"></a><h1 id="ç±»å‹ä»‹ç»"><a href="#ç±»å‹ä»‹ç»" class="headerlink" title="ç±»å‹ä»‹ç»"></a>ç±»å‹ä»‹ç»</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä¸ºä¸»è¦è¯­è¨€</p></blockquote><blockquote><p>æœ¬ç¯‡å°†è®°å½•é‚£äº›åªçŸ¥é“ç”¨ä½†ä¸æ˜ç™½å…·ä½“çš„ç±»å‹</p></blockquote><h4 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h4><ul><li><p>LiveDataæ˜¯ä¸æ•°æ®å®ä½“ç±»(POJOç±»)æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬éƒ½æ˜¯è´Ÿè´£æ•°æ®å­˜å‚¨</p></li><li><p>LiveDataä¹Ÿæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„æ•°æ®å®ä½“ç±»ï¼Œå¯ä»¥ä¸æ³¨å†Œå®ƒçš„è§‚å¯Ÿè€…å›è°ƒæ•°æ®æ˜¯å¦æ›´æ–°</p></li><li><p>LiveDataè¿˜èƒ½ç»‘å®šActivity / Fragmentï¼Œåªåœ¨å®ƒä»¬ç”Ÿå‘½å‘¨æœŸå¤„äºæ´»è·ƒçŠ¶æ€æ—¶æ‰è§¦å‘å›è°ƒ</p></li><li><p>ä»£ç å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> _photoListLive = MutableLiveData&lt;String&gt;()</span><br><span class="line"><span class="keyword">val</span> photoListLive: LiveData&lt;String&gt;</span><br><span class="line">    <span class="keyword">get</span>() = _photoListLive</span><br></pre></td></tr></table></figure><p>LiveDataä¸€èˆ¬éƒ½æ˜¯ä¸MutableLiveDataä¸€åŒä½¿ç”¨</p></li><li><p>LiveDataåœ¨å®ä½“ç±»é‡Œå¯ä»¥é€šçŸ¥æŒ‡å®šæŸä¸ªå­—æ®µçš„æ•°æ®æ›´æ–°.ï¼ˆä¹Ÿå°±æ˜¯åªè¦å‘ç”Ÿæœ‰ç‚¹å˜åŒ–ï¼Œéƒ½ä¼šè¿›è¡Œå›è°ƒï¼‰</p></li></ul><h4 id="MutableLiveData"><a href="#MutableLiveData" class="headerlink" title="MutableLiveData"></a>MutableLiveData</h4><ul><li>MutableLiveDataçš„çˆ¶ç±»æ˜¯LiveData</li><li>MutableLiveDataåˆ™æ˜¯å®Œå…¨æ˜¯æ•´ä¸ªå®ä½“ç±»æˆ–è€…æ•°æ®ç±»å‹å˜åŒ–åæ‰é€šçŸ¥ï¼Œä¸ä¼šç»†èŠ‚åˆ°æŸä¸ªå­—æ®µ</li></ul><h4 id="Mutable-List"><a href="#Mutable-List" class="headerlink" title="Mutable List"></a>Mutable List</h4><ul><li><p>åœ¨Kotlinä¸­MutableListå±äºå¯å˜ç±»å‹</p></li><li><p>MutableListåœ¨æœ¬è´¨ä¸Šå°±æ˜¯å°†ä¸å¯å˜çš„Listå˜ä¸ºå¯å˜ï¼Œéšä¾¿å¢åŠ äº† æ’å…¥ã€åˆ é™¤ã€æ›¿æ¢ç­‰æ–¹æ³•</p></li><li><p>åˆ›å»ºMutableList</p><p>mutableListOf()</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç©ºçš„å¯å˜list</span></span><br><span class="line"><span class="keyword">val</span> numNull = mutableListOf&lt;<span class="built_in">Int</span>&gt;()</span><br></pre></td></tr></table></figure><p>mutableListOf(vararg elements: T)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºå¤šä¸ªå…ƒç´ çš„å¯å˜list</span></span><br><span class="line"><span class="keyword">val</span> numMutable = mutableListOf(<span class="string">&quot;Alfred&quot;</span>, <span class="number">29</span>, <span class="string">&quot;ç”·&quot;</span>, <span class="string">&quot;180cm&quot;</span>, <span class="string">&quot;70kg&quot;</span>)</span><br></pre></td></tr></table></figure></li><li><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰add(),addAll(),remove(ç§»é™¤æŒ‡å®šå…ƒç´ ),removeAt(ç§»é™¤æŒ‡å®šä½ç½®å…ƒç´ ),removeAll(elements: Collection<E>)(åˆ é™¤é›†åˆ),clear(æ¸…é™¤æ‰€æœ‰å…ƒç´ ),set(æ›¿æ¢æŒ‡å®šä½ç½®å…ƒç´ )</p></li></ul><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><ul><li><p>åœ¨Kotlinä¸­Listæ˜¯å±äºä¸å¯å˜ç±»å‹</p></li><li><p>åˆ›å»ºæ–¹æ³•</p><p>listOf()ç”¨äºåˆ›å»ºæ²¡æœ‰å…ƒç´ çš„ç©ºList</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç©ºList</span></span><br><span class="line"><span class="keyword">val</span> numbersNull = listOf&lt;<span class="built_in">Int</span>&gt;()</span><br></pre></td></tr></table></figure><p>listOf(element: T)åˆ›å»ºåªæœ‰ä¸€ä¸ªå…ƒç´ çš„List</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºåªæœ‰ä¸€ä¸ªå…ƒç´ çš„List</span></span><br><span class="line"><span class="keyword">val</span> numbersOne = listOf&lt;<span class="built_in">Int</span>&gt;(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>listOf(vararg elements: T)åˆ›å»ºæ‹¥æœ‰å¤šä¸ªå…ƒç´ çš„List</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºå¤šä¸ªå…ƒç´ çš„List</span></span><br><span class="line"><span class="keyword">val</span> numbersMuch = listOf&lt;<span class="built_in">Int</span>&gt;(<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>)</span><br></pre></td></tr></table></figure></li><li><p>å› ä¸ºListæ˜¯ä¸å¯å˜ç±»å‹ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½å¯¹Listè¿›è¡Œå¢åˆ æ”¹çš„æ“ä½œçš„</p></li><li><p>Listæ˜¯ç»§æ‰¿è‡³Collectionæ¥å£ï¼Œå®ƒä»¬å‡ ä¹ä¸Šåªå®ç°äº†isEmpty()ã€sizeå±æ€§ã€get()ã€contains()ç­‰æ–¹æ³•ã€‚</p></li></ul><h4 id="Array-List"><a href="#Array-List" class="headerlink" title="Array List"></a>Array List</h4><ul><li><p>ç®€å•æ¥è¯´å°±æ˜¯Listæ¥å£çš„å¯è°ƒæ•´å¤§å°çš„æ•°ç»„å®ç°ï¼Œå®ç°æ‰€æœ‰å¯é€‰åˆ—è¡¨æ“ä½œï¼Œå¹¶å…è®¸æ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬ null</p></li><li><p>ArrayListçš„æ–¹æ³•ä¸­æ²¡æœ‰é”ï¼Œæ‰€ä»¥ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</p></li><li><p>å…¶å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç´¢å¼•æ‰¾åˆ°å…·ä½“çš„å†…å®¹ï¼Œä¹Ÿæ˜¯æœ‰åºçš„</p></li><li><p>åˆ›å»ºæ–¹æ³•</p><p>ArrayListå¯ä»¥åˆ›å»ºListï¼Œä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list : List&lt;String&gt; = arrayListOf()</span><br></pre></td></tr></table></figure><p>Listæ˜¯ä¸å¯ä»¥ä½¿ç”¨Listæ¥åˆ›å»ºè‡ªå·±ï¼Œåªèƒ½ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥åˆ›å»ºã€‚å½“ä½¿ç”¨ArrayListæ¥åˆ›å»ºListæ—¶ï¼Œæ­¤æ—¶å®ƒæ˜¯ä¸€ä¸ªListå¯¹è±¡äº†ï¼Œæœ‰äº›ArrayListæœ‰ä½†æ˜¯Listæ²¡æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œå®ƒå°±ä¸èƒ½å†ç”¨äº†ã€‚ </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list : ArrayList&lt;String&gt; = arrayListOf()</span><br></pre></td></tr></table></figure><p>è€Œè¿™æ ·åˆ›å»ºä¸€å¯¹è±¡åˆ™ä¿ç•™äº†ArrayListçš„æ‰€æœ‰å±æ€§ã€‚ </p></li></ul><h4 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h4><ul><li>HashSetå®ç°äº†Collectionçš„setæ¥å£</li><li>HashSetæ˜¯ä¸å…è®¸é›†åˆä¸­æœ‰é‡å¤çš„å€¼ï¼Œå½“å‡†å¤‡ä½¿ç”¨HashSetæ—¶ï¼Œé¦–å…ˆè¦ç¡®ä¿å¯¹è±¡å·²ç»é‡å†™äº†<strong>equals</strong>()å’Œ<strong>hashCode</strong>()æ–¹æ³•ï¼Œè¿™æ ·æ‰èƒ½æ¯”è¾ƒå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰</li><li>add(o : Objecy)æ–¹æ³•ï¼Œç”¨æ¥å‘Setä¸­æ·»åŠ å…ƒç´ ï¼Œå½“å…ƒç´ é‡å¤æ—¶ä¼šè¿”å›falseï¼ŒæˆåŠŸåˆ™ä¼šè¿”å›True</li></ul><h4 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h4><ul><li>HashMapå®ç°äº†Collectionçš„Mapæ¥å£ï¼ŒMapæ¥å£å¯¹é”®å€¼å¯¹è¿›è¡Œæ˜ å°„ï¼ˆä¹Ÿå°±æ˜¯æ˜¯å­˜å‚¨é”®å€¼å¯¹ï¼‰</li><li>Mapä¸­ä¹Ÿæ˜¯ä¸å…è®¸å‡ºç°é‡å¤çš„å€¼</li><li>è™½ç„¶HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯Collectionæä¾›çš„æ–¹æ³•èƒ½ä¿è¯HashMap synchronizedï¼ˆä¹Ÿå°±æ˜¯å¤šä¸ªçº¿ç¨‹è®¿é—®æ—¶ï¼Œèƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹Mapï¼‰</li><li>put(Key : Object ,value : Object )ç”¨æ¥å°†å…ƒç´ æ·»åŠ åˆ°mapä¸­</li></ul><h4 id="ArrayMap"><a href="#ArrayMap" class="headerlink" title="ArrayMap"></a>ArrayMap</h4><ul><li><h4 id="ArraySet"><a href="#ArraySet" class="headerlink" title="ArraySet"></a>ArraySet</h4></li></ul><p>-</p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Class </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºHTTPçš„ä¸€äº›ä»‹ç»</title>
      <link href="2021/04/26/%E5%85%B3%E4%BA%8EHTTP%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BB%8B%E7%BB%8D/"/>
      <url>2021/04/26/%E5%85%B3%E4%BA%8EHTTP%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»å¹¶åˆ†æHttpè¯·æ±‚</p><a id="more"></a><h1 id="å…³äºHTTPçš„ä¸€äº›ä»‹ç»"><a href="#å…³äºHTTPçš„ä¸€äº›ä»‹ç»" class="headerlink" title="å…³äºHTTPçš„ä¸€äº›ä»‹ç»"></a>å…³äºHTTPçš„ä¸€äº›ä»‹ç»</h1><blockquote><p>ç†è®º</p></blockquote><h2 id="HTTPçš„ä»‹ç»"><a href="#HTTPçš„ä»‹ç»" class="headerlink" title="HTTPçš„ä»‹ç»"></a>HTTPçš„ä»‹ç»</h2><p>åœ¨Androidä¸­ï¼Œç»å¤§å¤šæ•°çš„åº”ç”¨ç½‘ç»œé€šä¿¡éƒ½æ˜¯åŸºäºHttpåè®®çš„ï¼ŒHttpåè®®å¤„äºåº”ç”¨å±‚ï¼Œåº”ç”¨å±‚åè®®å°±æ˜¯ä¸ºäº†æ¥è§„èŒƒä¼ è¾“æ ¼å¼</p><h2 id="HTTPå·¥ä½œæµç¨‹"><a href="#HTTPå·¥ä½œæµç¨‹" class="headerlink" title="HTTPå·¥ä½œæµç¨‹"></a>HTTPå·¥ä½œæµç¨‹</h2><ol><li><p>å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨</p><p>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªTCPè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œç»è¿‡3æ¬¡æ¡æ‰‹ä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥</p></li><li><p>å‘é€æ•°æ®</p><p>æŒ‰ç…§Httpåè®®è§„å®šçš„æ ¼å¼æ¥ç»„è£…æ•°æ®ï¼Œé€šè¿‡TCPè¿æ¥å‘æœåŠ¡å™¨å‘é€æŠ¥æ–‡</p></li><li><p>æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚æŠ¥æ–‡å¹¶å¤„ç†</p><p>æœåŠ¡å™¨åŒè¿‡TCPè¿æ¥æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æŠ¥æ–‡ï¼ŒæŒ‰ç…§è§„å®šæ ¼å¼è§£è¯»æŠ¥æ–‡ï¼Œæ ¹æ®è§£è¯»æ¥ç”Ÿäº§å¯¹åº”çš„å“åº”æŠ¥æ–‡</p></li><li><p>æœåŠ¡å™¨å°†ç”Ÿæˆçš„å“åº”æŠ¥æ–‡å‘é€ç»™å®¢æˆ·ç«¯</p><p>æœåŠ¡å™¨é€šè¿‡TCPè¿æ¥å°†å“åº”æŠ¥æ–‡å‘é€ç»™å®¢æˆ·ç«¯</p></li><li><p>å…³é—­TCPè¿æ¥</p><p>åœ¨æœåŠ¡å™¨å°†æŠ¥æ–‡å‘ç»™å®¢æˆ·ç«¯ä¹‹åï¼Œä¼šå°†connectionæ¨¡å¼è®¾ç½®ä¸ºcloseï¼Œåˆ™æ˜¯æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå®¢æˆ·ç«¯è¢«åŠ¨å…³é—­ã€‚å¦‚æœconnectionæ¨¡å¼è®¾ç½®ä¸ºkeepaliveï¼Œåˆ™TCPè¿æ¥ä¸ä¼šé©¬ä¸Šå…³é—­ï¼Œè¿˜å¯ä»¥ç»§ç»­å‘é€è¯·æ±‚</p></li><li><p>å®¢æˆ·ç«¯å¤„ç†å“åº”æŠ¥æ–‡</p><p>æŒ‰ç…§è§„åˆ™è¿›è¡Œè§£æ</p></li></ol><h2 id="HTTPæŠ¥æ–‡æ ¼å¼"><a href="#HTTPæŠ¥æ–‡æ ¼å¼" class="headerlink" title="HTTPæŠ¥æ–‡æ ¼å¼"></a>HTTPæŠ¥æ–‡æ ¼å¼</h2><h4 id="è¯·æ±‚æŠ¥æ–‡-è¯·æ±‚æ•°æ®"><a href="#è¯·æ±‚æŠ¥æ–‡-è¯·æ±‚æ•°æ®" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡(è¯·æ±‚æ•°æ®)"></a>è¯·æ±‚æŠ¥æ–‡(è¯·æ±‚æ•°æ®)</h4><ul><li><p>è¯·æ±‚æŠ¥æ–‡ç”±<strong>è¯·æ±‚è¡Œ</strong>ã€<strong>è¯·æ±‚å¤´éƒ¨</strong>ã€<strong>ç©ºè¡Œ</strong>ã€<strong>è¯·æ±‚æ•°æ®</strong>å››éƒ¨åˆ†ç»„æˆ</p></li><li><p>è¯·æ±‚æ•°æ®(è¿™é‡Œä»¥ç™¾åº¦æœç´¢â€™<em>ç™½è‰²</em>â€˜è¿›è¡Œç¤ºèŒƒ)</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20210426095329.png"></p><blockquote><p><strong>Request URL</strong> ï¼šè¯·æ±‚åœ°å€</p><p><strong>Request Method</strong>ï¼šè¯·æ±‚æ¨¡å¼</p><p><strong>Status Code</strong>ï¼šè¯·æ±‚çŠ¶æ€ç </p><p><strong>Remote Address</strong>ï¼šè¿œç¨‹ä¸»æœºIPåœ°å€</p></blockquote><p>è¯·æ±‚æ ¼å¼å¦‚ä¸‹å›¾</p><p><img src="https://easyreadfs.nosdn.127.net/image_edc89a772041476cb6f7d0c8e65819e9"></p></li><li><p>è¯·æ±‚å‚æ•°</p><p>è¯·æ±‚å‚æ•°ä¸åœ¨GETä¸­ä½¿ç”¨ï¼Œè€Œæ˜¯åœ¨POSTä¸­ä½¿ç”¨ï¼Œå®ƒè¡¨ç¤ºå‘æœåŠ¡å™¨ä¼ é€’é™„åŠ çš„å‚æ•°ï¼Œæ ¼å¼å¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;seeType&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;source&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;userId&quot;</span>:<span class="string">&quot;30&quot;</span>&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="è¯·æ±‚è¡Œ"><a href="#è¯·æ±‚è¡Œ" class="headerlink" title="è¯·æ±‚è¡Œ"></a>è¯·æ±‚è¡Œ</h4><ul><li><p>è¯·æ±‚è¡Œæ˜¯ç”±*<strong>è¯·æ±‚æ–¹å¼**<em>ã€</em></strong>URLåœ°å€*<strong>ã€**<em>åè®®å+ç‰ˆæœ¬å·</em></strong>ç»„æˆ</p><blockquote><p>POST(è¯·æ±‚æ–¹å¼) /lotto/android/v1.0/order-group/queryOrderGroupPersonInfo(URLåœ°å€) HTTP/1.1(åè®®ç‰ˆæœ¬)</p></blockquote></li><li><h5 id="è¯·æ±‚æ–¹å¼"><a href="#è¯·æ±‚æ–¹å¼" class="headerlink" title="è¯·æ±‚æ–¹å¼"></a>è¯·æ±‚æ–¹å¼</h5><p>HTTPè¯·æ±‚çš„æ–¹å¼æ€»å…±æœ‰8ç§ï¼Œåˆ†åˆ«æ˜¯GETã€POSTã€HEADã€PUTã€DELETEã€TRANCEã€CONNECTONã€OPTIONSã€‚ä¸‹é¢ä»‹ç»å¸¸ç”¨çš„2ç§</p><ul><li><p><strong>GET</strong></p><p>è·å–Request URLä¸‹æ‰€ä»¥èµ„æº(ä¹Ÿå°±æ˜¯ä¸å¸¦å‚æ•°)</p></li><li><p><strong>POST</strong></p><p>åœ¨Request URLæ‰€è¡¨ç¤ºçš„èµ„æºåé™„åŠ å‚æ•°ï¼Œä»¥ä¾¿äºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®(ä¹Ÿå°±æ˜¯å¯ä»¥ä¼ é€’å‚æ•°æ¥è·å–æŒ‡å®šçš„èµ„æº)</p></li></ul></li><li><h5 id="URLåœ°å€"><a href="#URLåœ°å€" class="headerlink" title="URLåœ°å€"></a>URLåœ°å€</h5><p>ä¸ºè¯·æ±‚å¯¹åº”çš„URLåœ°å€ï¼Œå®ƒå’ŒæŠ¥æ–‡å¤´ä¸­çš„Hostå±æ€§ç»„æˆå®Œæ•´çš„è¯·æ±‚URLåœ°å€</p></li><li><h5 id="ä½¿ç”¨åè®®åç§°-ç‰ˆæœ¬å·"><a href="#ä½¿ç”¨åè®®åç§°-ç‰ˆæœ¬å·" class="headerlink" title="ä½¿ç”¨åè®®åç§°+ç‰ˆæœ¬å·"></a>ä½¿ç”¨åè®®åç§°+ç‰ˆæœ¬å·</h5><p>ä¹Ÿå°±æ˜¯å­—é¢æ„æ€ï¼Œä½¿ç”¨çš„åè®®å’Œå®ƒå½“å‰çš„ç‰ˆæœ¬</p></li></ul><h4 id="è¯·æ±‚å¤´éƒ¨"><a href="#è¯·æ±‚å¤´éƒ¨" class="headerlink" title="è¯·æ±‚å¤´éƒ¨"></a>è¯·æ±‚å¤´éƒ¨</h4><p>åœ¨è¯·æ±‚è¡Œä¹‹åä¼šæœ‰0æˆ–å¤šä¸ªè¯·æ±‚å¤´éƒ¨</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20210426103319.png"></p><blockquote><p><strong>accept-ranges</strong>ï¼šè¡¨æ˜å…¶æ”¯æŒéƒ¨åˆ†çš„è¯·æ±‚çš„æ ‡å¿—ç‰©ï¼Œæ­¤å­—æ®µè¡¨ç¤ºå¯ç”¨äºå®šä¹‰èŒƒå›´çš„å•ä½</p><p><strong>age</strong>ï¼šageçš„å€¼ä¸€èˆ¬æ˜¯è¿‘äº0çš„ï¼Œåƒæ˜¯è¿™æ ·Age:0ï¼Œè¿™æ ·åªèƒ½åœ¨åŸæœåŠ¡å™¨è·å–ï¼Œå¦åˆ™å®ƒé€šå¸¸æ˜¯æ ¹æ®ä»£ç†çš„å½“å‰æ—¥æœŸå’Œ**<em>Date**</em>HTTPå“åº”ä¸­åŒ…å«çš„é€šç”¨å¤´éƒ¨ä¹‹é—´çš„å·®å¼‚æ¥è®¡ç®—çš„ã€‚</p></blockquote><h4 id="ç©ºè¡Œ"><a href="#ç©ºè¡Œ" class="headerlink" title="ç©ºè¡Œ"></a>ç©ºè¡Œ</h4>]]></content>
      
      
      
        <tags>
            
            <tag> Http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººç®€å†</title>
      <link href="2021/04/15/%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86/"/>
      <url>2021/04/15/%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»˜é‘«åš"><a href="#ä»˜é‘«åš" class="headerlink" title="ä»˜é‘«åš"></a>ä»˜é‘«åš</h2><p>ç”µè¯: 18126157220 ä¸¨é‚®ç®±: <a href="mailto:&#x61;&#x36;&#49;&#x39;&#x31;&#57;&#x39;&#48;&#57;&#49;&#64;&#103;&#x6d;&#x61;&#105;&#108;&#46;&#x63;&#111;&#x6d;">&#x61;&#x36;&#49;&#x39;&#x31;&#57;&#x39;&#48;&#57;&#49;&#64;&#103;&#x6d;&#x61;&#105;&#108;&#46;&#x63;&#111;&#x6d;</a> ä¸¨ç°å±…åŸå¸‚: æ·±åœ³ </p><p>ä¸ªäººç½‘ç«™: <a href="https://brokes6.github.io/">https://brokes6.github.io/</a></p><p>æ±‚èŒæ„å‘: Androidå·¥ç¨‹å¸ˆ</p><h3 id="ä¸“ä¸šæŠ€èƒ½"><a href="#ä¸“ä¸šæŠ€èƒ½" class="headerlink" title="ä¸“ä¸šæŠ€èƒ½"></a>ä¸“ä¸šæŠ€èƒ½</h3><hr><p>Androidå¼€å‘ï¼šJavaï¼ˆç†Ÿç»ƒï¼‰ï¼ŒKotlinï¼ˆç†Ÿç»ƒï¼‰ </p><p>å…¶ä»–ï¼šHTML+CSSï¼ŒVueï¼ŒSQL</p><p>è½¯ä»¶ï¼šofficeåŠå…¬è½¯ä»¶ï¼ŒAxure RPï¼ŒPS</p><h3 id="åœ¨æ ¡ç»å†"><a href="#åœ¨æ ¡ç»å†" class="headerlink" title="åœ¨æ ¡ç»å†"></a>åœ¨æ ¡ç»å†</h3><hr><blockquote><p>2017å¹´09æœˆ - è‡³ä»Š (æœªæ¯•ä¸š)</p></blockquote><p><strong>æ·±åœ³é¹åŸæŠ€å¸ˆå­¦æ ¡</strong>   -  ç§»åŠ¨äº’è”ç½‘ - æ–‡å•†å­¦é™¢</p><ol><li>å­¦é™¢å†…ç§»åŠ¨Appæ¯”èµ› ç¬¬äºŒå ï¼ˆé¡¹ç›®åœ°å€: <a href="https://github.com/brokes6/Campus-Forum">https://github.com/brokes6/Campus-Forum</a> ï¼‰</li><li>ä¸ºä¼ä¸šï¼ˆåèè¯åˆ¸ï¼‰åšè¿‡ é˜…è¯»ç±»å®šåˆ¶è½¯ä»¶ï¼ˆé¡¹ç›®åœ°å€: <a href="https://github.com/brokes6/Reading">https://github.com/brokes6/Reading</a> ï¼‰</li><li>å­¦é™¢å†…å¼€å‘æ¯”èµ› ç¬¬ä¸€å</li><li>å­¦é™¢å†…ç§»åŠ¨Appæ¯”èµ› ç¬¬ä¸€å ï¼ˆé¡¹ç›®åœ°å€: <a href="https://github.com/brokes6/D-BiliBili">https://github.com/brokes6/D-BiliBili</a> ï¼‰</li></ol><h3 id="é¡¹ç›®ç»å†"><a href="#é¡¹ç›®ç»å†" class="headerlink" title="é¡¹ç›®ç»å†"></a>é¡¹ç›®ç»å†</h3><hr><blockquote><p>2020å¹´04æœˆ - 2020å¹´06æœˆ</p></blockquote><p><strong>äº‘éŸ³ä¹</strong>(<a href="https://github.com/brokes6/MusicPlayer">brokes6/MusicPlayer: MusicPlayerDomeéŸ³ä¹è½¯ä»¶ï¼ˆå·²ä½¿ç”¨ç½‘æ˜“äº‘éŸ³ä¹APIï¼‰ (github.com)</a>)</p><ul><li>æ•´ä¸ªé¡¹ç›®åˆ†ä¸ºäº†å‰å°æ˜¾ç¤ºå’Œåå°æœåŠ¡ï¼Œä½¿æ•ˆç‡æ›´é«˜ã€‚å‰å°æ˜¾ç¤ºç”¨äºæ˜¾ç¤ºå„ç§UIï¼Œåå°æœåŠ¡ç”¨äºç®¡ç†ã€æ§åˆ¶éŸ³ä¹</li><li>ä½¿ç”¨äº†è‡ªå®šä¹‰Viewæ¥å®ç°æ’­æ”¾ç•Œé¢ä¸­çš„ç²’å­æ•ˆæœï¼Œå¯éšèƒŒæ™¯é¢œè‰²æ¥åŠ¨æ€æ”¹å˜</li></ul><blockquote><p>2020å¹´10æœˆ - 2020å¹´12æœˆ</p></blockquote><p><strong>DaliDali</strong> Bç«™(<a href="https://github.com/brokes6/D-BiliBili">brokes6/D-BiliBili: â¤ ä»¿Bç«™Androidè½¯ä»¶,æ•°æ®æ¥æºäºç½‘ç»œçˆ¬è™« (github.com)</a>)</p><ul><li>é‡‡ç”¨äº†MVVMè®¾è®¡æ¨¡å¼ï¼Œä½è€¦åˆã€å¯é‡ç”¨æ€§</li><li>è§†é¢‘æ’­æ”¾é‡‡ç”¨äº†GSYVideoPlayer+DanmakuFlameMasterï¼ˆå¼¹å¹•åº“ï¼‰</li><li>ç½‘ç»œè¯·æ±‚é‡‡ç”¨äº†RxJava+Retrofit2ï¼Œä¿å­˜æ•°æ®é‡‡ç”¨äº†Room+LiveDate</li><li>å¤§éƒ¨åˆ†Viewéƒ½é‡‡å–äº†åˆ†å—åŠ è½½ï¼Œæå‡æ•ˆç‡</li></ul><blockquote><p>2021å¹´4æœˆ1 - è‡³ä»Š</p></blockquote><p><strong>AnyRandom</strong>(<a href="https://github.com/brokes6/AnyRandom">brokes6/AnyRandom: éšæœºé€‰æ‹©ï¼Œå®Œå…¨æœ¬åœ°ï¼ˆé™¤äº†åŠ è½½å›¾ç‰‡ä»¥å¤–ï¼‰ï¼ŒUIç²¾ç¾ğŸ‘ (github.com)</a>)</p><ul><li>ä½¿ç”¨äº†Kotlin+ViewModel+Roomåˆ¶ä½œçš„æœ¬åœ°éšæœºé€‰æ‹©è½¯ä»¶</li><li>ä½¿ç”¨äº†JetPackçš„åº“æ¥è¿›è¡Œå¼€å‘</li></ul><h3 id="ä¸ªäººæ€»ç»“"><a href="#ä¸ªäººæ€»ç»“" class="headerlink" title="ä¸ªäººæ€»ç»“"></a>ä¸ªäººæ€»ç»“</h3><hr><p>åœ¨æ ¡ä¸ªäººç»éªŒä¸°å¯Œï¼Œä¸ªäººåšè¿‡å‡ ä¸ªçƒ­é—¨ç±»å‹çš„é¡¹ç›®ï¼ˆé«˜ä»¿çš„Bç«™ï¼Œç½‘æ˜“äº‘éŸ³ä¹ç­‰ï¼‰ï¼Œç†Ÿæ‚‰ä½¿ç”¨JetPackä¸­çš„åº“ã€‚æœ‰è¿‡ç»™ä¸Šå¸‚å…¬å¸åš å®šåˆ¶è½¯ä»¶çš„é¡¹ç›®ç»éªŒ</p><p><em>æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æˆ‘çš„ç®€å†ï¼ŒæœŸå¾…èƒ½æœ‰æœºä¼šå’Œæ‚¨å…±äº‹ã€‚</em></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®€å† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kotlinä¸­ä½¿ç”¨ViewModelçš„æ•°æ®å…±äº«</title>
      <link href="2021/04/15/Kotlin%E4%B8%AD%E4%BD%BF%E7%94%A8ViewModel%E7%9A%84%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB/"/>
      <url>2021/04/15/Kotlin%E4%B8%AD%E4%BD%BF%E7%94%A8ViewModel%E7%9A%84%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†è®²è¿°å¯¹äºä½¿ç”¨ViewModelæ¥è¿›è¡ŒFragmentä¹‹é—´çš„æ•°æ®å…±äº«ï¼Œä½¿ç”¨çš„æŠ€æœ¯ä¸ºViewModelï¼ŒdataBinding</p><a id="more"></a><h1 id="Kotlinä¸­ä½¿ç”¨ViewModelçš„æ•°æ®å…±äº«"><a href="#Kotlinä¸­ä½¿ç”¨ViewModelçš„æ•°æ®å…±äº«" class="headerlink" title="Kotlinä¸­ä½¿ç”¨ViewModelçš„æ•°æ®å…±äº«"></a>Kotlinä¸­ä½¿ç”¨ViewModelçš„æ•°æ®å…±äº«</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä¸ºä¸»è¦è¯­è¨€</p></blockquote><p>æœ¬ç¯‡å°†è®²è¿°å¯¹äºä½¿ç”¨ViewModelæ¥è¿›è¡ŒFragmentä¹‹é—´çš„æ•°æ®å…±äº«ï¼Œä½¿ç”¨çš„æŠ€æœ¯ä¸ºViewModelï¼ŒdataBinding</p><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><p>å¯¹äºViewModelæ˜¯å±äºAndroidxåŒ…ä¸‹çš„JetPackç»„ä»¶ï¼Œæ‰€ä»¥åªéœ€è¦é¡¹ç›®ä½¿ç”¨äº†Androidxï¼Œå°±å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¼•å…¥é¢å¤–ä¾èµ–åŒ…</p><h3 id="ä»£ç æ•™ç¨‹"><a href="#ä»£ç æ•™ç¨‹" class="headerlink" title="ä»£ç æ•™ç¨‹"></a>ä»£ç æ•™ç¨‹</h3><p>åœ¨è¿›è¡Œç¼–ç ä¹‹å‰æƒ³è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œç»™é¡¹ç›®å¼€å¯dataBindingï¼Œåœ¨é¡¹ç›®çº§çš„build.gradleä¸­ï¼ŒdefaultConfigé—­åŒ…ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig&#123;</span><br><span class="line">    ...</span><br><span class="line">    dataBinding.enabled = <span class="keyword">true</span> </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¼€å¯äº†dataBindingäº†</p><ol><li><p>åˆ›å»ºViewModel</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span> : <span class="type">ViewModel</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> number: MutableLiveData&lt;<span class="built_in">Int</span>&gt; = MutableLiveData(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">()</span></span>: MutableLiveData&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> number</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">add</span><span class="params">(value: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        number.value = number.value?.plus(value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">set</span><span class="params">(value: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        number.value = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç»§æ‰¿ViewModelçš„ç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­åˆ›å»ºä¸€ä¸ªMutableLiveDataçš„å˜é‡ï¼Œå¹¶ç»™ä»–è®¾ç½®è·å–å’Œè®¾ç½®å€¼çš„æ–¹æ³•</p></li><li><p>åœ¨Activityä¸­è·å–ViewModel</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> viewModel: MyViewModel</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        viewModel = ViewModelProvider(<span class="keyword">this</span>).<span class="keyword">get</span>(MyViewModel::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–ViewModelæ˜¯é€šè¿‡<strong>ViewModelProvider</strong>(this).get(åˆšåˆšåˆ›å»ºçš„ViewModel::class.java)</p><blockquote><p>è¿™é‡ŒåŸæœ¬å¯ä»¥ä½¿ç”¨<strong>ViewModelProviders</strong>.of(Activity).get(åˆšåˆšåˆ›å»ºçš„ViewModel::class.java)ï¼Œä½†æ˜¯ViewModelProviderså·²ç»è¢«æ·˜æ±°äº†</p></blockquote></li><li><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»º2ä¸ªFragmentï¼Œå¹¶åœ¨Fragmentä¸­è·å–Activityçš„ViewModel</p><ol><li><p>BlankFragment</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20210104194138.png" alt="image-20210104194137046"></p></li></ol><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlankFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå˜é‡ï¼Œå°†å®ƒçš„å€¼è®¾ç½®ä¸ºActivityViewModelï¼Œæ‹¬å·é‡Œé¢åªéœ€è¦è¾“å…¥ViewModelç±»å‹å³å¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModel <span class="keyword">by</span> activityViewModels&lt;MyViewModel&gt;()</span><br><span class="line">    <span class="comment">//è¿™ä¸ªæŠ€å°±æ˜¯å½“å‰é¡¹ç›®çš„dataBindingï¼ˆlateinit ä»£è¡¨ç­‰ä¸‹è¿›è¡Œåˆå§‹åŒ–ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: FragmentBlankBinding</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>, container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View &#123;</span><br><span class="line">        <span class="comment">//åœ¨è¿™é‡Œè¿›è¡ŒdataBindingçš„åˆå§‹åŒ–</span></span><br><span class="line">        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_blank, container, <span class="literal">false</span>)</span><br><span class="line">        initView()</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">//å°†è·å–å®Œçš„ViewModelä¼ ç»™dataBindingï¼ˆæ˜¯å› ä¸ºxmlæ–‡ä»¶è®¾ç½®äº†å±æ€§ï¼‰</span></span><br><span class="line">        binding.<span class="keyword">data</span> = viewModel</span><br><span class="line">        <span class="comment">//è®¾ç½®ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸ºçˆ¶ç±»Activity</span></span><br><span class="line">        binding.lifecycleOwner = activity</span><br><span class="line">        <span class="comment">//ç‚¹å‡»æŒ‰é’®è¿›è¡Œåˆ‡æ¢Fragmentï¼Œæ˜¯é€šè¿‡Navigationè¿›è¡Œåˆ‡æ¢</span></span><br><span class="line">        binding.button.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> controller: NavController = Navigation.findNavController(it)</span><br><span class="line">            controller.navigate(R.id.action_blankFragment_to_detailFragment)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä¸‹é¢çš„ï¼Ÿ.let&#123;&#125;ä»£è¡¨å½“å‰å¯¹è±¡ä¸ä¸ºç©ºçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ&#123;&#125;å†…çš„å†…å®¹</span></span><br><span class="line">        viewModel.number.value?.let &#123; binding.seekBar.progress = it &#125;</span><br><span class="line">        binding.seekBar.setOnSeekBarChangeListener(<span class="keyword">object</span> : SeekBar.OnSeekBarChangeListener &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onProgressChanged</span><span class="params">(p0: <span class="type">SeekBar</span>?, p1: <span class="type">Int</span>, p2: <span class="type">Boolean</span>)</span></span> &#123;<span class="comment">//å¦‚æœæ’ä»¶çš„å€¼å˜äº†</span></span><br><span class="line">                viewModel.number.value = p1</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartTrackingTouch</span><span class="params">(p0: <span class="type">SeekBar</span>?)</span></span> &#123;<span class="comment">//åˆšå¼€å§‹è§¦æ‘¸çš„æ—¶å€™</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStopTrackingTouch</span><span class="params">(p0: <span class="type">SeekBar</span>?)</span></span> &#123;<span class="comment">//ç»“æŸè§¦æ‘¸</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹    xmlï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;data&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;com.laboratory.navviewmodel.MyViewModel&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/frameLayout&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/Title&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@&#123;String.valueOf(data.get())&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;30sp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.498&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.222&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">SeekBar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/seekBar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_margin</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.347&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/button&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;#858A8A&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;è¿›å…¥&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ConstraintLayoutæ˜¯ä¸ºäº†æ–¹ä¾¿è¿›è¡Œåœ¨Designæ¨¡å¼ä¸‹è¿›è¡Œæ‘†æ”¾æ§ä»¶ï¼Œä¸Šé¢è¯´çš„æ‰€éœ€çš„å†…å®¹æ˜¯variableä¸­å®šä¹‰çš„ï¼Œæ§ä»¶ä¸­å°±å¯ä»¥ä½¿ç”¨**@{å®šä¹‰çš„åç§°.è°ƒç”¨æ–¹æ³•}**</p><ol start="2"><li><p>DetailFragment</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20210104194213.png" alt="image-20210104194213106"></p></li></ol><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding : FragmentDetailBinding</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModel <span class="keyword">by</span> activityViewModels&lt;MyViewModel&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>, container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View &#123;</span><br><span class="line">        binding = DataBindingUtil.inflate(inflater,R.layout.fragment_detail,container,<span class="literal">false</span>)</span><br><span class="line">        initView()</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        binding.<span class="keyword">data</span> = viewModel</span><br><span class="line">        binding.lifecycleOwner = activity</span><br><span class="line">        binding.button.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> controller : NavController = Navigation.findNavController(it)</span><br><span class="line">            controller.navigate(R.id.action_detailFragment_to_blankFragment)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢çš„FragmentåŠŸèƒ½å·®ä¸å¤šï¼Œå¤šäº†ä¸¤ä¸ªæŒ‰é’®ï¼Œè¿›è¡Œ<strong>å¢åŠ </strong>å’Œ<strong>åˆ é™¤</strong></p><p>xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;data&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;com.laboratory.navviewmodel.MyViewModel&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:context</span>=<span class="string">&quot;.DetailFragment&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/textView&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@&#123;String.valueOf(data.number)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;30sp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.498&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.192&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/add&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;+&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;()-&gt;data.add(1)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;30sp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;@+id/reduce&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.5&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">&quot;@+id/reduce&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;@+id/reduce&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.0&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/reduce&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;-&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;()-&gt;data.add(-1)&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">&quot;30sp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">&quot;@+id/add&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.5&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.391&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/button&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;è¿”å›&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">&quot;0.498&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintVertical_bias</span>=<span class="string">&quot;0.535&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨äº†dataBindingä¸­ï¼Œè¿ç‚¹å‡»äº‹ä»¶éƒ½å¯ä»¥åœ¨xmlä¸­è®¾ç½®,åªéœ€è¦æƒ³ <strong>onClick=â€@{()-&gt;å¯¹è±¡.æ–¹æ³•}â€</strong> è¿™æ ·å»ä½¿ç”¨</p></li></ol><p>è¿™æ ·å…¨å±€éƒ½æ˜¯ä½¿ç”¨ç»Ÿä¸€çš„ViewModelæ¥è·å–æ•°æ®ï¼Œä¹Ÿå°±å¯ä»¥è¿›è¡Œæ•°æ®å…±äº«</p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Kotlin </tag>
            
            <tag> ViewModel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fragmentæ‡’åŠ è½½</title>
      <link href="2021/04/15/Fragment%E6%87%92%E5%8A%A0%E8%BD%BD/"/>
      <url>2021/04/15/Fragment%E6%87%92%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†è®²è¿°Fragmentæ‡’åŠ è½½çš„ä½¿ç”¨</p><a id="more"></a><h1 id="Fragmentæ‡’åŠ è½½"><a href="#Fragmentæ‡’åŠ è½½" class="headerlink" title="Fragmentæ‡’åŠ è½½"></a>Fragmentæ‡’åŠ è½½</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä¸ºä¸»è¦è¯­è¨€</p></blockquote><p><strong>ä»‹ç»</strong>ï¼šæ‡’åŠ è½½å°±é¡¾åæ€ä¹‰ï¼Œä¹Ÿå°±æ˜¯å½“å‰Fragmentå¤„äºå¯è§çš„çŠ¶æ€æ—¶ï¼Œæ‰ä¼šå»è¿›è¡ŒåŠ è½½ï¼Œè¿™ç§æƒ…å†µå¾ˆé€‚åˆFragmentåµŒå¥—Fragmentï¼Œä¸‹é¢ä»‹ç»åŸå› </p><ul><li>ActivityåµŒå¥—Fragmentï¼š</li></ul><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201228152428.png" alt="image-20201228152427313"></p><blockquote><p>è¿™æ ·å½“Activityè¿›è¡Œåˆ›å»ºå®ŒFragmentæ—¶ï¼Œè¿™3ä¸ªFragmentéƒ½ä¼šè¿è¡Œï¼Œæ‰§è¡Œä»–ä»¬çš„ç”Ÿå‘½å‘¨æœŸã€‚</p></blockquote><ul><li>ActivityåµŒå¥—FragmentåµŒå¥—Fragmentï¼š</li></ul><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201228152444.png" alt="image-20201228152443555"></p><blockquote><p>è¿™ç§æƒ…å†µä¸‹ï¼Œä½†Fragment_1è¿›è¡Œæ·»åŠ å¹¶åˆ›å»ºFragment_a,Fragment_b,Fragment_cæ—¶ï¼ŒFragment_bä¸­åˆä¼šç»§ç»­åˆ›å»ºFragment_dï¼ŒFragment_eï¼ŒFragment_fï¼Œæ‰€ä»¥è¿™æ ·ä¼šåœ¨å¾ˆå¤šä¸å¯è§çš„Fragmentä¸­æµªè´¹å†…å­˜å’Œç½‘ç»œã€‚</p></blockquote><blockquote><p>å› æ­¤æˆ‘ä»¬æƒ³è¦è¿›è¡ŒFragmentæ‡’åŠ è½½ï¼Œåªè®©å¤„äºæ˜¾ç¤ºçŠ¶æ€çš„Fragmentè¿›è¡ŒåŠ è½½ã€‚</p></blockquote><ul><li>ActivityåµŒå¥—ViewPageråµŒå¥—Fragment</li></ul><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201228153210.png" alt="image-20201228153209898"></p><blockquote><p>è§‚å¯Ÿä¸Šå›¾ï¼Œæˆ‘ä»¬èƒ½å‘ç° ViePager åˆå§‹åŒ–æ—¶ï¼Œé»˜è®¤ä¼šè°ƒç”¨å…¶å†…éƒ¨ Fragment çš„ setUserVisibleHint æ–¹æ³•ï¼Œå› ä¸ºå…¶é¢„ç¼“å­˜ Fragment ä¸ªæ•°ä¸º <code>1</code> çš„åŸå› ï¼Œæ‰€ä»¥åªæœ‰ Fragment_1 ä¸ Fragment_2 çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°è¢«è°ƒç”¨ã€‚</p></blockquote><h3 id="ViewPager-Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½"><a href="#ViewPager-Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½" class="headerlink" title="ViewPager+Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½"></a>ViewPager+Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½</h3><blockquote><p>åœ¨Andoirdxä¸­ï¼Œä¹‹å‰çš„setUserVisibleHint å·²ç»æ— æ³•ä½¿ç”¨ï¼Œç°åœ¨åªéœ€è¦ç»™é€‚é…å™¨ä¼ é€’BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENTå³å¯ï¼Œè¿™æ ·ï¼ŒFragmentåœ¨é‡å¤åˆ›å»ºæ—¶ï¼Œåˆ™ä¼šè°ƒç”¨onResumeæ–¹æ³•</p></blockquote><ol><li><p>åˆ›å»ºViewPagerçš„é€‚é…å™¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewPagerAdapter</span></span>(</span><br><span class="line">    fm: FragmentManager,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> titles: MutableList&lt;String&gt;,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> fragments: MutableList&lt;Fragment&gt;</span><br><span class="line">) : FragmentPagerAdapter(fm, BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        fragments.size</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItem</span><span class="params">(position: <span class="type">Int</span>)</span></span>: Fragment &#123;</span><br><span class="line">        <span class="keyword">return</span> fragments[position]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getPageTitle</span><span class="params">(position: <span class="type">Int</span>)</span></span>: CharSequence? &#123;</span><br><span class="line">        <span class="keyword">return</span> titles[position]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ å…¥3ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯Fragmentç®¡ç†å™¨ï¼ŒFragmenté›†åˆï¼ŒFragmentæ ‡é¢˜ï¼Œç„¶åå°†behaviorå€¼è®¾ç½®ä¸ºâ€BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENTâ€</p><blockquote><p>ä½¿ç”¨äº† <code>BEHAVIOR_RESUME_ONLY_CURRENT_FRAGMENT</code> åï¼Œåªæœ‰å½“å‰å¯è§çš„ Fragment æ‰èƒ½è°ƒç”¨ onResume æ–¹æ³•ã€‚</p></blockquote></li><li><p>ä¹‹åè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç»§æ‰¿Fragmentçš„ç±»æ¥è¿›è¡Œæ‡’åŠ è½½</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ‰§è¡Œæ‡’åŠ è½½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isLoaded = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mView: View? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        <span class="keyword">if</span> (mView == <span class="literal">null</span>) &#123;</span><br><span class="line">            mView = initView(inflater, container, savedInstanceState)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">initData</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setUserVisibleHint</span><span class="params">(isVisibleToUser: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.setUserVisibleHint(isVisibleToUser)</span><br><span class="line">        <span class="keyword">this</span>.isVisibleUser = isVisibleToUser</span><br><span class="line">        lazyLoad()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume()</span><br><span class="line">        <span class="comment">//å¢åŠ äº†Fragmentæ˜¯å¦å¯è§çš„åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (!isLoaded &amp;&amp; !isHidden) &#123;</span><br><span class="line">            initData()</span><br><span class="line">            isLoaded = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨Fragmenté”€æ¯Viewçš„æ—¶å€™ï¼Œé‡ç½®çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">        isLoaded = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåªæœ‰å¤„äºå¯è§çŠ¶æ€ä¸‹çš„Fragmentæ‰èƒ½è§¦å‘onResumeæ–¹æ³•ï¼Œæ‰å¯ä»¥è¿›è¡ŒåŠ è½½æ•°æ®</p></li></ol><h3 id="ViewPager2-Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½"><a href="#ViewPager2-Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½" class="headerlink" title="ViewPager2+Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½"></a>ViewPager2+Fragmentæ¨¡å¼ä¸‹çš„æ‡’åŠ è½½</h3>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> View </tag>
            
            <tag> Fragment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºGlideå„ç§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆé›†åˆï¼ˆä¸æ–­æ›´æ–°ï¼‰</title>
      <link href="2021/04/15/%E5%85%B3%E4%BA%8EGlide%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E9%9B%86%E5%90%88%EF%BC%88%E4%B8%8D%E6%96%AD%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
      <url>2021/04/15/%E5%85%B3%E4%BA%8EGlide%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E9%9B%86%E5%90%88%EF%BC%88%E4%B8%8D%E6%96%AD%E6%9B%B4%E6%96%B0%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†è®²è¿°ä½¿ç”¨Glideæ—¶é‡åˆ°çš„å„ç§é—®é¢˜ä¸è§£å†³</p><a id="more"></a><h1 id="å…³äºGlideå„ç§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆé›†åˆï¼ˆä¸æ–­æ›´æ–°ï¼‰"><a href="#å…³äºGlideå„ç§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆé›†åˆï¼ˆä¸æ–­æ›´æ–°ï¼‰" class="headerlink" title="å…³äºGlideå„ç§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆé›†åˆï¼ˆä¸æ–­æ›´æ–°ï¼‰"></a>å…³äºGlideå„ç§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆé›†åˆï¼ˆä¸æ–­æ›´æ–°ï¼‰</h1><blockquote><p>æœ¬ç¯‡å·²Javaä¸ºä¸»è¦è¯­è¨€</p></blockquote><h3 id="Glideä½¿ç”¨"><a href="#Glideä½¿ç”¨" class="headerlink" title="Glideä½¿ç”¨"></a>Glideä½¿ç”¨</h3><ol><li><p><a href="https://github.com/bumptech/glide">æ·»åŠ ä¾èµ–</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.github.bumptech.glide:glide:4.11.0&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.github.bumptech.glide:compiler:4.11.0&#x27;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="å…³äºGlideModuleçš„é—®é¢˜"><a href="#å…³äºGlideModuleçš„é—®é¢˜" class="headerlink" title="å…³äºGlideModuleçš„é—®é¢˜"></a>å…³äºGlideModuleçš„é—®é¢˜</h3><ol><li><p>åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª<strong>class</strong>æ–‡ä»¶</p></li><li><p>ç»§æ‰¿AppGlideModule</p></li><li><p>æ·»åŠ æ³¨è§£@GlideModule</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GlideModule</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyGlideModule</span> <span class="keyword">extends</span> <span class="title">AppGlideModule</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>é‡Œé¢å¹¶ä¸éœ€è¦å¡«å†™å†…å®¹</p></li></ol><h3 id="æ›¿æ¢Glideçš„è¯·æ±‚æ–¹å¼"><a href="#æ›¿æ¢Glideçš„è¯·æ±‚æ–¹å¼" class="headerlink" title="æ›¿æ¢Glideçš„è¯·æ±‚æ–¹å¼"></a>æ›¿æ¢Glideçš„è¯·æ±‚æ–¹å¼</h3><ol><li><p>æ·»åŠ ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&quot;com.github.bumptech.glide:okhttp3-integration:4.11.0&quot;</span></span><br><span class="line">implementation <span class="string">&#x27;com.squareup.okhttp3:okhttp:4.7.2&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª<strong>class</strong>æ–‡ä»¶</p></li><li><p>ç»§æ‰¿AppGlideModule</p></li><li><p>æ·»åŠ æ³¨è§£@GlideModule</p></li><li><p>é‡å†™*<strong>registerComponents**<em>å’Œ</em></strong>isManifestParsingEnabled***æ–¹æ³•</p></li><li><p>åœ¨**<em>registerComponents**</em>æ–¹æ³•ä¸­æ›¿æ¢ä¸ºOkHttp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GlideModule</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyGlideModule</span> <span class="keyword">extends</span> <span class="title">AppGlideModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applyOptions</span><span class="params">(Context context, GlideBuilder builder)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerComponents</span><span class="params">(Context context, <span class="meta">@NotNull</span> Glide glide, Registry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Glide åº•å±‚é»˜è®¤ä½¿ç”¨ HttpConnection è¿›è¡Œç½‘ç»œè¯·æ±‚,è¿™é‡Œæ›¿æ¢ä¸º Okhttp</span></span><br><span class="line">        registry.replace(GlideUrl.class, InputStream.class, <span class="keyword">new</span> OkHttpUrlLoader.Factory(ProgressManager.getInstance().with(<span class="keyword">new</span> OkHttpClient.Builder()).build()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isManifestParsingEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Error </tag>
            
            <tag> Android </tag>
            
            <tag> Glide </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AndroidStudioé”™è¯¯ç»Ÿè®¡</title>
      <link href="2021/04/15/AndroidStudio%E9%94%99%E8%AF%AF%E7%BB%9F%E8%AE%A1/"/>
      <url>2021/04/15/AndroidStudio%E9%94%99%E8%AF%AF%E7%BB%9F%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†æè¿°ä¸ªäººåœ¨ä½¿ç”¨Android Studioæ—¶é‡åˆ°çš„å¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯</p><a id="more"></a><h1 id="AndroidStudioé”™è¯¯ç»Ÿè®¡"><a href="#AndroidStudioé”™è¯¯ç»Ÿè®¡" class="headerlink" title="AndroidStudioé”™è¯¯ç»Ÿè®¡"></a>AndroidStudioé”™è¯¯ç»Ÿè®¡</h1><h3 id="AndroidStudio-Canary"><a href="#AndroidStudio-Canary" class="headerlink" title="AndroidStudio Canary"></a>AndroidStudio Canary</h3><ol><li><p>åœ¨é¡¹ç›®çº§ä¸­çš„build.gradleä¸­æ·»åŠ é¡¹ç›®ä¾èµ–åº“ï¼Œä¼šæŠ¥é”™</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url <span class="string">&#x27;https://maven.google.com&#x27;</span> &#125;</span><br><span class="line">        maven &#123; url <span class="string">&quot;https://jitpack.io&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å¤§æ¦‚æ˜¯å› ä¸ºåœ¨é¡¹ç›®çº§çš„gradleä¸­æ·»åŠ çš„gradleç‰ˆæœ¬è¿‡é«˜ï¼Œå–æ¶ˆäº†allprojects{}å¼•ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ext.kotlin_version = <span class="string">&quot;1.4.31&quot;</span></span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œçš„gradleç‰ˆæœ¬è¿‡é«˜</span></span><br><span class="line">        classpath <span class="string">&quot;com.android.tools.build:gradle:7.0.0&quot;</span></span><br><span class="line">        classpath <span class="string">&quot;org.jetbrains.kotlin:kotlin-gradle-plugin:<span class="variable">$kotlin_version</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ— æ³•ä½¿ç”¨</span></span><br><span class="line"><span class="comment">//allprojects &#123;</span></span><br><span class="line"><span class="comment">//    repositories &#123;</span></span><br><span class="line"><span class="comment">//        google()</span></span><br><span class="line"><span class="comment">//        jcenter()</span></span><br><span class="line"><span class="comment">//        maven &#123; url &quot;https://jitpack.io&quot; &#125;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">task clean(type: Delete) &#123;</span><br><span class="line">    delete rootProject.buildDir</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>AndroidStudio Canary å¯ä¸ AndroidStuidå…±å­˜</p><ul><li>æœ€å¥½ä¸¤ä¸ªéƒ½ä¸‹è½½ï¼Œç¨³å®šç‰ˆç”¨æ¥æ­£å¸¸å¼€å‘é¡¹ç›®ï¼Œæµ‹è¯•ç‰ˆç”¨æ¥ä½“éªŒæ–°åŠŸèƒ½</li></ul></li><li><p>ViewPagerå­é¡µé¢ä¸­å¼€å¯ä¸€ä¸ªæ–°çš„Activityï¼Œåœ¨è¿”å›ä¼šå¯¼è‡´Fragmenté¡µé¢ç©ºç™½</p><blockquote><p>åº”è¯¥æ˜¯å› ä¸ºViewåˆå§‹åŒ–ä¸åœ¨onCreateViewä¸­ï¼Œä¼šå¯¼è‡´é‡å¤åˆå§‹åŒ–Viewï¼Œå¯¼è‡´å‡ºé”™</p></blockquote><ul><li><p>æŠŠFragmentå¼€å¯æ‡’åŠ è½½ï¼ŒæŠŠViewåˆå§‹åŒ–æ”¾åœ¨onCreateViewä¸­ï¼Œæ•°æ®åŠ è½½æ”¾åœ¨æ‡’åŠ è½½ä¸­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isFirstLoad = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mView: View? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">initData</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        <span class="keyword">if</span> (mView == <span class="literal">null</span>) &#123;</span><br><span class="line">            mView = createView(inflater, container, savedInstanceState)</span><br><span class="line">            initView()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume()</span><br><span class="line">        <span class="keyword">if</span> (isFirstLoad) &#123;</span><br><span class="line">            initData()</span><br><span class="line">            isFirstLoad = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroyView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroyView()</span><br><span class="line">        isFirstLoad = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>é‡‡ç”¨RecyclerView+GSYVideoPlayeræ¥å®ç°æŠ–éŸ³æ•ˆæœæ—¶ï¼Œæ— æ³•æ§åˆ¶å’Œé”€æ¯è§†é¢‘</p><ul><li></li></ul></li><li><p>åœ¨kolitnä¸­ä½¿ç”¨Roomã€‚åœ¨åˆ›å»ºæ•°æ®åº“å®ä½“ç±»(appDataBase)çš„æ—¶å€™ï¼Œå¯¼å…¥ç›¸åº”çš„å®ä½“ç±»æ—¶ï¼Œåº”ä½¿ç”¨**::class**</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Database(entities = [xxx::class], version = 1)</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDatabase</span> : <span class="type">RoomDatabase</span></span>() &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="6"><li><p>å¤šä¸ªFragmentä½¿ç”¨Fragmentä¸­ViewModel(ç›¸åŒçš„ViewModel)å¿«æ·åˆ›å»ºçš„ViewModelå¹¶ä¸æ˜¯åŒä¸€ä¸ª</p><p>è¿™æ ·åˆ›å»ºçš„viewModelæ˜¯é‡æ–°åˆ›å»ºäº†ä¸€ä¸ªï¼Œå¹¶ä¸æ˜¯ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„viewModel</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> viewModel <span class="keyword">by</span> viewModels&lt;PhotoDetailViewModel&gt;()</span><br></pre></td></tr></table></figure><p>å¿…é¡»è¦è¿™æ ·åˆ›å»ºæ‰å¯ä»¥è·å–ç›¸åŒçš„viewModel</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> viewModel : PhotoDetailViewModel</span><br><span class="line"> viewModel = ViewModelProvider(activity <span class="keyword">as</span> PhotoDetailActivity).<span class="keyword">get</span>(PhotoDetailViewModel::<span class="keyword">class</span>.java)</span><br></pre></td></tr></table></figure></li></ol><p>7.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Error </tag>
            
            <tag> kotlin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºAndroidçš„å„ä¸ªViewçš„ä»‹ç»</title>
      <link href="2021/04/15/%E5%85%B3%E4%BA%8EAndroid%E7%9A%84%E5%90%84%E4%B8%AAView%E7%9A%84%E4%BB%8B%E7%BB%8D/"/>
      <url>2021/04/15/%E5%85%B3%E4%BA%8EAndroid%E7%9A%84%E5%90%84%E4%B8%AAView%E7%9A%84%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†ä»‹ç»Androidä¸€äº›å†·é—¨Viewçš„ä½¿ç”¨</p><a id="more"></a><h1 id="å…³äºAndroidçš„å„ä¸ªViewçš„ä»‹ç»"><a href="#å…³äºAndroidçš„å„ä¸ªViewçš„ä»‹ç»" class="headerlink" title="å…³äºAndroidçš„å„ä¸ªViewçš„ä»‹ç»"></a>å…³äºAndroidçš„å„ä¸ªViewçš„ä»‹ç»</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä¸ºä¸»è¦è¯­è¨€</p><p>ä»‹ç»çš„åŠŸèƒ½çš†ä¸ºæœ€æ–°åŠŸèƒ½</p></blockquote><ol><li><p><strong><em>Toolbar</em></strong></p><ul><li><p>è®¾ç½®æ ‡é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:title&#x3D;&quot;è¿™é‡Œæ˜¯æ ‡é¢˜&quot;</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®æ ‡é¢˜å‰çš„å›¾æ ‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:navigationIcon&#x3D;&quot;@drawable&#x2F;ic_baseline_arrow_back&quot;</span><br></pre></td></tr></table></figure><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20210407182013.png"></p></li><li><p>æ˜¯å¦é€‰æ‹©åœ¨å½“å‰çš„å¸ƒå±€å½“æ—¶æ˜¯å¦ä»¥â€œè§†å·®â€çš„æ–¹å¼æ¥è·Ÿéšæ»šåŠ¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_collapseMode&#x3D;&quot;pin&quot;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶å®å°±æ˜¯è®©è¿™ä¸ªViewçš„æ»šåŠ¨çš„é€Ÿåº¦æ¯”å…¶ä»–æ­£å¸¸æ»šåŠ¨çš„Viewé€Ÿåº¦ç¨å¾®æ…¢ä¸€ç‚¹</p></blockquote><h5 id="å…³äºCollapsingToolbarLayoutä¸Toolbarè”åŠ¨ä½¿ç”¨"><a href="#å…³äºCollapsingToolbarLayoutä¸Toolbarè”åŠ¨ä½¿ç”¨" class="headerlink" title="å…³äºCollapsingToolbarLayoutä¸Toolbarè”åŠ¨ä½¿ç”¨"></a>å…³äºCollapsingToolbarLayoutä¸Toolbarè”åŠ¨ä½¿ç”¨</h5><ul><li><p>è®¾ç½®ä¸Šæ»‘åˆ°Toolbaré«˜åº¦æ—¶ï¼ŒToolbarçš„èƒŒæ™¯ä»¥åŠè¿‡åº¦é¢œè‰²</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:contentScrim&#x3D;â€?attr&#x2F;colorPrimaryâ€</span><br></pre></td></tr></table></figure><blockquote><p>å½“ä¸Šæ»‘åˆ°toolbar é«˜åº¦æœŸé—´ç›´åˆ°è¾¾åˆ°toolbaré«˜åº¦æ—¶ï¼Œç»™toolbarè®¾ç½®çš„èƒŒæ™¯è‰²ï¼Œä»¥åŠè¿‡æ¸¡é¢œè‰²ã€‚<em>å½“ç„¶ï¼Œè¿™é‡Œä¸ä»…ä»…å¯ä»¥è®¾ç½®é¢œè‰²ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å›¾ç‰‡ã€‚</em> å¦‚æœä¸è®¾ç½®è¯¥å±æ€§ï¼Œæ ‡é¢˜æ ä¼šè¿‡æ¸¡ä¸ºä»¥ä¹‹å‰çš„å›¾ç‰‡ä¸ºèƒŒæ™¯</p></blockquote></li><li><p>è®¾ç½®Toolbar Titleä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:expandedTitleGravity&#x3D;â€center_horizontalâ€</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®Toolbar Titleè·ç¦»å¼€å§‹ä½ç½®çš„è¾¹è·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:expandedTitleMarginStart&#x3D;â€50dpâ€</span><br></pre></td></tr></table></figure></li><li></li></ul></li><li><p>è®¾ç½®Toolbaræ–‡å­—é¢œè‰² </p></li></ul></li><li><p><strong>Activityè·³è½¬åŠ¨ç”»</strong></p><ul><li><p>overridePendingTransition()</p><blockquote><p>è¿™ä¸ªæ–¹æ³•ç”¨æ¥è¦†ç›–å³å°†åˆ°æ¥çš„è·³è½¬åŠ¨ç”»ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥æ›¿æ¢åŸæœ¬çš„è·³è½¬åŠ¨ç”»</p></blockquote></li><li><p>overridePendingTransition()çš„è°ƒç”¨æ—¶æœº </p><p>è¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨startActivity()æˆ–è€…finish()ä¹‹åç«‹å³è°ƒç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> intent = Intent(activity, MainActivity::<span class="keyword">class</span>.java)</span><br><span class="line">        activity.startActivity(intent)</span><br><span class="line">        activity.overridePendingTransition(</span><br><span class="line">            R.anim.anim_slide_enter_bottom,</span><br><span class="line">            R.anim.anim_no_anim</span><br><span class="line">        )</span><br></pre></td></tr></table></figure><blockquote><p>overridePendingTransition()éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºè¿›å…¥åŠ¨ç”»ï¼Œç¬¬äºŒä¸ªä¸ºé€€å‡ºåŠ¨ç”»</p><p>è¿™äº›èµ„æºéƒ½éœ€è¦åœ¨animæ–‡ä»¶å¤¹ä¸­åˆ›å»º</p></blockquote></li></ul></li><li><p><strong>ObjectAnimator</strong></p><ul><li><p>ObjectAnimatoræ´¾ç”Ÿè‡ªValueAnimator,æ‰€ä»¥ValueAnimatorèƒ½ç”¨çš„æ–¹æ³•ï¼ŒObjectAnimatoréƒ½èƒ½ç”¨, ObjectAnimator æ˜¯ValueAnimatorçš„å­ç±»ã€‚</p></li><li><p>ä¾‹å­å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> objectAnimator: ObjectAnimator <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        ObjectAnimator.ofFloat(binding.ivCover, ANIMATION_PROPERTY_NAME, <span class="number">0f</span>, <span class="number">360f</span>).apply &#123;</span><br><span class="line">            interpolator = LinearInterpolator()</span><br><span class="line">            duration = DURATION_CD<span class="comment">//è®¾ç½®åŠ¨ç”»æ—¶é—´</span></span><br><span class="line">            repeatCount = ANIMATION_REPEAT_COUNTS</span><br><span class="line">            start()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>ObjectAnimator.ofFloat</strong>æ¥æ”¶4ä¸ªå‚æ•°</p><p>ç¬¬ä¸€ä¸ªï¼šè¿›è¡ŒåŠ¨ç”»çš„View</p><p>ç¬¬äºŒä¸ªï¼šéœ€è¦è¿›è¡ŒåŠ¨ç”»çš„å±æ€§</p><p>ç¬¬ä¸‰ä¸ªï¼šèµ·å§‹å€¼</p><p>ç¬¬å››ä¸ªï¼šç»“æŸå€¼</p></blockquote></li><li><p><em>ObjectAnimatorçš„å‡½æ•°</em></p><ol><li>æ”¹å˜æ—‹è½¬åº¦æ•° rotationã€rotationXã€rotationY<ul><li>rotation:è¡¨ç¤ºå›´ç»• Z æ—‹è½¬,rotation è¡¨ç¤ºæ—‹è½¬åº¦æ•°</li><li>rotationX:è¡¨ç¤ºå›´ç»•Xæ—‹è½¬,rotationXè¡¨ç¤ºæ—‹è½¬åº¦æ•°</li><li>rotationY:è¡¨ç¤ºå¾®è½¯Yæ—‹è½¬,rotationYè¡¨ç¤ºæ—‹è½¬åº¦æ•°</li></ul></li><li>ç§»åŠ¨ translationXã€translationY<ul><li>float translationX:è¡¨ç¤ºåœ¨Xè½´ä¸Šç§»åŠ¨çš„è·ç¦»ï¼Œä»¥å½“å‰æ§ä»¶ä¸ºåŸç‚¹ï¼Œå‘å³ä¸ºæ­£æ–¹å‘ï¼Œå‚æ•° translationX è¡¨ç¤ºç§»åŠ¨çš„è·ç¦»</li><li>float translationY:è¡¨ç¤ºåœ¨Yè½´ä¸Šç§»åŠ¨çš„è·ç¦»ï¼Œä»¥å½“å‰æ§ä»¶ä¸ºåŸç‚¹ï¼Œå‘ä¸‹ä½æ­£æ–¹å‘ï¼Œå‚æ•° translationY è¡¨ç¤ºç§»åŠ¨çš„è·ç¦»</li></ul></li><li>ç¼©æ”¾ scaleXã€scaleY<ul><li>float scaleX:åœ¨Xè½´ä¸Šç¼©æ”¾ï¼ŒscaleXè¡¨ç¤ºç¼©æ”¾å€æ•°</li><li>float scaleY:åœ¨Yè½´ä¸Šç¼©æ”¾ï¼ŒscaleYè¡¨ç¤ºç¼©æ”¾å€æ•°</li></ul></li><li>æ”¹å˜é€æ˜åº¦ alpha<ul><li>float alpha:æ§åˆ¶Viewçš„é€æ˜åº¦</li></ul></li></ol></li><li><p><em>è‡ªå®šä¹‰ObjectAnimatorçš„å±æ€§</em></p><ul><li><p>åªéœ€è¦ç¡®ä¿Viewéœ€è¦æ”¹å˜å±æ€§æœ‰å…¬å¼€çš„ <strong>setâ€™()</strong> / <strong>get()</strong> æ–¹æ³•å³å¯</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span></span>(  <span class="comment">//åœ†çš„åŠå¾„</span></span><br><span class="line">    <span class="keyword">var</span> radius: <span class="built_in">Int</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åªéœ€è¦ç»™å®ƒåˆ›å»ºä¸€ä¸ªset/getæ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPointView</span></span>(context: Context?, attrs: AttributeSet?) : View(context, attrs) &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mCircle: Circle? = Circle(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mCircle != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> paint = Paint()</span><br><span class="line">            paint.setAntiAlias(<span class="literal">true</span>)</span><br><span class="line">            paint.setColor(Color.RED)</span><br><span class="line">            paint.setStyle(Paint.Style.FILL)</span><br><span class="line">            canvas.drawCircle(<span class="number">400</span>, <span class="number">500</span>, mCircle.getRadius(), paint)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setå‡½æ•°</span></span><br><span class="line">    <span class="comment">//getå‡½æ•°</span></span><br><span class="line">    <span class="keyword">var</span> circleRadius: <span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = <span class="number">800</span></span><br><span class="line">        <span class="keyword">set</span>(radius) &#123;</span><br><span class="line">            mCircle.setRadius(radius)</span><br><span class="line">            invalidate()<span class="comment">//invalidate()è¯·æ±‚é‡ç»˜Viewæ ‘ï¼Œä¹Ÿå°±æ˜¯åˆ·æ–°View</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>åœ¨Activityä¸­ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> animator = ObjectAnimator.ofInt(view, <span class="string">&quot;circleRadius&quot;</span>, <span class="number">40</span>, <span class="number">400</span>)</span><br><span class="line">        animator.interpolator = BounceInterpolator()</span><br><span class="line">        animator.duration = <span class="number">2000</span></span><br><span class="line">        animator.start()</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p><strong>DataBingdingä¸ViewBinding</strong></p><ul><li><p>dataBinding</p><ol><li><p>åœ¨Modelçš„build.gradleä¸­å¼€å¯dataBinding</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">    buildFeatures&#123;</span><br><span class="line">        dataBinding = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨Android Stuio 4.0ä»¥ä¸Šæ—¶ï¼Œåªèƒ½ä½¿ç”¨<strong>buildFeatures</strong>æ¥è¿›è¡Œç®¡ç†</p></blockquote></li><li><p>åœ¨Xmlä¸­å¼€å¯</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20210414100322.png"></p><blockquote><p>å°†å…‰æ ‡ç§»åˆ°ç¬¬ä¸€è¡Œç¬¬ä¸€ä½ï¼ŒæŒ‰ä¸‹é”®ç›˜â€ALT+ENTERâ€é€‰æ‹©ç¬¬ä¸€ä¸ªåˆ›å»ºbinding layoutå³å¯</p></blockquote></li><li><p>åœ¨Activityä¸­å¼•å…¥</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">BaseActivity</span></span>(), View.OnClickListener &#123;</span><br><span class="line">    <span class="comment">//å…ˆç”³æ˜ä¸ºå»¶è¿Ÿåˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityMainBinding</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        <span class="comment">//ä½¿ç”¨DataBindingUtilæ¥è¿›è¡Œè½½å…¥å¸ƒå±€</span></span><br><span class="line">    binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_main)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">binding.randomText.text = <span class="string">&quot;å½“å‰éšæœºå‚æ•°ä¸º:<span class="subst">$&#123;it?.get(<span class="number">0</span>)?.randomName&#125;</span>&quot;</span></span><br><span class="line">binding.randomCountLast.text = <span class="string">&quot;éšæœºæ¬¡æ•°ä¸º:<span class="subst">$&#123;it?.get(<span class="number">0</span>)?.randomNum&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨<em>binding.xxx</em>æ¥å¼•ç”¨View</p></li></ol></li><li><p>viewBinding</p><ol><li><p>åœ¨Modelçš„build.gradleä¸­å¼€å¯dataBinding</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">        ...</span><br><span class="line">        buildFeatures&#123;</span><br><span class="line">        viewBinding = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li><li><p>å¼€å¯ä¹‹åï¼Œç³»ç»Ÿå°†ä¼šè‡ªåŠ¨çš„ç”Ÿæˆç»‘å®šç±»</p></li><li><p>åœ¨Activityä¸­ä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">BaseActivity</span></span>(), View.OnClickListener &#123;</span><br><span class="line">    <span class="comment">//å…ˆç”³æ˜ä¸ºå»¶è¿Ÿåˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityMainBinding</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        <span class="comment">//å°†ä¸éœ€è¦æŒ‡æ˜Layoutæ–‡ä»¶</span></span><br><span class="line">        binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„ä¸dataBindingä¸€è‡´</p></li></ol></li></ul></li></ol><p>5.</p>]]></content>
      
      
      
        <tags>
            
            <tag> kotlin </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kotlinçš„ä¸€äº›è¯­æ³•å’Œæ•°æ®ç»“æ„</title>
      <link href="2021/04/15/Kotlin%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%AD%E6%B3%95/"/>
      <url>2021/04/15/Kotlin%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡å°†è®²è¿°Kotlinçš„ä¸€äº›è¯­æ³•ç³–å’ŒLambdaçš„ä½¿ç”¨</p><a id="more"></a><h1 id="Kotlinçš„ä¸€äº›è¯­æ³•å’Œæ•°æ®ç»“æ„"><a href="#Kotlinçš„ä¸€äº›è¯­æ³•å’Œæ•°æ®ç»“æ„" class="headerlink" title="Kotlinçš„ä¸€äº›è¯­æ³•å’Œæ•°æ®ç»“æ„"></a>Kotlinçš„ä¸€äº›è¯­æ³•å’Œæ•°æ®ç»“æ„</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä¸ºä¸»è¦è¯­è¨€</p></blockquote><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a><em>æ•°ç»„</em></h2><ul><li><p>æ•°ç»„</p><ul><li><p>åˆ›å»ºæŒ‡å®šå¤§å°çš„ç©ºæ•°ç»„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dp = IntArray(n)</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºæ•°ç»„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dp = arrayOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)<span class="comment">//ç›¸å½“äº int[1,2,3]</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºæŒ‡å®šé•¿åº¦çš„ç©ºæ•°ç»„ï¼ˆç›¸å½“äºjavaä¸­çš„new int[n]ï¼‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> nullArray = arrayofNulls&lt;<span class="built_in">Int</span>&gt;(<span class="number">6</span>)</span><br></pre></td></tr></table></figure></li><li><h3 id="æ•°ç»„ç‰¹ç‚¹"><a href="#æ•°ç»„ç‰¹ç‚¹" class="headerlink" title="æ•°ç»„ç‰¹ç‚¹"></a>æ•°ç»„ç‰¹ç‚¹</h3><ul><li>ä¸€ä¸ªæ•°ç»„åªèƒ½ç”±åŒç§æ•°æ®ç±»å‹ç»„æˆ</li><li>æ•°ç»„ä¸€æ—¦åˆå§‹åŒ–ï¼Œé•¿åº¦å°±å›ºå®š</li><li>æ•°ç»„ä¸­å…ƒç´ çš„åœ°å€æ˜¯è¿ç»­çš„</li><li>æ•°ç»„æœ¬èº«æ˜¯æ²¡æœ‰å¢åˆ æ”¹æŸ¥çš„æ–¹æ³•</li></ul></li></ul></li></ul><h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><ul><li><p>é“¾è¡¨é€šå¸¸æœ‰å•é“¾è¡¨å’ŒåŒå‘é“¾è¡¨</p></li><li><h3 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h3><ul><li><p>å•é“¾è¡¨æ˜¯é“¾è¡¨ä¸­çš„ä¸€ç§ï¼Œå®ƒçš„æ–¹å‘æ˜¯å•å‘çš„ï¼Œå¯¹é“¾è¡¨çš„è®¿é—®è¦ä»å¤´éƒ¨(head)å¼€å§‹ï¼Œç„¶åä¾æ¬¡é€šè¿‡nextå»è®¿é—®ä¸‹ä¸€ä¸ªç»“ç‚¹</p></li><li><p>å•é“¾è¡¨çš„æ•°æ®ç»“æ„æ˜¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ƒç´ ï¼Œç¬¬äºŒä¸ªæ˜¯æŒ‡é’ˆã€‚å…ƒç´ ç”¨æ¥å­˜å‚¨ä»»æ„æ•°æ®ç±»å‹ï¼ŒæŒ‡é’ˆåˆ™æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹çš„å¼•ç”¨</p></li><li><p>åˆ›å»ºå•é“¾è¡¨ä½¿ç”¨çš„ç»“ç‚¹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span></span>(<span class="keyword">var</span> value : <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> next : Node? = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå•é“¾è¡¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedNode</span></span>&#123;</span><br><span class="line">    <span class="comment">//å¤´ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">var</span> head : Node? = <span class="literal">null</span></span><br><span class="line">    <span class="comment">//å°¾ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">var</span> last : Node?= <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><h3 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h3><ul><li><p>åŒå‘é“¾è¡¨ä¹Ÿæ˜¯é“¾è¡¨ä¸­çš„ä¸€ç§ï¼Œå®ƒä¸å•é“¾è¡¨ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„æ¯ä¸ªç»“ç‚¹æœ‰ä¸¤ä¸ªæŒ‡é’ˆã€‚ç¬¬ä¸€ä¸ªæŒ‡é’ˆæ˜¯æŒ‡å‘å®ƒçš„å‰é©±ç»“ç‚¹(ä¹Ÿå°±æ˜¯æŒ‡å‘å®ƒçš„ä¸Šä¸€ä¸ª)ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯æŒ‡å‘å®ƒçš„åç»§ç»“ç‚¹(ä¹Ÿå°±æ˜¯æŒ‡å‘å®ƒçš„ä¸‹ä¸€ä¸ª)ã€‚æ‰€ä»¥åŒå‘é“¾è¡¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„å»è®¿é—®å®ƒçš„å‰é©±ç»“ç‚¹å’Œåç»§ç»“ç‚¹</p></li><li><p>åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„æ˜¯ç”±3éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºprevæŒ‡é’ˆ(å‰é©±æŒ‡é’ˆ)ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºå…ƒç´ ï¼Œç¬¬ä¸‰éƒ¨åˆ†ä¸ºnextæŒ‡é’ˆ(åç»§æŒ‡é’ˆ)ã€‚prevæŒ‡é’ˆæ˜¯æŒ‡å‘ä¸Šä¸€ä¸ªç»“ç‚¹çš„å¼•ç”¨ï¼Œå…ƒç´ åˆ™å¯ä»¥ä¸ºä»»æ„æ•°æ®ç±»å‹ï¼ŒnextæŒ‡é’ˆåˆ™æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹çš„å¼•ç”¨</p></li><li><p>åˆ›å»ºåŒå‘é“¾è¡¨ä½¿ç”¨çš„ç»“ç‚¹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BNode</span></span>(<span class="keyword">var</span> value : <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> next : BNode? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> prev : BNode? = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºåŒå‘é“¾è¡¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BothwayNode</span></span>&#123;</span><br><span class="line">   <span class="keyword">var</span> head : BNode? = <span class="literal">null</span></span><br><span class="line">   <span class="keyword">var</span> last : BNode? = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><h3 id="å•å‘å¾ªç¯é“¾è¡¨"><a href="#å•å‘å¾ªç¯é“¾è¡¨" class="headerlink" title="å•å‘å¾ªç¯é“¾è¡¨"></a>å•å‘å¾ªç¯é“¾è¡¨</h3><ul><li><p>å•å‘å¾ªç¯é“¾è¡¨ï¼Œå®ƒåªæ˜¯åœ¨å•é“¾è¡¨çš„åŸºç¡€ä¸Šä½¿å¾—æœ€åä¸€ä¸ªç»“ç‚¹(å°¾ç»“ç‚¹)çš„æŒ‡é’ˆä¸åœ¨æŒ‡å‘ç©ºï¼Œè€Œæ˜¯æŒ‡å‘å¤´éƒ¨ã€‚ä½¿å…¶æˆä¸ºä¸€ä¸ªå¾ªç¯</p></li><li><p>å•å‘å¾ªç¯é“¾è¡¨çš„æ•°æ®ç»“æ„å’Œå•é“¾è¡¨æ˜¯ä¸€è‡´çš„</p><p><img src="https://upload-images.jianshu.io/upload_images/3992846-dbca0b4719ed6603?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp"></p></li></ul></li><li><h3 id="åŒå‘å¾ªç¯é“¾è¡¨"><a href="#åŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="åŒå‘å¾ªç¯é“¾è¡¨"></a>åŒå‘å¾ªç¯é“¾è¡¨</h3><ul><li><p>åŒå‘å¾ªç¯é“¾è¡¨ï¼Œå®ƒä¹Ÿåªæ˜¯åœ¨åŒé“¾è¡¨çš„åŸºç¡€ä¸Šä½¿å¾—æœ€åä¸€ä¸ªç»“ç‚¹çš„åç»§æŒ‡é’ˆ(next)æŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå¤´ç»“ç‚¹çš„å‰é©±æŒ‡é’ˆæŒ‡(prev)å‘æœ€åä¸€ä¸ªç»“ç‚¹</p></li><li><p>åŒå‘å¾ªç¯é“¾è¡¨çš„æ•°æ®ç»“æ„ä¹Ÿæ˜¯ä¸åŒå‘é“¾è¡¨ä¸€è‡´</p><p><img src="https://upload-images.jianshu.io/upload_images/3992846-305f533866fcc79b?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp"></p></li></ul></li><li><h3 id="é“¾è¡¨çš„åŸºç¡€æ“ä½œ"><a href="#é“¾è¡¨çš„åŸºç¡€æ“ä½œ" class="headerlink" title="é“¾è¡¨çš„åŸºç¡€æ“ä½œ"></a>é“¾è¡¨çš„åŸºç¡€æ“ä½œ</h3><ul><li><p>å•é“¾è¡¨æ’å…¥å…ƒç´ </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> head : Node? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> last : Node? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">insert</span><span class="params">(value : <span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> node = Node(value)<span class="comment">//å…ˆåˆ›å»ºç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span>)&#123;<span class="comment">//ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§ä¸ºå•é“¾è¡¨ä¸ºç©º</span></span><br><span class="line">          head = node<span class="comment">//åˆ™å°†å…ƒç´ ä¼ å…¥ï¼Œå¹¶å½“å‰å…ƒç´ å³æ˜¯å¤´ä¹Ÿæ˜¯å°¾</span></span><br><span class="line">            last = node</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            last!!.next = node<span class="comment">//å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™å°†å°¾æŒ‡é’ˆæŒ‡å‘å®ƒï¼Œå¹¶å°†å°¾æŒ‡é’ˆå‘åç§»</span></span><br><span class="line">            last = node</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å•é“¾è¡¨åˆ é™¤å…ƒç´ </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkedNode</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> head : Node? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> last : Node? = <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(value : <span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (head==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">            <span class="keyword">if</span>(head!!.value == value)&#123;<span class="comment">//å¦‚æœå¤´å°±æ˜¯è¦åˆ é™¤çš„å…ƒç´ </span></span><br><span class="line">              head = head!!.next<span class="comment">//å°†å¤´å‘åç§»å³å¯</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> iterator = head<span class="comment">//åˆ›å»ºä¸€ä¸ªç”¨æ¥éå†çš„ç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">while</span>(iterator!!.next!=<span class="literal">null</span>)&#123;<span class="comment">//ä»å¤´åˆ°å°¾å¾ªç¯</span></span><br><span class="line">                <span class="keyword">if</span>(iterator.next!!.value == value)&#123;<span class="comment">//å½“ä¸‹ä¸€ä¸ªç»“ç‚¹å°±æ˜¯è¦è¢«åˆ é™¤çš„å…ƒç´ æ—¶ï¼Œé€€å‡º</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">              &#125;</span><br><span class="line">                <span class="comment">//æ¯æ¬¡éƒ½å‘åç§»</span></span><br><span class="line">              iterator = iterator.next</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//å½“é€€å‡ºå¾ªç¯å°±ä»£è¡¨ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯è¦è¢«åˆ é™¤ï¼Œåˆ™å°†æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ª</span></span><br><span class="line">            iterator.next = iterator.next!!.next</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åŒå‘é“¾è¡¨æ·»åŠ å…ƒç´ </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BothwayNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> head : BNode? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> last : BNode? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">insert</span><span class="params">(value : <span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> node = BNode(value)</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>)&#123;<span class="comment">//è¿™é‡Œéƒ½ä¸å•é“¾è¡¨ç›¸ä¼¼</span></span><br><span class="line">            head = node</span><br><span class="line">            last = node</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//å› ä¸ºåŒå‘é“¾è¡¨æ˜¯æœ‰å‰é©±å’Œåç»§æŒ‡é’ˆçš„</span></span><br><span class="line">            <span class="comment">//æ‰€ä»¥éœ€è¦å°†last(å°¾æŒ‡é’ˆ)æŒ‡å‘å®ƒï¼Œåœ¨å°†æ’å…¥å…ƒç´ çš„å‰é©±æŒ‡å‘lastï¼Œæœ€ååœ¨å°†last(å°¾æŒ‡é’ˆ)åç§»</span></span><br><span class="line">            last!!.next = node</span><br><span class="line">            node.prev = last</span><br><span class="line">            last = node</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åŒå‘é“¾è¡¨åˆ é™¤å…ƒç´ </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BothwayNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> head : BNode? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> last : BNode? = <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(value : <span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(head!!.value == value)&#123;</span><br><span class="line">            <span class="comment">//å½“è¦åˆ é™¤çš„å…ƒç´ ä¸ºå¤´æ—¶ï¼Œå°†å¤´åç§»</span></span><br><span class="line">            head = head!!.next</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> iterator = head</span><br><span class="line">        <span class="keyword">while</span> (iterator!!.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (iterator.next!!.value == value)&#123;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            iterator = iterator.next</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (iterator.next!!.next != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­è¦åˆ é™¤çš„å…ƒç´ æ˜¯å¦ä¸ºæœ€åä¸€ä¸ª</span></span><br><span class="line">            <span class="comment">//å°†è¦åˆ é™¤å…ƒç´ çš„åä¸€ä¸ªçš„å‰é©±æŒ‡å‘å½“å‰å…ƒç´ </span></span><br><span class="line">            iterator.next!!.next!!.prev = iterator</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//ä¸ºæœ€åä¸€ä¸ªï¼Œåˆ™åªéœ€è¦å°†å‰é©±è®¾ç½®ä¸ºç©ºå³å¯</span></span><br><span class="line">            iterator.next!!.prev = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å®Œæˆäº†å‰é©±ï¼Œè¿˜éœ€è¦å°†åç»§ç»§ç»­æŒ‡å‘åä¸€ä½</span></span><br><span class="line">        iterator.next = iterator.next!!.next</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="For"><a href="#For" class="headerlink" title="For"></a><em>For</em></h2><ul><li><p>å¯¹ä¸€ä¸ªæ•°å­—è¿›è¡Œå¾ªç¯</p><ul><li><p>å¾ªç¯åˆ°é‚£ä¸ªæ•°å­—ï¼ˆä¸åŒ…æ‹¬ï¼‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span> until n)<span class="comment">//nå°±æ˜¯è¾“å…¥çš„æ•°å­—</span></span><br></pre></td></tr></table></figure></li><li><p>å¾ªç¯åˆ°é‚£ä¸ªæ•°å­—ï¼ˆåŒ…æ‹¬ï¼‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>..n)<span class="comment">//nå°±æ˜¯è¾“å…¥çš„æ•°å­—</span></span><br></pre></td></tr></table></figure></li><li></li></ul></li><li></li></ul><h2 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a><em>Lambda</em></h2><ul><li><p>å†…è”æ‰©å±•å‡½æ•°</p><ul><li><p><strong>let</strong> </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span>.let&#123;</span><br><span class="line">    <span class="comment">//é»˜è®¤æ˜¯itæ¥ä»£è¡¨ï¼Œå¯ä»¥é€šè¿‡itæ¥è®¿é—®å…¶å…¬æœ‰çš„å±æ€§å’Œæ–¹æ³•</span></span><br><span class="line">it.todo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åœºæ™¯</p><blockquote><p><strong>åœºæ™¯ä¸€:</strong> æœ€å¸¸ç”¨çš„åœºæ™¯å°±æ˜¯ä½¿ç”¨letå‡½æ•°å¤„ç†éœ€è¦é’ˆå¯¹ä¸€ä¸ªå¯nullçš„å¯¹è±¡ç»Ÿä¸€åšåˆ¤ç©ºå¤„ç†ã€‚</p><p><strong>åœºæ™¯äºŒ:</strong> ç„¶åå°±æ˜¯éœ€è¦å»æ˜ç¡®ä¸€ä¸ªå˜é‡æ‰€å¤„ç‰¹å®šçš„ä½œç”¨åŸŸèŒƒå›´å†…å¯ä»¥ä½¿ç”¨ </p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span>?.let &#123;</span><br><span class="line">   it.todo()</span><br><span class="line">   it.todo1()</span><br><span class="line">   it.todo2()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>with</strong></p><p>æ˜¯å°†æŸå¯¹è±¡ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œåœ¨å‡½æ•°å—å†…å¯ä»¥é€šè¿‡ this æŒ‡ä»£è¯¥å¯¹è±¡ã€‚è¿”å›å€¼ä¸ºå‡½æ•°å—çš„æœ€åä¸€è¡Œæˆ–æŒ‡å®šreturnè¡¨è¾¾å¼ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">with(<span class="keyword">object</span>)&#123;</span><br><span class="line">   <span class="comment">//todo</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">ViewHolder</span>, position: <span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">   <span class="keyword">val</span> item = getItem(position)?: <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">   with(item)&#123;</span><br><span class="line">      holder.tvNewsTitle.text = titleEn<span class="comment">//è¿™é‡Œçœç•¥äº†this.(åŸæœ¬ä¸ºthis.titleEn)</span></span><br><span class="line">  holder.tvNewsSummary.text = summary</span><br><span class="line">  holder.tvExtraInf.text = <span class="string">&quot;éš¾åº¦ï¼š<span class="variable">$gradeInfo</span> | å•è¯æ•°ï¼š<span class="variable">$length</span> | è¯»åæ„Ÿ: <span class="variable">$numReviews</span>&quot;</span></span><br><span class="line">       ...   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥ç›´æ¥è°ƒç”¨with(object)çš„å…¬æœ‰å±æ€§</p></blockquote></li><li><p><strong>run</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span>.run&#123;</span><br><span class="line"><span class="comment">//todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>runå¯ä»¥è¯´æ˜¯letå’Œwithçš„ç»“åˆä½“ï¼Œå®ƒæ—¢å¯ä»¥æ–¹ä¾¿è°ƒç”¨ï¼Œåˆä»¥æœ€åä¸€è¡Œä¸ºè¿”å›å€¼(æˆ–æŒ‡å®šçš„returnå€¼)</p></blockquote><p>ä¾‹å­å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">ViewHolder</span>, position: <span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">   </span><br><span class="line">  getItem(position)?.run&#123;</span><br><span class="line">      holder.tvNewsTitle.text = titleEn</span><br><span class="line">  holder.tvNewsSummary.text = summary</span><br><span class="line">       ...   </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæ˜¯å¯¹ä¸Šé¢çš„withè¿›è¡Œæ”¹å˜</p></blockquote></li><li><p><strong>apply</strong> </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span>.apply&#123;</span><br><span class="line"><span class="comment">//todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>apply</strong>å’Œ<strong>run</strong>å¾ˆåƒï¼Œ<strong>run</strong>æ˜¯è¿”å›æœ€åä¸€è¡Œæˆ–è€…æŒ‡å®šè¿”å›ç»“æœã€‚è€Œ<strong>apply</strong>åˆ™æ˜¯å¯¹æœ¬èº«è¿›è¡Œä¿®æ”¹ï¼Œè¿”å›è‡ªå·±</p></blockquote></li><li><p>ä¾‹å­å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user.apply&#123;</span><br><span class="line">    <span class="comment">//è¿™äº›nameéƒ½æ˜¯userä¸­çš„å…¬æœ‰å±æ€§</span></span><br><span class="line">    name = <span class="string">&quot;xxx&quot;</span></span><br><span class="line">    age = <span class="number">10</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>also</strong></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span>.also&#123;</span><br><span class="line"><span class="comment">//todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>also</strong>å’Œ<strong>let</strong>å¾ˆåƒ,<strong>also</strong>æ˜¯è¿”å›å®ƒæœ¬èº«ï¼Œ<strong>let</strong>æ˜¯è¿”å›æœ€åä¸€è¡Œ</p></blockquote><p>ä¾‹å­å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> adapter = DetailAdapter().also &#123;</span><br><span class="line">            binding.userRandomList.layoutManager = LinearLayoutManager(<span class="keyword">this</span>, LinearLayoutManager.HORIZONTAL, <span class="literal">false</span>)</span><br><span class="line">            binding.userRandomList.adapter = it</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li></li></ul><h2 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a><em>é«˜é˜¶å‡½æ•°</em></h2><h2 id="é¡¶å±‚å‡½æ•°"><a href="#é¡¶å±‚å‡½æ•°" class="headerlink" title="é¡¶å±‚å‡½æ•°"></a>é¡¶å±‚å‡½æ•°</h2><p>â€‹    åœ¨Kotlinä¸­ï¼Œå¦‚æœå°†ä¸€ä¸ªå‡½æ•°å†™åœ¨æ–‡ä»¶æºä»£ç çš„æœ€ä¸Šæ–¹ï¼ˆä¹Ÿå°±æ˜¯ä¸å±äºä»»ä½•ä¸€ä¸ªç±»ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯é¡¶å±‚å‡½æ•°</p><ul><li><p>ä»£ç å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.laboratory.anyrandom.util</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">toast</span><span class="params">(msg: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    runOnMainThread &#123;</span><br><span class="line">        Toast.makeText(App.context, msg, Toast.LENGTH_SHORT).show()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">runOnMainThread</span><span class="params">(runnable: <span class="type">Runnable</span>)</span></span> &#123;</span><br><span class="line">    Handler(Looper.getMainLooper()).post(runnable)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<strong>toast</strong>å’Œ<strong>runOnMainThread</strong>å°±æ˜¯é¡¶å±‚å‡½æ•°</p></li><li><p>ä½¿ç”¨</p><blockquote><p>åœ¨Kotlinä¸­ï¼Œé¡¶å±‚å‡½æ•°å±äºåŒ…å†…æˆå‘˜ï¼ŒåŒ…å†…å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ŒåŒ…å¤–åªéœ€è¦importè¯¥é¡¶å±‚å‡½æ•°ï¼Œå³å¯ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toast(<span class="string">&quot;æˆ‘æ˜¯é¡¶å±‚å‡½æ•°&quot;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨åŒä¸€ä¸ªåŒ…ä¸‹å¯ä»¥ç›´æ¥è®¿é—®</p></li></ul><h2 id="é¡¶å±‚å±æ€§"><a href="#é¡¶å±‚å±æ€§" class="headerlink" title="é¡¶å±‚å±æ€§"></a>é¡¶å±‚å±æ€§</h2><p>â€‹    æ—¢ç„¶æœ‰é¡¶å±‚æ–¹æ³•ï¼Œåº”è¯¥ä¹Ÿæœ‰é¡¶å±‚å±æ€§ã€‚å’Œé¡¶å±‚å‡½æ•°ä¸€æ ·ï¼Œå±æ€§ä¹Ÿå¯ä»¥æ”¾åœ¨æ–‡ä»¶çš„é¡¶å±‚ï¼Œä¸é™„å±ä¸ä»»ä½•ä¸€ä¸ªç±»ã€‚è¿™ç§å±æ€§å«é¡¶å±‚å±æ€§ã€‚</p><ul><li><p>ä»£ç å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.laboratory.anyrandom.util</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> topAttributes :<span class="built_in">Int</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure></li><li><p>å’Œé¡¶å±‚å‡½æ•°ç›¸åŒï¼Œæƒ³è¦åœ¨Javaä¸­è¿›è¡Œè®¿é—®ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦åœ¨è·¯å¾„ä¸Šæ–¹å†™ä¸Š(<strong><em>@file:JvmName(â€œä»£è¡¨åå­—â€)</em></strong>)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@file:JvmName</span>(<span class="string">&quot;TopUtils&quot;</span>)</span><br><span class="line"><span class="keyword">package</span> com.laboratory.anyrandom.util</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> topAttributes :<span class="built_in">Int</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨Javaä¸­ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TopUtils.getTopAttributes();</span><br></pre></td></tr></table></figure><p>å½“ç„¶åœ¨Javaæ˜¯é€šè¿‡è®¿é—®å™¨è¿›è¡Œè®¿é—®çš„(ä¹Ÿå°±æ˜¯Get() / Set()æ–¹æ³•)</p></li></ul><h2 id="æ‰©å±•å‡½æ•°"><a href="#æ‰©å±•å‡½æ•°" class="headerlink" title="æ‰©å±•å‡½æ•°"></a>æ‰©å±•å‡½æ•°</h2><p>â€‹    Kotlinå¯ä»¥åœ¨æ— éœ€ç»§æ‰¿çš„æƒ…å†µä¸‹å»æ‰©å±•ä¸€ä¸ªç±»ï¼Œè°ƒç”¨åˆ™åƒæ˜¯å†…éƒ¨å‡½æ•°ä¸€æ ·è°ƒç”¨</p><ul><li><p>ä»£ç å±•ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­æ˜¯å¦æ˜¯ä¸­æ–‡å­—ç¬¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="built_in">Char</span>.<span class="title">isChinese</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> unicodeBlock = Character.UnicodeBlock.of(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">if</span> (unicodeBlock == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS</span><br><span class="line">        || unicodeBlock == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A</span><br><span class="line">    ) <span class="comment">// ä¸­æ—¥éŸ©è±¡å½¢æ–‡å­—</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å£°æ˜ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œæƒ³è¦ä¸€ä¸ªè¢«æ‰©å±•çš„ç›®æ ‡ã€‚ä»¥ä¸Šé¢ä»£ç ä¸ºä¾‹ï¼Œè¿™æ˜¯å¯¹Charçš„æ‰©å±•ï¼Œæ‰©å±•çš„æ–¹æ³•åä¸ºisChineseï¼Œè¿”å›å€¼ä¸ºBooleanç±»å‹</p></blockquote></li><li><p>æ‰©å±•å‡½æ•°åªèƒ½å¯¹Publicå¯¹è±¡è¿›è¡Œæ‰©å±•ï¼Œå¯¹äºPrivateçš„æˆå‘˜æ˜¯æ— æ³•è®¿é—®çš„</p></li><li><p>æ‰©å±•å‡½æ•°å¯ä»¥ä¸é¡¶å±‚å‡½æ•°ä¸€æ ·ï¼Œä¸é¡¶å±‚å‡½æ•°å†™åœ¨åŒä¸ªä½ç½®</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@file:JvmName</span>(<span class="string">&quot;TopUtils&quot;</span>)</span><br><span class="line"><span class="keyword">package</span> com.laboratory.anyrandom.util</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Handler</span><br><span class="line"><span class="keyword">import</span> android.os.Looper</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast</span><br><span class="line"><span class="keyword">import</span> com.laboratory.anyrandom.App</span><br><span class="line"></span><br><span class="line"><span class="comment">//é¡¶å±‚å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">toast</span><span class="params">(msg: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    runOnMainThread &#123;</span><br><span class="line">        Toast.makeText(App.context, msg, Toast.LENGTH_SHORT).show()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">runOnMainThread</span><span class="params">(runnable: <span class="type">Runnable</span>)</span></span> &#123;</span><br><span class="line">    Handler(Looper.getMainLooper()).post(runnable)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰©å±•å‡½æ•°</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­æ˜¯å¦æ˜¯ä¸­æ–‡å­—ç¬¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="built_in">Char</span>.<span class="title">isChinese</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> unicodeBlock = Character.UnicodeBlock.of(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">if</span> (unicodeBlock == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS</span><br><span class="line">        || unicodeBlock == Character.UnicodeBlock.CJK_UNIFIED_IDEOGRAPHS_EXTENSION_A</span><br><span class="line">    ) <span class="comment">// ä¸­æ—¥éŸ©è±¡å½¢æ–‡å­—</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="Lazy"><a href="#Lazy" class="headerlink" title="Lazy"></a>Lazy</h2><ul><li><p>lateinit var: lateinitåªç”¨äºå¯å˜å˜é‡(var xxx)</p></li><li><p>by lazy: lazyåªç”¨äºä¸å¯å˜å˜é‡(val xxx)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> lazyValue: String <span class="keyword">by</span> lazy &#123;</span><br><span class="line">    println(<span class="string">&quot;computed!&quot;</span>)</span><br><span class="line">    <span class="string">&quot;Hello&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//ç¬¬ä¸€æ¬¡è°ƒç”¨</span></span><br><span class="line">  computedï¼</span><br><span class="line">  Hello</span><br><span class="line"><span class="comment">//ç¬¬äºŒæ¬¡</span></span><br><span class="line">  Hello</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>get()</code> ä¼šæ‰§è¡Œå·²ä¼ é€’ç»™ <code>lazy()</code> çš„ lambda è¡¨è¾¾å¼å¹¶è®°å½•ç»“æœï¼Œ åç»­è°ƒç”¨ <code>get()</code> åªæ˜¯è¿”å›è®°å½•çš„ç»“æœã€‚</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> kotlin </tag>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Androidé¢è¯•é¢˜ç¬”è®°</title>
      <link href="2021/02/18/Android%E9%9D%A2%E8%AF%95%E9%A2%98%E7%AC%94%E8%AE%B0/"/>
      <url>2021/02/18/Android%E9%9D%A2%E8%AF%95%E9%A2%98%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>Androidé¢è¯•é¢˜è®°å½•</p><a id="more"></a><h1 id="Androidé¢è¯•é¢˜ç¬”è®°"><a href="#Androidé¢è¯•é¢˜ç¬”è®°" class="headerlink" title="Androidé¢è¯•é¢˜ç¬”è®°"></a>Androidé¢è¯•é¢˜ç¬”è®°</h1><blockquote><p>é¢è¯•é¢˜çš„ç¬”è®°ä¸è‡ªå·±çš„çœ‹æ³•</p></blockquote><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><ol><li><p>æ•°ç»„</p><ul><li><p>æ˜¯ç”±åŒä¸€ç§æ•°æ®ç±»å‹ç»„æˆ</p></li><li><p>å­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜ä¸­</p></li><li><p>å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥æŸ¥æ‰¾æ•°ç»„ä¸­çš„å…ƒç´ åœ°å€</p></li><li><p>é€šå¸¸æœ‰ä¸€ç»´æ•°ç»„ï¼ˆä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¹Ÿæ˜¯æœ€ç®€å•çš„æ•°æ®ç»“æ„ï¼‰ï¼Œå¤šç»´æ•°ç»„</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼š</p><table><thead><tr><th>ç®—æ³•</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td>ç©ºé—´</td><td>O(n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(n)</td></tr><tr><td>æ’å…¥</td><td>O(n)</td></tr><tr><td>åˆ é™¤</td><td>O(n)</td></tr></tbody></table></li></ul></li></ol><ol start="2"><li><p>é“¾è¡¨</p><ul><li><p>é“¾è¡¨æ•´ä½“çœ‹èµ·æ¥æ˜¯ä¸ªæ ‘å‹ï¼Œè€Œä¸æ˜¯æ•°ç»„</p></li><li><p>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…æ‹¬ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªæŒ‡é’ˆ</p></li><li><p>èŠ‚ç‚¹ä¸­çš„æ•°æ®ç±»å‹å¯ä»¥ä¸ºä»»æ„ç±»å‹ </p></li><li><p>æŒ‡é’ˆå°±æ˜¯æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹çš„å¼•ç”¨</p></li><li><p>æ¯ä¸ªé“¾è¡¨éƒ½åŒ…å«ä¸€ä¸ªå¤´èŠ‚ç‚¹å’Œä¸€ä¸ªå°¾èŠ‚ç‚¹</p></li><li><p>å¤´èŠ‚ç‚¹å°±æ˜¯é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚å°¾èŠ‚ç‚¹å°±æ˜¯é“¾è¡¨ä¸­æœ€åä¸€ä¸ªèŠ‚ç‚¹</p></li><li><p>å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹å¹¶ä¸ç›¸è¿ï¼Œå°¾èŠ‚ç‚¹çš„æŒ‡é’ˆä¸‹ä¸€ä¸ªæ˜¯ç»“å°¾ï¼ˆä¹Ÿå°±æ˜¯æŒ‡å‘ç©ºï¼‰ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¾ªç¯æ•°æ®ç»“æ„</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼š</p><table><thead><tr><th>ç®—æ³•</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td>ç©ºé—´</td><td>O(n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(n)</td></tr><tr><td>æ’å…¥</td><td>O(1)</td></tr><tr><td>åˆ é™¤</td><td>O(1)</td></tr></tbody></table></li></ul></li><li><p>åŒå‘é“¾è¡¨</p><ul><li><p>ä¸€ä¸ªåŒå‘é“¾è¡¨é¦–å…ˆæ˜¯ä¸€ä¸ªé“¾è¡¨</p></li><li><p>ä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­æœ‰ä¸€ä¸ªå‰é©±æŒ‡é’ˆå’Œä¸€ä¸ªåç»§æŒ‡é’ˆ</p></li><li><p>å‰é©±æŒ‡é’ˆæ˜¯æŒ‡å‘å‰é©±ç»“ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼‰</p></li><li><p>åç»§æŒ‡é’ˆæ˜¯æŒ‡å‘åç»§ç»“ç‚¹ï¼ˆä¹Ÿå°±æ˜¯åä¸€ä¸ªç»“ç‚¹ï¼‰</p></li><li><p>åœ¨åŒå‘é“¾è¡¨ä¸­ä¹Ÿæœ‰ä¸€ä¸ªå¤´ç»“ç‚¹ï¼Œå¤´ç»“ç‚¹æ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªç»“ç‚¹æŒ‡å‘ç©º</p></li><li><p>å¦‚æœæœ€åä¸€ä¸ªç»“ç‚¹æŒ‡å‘ç¬¬ä¸€ä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆè¿™å°±å˜æˆäº†åŒå‘å¾ªç¯é“¾è¡¨</p></li><li><p>åŒå‘å¾ªç¯é“¾è¡¨å¯ä»¥å¾ˆå®¹æ˜“ä»æ¯ä¸ªç»“ç‚¹æŸ¥æ‰¾åˆ°å®ƒçš„å‰é©±èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼š</p><table><thead><tr><th>ç®—æ³•</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td>ç©ºé—´</td><td>O(n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(n)</td></tr><tr><td>æ’å…¥</td><td>O(1)</td></tr><tr><td>åˆ é™¤</td><td>O(1)</td></tr></tbody></table></li></ul></li><li><p>æ ˆ</p><ul><li><p>æ˜¯ä¸€ä¸ªæœ‰ç€ã€åè¿›å…ˆå‡ºã€‘ç‰¹æ€§çš„æ•°æ®ç»“æ„</p></li><li><p>ä¹Ÿå°±æ˜¯æœ€åè¿›æ ˆçš„å…ƒç´ ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªå‡ºæ ˆçš„å…ƒç´ </p></li><li><p>æƒ³è¦å¾—åˆ°æ ˆä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯æœ€ä¸‹é¢çš„å…ƒç´ ï¼‰ï¼Œå°±å¿…é¡»è¦æŠŠåé¢ï¼ˆä¸Šé¢ï¼‰æ‰€æœ‰çš„å…ƒç´ éƒ½å…ˆå‡ºæ ˆï¼Œæ‰å¯ä»¥å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ </p></li><li><p>å‘æ ˆä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ“ä½œè¢«ç§°ä½œPush(å…¥æ ˆ)</p></li><li><p>ä»æ ˆä¸­å–å‡ºä¸€ä¸ªå…ƒç´ çš„æ“ä½œè¢«ç§°ä¸ºPop(å‡ºæ ˆ)</p></li><li><p>æŸ¥çœ‹ä¸”ä¸åˆ é™¤æ ˆä¸­æœ€åä¸€ä¸ªå…¥æ ˆçš„å…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯æœ€ä¸Šæ–¹çš„å…ƒç´ ï¼‰çš„æ“ä½œè¢«ç§°ä¸ºTop</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼š</p><table><thead><tr><th>ç®—æ³•</th><th>å¹³å‡å¤æ‚åº¦</th></tr></thead><tbody><tr><td>ç©ºé—´</td><td>O(n)</td></tr><tr><td>æŸ¥æ‰¾</td><td>O(n)</td></tr><tr><td>å…¥æ ˆ(Push)</td><td>O(1)</td></tr><tr><td>å‡ºæ ˆ(Pop)</td><td>O(1)</td></tr><tr><td>æŸ¥çœ‹æ ˆé¡¶(Top)</td><td>O(1)</td></tr></tbody></table></li></ul></li><li><p>é˜Ÿåˆ—</p><ul><li></li></ul></li><li></li><li><p>è´ªå©ªç®—æ³•</p><ul><li>è´ªå©ªç®—æ³•ä¹Ÿå°±æ˜¯åœ¨æ±‚è§£ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œåšå‡ºå½“å‰æœ€å¥½çš„è§£å†³ï¼Œè€Œä¸æ˜¯å…¨å±€æœ€å¥½çš„è§£å†³</li><li>è¿™ç§ç®—æ³•çš„å®ç°éƒ½æ˜¯åœ¨æŸä¸€æ–¹é¢ä¸Šå±€éƒ¨æœ€ä¼˜è§£</li><li>è´ªå©ªç®—æ³•ä¹Ÿæ˜¯ä¸å¯å›é€€çš„</li><li>è´ªå©ªç®—æ³•åœ¨æœ€ä¼˜å­ç»“æ„é—®é¢˜ä¸­å°¤ä¸ºæœ‰æ•ˆï¼Œæœ€ä¼˜å­ç»“æ„ä¹Ÿå°±æ˜¯å±€éƒ¨æœ€ä¼˜èƒ½å†³å®šå…¨å±€æœ€ä¼˜ï¼ˆé—®é¢˜èƒ½åˆ†æˆå¤šä¸ªå°é—®é¢˜ï¼Œæ¯ä¸ªå°é—®é¢˜çš„æœ€ä¼˜è§£å†³èƒ½é€’æ¨åˆ°æœ€ç»ˆé—®é¢˜çš„æœ€ä¼˜è§£ï¼‰</li><li>å½“ä¸€ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è´ªå©ªç®—æ³•è§£å†³æ—¶ï¼Œé‚£ä¹ˆè´ªå©ªç®—æ³•ä¸€èˆ¬æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æœ€å¥½è§£å†³åŠæ³•</li></ul></li><li></li></ol><h3 id="Javaæ ¸å¿ƒ"><a href="#Javaæ ¸å¿ƒ" class="headerlink" title="Javaæ ¸å¿ƒ"></a>Javaæ ¸å¿ƒ</h3><ol><li><p>åŸºæœ¬æ•°æ®ç±»å‹</p><ul><li><p>byteï¼ˆæ•°æ®ç±»å‹ä¸º8ä½ï¼Œæœ‰ç¬¦å·ï¼Œä»¥è€Œè¿›ç¨‹è¡¥ç çš„æ•´æ•°ï¼Œé»˜è®¤å€¼æ˜¯â€0â€ï¼‰</p></li><li><p>shortï¼ˆæ•°æ®ç±»å‹ä½16ä½ï¼Œæœ‰ç¬¦å·ï¼Œä»¥äºŒè¿›ç¨‹è¡¥ç çš„æ•´æ•°ï¼Œé»˜è®¤å€¼æ˜¯â€0â€ï¼‰</p></li><li><p>intï¼ˆæ•°æ®ç±»å‹ä¸º32ä½ï¼Œæœ‰ç¬¦å·ï¼Œä»¥äºŒè¿›ç¨‹è¡¥ç è¡¨ç¤ºçš„æ•´æ•°ï¼Œé»˜è®¤å€¼æ˜¯â€0â€ï¼‰</p></li><li><p>longï¼ˆæ•°æ®ç±»å‹ä¸º64ä½ï¼Œæœ‰ç¬¦å·ï¼Œä»¥äºŒè¿›ç¨‹è¡¥ç çš„æ•´æ•°ï¼Œé»˜è®¤å€¼æ˜¯â€0Lâ€(Læ˜¯ä¸åŒºåˆ†å¤§å°å†™ï¼Œä¸ºäº†ä¹¦å†™è§„èŒƒï¼Œæœ€å¥½å†™æˆå¤§å†™)ï¼‰</p></li><li><p>floatï¼ˆæ•°æ®ç±»å‹ä¸ºå•ç²¾åº¦ï¼Œ32ä½çš„æµ®ç‚¹æ•°ï¼Œé»˜è®¤å€¼æ˜¯â€0fâ€ï¼‰</p></li><li><p>doubleï¼ˆæ•°æ®ç±»å‹ä¸ºåŒç²¾åº¦ï¼Œ64ä½çš„æµ®ç‚¹æ•°ï¼Œé»˜è®¤å€¼æ˜¯â€0dâ€ï¼‰</p></li><li><p>booleanï¼ˆæ•°æ®ç±»å‹ä¸ºè¡¨ç¤ºä¸€ä½çš„ä¿¡æ¯ï¼Œé»˜è®¤å€¼åªæœ‰ä¸¤ç§â€trueâ€,â€falseâ€ï¼‰</p></li><li><p>charï¼ˆæ•°æ®ç±»å‹ä¸ºä¸€ä¸ªå•ä¸€çš„16ä½Unicodeå­—ç¬¦ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„å­—ç¬¦ï¼‰</p><blockquote><p>Unicodeæ˜¯å…¨çƒç»Ÿä¸€çš„å­—ç¬¦ç¼–ç </p></blockquote></li></ul></li><li><p>æŠ½è±¡ç±»çš„æ¦‚å¿µ</p><ul><li>åœ¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç”¨ç±»æ¥æè¿°ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»éƒ½æ˜¯æ¥æè¿°å¯¹è±¡çš„ï¼Œå½“ä¸€ä¸ªç±»æ²¡æœ‰è¶³å¤Ÿå¤šçš„ä¿¡æ¯æ¥æç»˜ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»</li></ul></li><li><p>æŠ½è±¡çš„æ¦‚å¿µ</p><ul><li></li></ul></li><li><p>ç»§æ‰¿</p><ul><li>ç»§æ‰¿å¯ä»¥ä½¿å­ç±»åˆ«å…·æœ‰çˆ¶ç±»åˆ«çš„å„ç§å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸éœ€è¦å»åœ¨é‡å¤ç¼–å†™ç›¸åŒä»£ç ã€‚å­ç±»åœ¨ç»§æ‰¿çˆ¶ç±»çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å»é‡æ–°å®šä¹‰æŸäº›å±æ€§ï¼Œå¹¶é‡å†™æŸäº›æ–¹æ³•ï¼Œæ¥è¦†ç›–çˆ¶ç±»åˆ«çš„åŸæœ‰å±æ€§å’Œæ–¹æ³•ï¼Œä½¿è·å–å’Œçˆ¶ç±»åˆ«ä¸åŒçš„åŠŸèƒ½ã€‚å½“é‡åˆ°éœ€è¦å¤šé‡ç»§æ‰¿çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å®ç°æ¥å£æ¥å®ç°å¤šç»§æ‰¿ç›¸ä¼¼çš„æ•ˆæœ</li></ul></li><li><p>å°è£…</p><ul><li>ä»å­—é¢æ„æ€ä¸Šæ¥è®²å°±æ˜¯åŒ…è£…çš„æ„æ€ï¼Œæ˜¯æŒ‡åˆ©ç”¨æŠ½è±¡æ•°æ®ç±»å‹ï¼Œå°†æ•°æ®å’Œæœ‰å…³æ•°æ®æ“ä½œéƒ½å°è£…èµ·æ¥ï¼Œä½¿å®ƒå˜æˆä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç‹¬ç«‹ä½“ã€‚ç”¨æˆ·ä¸çŸ¥é“å¯¹è±¡å†…éƒ¨çš„ç»†èŠ‚ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡æä¾›çš„æ¥å£æ¥è¿›è¡Œè®¿é—®å¯¹è±¡ã€‚å¥½å¤„æ˜¯ï¼šå‡å°‘è€¦åˆæ€§ï¼Œæ–¹ä¾¿æœªæ¥ä¿®æ”¹</li></ul></li><li><p>å¤šæ€</p><ul><li>å¤šæ€å°±æ˜¯æŒ‡ä¸€ä¸ªè¡Œä¸ºæœ‰å¤šä¸ªä¸åŒçš„è¡¨ç°å½¢å¼æˆ–å½¢æ€çš„èƒ½åŠ›ã€‚å¤šæ€å°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨ä¸åŒçš„å®ä¾‹è€Œæ‰§è¡Œä¸åŒçš„æ“ä½œï¼ˆæ¯”å¦‚è¯´å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œå®ƒæœ‰ä¸¤ä¸ªä¸åŒçš„å®ä¾‹å¯¹è±¡ï¼Œä½¿ç”¨ä¸åŒçš„å®ä¾‹åŒ–å°±å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•ˆæœï¼‰</li></ul></li><li><p>é¢å‘å¯¹è±¡çš„ä¸‰ä¸ªåŸºæœ¬å…ƒç´ å’Œäº”ä¸ªåŸåˆ™</p><ol><li>å…ƒç´ <ul><li>ç»§æ‰¿</li><li>å¤šæ€</li><li>å°è£…</li></ul></li><li>åŸåˆ™<ul><li>å•ä¸€èŒè´£</li><li>å¼€é—­åŸåˆ™</li><li>é‡Œæ°æ›¿æ¢</li><li>ä¾èµ–å€’ç½®</li><li>æ¥å£éš”ç¦»</li></ul></li></ol></li><li><p>ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ</p><ol><li>è¿›ç¨‹<ul><li>è¿›ç¨‹å°±æ˜¯ç¨‹åºä¸€æ¬¡è¿è¡Œçš„è¿‡ç¨‹ï¼Œæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚åœ¨javaä¸­ï¼Œå½“æˆ‘ä»¬è¿è¡Œmainå‡½æ•°ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¼€å¯äº†ä¸€ä¸ªJVMè¿›ç¨‹</li></ul></li><li>çº¿ç¨‹<ul><li>çº¿ç¨‹äºè¿›ç¨‹ç±»ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¿›ç¨‹æ›´å°çš„æ‰§è¡Œå•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ã€‚å½“è¿è¡Œmainå‡½æ•°æ—¶ï¼Œmainå‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹</li></ul></li></ol></li><li><p>JDK &amp; JVM &amp; JREåˆ†åˆ«æ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬çš„åŒºåˆ«ï¼Ÿ</p><ol><li><p>JDK</p><ul><li>JDKæ˜¯æ•´ä¸ªJAVAå¼€å‘çš„æ ¸å¿ƒï¼Œæ˜¯é¢å‘å¼€å‘è€…ä½¿ç”¨çš„SDKï¼Œå®ƒæä¾›äº†JAVAçš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒ</li></ul></li><li><p>JRE</p><ul><li>JREå°±æ˜¯è¿è¡Œæ—¶ç¯å¢ƒï¼ˆå®ƒä¸»è¦åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒJVMçš„æ ‡å‡†å®ç°ï¼ŒJAVAçš„ä¸€äº›åŸºæœ¬ç±»åº“ï¼‰</li></ul></li><li><p>JVM</p><ul><li>JVMæ˜¯JAVAè™šæ‹Ÿæœºï¼Œä¹Ÿå°±æ˜¯å› ä¸ºå®ƒï¼Œæ‰€ä»¥JAVAæ‰æ‹¥æœ‰è·¨å¹³å°æ€§</li></ul></li><li><p>åŒºåˆ«</p><ul><li><p>å®ƒä»¬ä¸‰è€…çš„å…³ç³»ä¸ºï¼šJDKåŒ…å«JREåŒ…å«JVM</p><p><img src="https://i.loli.net/2021/02/16/QnCLmVgM7TbdjD2.png" alt="image-20210216113540235"></p></li></ul></li></ol></li><li><p>ä»€ä¹ˆæ˜¯é¢å‘è¿‡ç¨‹ &amp; ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ &amp; åŒºåˆ«ï¼Ÿ</p><ol><li><p>é¢å‘å¯¹è±¡</p><ul><li>é¢å‘å¯¹è±¡æ˜¯ä¸€ç§å¯¹<strong>ç°å®ä¸–ç•Œç†è§£å’ŒæŠ½è±¡</strong>çš„æ–¹æ³•</li></ul></li><li><p>é¢å‘è¿‡ç¨‹</p></li></ol></li></ol><ul><li>æ˜¯ä¸€ç§ <strong>ä»¥è¿‡ç¨‹ä¸ºä¸­å¿ƒ</strong> çš„ç¼–ç¨‹æ€æƒ³ã€‚è¿™äº›éƒ½æ˜¯ä»¥ä»€ä¹ˆæ­£åœ¨å‘ç”Ÿä¸ºä¸»è¦ç›®æ ‡è¿›è¡Œç¼–ç¨‹ï¼Œä¸åŒäºé¢å‘å¯¹è±¡çš„æ˜¯è°åœ¨å—å½±å“ã€‚æ¯ä¸ªè¿‡ç¨‹æœ‰ä¸€ä¸ªé˜¶æ®µæ€§çš„ç›®æ ‡ï¼Œä¾æ¬¡å®Œæˆè¿™äº›è¿‡ç¨‹ï¼Œæ‰èƒ½å¾—åˆ°ç»“æœ</li></ul><ol start="11"><li><p>ç»™æˆ‘è¯´è¯´Javaé¢å‘å¯¹è±¡çš„ç‰¹å¾</p><ol><li>ç‰¹ç‚¹<ul><li>å¯¹è±¡å…·æœ‰å±æ€§å’Œè¡Œä¸º</li><li>å¯¹è±¡å…·æœ‰å˜åŒ–å’Œå½¢æ€</li><li>å¯¹è±¡å…·æœ‰å”¯ä¸€æ€§</li><li>å¯¹è±¡éƒ½æ˜¯æŸä¸ªç±»åˆ«çš„å®ä¾‹</li><li>ä¸€åˆ‡çš†ä¸ºå¯¹è±¡ï¼ŒçœŸå®ä¸–ç•Œä¸­çš„æ‰€æœ‰äº‹ç‰©éƒ½å¯ä»¥è§†ä¸ºå¯¹è±¡</li></ul></li><li>ä¸‰å¤§åŸºæœ¬ç‰¹å¾<ul><li>ç»§æ‰¿</li><li>å¤šæ€</li><li>å°è£…</li></ul></li></ol></li><li><p>ä»€ä¹ˆæ˜¯é‡è½½ &amp; ä»€ä¹ˆæ˜¯é‡å†™ &amp; åŒºåˆ«</p><ol><li><p>é‡è½½</p><ul><li>é‡è½½å°±æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œæ–¹æ³•åç›¸åŒï¼Œè€Œå‚æ•°ä¸åŒï¼Œè¿”å›ç±»å‹å¯ä»¥ç›¸åŒï¼Œä¹Ÿå¯ä»¥ä¸ç›¸åŒ</li></ul></li><li><p>é‡å†™</p><ul><li>é‡å†™æ˜¯æŒ‡åœ¨æ–¹æ³•åç›¸åŒæ—¶ï¼Œå‚æ•°ä¹Ÿç›¸åŒï¼Œè¿”å›ç±»å‹ä¹Ÿç›¸åŒï¼Œä½†æ–¹æ³•å†…éƒ¨å®ç°æ“ä½œä¸åŒï¼ˆä¸€èˆ¬è¡¨ç¤ºå­ç±»ä¸çˆ¶ç±»ä¹‹é—´çš„å…³ç³»ï¼‰</li></ul></li><li><p>åŒºåˆ«</p><table><thead><tr><th>åŒºåˆ«ç‚¹</th><th>é‡è½½æ–¹æ³•</th><th>é‡å†™æ–¹æ³•</th></tr></thead><tbody><tr><td>å‚æ•°åˆ—è¡¨</td><td>å¿…é¡»ä¿®æ”¹</td><td>ä¸€å®šä¸èƒ½ä¿®æ”¹</td></tr><tr><td>è¿”å›ç±»å‹</td><td>å¿…é¡»ä¿®æ”¹</td><td>ä¸€å®šä¸èƒ½ä¿®æ”¹</td></tr><tr><td>è®¿é—®ä¿®é¥°ç¬¦</td><td>ä¸èƒ½æ¯”çˆ¶ç±»æ›´ä¸¥æ ¼</td><td>ä¸€å®šä¸èƒ½ä¿®æ”¹</td></tr><tr><td>æ–¹æ³•å</td><td>ä¸€è‡´</td><td>ä¸€è‡´</td></tr><tr><td>å¼‚å¸¸</td><td>å¯ä»¥ä¿®æ”¹</td><td>å¯ä»¥å‡å°‘æˆ–åˆ é™¤ï¼Œä¸€å®šä¸èƒ½æŠ›å‡ºæ–°çš„æˆ–è€…æ›´</td></tr><tr><td>è®¿é—®</td><td>å¯ä»¥ä¿®æ”¹</td><td>ä¸€å®šä¸èƒ½åšæ›´ä¸¥æ ¼çš„é™åˆ¶ï¼ˆå¯ä»¥é™ä½é™åˆ¶ï¼‰</td></tr></tbody></table></li></ol></li><li><p>è°ˆè°ˆä½ å¯¹thiså’Œsuperçš„è®¤è¯†</p><ol><li>this<ul><li>thiså°±æ˜¯æŒ‡å½“å‰æ–¹æ³•çš„è°ƒç”¨è€…ï¼ˆä¹Ÿå°±æ˜¯æŒ‡å½“å‰ä½¿ç”¨çš„å¯¹è±¡ï¼‰</li></ul></li><li>super<ul><li>superåªæ˜¯ç¼–è¯‘æœŸä¸­çš„ä¸€ä¸ªæŒ‡ç¤ºç¬¦ï¼ˆä¹Ÿå°±æ˜¯è¢«çœ‹ä½œæ˜¯è°ƒç”¨çˆ¶ç±»ä¸­è¢«é‡å†™çš„æ–¹æ³•ï¼Œä½†å®é™…ä¸Šè°ƒç”¨è€…è¿˜æ˜¯å­ç±»å¯¹è±¡ï¼‰</li></ul></li></ol></li><li><p>æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«</p><ol><li>æ¥å£<ul><li>æ¥å£æ˜¯å…¬å¼€çš„ï¼Œä¸èƒ½æœ‰ç§æœ‰çš„å˜é‡å’Œæ–¹æ³•ï¼Œæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½<strong>æ²¡æœ‰æ–¹æ³•ä½“</strong>ï¼Œé€šè¿‡å…³é”®å­—<strong>interface</strong>å®ç°ã€‚æ¥å£ä¹Ÿå¯ä»¥è¢«çœ‹åšæŠ½è±¡ç±»çš„å˜ä½“ï¼Œæ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯æŠ½è±¡çš„ï¼Œå¯ä»¥é€šè¿‡æ¥å£æ¥å®ç°å¤šé‡ç»§æ‰¿</li></ul></li><li>æŠ½è±¡ç±»<ul><li>æŠ½è±¡ç±»å¯ä»¥æ‹¥æœ‰ç§æœ‰çš„æ–¹æ³•å’Œå˜é‡ï¼Œé€šè¿‡<strong>abstract</strong>æ¥å£°æ˜ä¸€ä¸ªç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¢«å£°æ˜ä¸ºæŠ½è±¡æ–¹æ³•<strong>ä¸èƒ½åŒ…å«æ–¹æ³•ä½“</strong>ã€‚æŠ½è±¡ç±»çš„å­ç±»ä¸ºçˆ¶ç±»ä¸­<strong>æ‰€æœ‰æŠ½è±¡æ–¹æ³•çš„å…·ä½“å®ç°</strong>ï¼Œå¦åˆ™ä¹Ÿæ˜¯æŠ½è±¡ç±»</li></ul></li><li>ç›¸åŒç‚¹<ul><li>éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–</li><li>æ¥å£çš„å®ç°ç±»æˆ–è€…æŠ½è±¡ç±»çš„å­ç±»éƒ½åªæœ‰å®ç°äº†<strong>æ¥å£æˆ–è€…æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•</strong>åæ‰èƒ½å®ä¾‹åŒ–</li></ul></li><li>ä¸åŒç‚¹<ul><li>æ¥å£åªèƒ½å®šä¹‰ï¼Œä¸èƒ½æœ‰æ–¹æ³•çš„å®ç°ã€‚æŠ½è±¡ç±»å¯ä»¥å®šä¹‰ä¹Ÿå¯ä»¥å®ç°æ–¹æ³•</li><li>å®ç°æ¥å£çš„å…³é”®å­—ä¸ºimplementsï¼Œç»§æ‰¿æŠ½è±¡ç±»çš„å…³é”®å­—ä¸ºextendsã€‚ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»</li><li>æ¥å£å¼ºè°ƒç‰¹å®šåŠŸèƒ½çš„å®ç°ï¼ŒæŠ½è±¡ç±»å¼ºè°ƒæ‰€å±å…³ç³»</li></ul></li></ol></li><li><p>ç»™æˆ‘è¯´è¯´æƒé™ä¿®é¥°ç¬¦ç‰¹æ€§</p><ol><li>public å…¬å¼€çš„</li><li>private ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå¤–éƒ¨æ²¡æœ‰è®¿é—®æƒ</li><li>protected ç»§æ‰¿æƒé™ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»åï¼Œå­ç±»æœ‰æƒé™è®¿é—®çˆ¶ç±»ï¼Œåœ¨ä¸åŒçš„åŒ…ä¸‹éƒ½å¯ä»¥è®¿é—®</li><li>default é»˜è®¤è®¿é—®æƒé™ï¼Œåœ¨åŒä¸ªåŒ…ä¸‹éƒ½å¯ä»¥è®¿é—®</li></ol></li><li><p>ç»™æˆ‘è°ˆè°ˆJavaä¸­çš„å†…éƒ¨ç±»</p><blockquote><p>åœ¨Javaä¸­å…è®¸åœ¨ç±»çš„å†…éƒ¨åœ¨åˆ›å»ºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªå®šä¹‰åœ¨ç±»å†…éƒ¨çš„ç±»å°±è¢«ç§°ä½œå†…éƒ¨ç±»ï¼ŒåŒ…å«å†…éƒ¨ç±»çš„ç±»å°±è¢«ç§°ä½œå¤–éƒ¨ç±»ã€‚å†…éƒ¨ç±»å¯ä»¥æ–¹ä¾¿çš„è®¿é—®å¤–éƒ¨ç±»ç§æœ‰å±æ€§å’Œæ–¹æ³•</p></blockquote><ol><li><p>é™æ€å†…éƒ¨ç±»</p><ul><li><p>å®šä¹‰æ–¹å¼ä¸º static classã€‚é™æ€å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯ä¸å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticOutter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer outterNum = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">outStatic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;run out static&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticInner</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStaticInner</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è°ƒç”¨å¤–éƒ¨ç±»çš„é™æ€æ–¹æ³•&quot;</span>);</span><br><span class="line">            outStatic();</span><br><span class="line">            System.out.println(<span class="string">&quot;è°ƒç”¨å¤–éƒ¨ç±»çš„é™æ€å±æ€§&quot;</span>);</span><br><span class="line">            System.out.println(outterNum);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æˆå‘˜å†…éƒ¨ç±»</p><ul><li><p>å®šä¹‰æ–¹å¼ä¸º classã€‚æˆå‘˜å†…éƒ¨ç±»é™¤äº†å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œè¿˜å¯ä»¥è®¿é—®å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œä½†ä¸å¯ä»¥å®šä¹‰é™æ€å˜é‡å’Œé™æ€æ–¹æ³•ã€‚è¿™é‡Œå¯ä»¥å§æˆå‘˜å†…éƒ¨ç±»çœ‹ä½œä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„<strong>å®ä¾‹æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer outterNum = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">outterMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¿è¡Œå¤–éƒ¨æ–¹æ³•......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">innerMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;outterNum:&quot;</span>+outterNum);</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿è¡Œoutterçš„æ–¹æ³•&quot;</span>);</span><br><span class="line">            outterMethod();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ–¹æ³•å†…éƒ¨ç±»</p><ul><li><p>å®šä¹‰æ–¹å¼ä¸º classã€‚æ–¹æ³•å†…éƒ¨ç±»å°±æ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰çš„ä¸€ä¸ªç±»ï¼Œæ–¹æ³•å†…éƒ¨ç±»åªèƒ½åœ¨å®šä¹‰çš„æ–¹æ³•ä¸­ä½¿ç”¨ã€‚æ–¹æ³•å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è°ƒç”¨å®šä¹‰æ–¹æ³•çš„å‚æ•°å’Œæ–¹æ³•å†…éƒ¨çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨å¤–éƒ¨ç±»ä¸­çš„é™æ€å±æ€§å’Œæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodOutter</span> </span>&#123;</span><br><span class="line">     <span class="keyword">private</span> Integer outter = <span class="number">10</span>;</span><br><span class="line">     </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethod</span><span class="params">(Integer param)</span></span>&#123;</span><br><span class="line">         String local = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">         <span class="class"><span class="keyword">class</span> <span class="title">MethodInner</span></span>&#123;</span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">innerMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">                 System.out.println(<span class="string">&quot;MethodOutter outter:&quot;</span>+outter);</span><br><span class="line">                 System.out.println(<span class="string">&quot;param:&quot;</span>+param);</span><br><span class="line">                 System.out.println(<span class="string">&quot;local:&quot;</span>+local);</span><br><span class="line">             &#125;</span><br><span class="line">             </span><br><span class="line">         &#125;</span><br><span class="line">         MethodInner inner = <span class="keyword">new</span> MethodInner();</span><br><span class="line">         inner.innerMethod();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">         MethodOutter out = <span class="keyword">new</span> MethodOutter();</span><br><span class="line">         out.testMethod(<span class="number">1</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li><li><p>åŒ¿åå†…éƒ¨ç±»</p><ul><li><p>åŒ¿åå†…éƒ¨ç±»åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œå®ƒæ²¡æœ‰åå­—ï¼Œæ²¡æœ‰æ„é€ æ–¹æ³•ï¼Œä½†å®ƒå¯ä»¥æ ¹æ®å‚æ•°è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚å’Œæ–¹æ³•å†…éƒ¨ç±»ä¸€æ ·ï¼ŒåŒ¿åå†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è®¿é—®å±€éƒ¨å˜é‡å’Œå‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TestInteface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String param)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnonymousTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">new</span> TestInteface() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(String param)</span> </span>&#123;</span><br><span class="line">                System.out.println(param);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol></li><li><p>ä»€ä¹ˆæ˜¯æ‹†ç®± &amp; è£…ç®±ï¼Œèƒ½ç»™æˆ‘ä¸¾æ —å­å—ï¼Ÿ</p><ol><li><p>Javaä¸­åŸºç¡€æ•°æ®ç±»å‹ä¸å®ƒä»¬çš„åŒ…è£…ç±»è¿›è¡Œè¿ç®—æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢è¿‡ç¨‹å¯¹ç¨‹åºå‘˜æ˜¯é€æ˜çš„ï¼Œè¿™å°±æ˜¯è£…ç®±å’Œæ‹†ç®±ï¼Œè£…ç®±å’Œæ‹†ç®±å¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç æ›´ç®€æ´æ˜“æ‡‚</p></li><li><p>åœ¨é‚£äº›æƒ…å†µä¸‹ä¼šè¿›è¡Œæ“ä½œ</p><ul><li>è¿›è¡Œâ€˜=â€™èµ‹å€¼æ“ä½œï¼ˆè£…ç®±æˆ–æ‹†ç®±ï¼‰</li><li>è¿›è¡Œâ€™ + , - , * , / â€˜æ··åˆè¿ç®—ï¼ˆæ‹†ç®±ï¼‰</li><li>è¿›è¡Œâ€™ &gt; , &lt; , ==â€™æ¯”è¾ƒè¿ç®—ï¼ˆæ‹†ç®±ï¼‰</li><li>è¿›è¡Œâ€™equalsâ€™è¿›è¡Œæ¯”è¾ƒï¼ˆè£…ç®±ï¼‰</li></ul></li><li><p>ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAutoBox</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Float&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">1.0f</span>);</span><br><span class="line">    <span class="keyword">float</span> firstElement = list.get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬äºŒè¡Œä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå­˜æ”¾Floatç±»å‹çš„Listï¼Œç„¶åå¾€é‡Œæ·»åŠ 1.0f(floatåŸºç¡€ç±»å‹)ï¼Œåœ¨å°†ç»“æœè¿”å›ç»™floatï¼ˆè¿™é‡ŒListå–å‡ºçš„ç»“æœæ˜¯ä¸ºFloatï¼‰</p><p>æ‰€ä»¥ç»“æœå¾ˆæ˜æ˜¾äº†ï¼Œä»¥floatå’ŒFloatä¸ºä¾‹ï¼Œè£…ç®±å°±æ˜¯è°ƒç”¨Floatçš„<strong>valueOf</strong>æ–¹æ³•newä¸€ä¸ªFloatå¹¶èµ‹å€¼ï¼Œæ‹†ç®±å°±æ˜¯è°ƒç”¨Floatå¯¹è±¡çš„<strong>floatValue</strong>æ–¹æ³•å¹¶èµ‹å€¼è¿”å›ç»™floatã€‚å…¶ä»–åŸºç¡€ç±»å‹éƒ½æ˜¯å¤§åŒå°å¼‚çš„ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹æºç ã€‚</p></li></ol></li><li><p>staticå…³é”®å­—çš„ä½œç”¨ï¼Ÿ</p><p>åœ¨Javaä¸­ä¸»è¦æœ‰3ç§ä½¿ç”¨æƒ…å†µ</p><ol><li><p>staticæˆå‘˜å˜é‡</p><blockquote><p>ï¼ˆJavaç±»æä¾›äº†ä¸¤ç§ç±»å‹çš„å˜é‡ï¼šç”¨staticå…³é”®å­—ä¿®é¥°çš„é™æ€å˜é‡å’Œä¸ç”¨staticå…³é”®å­—ä¿®é¥°çš„å®ä¾‹å˜é‡ï¼‰</p></blockquote><ul><li>é™æ€å˜é‡å±äºç±»ï¼Œåœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå¤åˆ¶ï¼Œåªè¦é™æ€å˜é‡æ‰€åœ¨çš„ç±»è¢«åŠ è½½ï¼Œè¿™ä¸ªé™æ€å˜é‡å°±ä¼šè¢«åˆ†é…ç©ºé—´ï¼Œå› æ­¤å°±å¯ä»¥è¢«ä½¿ç”¨äº†ã€‚å¯¹é™æ€å˜é‡çš„å¼•ç”¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯â€œç±».é™æ€å˜é‡â€å’Œâ€å¯¹è±¡.é™æ€å˜é‡â€</li><li>å®ä¾‹å˜é‡å±äºå¯¹è±¡ï¼Œåªæœ‰å¯¹è±¡è¢«åˆ›å»ºåï¼Œå®ä¾‹å˜é‡æ‰ä¼šè¢«åˆ†é…å†…å­˜ç©ºé—´ï¼Œæ‰èƒ½è¢«ä½¿ç”¨ï¼Œå®ƒåœ¨å†…å­˜ä¸­å­˜åœ¨å¤šä¸ªå¤åˆ¶ï¼Œåªæœ‰ç”¨â€œå¯¹è±¡.å®ä¾‹å˜é‡â€çš„æ–¹å¼æ¥å¼•ç”¨</li></ul></li><li><p>staticæˆå‘˜æ–¹æ³•</p><blockquote><p>Javaä¸­æä¾›äº†staticæ–¹æ³•å’Œéstaticæ–¹æ³•</p></blockquote><ul><li>staticæ–¹æ³•æ˜¯ç±»çš„æ–¹æ³•ï¼Œä¸éœ€è¦åˆ›å»ºå¯¹è±¡å°±å¯ä»¥è¢«è°ƒç”¨</li><li>è€Œéstaticæ–¹æ³•æ˜¯å¯¹è±¡çš„æ–¹æ³•ï¼Œåªæœ‰å¯¹è±¡è¢«åˆ›å»ºå‡ºæ¥åæ‰å¯ä»¥è¢«ä½¿ç”¨ï¼ˆstaticæ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨thiså’Œsuperå…³é”®å­—ï¼Œä¸èƒ½è°ƒç”¨éstaticæ–¹æ³•ï¼‰</li></ul></li><li><p>staticä»£ç å—</p><ul><li>staticä»£ç å—åœ¨ç±»ä¸­æ˜¯ç‹¬ç«‹äºæˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°çš„ä»£ç å—çš„ã€‚æ³¨æ„ï¼š è¿™äº›staticä»£ç å—åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡</li></ul></li></ol></li><li><p>finalå…³é”®å­—çš„ä½œç”¨</p><ul><li></li></ul></li><li><p>è¯´è¯´Javaå¼‚å¸¸ä½“ç³»ä¸»è¦ç”¨æ¥å¹²ä»€ä¹ˆçš„ &amp; å¼‚å¸¸ä½“ç³»ï¼Ÿ</p><ul><li></li></ul></li><li><p>Errorå’ŒExceptionçš„åŒºåˆ«ï¼Ÿ</p><ul><li></li></ul></li><li><p>è¯´è¯´è¿è¡Œæ—¶å¼‚å¸¸å’Œéè¿è¡Œæ—¶å¼‚å¸¸çš„åŒºåˆ«ï¼Ÿ</p><ul><li></li></ul></li><li><p>å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ï¼Ÿ</p><ul><li></li></ul></li><li><p>5ä¸ªå¸¸è§çš„è¿è¡Œæ—¶å¼‚å¸¸</p><ul><li></li></ul></li><li><p>è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„åŒºåˆ«ï¼Ÿ</p><ul><li>è½¯å¼•ç”¨å…³è”çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œè€Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åœ¨JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶æ€»ä¼šè¢«å›æ”¶ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ å¼±å¼•ç”¨åœ¨æ¯æ¬¡è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™éƒ½ä¼šè¢«å›æ”¶ï¼Œè½¯å¼•ç”¨åªä¼šåœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™å›æ”¶ï¼‰</li></ul></li><li><p>Socketçš„å®šä¹‰</p><ul><li>å³å¥—æ¥å­—ï¼Œ<strong>æ˜¯åº”ç”¨å±‚ ä¸ <code>TCP/IP</code> åè®®æ—é€šä¿¡çš„ä¸­é—´è½¯ä»¶æŠ½è±¡å±‚ï¼Œè¡¨ç°ä¸ºä¸€ä¸ªå°è£…äº† TCP / IPåè®®æ— çš„ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰</strong></li></ul></li><li><p>ç»™æˆ‘è¯´è¯´çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</p></li><li><p>çº¿ç¨‹æ­»é”çš„åŸå›  &amp; ä¸¾ä¸ªæ —å­ &amp; å¦‚ä½•é¿å…æ­»é”</p></li><li><p>å¦‚ä½•åœæ­¢æ‰ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ</p></li><li><p>wait()å’Œsleep()çš„åŒºåˆ«ï¼Ÿ</p></li><li><p>Javaä¸­åˆ›å»ºçº¿ç¨‹çš„2ç§æ–¹å¼ &amp; åŒºåˆ«ï¼Ÿ</p></li><li><p><code>StringBuffer</code> å’Œ<code>StringBuilder</code> çš„åŒºåˆ«åœ¨å“ªé‡Œ?</p><p>StringBufferå’ŒStringBuilderå’ŒStringåŸºæœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç”¨æ¥å­˜æ”¾å­—ç¬¦ä¸²çš„ã€‚</p><ul><li>stringï¼šä½†stringæ˜¯ä¸å¯å˜çš„ï¼Œä»»ä½•å¯¹stringçš„æ”¹å˜éƒ½ä¼šé‡æ–°åˆ›å»ºæ–°çš„stringï¼Œè€ŒStringBufferå’ŒStringBuilderæ˜¯å¯å˜çš„çš„</li><li>StringBufferï¼šåŒºåˆ«åœ¨StringBufferæ”¯æŒå¹¶å‘æ“ä½œï¼Œæ˜¯çº¿æ€§å®‰å…¨çš„ï¼Œé€‚åˆåœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ã€‚</li><li>StringBuilderï¼šä¸æ”¯æŒå¹¶å‘æ“ä½œï¼Œçº¿æ€§ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥ä¸åˆé€‚åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œä½†StringBuilderåœ¨å•çº¿ç¨‹ä¸­æ€§èƒ½æ¯”StringBufferæ›´é«˜</li></ul></li><li></li></ol><h3 id="Androidæ ¸å¿ƒ"><a href="#Androidæ ¸å¿ƒ" class="headerlink" title="Androidæ ¸å¿ƒ"></a>Androidæ ¸å¿ƒ</h3><ol><li><p>Activityç”Ÿå‘½å‘¨æœŸï¼ˆå…·ä½“å¯ä»¥å»Activityçš„è®²è§£é‡ŒæŸ¥çœ‹ï¼‰</p><ul><li>onCreate(åœ¨æ´»åŠ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œè§¦å‘è¯¥æ–¹æ³•)</li><li>onStart(è¯¥æ–¹æ³•è¡¨ç¤ºæ´»åŠ¨å°†è¢«å±•ç°ç»™ç”¨æˆ·)</li><li>onResumeï¼ˆè¯¥æ–¹æ³•è¡¨ç¤ºæ´»åŠ¨å‡†å¤‡å¥½ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼‰</li><li>onPauseï¼ˆè¯¥æ–¹æ³•è¡¨ç¤ºæ´»åŠ¨å› ä¸ºå…¶ä»–åŸå› ï¼Œè¢«å…¶ä»–Activityï¼Œå…¨å±çš„Dialogè¦†ç›–ï¼‰</li><li>onStopï¼ˆè¯¥æ–¹æ³•è¡¨ç¤ºæ´»åŠ¨ä¸åœ¨æƒ³è¦å±•ç¤ºç»™ç”¨æˆ·ï¼Œå¦‚æœå†…å­˜ä¸è¶³åˆ™ä¼šè¿›è¡Œå›æ”¶ï¼‰</li><li>onRestart ï¼ˆè¯¥æ–¹æ³•è¡¨ç¤ºæ´»åŠ¨ä»åœæ­¢çŠ¶æ€å†æ¬¡æƒ³è¦å±•ç¤ºç»™ç”¨æˆ·ï¼‰</li><li>onDestoryï¼ˆè¯¥æ–¹æ³•è¡¨ç¤ºæ´»åŠ¨è¢«é”€æ¯ï¼Œå¯èƒ½ä¼šæœ‰ä¸€å®šå»¶è¿Ÿæ‰ä¼šè¢«å›æ”¶ï¼‰</li></ul></li><li><p>Androidå››å¤§ç»„ä»¶</p><ul><li>æ´»åŠ¨ Activityï¼ˆæ˜¯æ‰€æœ‰ç¨‹åºçš„æ ¹æœ¬ï¼‰</li><li>æœåŠ¡ Serviceï¼ˆAndroidç»„ä»¶ä¸­çš„ä¸€ç§ï¼Œä¸å¯ä»¥è‡ªå·±è¿è¡Œï¼Œåªèƒ½åå°è¿è¡Œï¼Œå¯ä»¥ä¸å…¶ä»–ç»„ä»¶è¿›è¡Œäº¤äº’ï¼‰</li><li>å¹¿æ’­ BroadcastReceiverï¼ˆæ˜¯ä¸€ç§åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œä¹Ÿå¯ä»¥åœ¨åº”ç”¨å†…éƒ¨è¿›è¡Œä¼ é€’ä¿¡æ¯ï¼‰</li><li>å†…å®¹æä¾›è€… Content Providerï¼ˆAndroidæä¾›ç¬¬ä¸‰æ–¹åº”ç”¨æ•°æ®è®¿é—®çš„æœºåˆ¶ï¼‰</li></ul></li><li><p>Serviceä¸IntentServiceçš„åŒºåˆ«</p><ul><li>Androidä¸­çš„Serviceæ˜¯ç”¨äºåå°æœåŠ¡çš„ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œå®ƒæ˜¯ä¾èµ–ä¸ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯è¿è¡Œæ¥ä¸»çº¿ç¨‹ä¸Šçš„ï¼Œä¸æ¨èåœ¨Serviceä¸­ç¼–å†™è€—æ—¶æ“ä½œ</li><li>ä½†æ˜¯å¦‚æœå¿…é¡»è¦åœ¨Serviceä¸­ç¼–å†™è€—æ—¶æ“ä½œï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨IntentService</li><li>IntentServiceæ˜¯ç»§æ‰¿Serviceçš„ï¼Œå®ƒåŒ…å«äº†Serviceçš„å…¨éƒ¨ç‰¹æ€§ï¼Œç”Ÿå‘½å‘¨æœŸ</li><li>IntentServiceä¸Serviceä¸åŒçš„æ˜¯ï¼Œåœ¨IntentServiceè¿›è¡ŒonCreateçš„æ—¶å€™ï¼Œå†…éƒ¨å¼€å¯äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥å»æ‰§è¡Œè€—æ—¶æ“ä½œ</li></ul></li><li><p>Android åº”ç”¨çš„ç»“æ„</p><ul><li></li></ul></li><li><p>Android åº”ç”¨ä¸­ä¿å­˜æ•°æ®</p><ul><li>sharedPreferenceï¼ˆç”¨xmlæ¥ä¿å­˜åº”ç”¨ä¸­çš„æ•°æ®ï¼Œæœ¬åœ°ï¼‰</li><li>SQLï¼ˆå°†åº”ç”¨æ•°æ®ä¿å­˜åˆ°åº”ç”¨æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œåº”ç”¨æœ¬åœ°ï¼‰</li><li>Fileï¼ˆå°†åº”ç”¨æ•°æ®ä¿å­˜åˆ°åˆ›å»ºçš„txtæ–‡ä»¶ä¸­ï¼Œæœ¬åœ°ï¼‰</li></ul></li><li><p>åœ¨ Android åº”ç”¨ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</p><ul><li>ä½¿ç”¨Threadæ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆä¹Ÿå°±æ˜¯åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œè€—æ—¶æ“ä½œï¼Œåœ¨å°†ç»“æœé€šè¿‡Handlerä¼ å›ä¸»çº¿ç¨‹ï¼‰</li><li>ä½¿ç”¨AsyncTaskæ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆä¹Ÿå°±æ˜¯åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œè€—æ—¶æ“ä½œï¼Œå¯é€šè¿‡<strong>onProgressUpdate</strong>æ–¹æ³•æ¥ä¿®æ”¹UIï¼‰</li></ul></li><li><p>ä¸¤ä¸ª Fragment ä¹‹é—´è¿›è¡Œé€šä¿¡</p><ul><li>ä½¿ç”¨æ¥å£æ¥è¿›è¡Œä¸¤ä¸ªFragmentä¹‹é—´çš„é€šä¿¡ï¼Œé€šè¿‡å®¿ä¸»Activityä¸­è½¬ä¸€ä¸‹</li><li>ä½¿ç”¨å¹¿æ’­</li></ul></li><li><p>Android çš„é€šçŸ¥ç³»ç»Ÿ</p><ul><li></li></ul></li><li><p>Androidå¯åŠ¨æ¨¡å¼</p><ul><li>standardï¼ˆé‚£é‡Œè°ƒç”¨å°±å»é‚£é‡Œï¼Œå¯å¤šæ¬¡å †å ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªç›¸åŒçš„Activityï¼‰</li><li>singleTopï¼ˆå¯å¤šæ¬¡å®ä¾‹åŒ–ï¼Œä½†ä¸å¯å †å ï¼Œå½“æ ˆé¡¶ä¸ºç›¸åŒçš„Activityåˆ™ä¼šè°ƒç”¨onNewIntent()æ–¹æ³•ï¼‰</li><li>singleTaskï¼ˆå½“å·²è¢«å®ä¾‹åŒ–ï¼Œå†æ¬¡åˆ›å»ºåˆ™ä¼šå°†è‡ªå·±ä»¥ä¸Šçš„æ‰€æœ‰Activityå…¨éƒ¨é”€æ¯ï¼Œåœ¨è°ƒç”¨onNewIntent()ï¼Œå¦‚æ²¡è¢«å®ä¾‹åŒ–ï¼Œé‚£å°†ä¼šåˆ›å»ºæ–°çš„Taskå¹¶å®ä¾‹åŒ–ååœ¨å…¥æ ˆï¼‰</li><li>singleInstanceï¼ˆå­˜åœ¨äºå•ç‹¬çš„æ ˆä¸­ï¼Œåœ¨è¿™ä¸ªæ ˆä¸­ï¼Œåªæœ‰ä¹Ÿä»…æœ‰å®ƒä¸€ä¸ªï¼‰</li></ul></li><li><p>ä»€ä¹ˆæ˜¯Fragment</p><ul><li>Fragmentç›¸å½“äºæ˜¯Activityä¸­çš„æ¨¡å—ï¼Œå®ƒæœ‰ç€è‡ªå·±çš„å¸ƒå±€ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œå•ç‹¬å¤„ç†è‡ªå·±çš„è¾“å…¥è¾“å‡º</li></ul></li><li><p>Fragment çš„ç”Ÿå‘½å‘¨æœŸ</p><ul><li>onAttchï¼ˆå½“Fragmentä¸Activityå‘ç”Ÿå…³è”æ—¶è°ƒç”¨ï¼‰</li><li>onCreateï¼ˆåˆ›å»ºFragmentæ—¶å›è°ƒï¼Œå¦‚æœæƒ³è¦ä¿å­˜FragmentåŸºæœ¬ç»„ä»¶ï¼Œåˆ™åœ¨è¿™é‡Œåˆå§‹åŒ–ï¼‰</li><li>onCreateViewï¼ˆé¦–æ¬¡ç»˜åˆ¶é¡µé¢æ—¶è°ƒç”¨ï¼Œåœ¨æ­¤å¯ä»¥åˆ›å»ºViewã€‚è¿™é‡Œä¸èƒ½è¿›è¡Œè€—æ—¶æ“ä½œï¼‰</li><li>onActivityCreatedï¼ˆåœ¨onCreateæ–¹æ³•å®Œæˆåè¿”å›ï¼Œè¿™é‡Œå¯ä»¥è¿›è¡Œä¸Activityäº¤äº’UIæ“ä½œï¼Œä¸èƒ½åœ¨æ­¤ä¹‹å‰ä¸Activityè¿›è¡Œäº¤äº’ï¼‰</li><li>onStartï¼ˆå¯åŠ¨Fragmentæ—¶å›è°ƒï¼Œæ­¤æ—¶Fragmentå¯è§ï¼Œåªæ˜¯æ²¡æœ‰æ˜¾ç¤ºåœ¨å‰å°ï¼Œä¸èƒ½å’Œç”¨æˆ·è¿›è¡Œäº¤äº’ï¼‰</li><li>onResumeï¼ˆFragmentåœ¨å‰å°å¤„äºå¯è§çŠ¶æ€æ—¶è¿”å›ï¼Œå¯ä»¥ä¸ç”¨æˆ·äº¤äº’ï¼‰</li><li>onPauseï¼ˆFragmentå¤„äºæš‚åœçŠ¶æ€æ—¶è¿”å›ï¼Œå¤„äºå¯è§çŠ¶æ€ï¼Œä½†ä¸èƒ½å’Œç”¨æˆ·äº¤äº’ï¼‰</li><li>onStopï¼ˆåœæ­¢Fragmentæ—¶å›è°ƒï¼Œå¤„äºå®Œå…¨ä¸å¯è§ï¼‰</li><li>onDestoryViewï¼ˆé”€æ¯æœ‰å…³Fragmentçš„è§†å›¾ï¼Œä½†è¿˜æœªä¸Activityè§£é™¤ç»‘å®šï¼‰</li><li>onDestoryï¼ˆé”€æ¯Fragmentæ—¶å›è°ƒï¼‰</li><li>onDetachï¼ˆä¸Activityçš„å…³è”è¢«å–æ¶ˆæ—¶è°ƒç”¨ï¼‰</li></ul></li><li><p>Android çš„ Dialog</p></li></ol><pre><code>- </code></pre><ol start="13"><li><p>Android çš„ View </p><ul><li></li></ul></li><li><p>Fragment å’Œ Activity æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ƒä»¬ä¹‹é—´åˆæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p><ul><li></li></ul></li><li><p>è§£é‡Šä¸€ä¸‹ Android ä¸­çš„ Intent </p><ul><li></li></ul></li><li><p>onSaveInstanceStateæ–¹æ³•ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«æ‰§è¡Œï¼Ÿ</p><ul><li>æŒ‰ä¸‹Homeé”®æ—¶ï¼Œå› ä¸ºç³»ç»Ÿä¸çŸ¥é“ä½ åœ¨æŒ‰ä¸‹Homeé”®ä¹‹åè¦è¿è¡Œå¤šå°‘ä¸ªç¨‹åºï¼Œè‡ªç„¶ä¹Ÿä¸çŸ¥é“å½“å‰çš„Activityä¼šä¸ä¼šé”€æ¯ï¼Œæ‰€ä»¥ç³»ç»Ÿåˆ™ä¼šè°ƒç”¨onSaveInstanceStateæ¥ä¿å­˜é‚£äº›éæ°¸ä¹…æ€§çš„æ•°æ®</li><li>å…³é—­å±å¹•</li><li>ä»å½“å‰Activityå¼€å¯å¦ä¸€ä¸ªActivity</li><li>å±å¹•æ–¹å‘å‘ç”Ÿå˜åŒ–æ—¶</li></ul><blockquote><p>onSaveInstanceState() è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥ä¿å­˜UIçŠ¶æ€çš„ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿å­˜å½“å‰UIå’Œä½ æ‰€æƒ³ä¿å­˜çš„ä¸œè¥¿</p></blockquote></li><li><p>ç®€è¿°View Touchäº‹ä»¶ä¼ é€’æœºåˆ¶ã€‚</p><ol><li>è¿‡ç¨‹<ul><li>dispatchTouchEvent -&gt; onInterceptTouchEventï¼ˆè¯¥æ–¹æ³•åªåœ¨ViewGroupä¸­æœ‰ï¼‰ -&gt; onTouchEvent</li></ul></li><li>dispatchTouchEvent ï¼ˆè¿›è¡Œäº‹ä»¶åˆ†å‘ï¼Œè¿”å›å€¼æ˜¯Booleanï¼‰</li><li>onInterceptTouchEvent ï¼ˆè¿›è¡Œäº‹ä»¶æ‹¦æˆªï¼Œè¯¥æ–¹æ³•åªåœ¨ViewGroupä¸­æœ‰ï¼ŒViewä¸­æ˜¯æ²¡æ­¤æ–¹æ³•ï¼Œä¸€æ—¦æ‹¦æˆªï¼Œåˆ™æ‰§è¡ŒViewGroupçš„onTouchEventï¼Œåœ¨ViewGroupä¸­å¤„ç†äº‹ä»¶ï¼Œè€Œä¸ä¼šæ¥ç€åˆ†å‘ç»™Viewï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥åé¢çš„äº‹ä»¶éƒ½ä¼šäº¤ç»™ViewGroupæ¥å¤„ç†ï¼‰</li><li>onTouchEventï¼ˆè¿›è¡Œäº‹ä»¶å¤„ç†ï¼‰</li></ol></li><li><p>ä¸ºä»€ä¹ˆåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ new Handler() ä¼šæŠ›å‡ºå¼‚å¸¸?</p><ul><li>æ˜¯å› ä¸ºåœ¨åˆ›å»ºHandleræ—¶ï¼Œä¼šå…ˆè·å–å½“å‰çº¿ç¨‹çš„Looperï¼Œå¦‚æœLooperä¸ºç©ºï¼Œåˆ™ä¼šå¼‚å¸¸</li></ul></li><li><p>invalidate()å’ŒpostInvalidate()çš„åŒºåˆ«ï¼Ÿ</p><ul><li>invalidateå’ŒpostInvalidateéƒ½æ˜¯ç”¨æ¥åˆ·æ–°Viewçš„ï¼Œä½†æ˜¯invalidateæ˜¯ç”¨äºä¸»çº¿ç¨‹åˆ·æ–°ï¼Œå¦‚æœåœ¨å­çº¿ç¨‹åˆ™éœ€è¦é…åˆHandlerã€‚è€ŒpostInvalidateå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­ç›´æ¥è°ƒç”¨</li></ul><blockquote><p>invalidate() è¯·æ±‚é‡ç»˜Viewæ ‘ï¼Œå³draw()è¿‡ç¨‹ï¼Œå³ç”¨æ¥åˆ·æ–°Viewçš„ï¼ˆè°è°ƒç”¨ä»–ï¼Œè°å°±åˆ·æ–°ï¼‰</p></blockquote></li><li><p>resç›®å½•å’Œassetsç›®å½•çš„åŒºåˆ«ï¼Ÿ</p><ul><li>res/rawä¸­çš„æ–‡ä»¶æ˜¯ä¼šè¢«æ˜ å°„åˆ°R.javaä¸­çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨èµ„æºIDï¼Œä¸å¯ä»¥æœ‰ç›®å½•ç»“æ„</li><li>assetsä¸­çš„æ–‡ä»¶æ˜¯ä¸ä¼šæ˜ å°„åˆ°R.javaä¸­çš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨åˆ™éœ€è¦AssetsManagerç±»æ¥è¿›è¡Œè®¿é—®ï¼Œå¯ä»¥åˆ›å»ºå­æ–‡ä»¶å¤¹</li></ul></li><li><p>onTouch()ã€onTouchEvent()å’ŒonClick()å…³ç³»ï¼Ÿ</p><ul><li>ä¼˜å…ˆåº¦ onTouch -&gt; onTouchEvent -&gt; onClick</li><li>å› æ­¤onTouchListenerçš„onTouchä¼šå…ˆè§¦å‘ï¼Œå¦‚æœonTouchè¿”å›ä¸ºfalseæ‰ä¼šæ¥ç€è§¦å‘onTouchEvent</li><li>onClickå†…éƒ¨æ˜¯é€šè¿‡onTouchEventæ¥å®ç°çš„</li></ul></li><li><p>ä¸ºä»€ä¹ˆå­çº¿ç¨‹ä¸èƒ½æ›´æ–°UIï¼Ÿ</p><ul><li>åªæœ‰åˆ›å»ºè§†å›¾å±‚æ¬¡ç»“æ„çš„åŸå§‹çº¿ç¨‹æ‰èƒ½æ›´æ–°è¿™ä¸ªè§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ä¸»çº¿ç¨‹æ‰æœ‰æƒåŠ›å»æ›´æ–°UI</li><li>å‡å¦‚å…è®¸å¤šçº¿ç¨‹æ›´æ–°<code>UI</code>ï¼Œä½†æ˜¯è®¿é—®<code>UI</code>æ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œä¸€æ—¦å¤šçº¿ç¨‹æŠ¢å äº†èµ„æºï¼Œé‚£ä¹ˆç•Œé¢å°†ä¼šä¹±å¥—æ›´æ–°äº†</li><li>å…¶å®è¿˜æ˜¯å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UIçš„ï¼Œå‰ææ˜¯å®ƒè¦æ‹¥æœ‰è‡ªå·±çš„ViewRootï¼ŒViewRootæ˜¯åœ¨onResumeä¸­çš„addView()åˆ›å»ºçš„ã€‚ä¸€èˆ¬æ¥è¯´åœ¨onCreateä¸­é€šè¿‡å­çº¿ç¨‹æ›´æ–°UIæ˜¯å¯è¡Œçš„ï¼Œä½†ä¸æ¨èï¼Œå› ä¸ºAndroid UIæ“ä½œå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨</li></ul></li><li><p>åœ¨ onCreateä¸­ runOnUiTherad -&gt; onHandler(Looper.getMainLooper()).post -&gt; Thread(runOnUiTherad) -&gt; View.post</p><blockquote><p>runOnUiTherad ï¼ˆè°ƒç”¨æ­¤æ–¹æ³•å°±å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼‰</p><p>onHandler(Looper.getMainLooper())ï¼ˆåˆ›å»ºHandleræ—¶ä¼ é€’äº†ä¸»çº¿ç¨‹çš„Looperï¼Œè¿™æ ·onHandlerå°±ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼‰</p><p>View.postï¼ˆView.post() çš„å†…éƒ¨ä¹Ÿæ˜¯è°ƒç”¨äº† Handlerï¼‰</p></blockquote></li><li><p>SharedPreferenceçš„applyå’Œcommitçš„åŒºåˆ«?</p><ul><li>applyï¼ˆé¦–å…ˆapplyæ˜¯æ²¡æœ‰è¿”å›ç»“æœçš„ï¼Œå…¶æ¬¡applyæ˜¯å°†ä¿®æ”¹çš„æ•°æ®æäº¤ç»™å†…å­˜ï¼Œç„¶ååœ¨å¼‚æ­¥æäº¤ç»™ç¡¬ç›˜ï¼‰</li><li>commitï¼ˆcommitæ˜¯ä¼šè¿”å›ä¸€ä¸ªBooleanï¼Œè¡¨æ˜æ˜¯å¦ä¿®æ”¹æˆåŠŸã€‚commitæ˜¯å°†æ•°æ®åŒæ­¥æäº¤ç»™ç¡¬ç›˜ï¼‰</li></ul></li><li><p>ScrollViewä¸‹åµŒå¥—ä¸€ä¸ªListViewé€šå¸¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</p><ul><li>é—®é¢˜ï¼šå½“ScrollViewåµŒå¥—ListViewæ—¶ï¼ŒListViewçš„é«˜åº¦è®¾ç½®ä¸ºwrap_contentæ—¶ä¼šäº§ç”Ÿï¼Œä¸€èˆ¬æƒ…å†µä¸‹ListViewåªæ˜¾ç¤ºçš„ç¬¬ä¸€ä¸ªItemã€‚</li><li>è§£å†³<ol><li>æ‰‹åŠ¨è®¾ç½®ListViewé«˜åº¦ï¼Œåªéœ€è¦åœ¨ç»™ListViewè®¾ç½®å®ŒAdapterä¹‹ååœ¨å®é™…æµ‹é‡é«˜åº¦å¹¶èµ‹å€¼</li><li>åœæ­¢ä½¿ç”¨ScrollViewåµŒå¥—ListViewï¼Œæ”¹ç”¨ListViewå¤šItem</li><li>è‡ªå®šä¹‰å¯é€‚åº”ScrollViewçš„ListViewï¼Œä¹Ÿå°±æ˜¯é‡å†™ListViewä¸­çš„onMeasureæ–¹æ³•</li></ol></li></ul></li><li><p>ä»€ä¹ˆæ˜¯OOMï¼Ÿæ£€æµ‹OOMçš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ</p><ul><li>OOMæ˜¯å†…å­˜æ³„æ¼</li><li><strong>WeakReference</strong>ä¸<strong>ReferenceQueue</strong>è”åˆä½¿ç”¨ï¼Œåœ¨å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡è¢«å›æ”¶åï¼Œä¼šå°†å¼•ç”¨æ·»åŠ åˆ°<strong>ReferenceQueue</strong>ï¼›æ¸…ç©ºåï¼Œå¯ä»¥æ ¹æ®æ˜¯å¦ç»§ç»­å«æœ‰è¯¥å¼•ç”¨æ¥åˆ¤å®šæ˜¯å¦è¢«å›æ”¶ï¼›åˆ¤å®šå›æ”¶ï¼Œ æ‰‹åŠ¨GC, å†æ¬¡åˆ¤å®šå›æ”¶ï¼Œé‡‡ç”¨åŒé‡åˆ¤å®šæ¥ç¡®ä¿å½“å‰å¼•ç”¨æ˜¯å¦è¢«å›æ”¶çš„çŠ¶æ€æ­£ç¡®æ€§ï¼›å¦‚æœä¸¤æ¬¡éƒ½æœªå›æ”¶ï¼Œåˆ™ç¡®å®šä¸ºæ³„æ¼å¯¹è±¡ã€‚</li><li>å¦‚ä½•é¿å…å†…å­˜æ³„éœ²ï¼š<ol><li>ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼Œæ¯”å¦‚Recacheã€DiskLruCacheã€å¯¹è±¡é‡å¤å¹¶ä¸”é¢‘ç¹è°ƒç”¨å¯ä»¥è€ƒè™‘å¯¹è±¡æ± </li><li>å¯¹äºå¼•ç”¨ç”Ÿå‘½å‘¨æœŸä¸ä¸€æ ·çš„å¯¹è±¡ï¼Œå¯ä»¥ç”¨è½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨SoftReferner WeakReferner</li><li>å¯¹äºèµ„æºå¯¹è±¡ ä½¿ç”¨finally å¼ºåˆ¶å…³é—­</li><li>å†…å­˜å‹åŠ›è¿‡å¤§å°±è¦ç»Ÿä¸€çš„ç®¡ç†å†…å­˜</li></ol></li></ul></li><li><p>å¹¿æ’­çš„ä¸¤ç§æ³¨å†Œå½¢å¼</p><ul><li><p>é™æ€æ³¨å†Œï¼ˆåœ¨AndroidManifestä¸­è¿›è¡Œæ³¨å†Œï¼‰åœ¨AndroidManifestä¸­è¿›è¡Œæ³¨å†Œåï¼Œä¸ç®¡æ”¹åº”ç”¨ç¨‹åºæ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œéƒ½ä¼šè¿›è¡Œç›‘å¬ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;receiver android:name=<span class="string">&quot;.IncomingSMSReceiver&quot;</span>&gt;  </span><br><span class="line">    &lt;intent-filter&gt;  </span><br><span class="line">         &lt;action android:name=<span class="string">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>/&gt;  </span><br><span class="line">    &lt;/intent-filter&gt;  </span><br><span class="line">&lt;/receiver&gt;  </span><br></pre></td></tr></table></figure></li><li><p>åŠ¨æ€æ³¨å†Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IntentFilter filter = <span class="keyword">new</span> IntentFilter(<span class="string">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>);  </span><br><span class="line">IncomingSMSReceiver receiver = <span class="keyword">new</span> IncomingSMSReceiver();  </span><br><span class="line">registerReceiver(receiver, filter);  </span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¦‚ä½•è®¾è®¡å¼€å‘ä¸€ä¸ªå›¾ç‰‡è½®æ’­ç»„ä»¶ï¼Ÿç®€è¿°è¦ç‚¹æˆ–å†™ä»£ç ã€‚</p><ol><li><p>æ•´ä¸ªç»„ä»¶é‡‡ç”¨ViewPager</p></li><li><p>é€‚é…å™¨ç»§æ‰¿è‡ªPagerAdapter</p></li><li><p>é‡å†™getCount()ï¼ŒisViewFromObject(View arg0, Object arg1)ï¼ŒdestroyItem(ViewGroup container, int position, Object object)ï¼ŒinstantiateItem(ViewGroup container, int position)å››ä¸ªæ–¹æ³•ã€‚</p><blockquote><p>getCountï¼ˆè·å–å½“å‰ç•Œé¢ä¸ªæ•°ï¼‰</p><p>isViewFromObjectï¼ˆåˆ¤æ–­æ˜¯å¦ç”±å¯¹è±¡ç”Ÿæˆé¡µé¢ï¼‰</p><p>destroyItemï¼ˆå›æ”¶Itemï¼‰</p><p>instantiateItemï¼ˆåŠ è½½Itemï¼‰</p></blockquote></li><li><p>getCountä»£è¡¨è¿”å›çš„æ¡ç›®ï¼Œè¦å®ç°æ— é™è½®æ’­ï¼Œè¿™é‡Œå°±è¦ç»™å‡ºä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡Integer.MAX_VALUEã€‚å…¶ä»–çš„å’Œæ™®é€šViewPagerå¼€å‘ä¸€æ ·ï¼Œåœ¨isViewFromObjectè¿”å›arg0 == arg1ï¼Œåœ¨destroyItemä¸­æ‘§æ¯æ»‘å‡ºçš„View,container.removeView((View) object),åœ¨instantiateItemä¸­æ·»åŠ å¯¹åº”çš„item,è®°å¾—æ·»åŠ item,container.addView(child)ã€‚é‡Œé¢çš„postionéƒ½è¦åšå–ä½™å¤„ç†ï¼Œé¿å…æ•°ç»„è¶Šç•Œã€‚</p></li><li><p>æœ€åï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªhandlerå®ç°è‡ªåŠ¨è½®æ’­ï¼Œé‡å†™onTouchEventæ¥å¯¹è‡ªåŠ¨è½®æ’­æ§åˆ¶ã€‚</p></li></ol></li><li><p>Kotlinä¸­åç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</p><ol><li>çº¿ç¨‹<ul><li>çº¿ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜CPUçš„èµ„æºä½¿ç”¨ç‡ï¼Œä½¿å¤šä¸ªä»»åŠ¡å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œæ˜¯æœåŠ¡äºæœºå™¨çš„ã€‚çº¿ç¨‹çš„è°ƒåº¦æ˜¯ç³»ç»Ÿæ¥å®Œæˆçš„ï¼Œä¸€èˆ¬æ˜¯æŠ¢å å¼çš„ï¼Œæ ¹æ®ä¼˜å…ˆçº§æ¥åˆ†é…</li></ul></li><li>åç¨‹<ul><li>åç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†è®©å¤šä¸ªä»»åŠ¡ä¹‹é—´æ›´å¥½çš„åä½œï¼Œæ˜¯æœåŠ¡äºäººçš„ã€‚åç¨‹ä¸ºäº†ç¡®ä¿ä»£ç é€»è¾‘æ˜¯é¡ºåºï¼Œæ‰€ä»¥è°ƒåº¦æ˜¯ç”±å¼€å‘è€…æ¥å®šåˆ¶çš„</li></ul></li></ol></li><li><p>ä»æ¶æ„å›¾çœ‹ï¼Œandroidåˆ†ä¸ºå‡ ä¸ªå±‚?</p><ul><li>5å±‚<ol><li>:Linux Kernel(Linuxå†…æ ¸)</li><li>Hardware Abstraction Layer(ç¡¬ä»¶æŠ½è±¡å±‚)</li><li>Libraries(ç³»ç»Ÿè¿è¡Œåº“æˆ–è€…æ˜¯c/c++ æ ¸å¿ƒåº“)</li><li>Application Framework(å¼€å‘æ¡†æ¶åŒ… )</li><li>Applications(æ ¸å¿ƒåº”ç”¨ç¨‹åº)</li></ol></li></ul><p><img src="https://uploadfiles.nowcoder.com/images/20170308/8698685_1488963422551_58DC97016985EB4A658556EF1A13A275" alt="img"></p></li><li><p>VideoView</p><ul><li>ä¸å¯ä»¥æ§åˆ¶å¤§å°ï¼ˆè¿™é‡Œçš„å¤§å°å°±æ˜¯æŒ‡Viewçš„å¤§å°ï¼Œç»™ä»–è®¾ç½®é«˜å®½æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼‰</li><li>VideoViewå®é™…çš„å°ºå¯¸å¯èƒ½å¹¶ä¸æ˜¯è¿™ä¸ªå°ºå¯¸è®¾ç½®çš„å¤§å°. VideoViewåœ¨æµ‹é‡è‡ªèº«çš„å°ºå¯¸æ—¶ä¼šä¾æ®è§†é¢‘çš„çœŸå®å°ºå¯¸æ¥è°ƒæ•´è‡ªå·±çš„å¤§å°ã€‚</li></ul></li><li><p>ä½¿ç”¨SimpleAdapterä½œä¸º ListViewçš„é€‚é…å™¨ï¼Œè¡Œå¸ƒå±€ä¸­æ”¯æŒä¸‹åˆ—å“ªäº›ç»„ä»¶ï¼Ÿ</p><ul><li>å®ç°Checkableæ¥å£çš„View</li><li>TextView</li><li>ImageView</li></ul></li><li><p>å¦‚ä½•åœ¨ä»»æ„ä½ç½®å…³æ‰åº”ç”¨æ‰€æœ‰Activity &amp; å¦‚ä½•åœ¨ä»»æ„ä½ç½®å…³æ‰æŒ‡å®šçš„Activityï¼Ÿ</p></li><li><p>Activityä»»åŠ¡æ ˆæ˜¯ä»€ä¹ˆï¼Ÿåœ¨é¡¹ç›®ä¸­æœ‰ç”¨åˆ°å®ƒå—ï¼Ÿè¯´ç»™æˆ‘å¬å¬</p></li><li><p>ä»€ä¹ˆæƒ…å†µä¸‹Activityä¸èµ°onDestory?</p><ul><li>System.exit(0)ï¼ˆä½¿ç”¨æ­¤æ–¹æ³•æ¥é€€å‡ºåº”ç”¨æ—¶ï¼Œæ˜¯ä¸ä¼šè§¦å‘onDestoryï¼‰</li><li>æ ˆé‡Œé¢çš„ç¬¬ä¸€ä¸ªæ²¡æœ‰é”€æ¯çš„activityä¼šæ‰§è¡ŒonDestroyæ–¹æ³•ï¼Œå…¶ä»–çš„ä¸ä¼šæ‰§è¡Œï¼ˆä»MainActivityè·³è½¬åˆ°activity-Aï¼ˆæˆ–è€…ç»§ç»­ä»activity-Aå†è·³è½¬åˆ°activity-Bï¼‰ï¼Œè¿™æ—¶å€™ï¼Œä»åå°å¼ºæ€ï¼Œåªä¼šæ‰§è¡ŒmainActivityçš„onDestroyæ–¹æ³•ï¼Œactivity-Aï¼ˆä»¥åŠactivity-Bï¼‰çš„onDestroyæ–¹æ³•éƒ½ä¸ä¼šæ‰§è¡Œï¼‰</li></ul></li><li><p>ä»€ä¹ˆæƒ…å†µä¸‹Activityä¼šå•ç‹¬æ‰§è¡ŒonPause?</p><ul><li>å½“Activityè¢«ä¸€ä¸ªé€æ˜çš„Dialogæˆ–è€…åˆ«çš„ä¸œè¥¿è¦†ç›–æ—¶ï¼Œæ­¤æ—¶å®ƒä¾ç„¶ä¸çª—å£ç®¡ç†å™¨ä¾ç„¶ä¿æŒè¿æ¥ï¼Œç³»ç»Ÿç»§ç»­ç»´æŠ¤å…¶å†…éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥å®ƒä»ç„¶å¯è§ï¼Œä½†å®ƒå·²ç»å¤±å»äº†ç„¦ç‚¹æ•…ä¸å¯ä¸ç”¨æˆ·äº¤äº’ï¼Œæ‰€ä»¥è¢«è¦†ç›–çš„Activityå¹¶ä¸ä¼šæ‰§è¡ŒonStop()æ–¹æ³•ï¼Œåªä¼šæ‰§è¡ŒonPause</li></ul></li><li><p>éšå¼ Intent å’Œ æ˜¾å¼ Intent</p><ul><li>ä½¿ç”¨æ˜¾å¼Intentæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šå¯åŠ¨é‚£ä¸€ä¸ªActivity</li><li>ä½¿ç”¨éšå¼Intentæ—¶ï¼Œåªç”¨å‘Šè¯‰ç³»ç»Ÿæƒ³åšä»€ä¹ˆï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨çš„æ‰¾åˆ°ç¬¦åˆçš„Activityæ¥å¯åŠ¨</li></ul></li><li><p>ä»€ä¹ˆæ˜¯ Loader ï¼Ÿ</p></li><li><p>ä»€ä¹ˆæ˜¯ NDK ï¼Œä¸ºä»€ä¹ˆå®ƒæ˜¯æœ‰ç”¨çš„ï¼Ÿ</p></li><li><p>å¦‚ä½•ç†è§£ä¸¥æ ¼æ¨¡å¼ï¼ˆStrictModeï¼‰</p></li><li><p>ä»€ä¹ˆæ˜¯ Lint ï¼Ÿå®ƒçš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>ListView å’Œ RecyclerView æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></li><li><p>å¦‚ä½•ç†è§£ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ã€‚æ€ä¹ˆä½¿ç”¨å®ƒï¼Ÿ</p></li><li><p>ä¸ºä»€ä¹ˆ Bundle è¢«ç”¨æ¥ä¼ é€’æ•°æ®ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨ç®€å•çš„ HashMap æ•°æ®ç»“æ„ï¼Ÿ</p><blockquote><p>Bundleæœ¬è´¨ä¸Šä¹Ÿæ˜¯ç”¨ArrayMapæ¥è¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯é—®ä¸ºä»€ä¹ˆè¦ç”¨ArrayMapæ¥è¿›è¡Œå­˜å‚¨ã€‚</p></blockquote><ul><li>ArrayMapï¼šé€‚åˆå°æ•°æ®å­˜å‚¨ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æ—¶å€™ï¼Œæ€§èƒ½å°†é€€åŒ–ã€‚</li><li>HashMap ï¼šå†…éƒ¨æ˜¯ä½¿ç”¨æ•°ç»„+é“¾è¡¨çš„ç»“æœï¼Œåœ¨æ•°æ®é‡å¤§çš„æ—¶å€™æ€§èƒ½ä¸é”™ï¼Œä½†åœ¨æ•°æ®å°çš„æ—¶å€™ï¼Œå®ƒçš„Entry Arrayæ¯”ArrayMapå æ›´å¤šçš„ç©ºé—´</li></ul><p>åœ¨Androidä¸­ï¼Œå¤šæ•°ä¼ é€’éƒ½æ˜¯è¾ƒå°çš„æ•°æ®ï¼Œæ‰€ä»¥ä½¿ç”¨Bundle ï¼ˆArrayMapï¼‰æ›´å¥½ã€‚è€Œä¸”å¦‚æœä½¿ç”¨Intentæ¥ä¼ é€’æ•°æ®ï¼ŒBundleçš„Parcelableåºåˆ—åŒ–æ¯”HashMap çš„Serializableæ€§èƒ½æ›´å¥½</p></li><li><p>å¦‚ä½•ç†è§£ Android çš„ Dialog ï¼Ÿ</p><ul><li>è¦åœ¨Activityä¸­åˆ›å»ºä¸€ä¸ªDialogï¼Œå¯ä»¥åœ¨onCreateä¸­è°ƒç”¨showDialog(id)ï¼Œä¹‹åä¼šå›è°ƒonCreateDialog(int id,Bundle rags)è¿™é‡Œè¿”å›çš„idå°±æ˜¯showDiologä¸­ä¼ å…¥çš„idï¼Œç”¨æ¥è¡¨ç¤ºDialogï¼Œä¹‹åå°±æ¥åœ¨onCreateDialogä¸­åˆ›å»ºä½ è‡ªå·±çš„Dialogã€‚æœ€åè¿˜ä¼šè°ƒç”¨onPrepareDialog()ï¼Œä¹‹åå°±åˆ›å»ºå®Œæ¯•ã€‚ä¸‹æ¬¡åœ¨è°ƒç”¨ï¼ˆå½“å‰Activityä¸é”€æ¯ï¼‰showDialogå°±ä¸ä¼šå…è®¸onCreatesDialogï¼Œåªä¼šè°ƒç”¨onPrepareDoalog</li></ul></li><li><p>ä»€ä¹ˆæ˜¯ ViewGroup ï¼Œå®ƒä¸ View çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ</p></li><li><p>è°ˆè°ˆ Serializable æ¥å£å’Œ Parcelable æ¥å£çš„åŒºåˆ«ã€‚åœ¨ Android ä¸­æœ€å¥½ä½¿ç”¨å“ªç§æ¥å£ï¼Ÿ</p></li><li><p>å½“ Bitmap å ç”¨è¾ƒå¤šå†…å­˜æ—¶ï¼Œä½ æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</p></li><li><p>AsyncTask çš„ç”Ÿå‘½å‘¨æœŸå’Œ(å®ƒæ‰€å±çš„) Activity çš„ç”Ÿå‘½å‘¨æœŸæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿè¿™ç§å…³ç³»å¯èƒ½ä¼šå¯¼è‡´ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿ å¦‚ä½•é¿å…è¿™äº›é—®é¢˜å‘ç”Ÿï¼Ÿ </p></li><li><p>ä»€ä¹ˆæ˜¯ NDK ï¼Œä¸ºä»€ä¹ˆå®ƒæ˜¯æœ‰ç”¨çš„ï¼Ÿ</p></li><li><p>å¦‚ä½•ç†è§£ä¸¥æ ¼æ¨¡å¼ï¼ˆStrictModeï¼‰</p></li><li><p>ä»€ä¹ˆæ˜¯ SurfaceView ï¼Ÿ</p></li><li><p>ä½ çŸ¥é“ä»€ä¹ˆæ˜¯è§†å›¾æ ‘(View Tree)å—ï¼Ÿæ€æ ·ä¼˜åŒ–å®ƒçš„æ·±åº¦ï¼Ÿ</p></li><li><p>é˜è¿°ä¸€ä¸‹ Android ä¸­çš„ HashMap , ArrayMap å’Œ SparseArray</p></li><li><p>é˜è¿°ä¸€ä¸‹ Looper, Handler å’Œ HandlerThread</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> é¢è¯•é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Collapsingä¸Navigation</title>
      <link href="2020/12/24/Collapsing%E4%B8%8ENavigation/"/>
      <url>2020/12/24/Collapsing%E4%B8%8ENavigation/</url>
      
        <content type="html"><![CDATA[<p>ä»‹ç»Collapsingä¸Navigationçš„ä½¿ç”¨</p><a id="more"></a><h1 id="Collapsingä¸Navigation"><a href="#Collapsingä¸Navigation" class="headerlink" title="Collapsingä¸Navigation"></a>Collapsingä¸Navigation</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä¸ºä¸»è¦è¯­è¨€</p></blockquote><p>å…³äºNavigationçš„éƒ¨åˆ†ï¼Œä¸Šç¯‡æœ‰ï¼Œè¿™é‡Œå°±ä¸ä½œå¤šä»‹ç»äº†</p><h3 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h3><ol><li><p>å°†activity_mainä¸­çš„ â€œConstraintLayoutâ€æŠ½å–å‡ºæ¥ï¼Œæ–¹ä¾¿æ“ä½œï¼šå·¦é”®é€‰ä¸­åŒºåŸŸï¼Œå•æœºå³é”®é€‰æ‹©Refactorï¼Œåœ¨é€‰æ‹© Layoutè¿›è¡ŒæŠ½å–ï¼Œè¿™é‡Œæˆ‘å‘½åä¸ºï¼ˆlayout_constraiontï¼‰</p></li><li><p>åœ¨åŸæœ¬çš„ConstraintLayoutçš„å¸ƒå±€ä¸­æ·»åŠ å±‚çº§</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.coordinatorlayout.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.google.android.material.appbar.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/appbar&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;192dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">com.google.android.material.appbar.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/collTpplabar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:contentScrim</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll|exitUntilCollapsed&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:toolbarId</span>=<span class="string">&quot;@+id/toolbar&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- è¿™é‡Œçš„lCollapsingToolbarLayoutä¹Ÿå°±æ˜¯å¯æ»‘åŠ¨çš„Toolbarï¼Œåœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­è¿›è¡Œå˜åŒ–çš„å°±æ˜¯å®ƒ --&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">androidx.appcompat.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;pin&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¿™é‡Œçš„layout_collapseModeè®¾ç½®ä¸ºpin æ˜¯ä¸ºäº†å°†Tooblarè¿›è¡Œå›ºå®šä½ï¼Œä¸è®©ä»–ä¸Šæ»‘ç§»å‡ºå±å¹• --&gt;</span></span><br><span class="line">            </span><br><span class="line">        <span class="tag">&lt;/<span class="name">com.google.android.material.appbar.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">com.google.android.material.appbar.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.core.widget.NestedScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">app:layout_behavior</span>=<span class="string">&quot;com.google.android.material.appbar.AppBarLayout$ScrollingViewBehavior&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- NestedScrollViewåªå…è®¸æœ‰ä¸€ä¸ªå­ç±»ï¼Œå°½é‡å‡å°‘åµŒå¥—RecyclerViewï¼ŒåŸå› å¯æŸ¥çœ‹(CoordinatorLayoutåµŒå¥—RecyclerView)æ–‡ç«  --&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:showIn</span>=<span class="string">&quot;@layout/activity_main&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/fragment&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:name</span>=<span class="string">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:defaultNavHost</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:navGraph</span>=<span class="string">&quot;@navigation/navigation&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">androidx.core.widget.NestedScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.coordinatorlayout.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å±‚çº§å¦‚ä¸‹:</p><ul><li>CoordinatorLayout<ul><li>AppBarLayout<em>ï¼ˆAppBarLayoutè¦ä¸CoordinatorLayoutä¸€åŒä½¿ç”¨ï¼‰</em><ul><li>CollapsingToolbarLayout<em>ï¼ˆå¯æ»‘åŠ¨Toolbarï¼‰</em></li><li>Toolbar <em>ï¼ˆæœ€ç»ˆå›ºå®šçš„Toolbarï¼‰</em></li></ul></li><li>NestedScrollView<em>ï¼ˆæ»‘åŠ¨å¸ƒå±€ï¼‰</em><ul><li>ConstraintLayout<em>ï¼ˆçº¦æŸå¸ƒå±€ï¼‰</em><ul><li>fragment</li></ul></li></ul></li></ul></li></ul></li><li><p>å› ä¸ºéœ€è¦å°†é¡¶éƒ¨é€šçŸ¥æ è¿›è¡Œè¦†ç›–ï¼Œæ‰€ä»¥å°†åŸæœ¬çš„ActionBarå–æ¶ˆæ‰ï¼Œä¹Ÿå°±æ˜¯å°†å½“å‰themeä¸»é¢˜è®¾ç½®ä¸º NoActionBar å³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.AppCompat.NoActionBar&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">   </span><br><span class="line">              <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ—¢ç„¶å–æ¶ˆäº†ActionBarï¼Œé‚£ä¹ˆéœ€è¦è‡ªå·±è®¾ç½®ä¸€ä¸ªActionBarï¼Œåœ¨ç¬¬äºŒéƒ¨ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†Toolbarï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒè®¾ç½®ä¸ºActionBar</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">setContentView(R.layout.activity_main)</span><br><span class="line">setSupportActionBar(toolbar)</span><br></pre></td></tr></table></figure><p>åˆ«çš„ä»£ç ä¸éœ€è¦æ”¹åŠ¨</p></li><li><p>åœ¨å„ä¸ªFragmentä¸­éœ€è¦è¿›è¡Œè®¾ç½®CollapsingToolbarLayout.titleçš„å€¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(inflater: <span class="type">LayoutInflater</span>, container: <span class="type">ViewGroup</span>?,savedInstanceState: <span class="type">Bundle</span>?)</span></span>: View? &#123;</span><br><span class="line">        requireActivity().collTpplabar.title = getString(R.string.text_fragment)</span><br><span class="line">        <span class="comment">//ç›´æ¥ä½¿ç”¨requireActivity()æ¥è®¿é—®åˆ°Activityçš„CollapsingToolbarLayoutï¼Œå¹¶ä¸ºå®ƒè®¾ç½®Title</span></span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_text, container, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±å®Œæˆæ•ˆæœäº†</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> View </tag>
            
            <tag> Kotlin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DrawerLayoutçš„ä½¿ç”¨</title>
      <link href="2020/12/24/DrawerLayout%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2020/12/24/DrawerLayout%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä»‹ç»Androidä¸­çš„DrawerLayoutçš„ä½¿ç”¨</p><a id="more"></a><h1 id="DrawerLayoutçš„ä½¿ç”¨"><a href="#DrawerLayoutçš„ä½¿ç”¨" class="headerlink" title="DrawerLayoutçš„ä½¿ç”¨"></a>DrawerLayoutçš„ä½¿ç”¨</h1><blockquote><p>æœ¬ç¯‡å·²Kotlinä¸ºä¸»è¦è¯­è¨€</p></blockquote><p>DrawerLayoutä¹Ÿå°±æ˜¯ä¾§è¾¹æ </p><h3 id="æ•´ä½“åˆ†æ"><a href="#æ•´ä½“åˆ†æ" class="headerlink" title="æ•´ä½“åˆ†æ"></a>æ•´ä½“åˆ†æ</h3><ul><li>DrawerLayout     â€“ä¾§è¾¹æ çš„çˆ¶å®¹å™¨<ul><li>Fragment    â€“å®¹å™¨</li></ul></li><li>NavigationView   â€“ä¾§è¾¹æ </li></ul><h3 id="å¼€å§‹å®ç°"><a href="#å¼€å§‹å®ç°" class="headerlink" title="å¼€å§‹å®ç°"></a>å¼€å§‹å®ç°</h3><ol><li><p>é¦–å…ˆåˆ›å»º3ä¸ªFragment</p><p>ListFragmentï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>, container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_list, container, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TextFragmentï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>, container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_text, container, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PagerFragmentï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PagerFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>, container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_pager, container, <span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹å‡» New åˆ›å»ºç©ºç™½Framgnetå³å¯</p><p><img src="C:\Users\fuxinbo\AppData\Roaming\Typora\typora-user-images\image-20201223112423832.png" alt="image-20201223112423832"></p></li><li><p>æ¥ä¸‹æ¥åœ¨resæ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºâ€navigationâ€çš„æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºnavigationçš„xmlæ–‡ä»¶</p><p><img src="C:\Users\fuxinbo\AppData\Roaming\Typora\typora-user-images\image-20201223112937398.png" alt="image-20201223112937398"></p></li><li><p>åœ¨navigationä¸­ç¼–å†™3ä¸ªFragmentï¼Œå¹¶å°†åˆšåˆšåˆ›å»ºçš„3ä¸ªFragmentä¼ å…¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/navigation&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">&quot;@id/textFragment&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.laboratory.drawerdome.TextFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/text_fragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">&quot;@layout/fragment_text&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/listFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.laboratory.drawerdome.ListFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/list_fragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">&quot;@layout/fragment_list&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/pagerFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.laboratory.drawerdome.PagerFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/pager_fragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">&quot;@layout/fragment_pager&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ç»§ç»­åœ¨resä¸‹åˆ›å»ºåä¸ºâ€menuâ€çš„æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºmenuçš„xml</p></li><li><p>åœ¨menuä¸­ç¼–å†™3ä¸ªitemï¼Œitemçš„åå­—è¦ä¸navigationä¸­çš„fragmentç›¸åŒ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_baseline_one&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;@string/text_fragment&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/listFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_baseline_two&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;@string/list_fragment&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/pagerFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_baseline_three&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;@string/pager_fragment&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥å°±æ˜¯åœ¨activity_mainä¸­è¿›è¡Œè®¾ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.drawerlayout.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawerLayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:openDrawer</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/fragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:defaultNavHost</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:navGraph</span>=<span class="string">&quot;@navigation/navigation&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.google.android.material.navigation.NavigationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/navigation&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;start&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:headerLayout</span>=<span class="string">&quot;@layout/navigation_header&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:menu</span>=<span class="string">&quot;@menu/menu&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.drawerlayout.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°†menuè®¾ç½®ç»™NavigationViewï¼Œfragmentè®¾ç½®ä¾§è¾¹æ NavigationView</p><blockquote><p>android:layout_gravity=â€startâ€   æ„æ€ä¸ºè®¾ç½®ä¾§è¾¹æ æ˜¯ä»å·¦åˆ°å³ï¼Œä¸€å®šè¦å†™</p><p>DrawerLayoutçš„openDrawerï¼Œæ˜¯è®¾ç½®æ˜¾ç¤ºæ•ˆæœ</p></blockquote></li><li><p>æœ€ååœ¨Activityä¸­è®¾ç½®</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="comment">//drawerLayoutä¸å¯¼èˆªæ çš„ä¸­ç»§å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> appBerConfiguration: AppBarConfiguration</span><br><span class="line">    <span class="comment">//å¯¼èˆªæ æ§åˆ¶å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> navController: NavController</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        <span class="comment">//è·å–Fragmentå®¹å™¨</span></span><br><span class="line">        navController = findNavController(R.id.fragment)</span><br><span class="line">        <span class="comment">//å°†drawerLayoutå’Œè·å–åˆ°å¯¼èˆªæ å›¾è¡¨ç›¸è¿</span></span><br><span class="line">        appBerConfiguration = AppBarConfiguration(navController.graph, drawerLayout)</span><br><span class="line">        <span class="comment">//è®¾ç½®å°†ç”±appBerConfigurationæ¥æ§åˆ¶navController</span></span><br><span class="line">        setupActionBarWithNavController(navController, appBerConfiguration)</span><br><span class="line">        <span class="comment">//ç»™Navigationè®¾ç½®æ§åˆ¶å™¨</span></span><br><span class="line">        navigation.setupWithNavController(navController)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†é¡¶éƒ¨æ ä¸navigationè¿›è¡Œè¿æ¥</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSupportNavigateUp</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> navController.navigateUp(appBerConfiguration) || <span class="keyword">super</span>.onSupportNavigateUp()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>ä»¥ä¸Šæ•ˆæœå°±å®Œæˆäº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> View </tag>
            
            <tag> Kotlin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PicGoä¸Typora ä¸Šä¼ å›¾ç‰‡</title>
      <link href="2020/12/24/PicGo%E4%B8%8ETypora-%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/"/>
      <url>2020/12/24/PicGo%E4%B8%8ETypora-%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>å…³äºPicGoçš„é…ç½®ä¸ä½¿ç”¨</p><a id="more"></a><h1 id="PicGoçš„è®¾ç½®ä¸Typoraä¸Šä¼ å›¾ç‰‡"><a href="#PicGoçš„è®¾ç½®ä¸Typoraä¸Šä¼ å›¾ç‰‡" class="headerlink" title="PicGoçš„è®¾ç½®ä¸Typoraä¸Šä¼ å›¾ç‰‡"></a>PicGoçš„è®¾ç½®ä¸Typoraä¸Šä¼ å›¾ç‰‡</h1><blockquote><p>éœ€è¦èŠ±é’±çš„å“ˆ</p></blockquote><p><strong>é¦–å…ˆéœ€è¦è¿›è¡Œä¸‹é¢ä¸¤ä¸ªæ“ä½œ</strong></p><ol><li>é˜¿é‡ŒOSSå­˜å‚¨çš„è´­ä¹°ï¼ˆä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œä»¥é˜¿é‡Œä¸ºä¾‹å­ï¼‰</li><li>PicGoçš„ä¸‹è½½ä¸è®¾ç½®</li></ol><h3 id="é˜¿é‡ŒOSS"><a href="#é˜¿é‡ŒOSS" class="headerlink" title="é˜¿é‡ŒOSS"></a>é˜¿é‡ŒOSS</h3><ol><li><p><a href="https://www.aliyun.com/">æ‰“å¼€é˜¿é‡Œäº‘</a></p></li><li><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224151334.png"></p><p>é€‰æ‹©å¯¹è±¡å­˜å‚¨OSS</p></li><li><p>ç‚¹å‡»åˆ™æ‰£å¥—é¤è¿›è¡Œè´­ä¹°ï¼ˆ40Gï¼Œ1å¹´ï¼Œ8.7å…ƒå¾ˆé¦™ï¼‰</p></li><li><p>è´­ä¹°å®Œæˆåï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œåœ¨å·¦è¾¹æ ä¸­é€‰æ‹©Bucketåˆ—è¡¨</p></li><li><p>ç‚¹å‡»åˆ›å»ºBucket</p><ul><li><p>åœ°åŒºé€‰æ‹©ç¦»ä½ æœ€è¿‘çš„åœ°æ–¹ï¼Œç‰ˆæœ¬æ§åˆ¶å™¨çœ‹éœ€æ±‚æ¥å¼€ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯ä¸é¡»è¦å¼€å¯çš„ï¼ˆä¸ä¼šèŠ±é¢å¤–çš„é’±ï¼Œä½†æ˜¯ä¼šå ç”¨ä½ çš„ç©ºé—´ï¼‰</p></li><li><p>è¯»å†™æƒé™æ”¹ä¸ºå…¬å…±è¯»ï¼ˆä¸ç„¶åˆ«äººè®¿é—®ä¸äº†ä½ çš„å›¾ç‰‡ï¼‰</p></li><li><p>åˆ«çš„éƒ½æ˜¯å¹¶ä¸å¼€é€š</p></li></ul><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224151726.png" alt="image-20201224151723354"></p></li><li><p>æ¥ä¸‹æ¥åˆ›å»ºAccessKeyï¼Œç‚¹å‡»Access Key</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224152803.png" alt="image-20201224152801998"></p></li><li><p>ç‚¹å‡»åˆ›å»ºAccess Keyï¼Œå°†åˆ›å»ºå¥½çš„Access Keyä¿å­˜åˆ°æœ¬åœ°</p></li><li><p><a href="http://gosspublic.alicdn.com/oss-browser/1.9.4/oss-browser-win32-x64.zip">ä¸‹è½½å®‰è£…OSS Browserå®¢æˆ·ç«¯</a>ï¼ˆOSS Browseræ˜¯é˜¿é‡Œäº‘å®˜æ–¹çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨æ‹¥æœ‰OSSæƒé™çš„ç”¨æˆ·ç™»å½•ï¼Œä»è€Œå…å»ç™»å½•å®˜ç½‘æ§åˆ¶å°çš„éº»çƒ¦ã€‚ï¼‰</p></li><li><p>ä¸‹è½½å®‰è£…å¥½ä¹‹åæ‰“å¼€ï¼Œç”¨åˆšåˆšåˆ›å»ºå¥½çš„Access Keyæ¥è¿›è¡Œç™»å½•,Endpointé€‰æ‹©å…¬å…±äº‘ï¼Œä¹‹åå°±å¯ä»¥åœ¨é‡Œé¢çœ‹è§ä¸Šä¼ çš„å›¾ç‰‡ï¼Œæ–‡ä»¶ä¹‹ç±»çš„</p></li></ol><h3 id="PicGo"><a href="#PicGo" class="headerlink" title="PicGo"></a>PicGo</h3><p>PicGoæ˜¯ä¸€ä¸ªæ”¯æŒå¤šç§å›¾åºŠçš„å®¢æˆ·ç«¯å›¾ç‰‡ä¸Šä¼ å·¥å…·ï¼Œå¯ä»¥å®ç°å¿«é€Ÿä¸Šä¼ å›¾ç‰‡åˆ°æŒ‡å®šå›¾åºŠï¼Œå¹¶å°†é“¾æ¥ä¿å­˜åˆ°å‰ªè´´æ¿ã€‚</p><ol><li><p><a href="https://github.com/Molunerfinn/PicGo/releases">ä¸‹è½½PicGo</a></p></li><li><p>ä¸‹è½½å®‰è£…å¥½ä¹‹åï¼Œç‚¹å‡»å›¾åºŠè®¾ç½®ï¼Œé€‰æ‹©é˜¿é‡Œäº‘</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224153500.png" alt="image-20201224153459239"></p></li><li><p>é€‰æ‹©PicGoè®¾ç½®ï¼Œä¿®æ”¹å¿«æ·é”®ï¼Œè®¾ç½®ä½ å–œæ¬¢çš„å¿«æ·é”®</p></li><li><p>å…¶ä½™è®¾ç½®å¦‚ä¸‹</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224153701.png" alt="image-20201224153700790"></p></li></ol><h3 id="Typoraä¸Šä¼ å›¾ç‰‡"><a href="#Typoraä¸Šä¼ å›¾ç‰‡" class="headerlink" title="Typoraä¸Šä¼ å›¾ç‰‡"></a>Typoraä¸Šä¼ å›¾ç‰‡</h3><ol><li><p>æ‰“å¼€Typoraçš„è®¾ç½®</p></li><li><p>è¿›è¡Œå¦‚ä¸‹çš„è®¾ç½®</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224153821.png" alt="image-20201224153820513"></p></li></ol><h3 id="ä½¿ç”¨æ•™å­¦"><a href="#ä½¿ç”¨æ•™å­¦" class="headerlink" title="ä½¿ç”¨æ•™å­¦"></a>ä½¿ç”¨æ•™å­¦</h3><p>Win10çš„æˆªå›¾å¿«æ·é”®ä¸ºï¼ˆwin+shift+sï¼‰è¿›è¡Œé€‰æ‹©æˆªå›¾ï¼Œæˆªå®Œå›¾ç‰‡ä¹‹åï¼Œç²˜è´´è¿›Typoraï¼Œé€‰æ‹©ä¸Šä¼ å›¾ç‰‡ å³å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> Service </tag>
            
            <tag> Money </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WorkManageråå°ä»»åŠ¡</title>
      <link href="2020/12/24/WorkManager%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1/"/>
      <url>2020/12/24/WorkManager%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>ä»‹ç»JetPackä¸­çš„WorkManager</p><a id="more"></a><h1 id="å…³äºWorkManagerçš„ä½¿ç”¨"><a href="#å…³äºWorkManagerçš„ä½¿ç”¨" class="headerlink" title="å…³äºWorkManagerçš„ä½¿ç”¨"></a>å…³äºWorkManagerçš„ä½¿ç”¨</h1><blockquote><p>æœ¬ç¯‡ä»¥Kotlinä¸ºä¸»è¦è¯­è¨€</p></blockquote><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><strong>WorkManager</strong>æ˜¯ä¸€ä¸ªåå°æ‰§è¡Œä»»åŠ¡ç®¡ç†ï¼Œå³ä½¿åœ¨åº”ç”¨é€€å‡ºï¼Œä¹Ÿå¯ä»¥ç»§ç»­æ‰§è¡Œè¢«åˆ›å»ºçš„ä»»åŠ¡ã€‚è¿˜å¯ä»¥ä¸º<strong>WorkManager</strong>æ·»åŠ è§¦å‘æ¡ä»¶ã€‚å½“ç„¶è¿˜æœ‰ç‰¹æ®Šæƒ…å†µï¼Œå½“åº”ç”¨è¢«å½»åº•æ€æ­»çš„æ—¶å€™ï¼Œä»»åŠ¡æ˜¯ä¸ä¼šè§¦å‘çš„ï¼Œä¼šç­‰åˆ°ä¸‹æ¬¡åº”ç”¨å¼€å¯ï¼Œç„¶åè§¦å‘ä»»åŠ¡</p><ol><li><p>æ·»åŠ ä¾èµ–</p><ul><li><p>æ‰“å¼€å½“å‰é¡¹ç›®çš„ProjecySturcture</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224145449.png" alt="image-20201224145447147"></p></li><li><p>åœ¨Dependencies.appä¸­ç‚¹å‡» + æ¥æ·»åŠ ä¾èµ–ï¼Œä¹‹ååœ¨Library Dependencyä¸­æœç´¢androidx.work</p><p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224145615.png" alt="image-20201223092135741"></p></li><li><p>é€‰æ‹©ktxç»“å°¾çš„ï¼Œç‚¹å‡»okï¼Œç­‰å¾…ä¸‹è½½å®Œæˆ</p></li></ul></li><li><p>æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªç±»MyWorker ç»§æ‰¿ Worker</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyWorker</span></span>(context: Context, workerParams: WorkerParameters) : Worker(context, workerParams) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doWork</span><span class="params">()</span></span>: Result &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;work&quot;</span>, <span class="string">&quot;doWork: <span class="variable">$data</span> ä»»åŠ¡å¼€å§‹&quot;</span> )</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>)</span><br><span class="line">        Log.e(<span class="string">&quot;work&quot;</span>, <span class="string">&quot;doWork: <span class="variable">$data</span> ä»»åŠ¡ç»“æŸ&quot;</span> )</span><br><span class="line">        <span class="keyword">return</span> Result.success()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§æ‰¿Worker æ˜¯éœ€è¦ä¼ å…¥å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºæ„é€ æ–¹æ³•ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿï¼Œäºæ˜¯æ‰“å°æ—¥å¿—</p></li><li><p>ç„¶åå†Activityä¸­åˆ›å»ºå…¨å±€å˜é‡ workManangerï¼Œå¹¶ä¸”åˆ›å»ºworkRequestä¸”ä¼ å…¥</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> workManager = WorkManager.getInstance(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        <span class="comment">//è¿™é‡Œåœ¨XMLä¸­åˆ›å»ºäº†ä¸€ä¸ªButtonï¼Œä¸ºå…¶è®¾ç½®ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">        button.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> wrokRequest = OneTimeWorkRequestBuilder&lt;MyWorker&gt;()</span><br><span class="line">            .build()</span><br><span class="line">            workManager.enqueue(wrokRequest)</span><br><span class="line">            <span class="comment">//å°†åˆ›å»ºå¥½çš„workRequestä¼ é€’ç»™workManager</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šï¼Œå…³äºworkManagerçš„ç®€å•ä½¿ç”¨å°±å®Œæˆäº†</p></li></ol><h3 id="WorkManagerçš„è§¦å‘æ¡ä»¶ä¸ä¼ é€’æ•°æ®ã€ä¸²æ¥"><a href="#WorkManagerçš„è§¦å‘æ¡ä»¶ä¸ä¼ é€’æ•°æ®ã€ä¸²æ¥" class="headerlink" title="WorkManagerçš„è§¦å‘æ¡ä»¶ä¸ä¼ é€’æ•°æ®ã€ä¸²æ¥"></a>WorkManagerçš„è§¦å‘æ¡ä»¶ä¸ä¼ é€’æ•°æ®ã€ä¸²æ¥</h3><h5 id="è§¦å‘æ¡ä»¶"><a href="#è§¦å‘æ¡ä»¶" class="headerlink" title="è§¦å‘æ¡ä»¶"></a>è§¦å‘æ¡ä»¶</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">val</span> constraints = Constraints.Builder()</span><br><span class="line">           .setRequiredNetworkType(NetworkType.CONNECTED)</span><br><span class="line">           .build()</span><br><span class="line"><span class="keyword">val</span> wrokRequest = OneTimeWorkRequestBuilder&lt;MyWorker&gt;()</span><br><span class="line">           .setConstraints(constraints)</span><br><span class="line">           .build()</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªconstraintsï¼Œå¹¶ä¸”ç»™ä»–è®¾ç½®è§¦å‘æ¡ä»¶ä¸ºè¿æ¥ç½‘ç»œæ—¶è§¦å‘ï¼Œç„¶åä¼ é€’ç»™workRequest</p><h5 id="ä¼ é€’æ•°æ®"><a href="#ä¼ é€’æ•°æ®" class="headerlink" title="ä¼ é€’æ•°æ®"></a>ä¼ é€’æ•°æ®</h5><p>å¯ä»¥å°†æ•°æ®ä¼ é€’è¿›Workerï¼ŒWorkerä¹Ÿå¯ä»¥æŠŠæ•°æ®ä¼ é€’å‡ºæ¥</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> wrokRequest = OneTimeWorkRequestBuilder&lt;MyWorker&gt;()</span><br><span class="line">            .setConstraints(constraints)</span><br><span class="line">            .setInputData(workDataOf(INTPUT_WORK_KEY to <span class="keyword">data</span>))</span><br><span class="line">            .build()</span><br></pre></td></tr></table></figure><p>ä¼ é€’æ•°æ®æ˜¯é€šè¿‡setInputDataï¼Œæ¥å—ä¸€ä¸ªworkDataå‚æ•°ï¼ŒworkDataæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæœ€ååœ¨Workerä¸­æ¥å—æ•°æ®</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyWorker</span></span>(context: Context, workerParams: WorkerParameters) : Worker(context, workerParams) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doWork</span><span class="params">()</span></span>: Result &#123;</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = inputData.getString(<span class="string">&quot;Key&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> Result.success(workDataOf(OUT_WORK_KEY to <span class="string">&quot;ä»»åŠ¡å·²ç»“æŸ&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡inputData æ¥æ¥å—æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡return Successæ¥ä¼ é€’å‡ºå»æ•°æ®ï¼Œåœ¨Activity/Fragmentä¸­é€šè¿‡LiveDataè§‚å¯Ÿæ¥è·å–æ•°æ®</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">workManage.getWorkInfoByIdLiveData(workRequestA.id).observe(<span class="keyword">this</span>, Observer &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;ä»»åŠ¡å®Œæˆï¼Œè¿”å›æ•°æ®ä¸º<span class="subst">$&#123;it.outputData&#125;</span>&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure><h5 id="ä¸²æ¥"><a href="#ä¸²æ¥" class="headerlink" title="ä¸²æ¥"></a>ä¸²æ¥</h5><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå°†åˆ›å»ºè§¦å‘æ¡ä»¶ä¸åˆ›å»ºworkRequestçš„å†…å®¹æå–å‡ºæ¥ï¼ˆå¿«æ·é”®ä¸º:ctrl+alt+mï¼‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createWork</span><span class="params">(<span class="keyword">data</span>: <span class="type">String</span>)</span></span>: OneTimeWorkRequest &#123;</span><br><span class="line">        <span class="keyword">val</span> constraints = Constraints.Builder()</span><br><span class="line">            .setRequiredNetworkType(NetworkType.CONNECTED)</span><br><span class="line">            .build()</span><br><span class="line">        <span class="keyword">return</span> OneTimeWorkRequestBuilder&lt;MyWorker&gt;()</span><br><span class="line">            .setConstraints(constraints)</span><br><span class="line">            .setInputData(workDataOf(INTPUT_WORK_KEY to <span class="keyword">data</span>))</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ç»™è¿™ä¸ªæ–¹æ³•ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥è¿›è¡Œä¸Workerä¹‹é—´ä¼ é€’æ•°æ®,ç„¶åä½¿ç”¨</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> WORK_A_DATA = <span class="string">&quot;A ni shi han han&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> WORK_B_DATA = <span class="string">&quot;B ni shi han han&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> workRequestA = createWork(WORK_A_DATA)</span><br><span class="line"><span class="keyword">val</span> workRequestB = createWork(WORK_B_DATA)</span><br><span class="line">    workManager.beginWith(workRequestA)</span><br><span class="line">        .then(workRequestB)</span><br><span class="line">        .enqueue()</span><br></pre></td></tr></table></figure><p>beginWith() æ˜¯ä¼ å…¥ç¬¬ä¸€ä¸ªworkRequestï¼Œå‰©ä¸‹çš„é€šè¿‡thenæ¥ä¼ é€’ï¼Œæœ€ååˆ«å¿˜äº†è°ƒç”¨enqueue()</p>]]></content>
      
      
      
        <tags>
            
            <tag> Thread </tag>
            
            <tag> Kotlin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Roomåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨</title>
      <link href="2020/12/24/Room%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2020/12/24/Room%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ä»‹ç»JetPackä¸­çš„Room</p><a id="more"></a><h1 id="Roomåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨"><a href="#Roomåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨" class="headerlink" title="Roomåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨"></a>Roomåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨</h1><blockquote><p>æœ¬ç¯‡å·²Javaä¸ºä¸»è¦è¯­è¨€</p></blockquote><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&quot;androidx.room:room-runtime:2.2.5&quot;</span></span><br><span class="line">annotationProcessor  <span class="string">&quot;androidx.room:room-compiler:2.2.5&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æ¥ä¸‹æ¥æˆ‘å°±ä»¥ä¿å­˜å†å²ä¸ºä¾‹,å…ˆä»‹ç»ä¸€ä¸‹å„ä¸ªæ³¨é‡Šçš„æ„æ€</p><table><thead><tr><th>æ³¨é‡Šåç§°</th><th>æ„æ€</th></tr></thead><tbody><tr><td>@Entity</td><td>ä»£è¡¨æ•°æ®åº“ä¸­æŸä¸ªè¡¨çš„å®ä½“ç±»ã€‚</td></tr><tr><td>@Ignore</td><td>ä»£è¡¨æ— ç”¨çš„æ„é€ æ–¹æ³•</td></tr><tr><td>@PrimaryKey()</td><td>ä»£è¡¨ä¸»é”®çš„æ„æ€ï¼Œæ˜¯å¿…é¡»è¦æœ‰çš„</td></tr><tr><td>@Database</td><td>åŒ…å«æ•°æ®åº“æŒæœ‰è€…ï¼Œå¹¶ä½œä¸ºä¸åº”ç”¨æŒä¹…å…³è”æ•°æ®çš„åº•å±‚è¿æ¥çš„ä¸»è¦è®¿é—®ç‚¹</td></tr></tbody></table><ol><li><p>åˆ›å»º HistoryBean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HistoryBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HistoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HistoryBean</span><span class="params">(<span class="keyword">int</span> id, String name, String address, String state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.EquipmentId = id;</span><br><span class="line">        <span class="keyword">this</span>.EquipmentName = name;</span><br><span class="line">        <span class="keyword">this</span>.EquipmentAddress = address;</span><br><span class="line">        <span class="keyword">this</span>.EquipmentState = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PrimaryKey()</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> EquipmentId;</span><br><span class="line">    <span class="keyword">private</span> String EquipmentName;</span><br><span class="line">    <span class="keyword">private</span> String EquipmentAddress;</span><br><span class="line">    <span class="keyword">private</span> String EquipmentPersonnel;</span><br><span class="line">    <span class="keyword">private</span> String EquipmentState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEquipmentId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> EquipmentId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEquipmentId</span><span class="params">(<span class="keyword">int</span> equipmentId)</span> </span>&#123;</span><br><span class="line">        EquipmentId = equipmentId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEquipmentName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> EquipmentName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEquipmentName</span><span class="params">(String equipmentName)</span> </span>&#123;</span><br><span class="line">        EquipmentName = equipmentName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEquipmentAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> EquipmentAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEquipmentAddress</span><span class="params">(String equipmentAddress)</span> </span>&#123;</span><br><span class="line">        EquipmentAddress = equipmentAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEquipmentPersonnel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> EquipmentPersonnel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEquipmentPersonnel</span><span class="params">(String equipmentPersonnel)</span> </span>&#123;</span><br><span class="line">        EquipmentPersonnel = equipmentPersonnel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEquipmentState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> EquipmentState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEquipmentState</span><span class="params">(String equipmentState)</span> </span>&#123;</span><br><span class="line">        EquipmentState = equipmentState;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ç®¡ç†ç±» ï¼ˆAppDatabaseï¼‰ç»§æ‰¿ RoomDatabase</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Database(entities = &#123;HistoryBean.class&#125;, version = 1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDatabase</span> <span class="keyword">extends</span> <span class="title">RoomDatabase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> HistoryDao <span class="title">historyDao</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç„¶ååœ¨åˆ›å»ºä¸€ä¸ªæ•°æ®åº“æ“ä½œæ¥å£ ï¼ˆHistoryDaoï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HistoryDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> historyBean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertAll</span><span class="params">(HistoryBean historyBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Query(&quot;DELETE FROM historybean&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ•°æ®ï¼ˆä¼ å…¥ä¸ä¸€æ ·çš„æ•°æ®ï¼Œå°†ä¼šè‡ªåŠ¨å°†ä¸ä¸€æ ·çš„æ•°æ®æ›¿æ¢æ—§æ•°æ®ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> historyBean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUsers</span><span class="params">(HistoryBean historyBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Query(&quot;SELECT * FROM HistoryBean&quot;)</span></span><br><span class="line">    LiveData&lt;List&lt;HistoryBean&gt;&gt; getAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>æ¥ä¸‹æ¥å°±æ˜¯åœ¨Activity/Fragmentä¸­ä½¿ç”¨ï¼Œå› ä¸ºåœ¨ä¸»çº¿ç¨‹ä¸­æ˜¯ä¸å…è®¸è¿›è¡Œæ•°æ®åº“æ“ä½œçš„ï¼Œä¼šé˜»å¡çº¿ç¨‹ï¼Œæ‰€ä»¥å¿…é¡»è¦åœ¨å­çº¿ç¨‹ä¸­æ¥æ“ä½œæ•°æ®åº“ã€‚ä¸‹é¢çš„ä»£ç å°±æ˜¯ä½¿ç”¨AsyncTaskæ¥è¿›è¡Œå­çº¿ç¨‹æ“ä½œ</p><p>é‚£ä¹ˆä¸‹é¢å°†åˆ›å»ºä¸€ä¸ªæ•°æ®åº“æ“ä½œç±»ï¼Œç”¨æ¥æ–¹ä¾¿è¿›è¡Œæ•°æ®åº“æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaoOperation</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppDatabase db;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DaoOperation instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™é‡Œå°†DaoOpertaionè®¾ç½®ä¸ºå•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºä¼šåœ¨å„ç§åœ°æ–¹ä½¿ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DaoOperation <span class="title">getDatabase</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (AppDatabase.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    db = MyApplication.getDatabase(context);</span><br><span class="line">                    instance = <span class="keyword">new</span> DaoOperation();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¯å¯¹å¤–å¼€æ”¾æ¥å£</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertHistory</span><span class="params">(HistoryBean historyBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> insertHistory(historyBean).execute(historyBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dellHistory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> dellHistory().execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upHistory</span><span class="params">(HistoryBean historyBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> upHistory(historyBean).execute(historyBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»¥ä¸‹æ˜¯å†…éƒ¨å®ç°è¿‡ç¨‹</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥å†å²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">insertHistory</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">HistoryBean</span>, <span class="title">Void</span>, <span class="title">Void</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> HistoryBean historyBean;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">insertHistory</span><span class="params">(HistoryBean historyBean)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.historyBean = historyBean;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(HistoryBean... historyBeans)</span> </span>&#123;</span><br><span class="line">            db.historyDao().insertAll(historyBean);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤å…¨éƒ¨å†å²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">dellHistory</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">Void</span>, <span class="title">Void</span>, <span class="title">Void</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">dellHistory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(Void... voids)</span> </span>&#123;</span><br><span class="line">            db.historyDao().deleteAll();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ”¹å†å²ï¼ˆåŸºæœ¬ç”¨ä¸ä¸Šï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">upHistory</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">HistoryBean</span>, <span class="title">Void</span>, <span class="title">Void</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> HistoryBean historyBean;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">upHistory</span><span class="params">(HistoryBean historyBean)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.historyBean = historyBean;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Void <span class="title">doInBackground</span><span class="params">(HistoryBean... historyBeans)</span> </span>&#123;</span><br><span class="line">            db.historyDao().updateUsers(historyBean);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…³äºAsyncTastçš„ä½¿ç”¨ï¼Œå…¶ä»–ç¯‡å¹…å°±å·²ç»è®²è¿‡äº†ï¼Œè¿™é‡Œå°±å¹¶è¿›è¡Œè®²è§£äº† <a href="%E5%85%B3%E4%BA%8EAndroid%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C.md">å…³äºAndroidå¤šçº¿ç¨‹æ“ä½œ</a></p></li><li><p>æœ€ååœ¨Activty/Fragmentä¸­ä½¿ç”¨ï¼ˆå±•ç¤ºç»å¸¸ä½¿ç”¨çš„æ’å…¥å’Œåˆ é™¤ï¼‰</p><p><code>æ’å…¥</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DaoOperation.getDatabase(<span class="keyword">this</span>).insertHistory(<span class="keyword">new</span> HistoryBean(id,name, address,state));</span><br></pre></td></tr></table></figure><p><code>åˆ é™¤</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DaoOperation.getDatabase(<span class="keyword">this</span>).dellHistory();</span><br></pre></td></tr></table></figure></li><li><p>å±•ç¤ºä¸ä¸€æ ·çš„æ•°æ®åº“æŸ¥è¯¢ï¼ˆä¸‹é¢çš„ä»£ç HistoryModelæ˜¯å› ä¸ºæˆ‘å½“å‰é¡¹ç›®ä½¿ç”¨çš„Mvvmçš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘å°†æ‰€ä»¥æ•°æ®æ“ä½œéƒ½æ”¾åœ¨Modelä¸­äº†ï¼‰</p><p>å› ä¸ºä¸Šé¢è®¾ç½®æŸ¥è¯¢çš„ç»“æœä¸ºLiveDataï¼Œä¹Ÿå°±æ˜¯å¯è§‚å¯Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HistoryModel mHistoryModel = <span class="keyword">new</span> ViewModelProvider(<span class="keyword">this</span>).get(HistoryModel.class);</span><br><span class="line">        mHistoryModel.getHistory(<span class="keyword">this</span>).observe(<span class="keyword">this</span>, <span class="keyword">new</span> Observer&lt;List&lt;HistoryBean&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onChanged</span><span class="params">(List&lt;HistoryBean&gt; historyBeans)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//è¿™é‡Œæˆ‘æ˜¯å°†æŸ¥è¯¢åˆ°çš„æ•°æ®ä¼ å…¥è®¾é…å™¨ä¸­</span></span><br><span class="line">                adapter.loadMore(historyBeans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>å…³äºä½¿ç”¨LiveDataçš„å¥½å¤„æœ‰å¤šï¼Œæ¯”å¦‚</p><ul><li>ä¼šè§‚å¯Ÿå½“å‰å¼•ç”¨ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼Œåªä¼šåœ¨ç”Ÿå‘½å‘¨æœŸå†…è¿›è¡Œæ“ä½œ</li><li>ä¸ä¼šé€ æˆå†…å­˜æ³„æ¼</li><li>ä¸€æ—¦æ•°æ®å‘é€å˜åŒ–ï¼Œå°†ç«‹é©¬é€šçŸ¥</li></ul></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SmallestWidth é™å®šç¬¦</title>
      <link href="2020/12/17/SmallestWidth-%E9%99%90%E5%AE%9A%E7%AC%A6/"/>
      <url>2020/12/17/SmallestWidth-%E9%99%90%E5%AE%9A%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<p>ä»‹ç»Androidå±å¹•é€‚é…çš„æ–¹æ³•</p><a id="more"></a><h1 id="SmallestWidth-é™å®šç¬¦"><a href="#SmallestWidth-é™å®šç¬¦" class="headerlink" title="SmallestWidth é™å®šç¬¦"></a>SmallestWidth é™å®šç¬¦</h1><blockquote><p>æœ¬ç¯‡ä¸é™è¯­è¨€</p></blockquote><h3 id="ä»‹ç»smallestWidth-é™å®šç¬¦"><a href="#ä»‹ç»smallestWidth-é™å®šç¬¦" class="headerlink" title="ä»‹ç»smallestWidth é™å®šç¬¦"></a>ä»‹ç»smallestWidth é™å®šç¬¦</h3><ol><li>ä¼˜ç‚¹<ul><li>ä½¿ç”¨è¿™ç§æ–¹å¼åªéœ€è¦å°‘é‡ dimens.xml æ–‡ä»¶å³å¯è¾¾åˆ°é€‚é…ï¼Œè€Œä¸”æ ¹æœ¬ä¸ç”¨è€ƒè™‘è™šæ‹ŸæŒ‰é”®çš„é—®é¢˜ã€‚å¦‚æœåªé€‚é…æ‰‹æœºï¼Œdimens.xml æ–‡ä»¶æ‰€å çš„ä½“ç§¯åªæœ‰ 100 å¤š KBï¼Œå³ä½¿åŠ ä¸Šå¹³æ¿å’Œ TVï¼Œä¹Ÿå°± 500 å¤š KBï¼Œå®Œå…¨å¯ä»¥æ¥æ”¶ã€‚</li></ul></li></ol><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ol><li>æ‰“å¼€AndroidStudio</li><li>è¿›å…¥Settings</li><li>é€‰æ‹©Plugins</li><li>åœ¨æ’ä»¶å•†åº—é‡Œé¢ æœç´¢ â€œScreenMatchâ€ ç‚¹å‡»å®‰è£… æœ€åç‚¹å‡»â€œokâ€ï¼Œé‡å¯AndroidStudioå³å¯</li><li>åœ¨é¡¹ç›®çš„é»˜è®¤ values æ–‡ä»¶å¤¹ä¸­éœ€è¦ä¸€ä»½ dimens.xml æ–‡ä»¶<ul><li><a href="https://github.com/wildma/ScreenAdaptation/blob/master/app/src/main/res/values/dimens.xml">è¿™é‡Œæä¾›ä½¿ç”¨</a></li></ul></li><li>æ‰§è¡Œç”Ÿæˆ<ul><li>æ’ä»¶å®‰è£…å¥½åï¼Œåœ¨é¡¹ç›®çš„ä»»æ„ç›®å½•æˆ–æ–‡ä»¶ä¸Šå³é”®ï¼Œé€‰æ‹© ScreenMatch é€‰é¡¹ï¼ˆå¦‚ä¸‹å›¾ï¼‰</li><li><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224145630.webp" alt="img"></li></ul></li><li>é€‰æ‹©å¯¹é‚£ä¸ªmoduleè¿›è¡Œé€‚é…ï¼ˆä¸€èˆ¬æ¥è¯´å°±æ˜¯é€‰æ‹©appå³å¯ï¼‰</li><li>resç›®å½•ä¸‹ä¼šç”Ÿæˆå¯¹åº”å®½åº¦dpiçš„æ–‡ä»¶ï¼ˆå¦‚ä¸‹å›¾ï¼‰<ul><li><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/20201224145638.webp" alt="img"></li></ul></li><li>åœ¨xmlæ–‡ä»¶ä¸­å†™å¸ƒå±€çš„æ—¶å€™ï¼Œå•ä½å°±ä½¿ç”¨dp_xxxå³å¯å®Œæˆé€‚é…ï¼ˆå¦‚ä¸‹ï¼‰</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;@dimen/dp_50&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;@dimen/dp_50&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;Hello World!&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> å±å¹•é€‚é… </tag>
            
            <tag> NoLimits </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Andoridçš„å¤šçº¿ç¨‹æ“ä½œ/UI</title>
      <link href="2020/12/17/Andorid%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C-UI/"/>
      <url>2020/12/17/Andorid%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%93%8D%E4%BD%9C-UI/</url>
      
        <content type="html"><![CDATA[<p>ä»‹ç»åœ¨Androidä¸­ä»»ä½•å¼€å¯å¤šçº¿ç¨‹</p><a id="more"></a><h1 id="Andoridçš„å¤šçº¿ç¨‹æ“ä½œ-UI"><a href="#Andoridçš„å¤šçº¿ç¨‹æ“ä½œ-UI" class="headerlink" title="Andoridçš„å¤šçº¿ç¨‹æ“ä½œ/UI"></a>Andoridçš„å¤šçº¿ç¨‹æ“ä½œ/UI</h1><blockquote><p>æœ¬ç¯‡å·²Javaä¸ºä¸»è¦è¯­è¨€</p></blockquote><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><ol><li>Thread</li><li>AsyncTask</li></ol><h3 id="Threadçš„ä½¿ç”¨"><a href="#Threadçš„ä½¿ç”¨" class="headerlink" title="Threadçš„ä½¿ç”¨"></a>Threadçš„ä½¿ç”¨</h3><h5 id="Threadå­çº¿ç¨‹è¿è¡Œ"><a href="#Threadå­çº¿ç¨‹è¿è¡Œ" class="headerlink" title="Threadå­çº¿ç¨‹è¿è¡Œ"></a>Threadå­çº¿ç¨‹è¿è¡Œ</h5><ol><li>åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿Threadï¼Œå¹¶ä¸”é‡å†™runæ–¹æ³•ï¼ˆå¦‚ä¸‹ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span>()</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦åœ¨runæ–¹æ³•ä¸­å†™è€—æ—¶æ“ä½œå³å¯</p><ol start="2"><li>ä½¿ç”¨ï¼š MyThread.start(); </li><li>æ›´æ”¹å†™æ³•ï¼Œç»§æ‰¿Runnable</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Runnable</span>()</span>&#123;</span><br><span class="line"><span class="meta">@Overrid</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//TODO</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ”¹äº†å†™æ³•ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿéœ€è¦æ”¹å˜,</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyThread thread = <span class="keyword">new</span> MyThread();</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure><h5 id="Threadå­çº¿ç¨‹é€šçŸ¥UIæ›´æ”¹"><a href="#Threadå­çº¿ç¨‹é€šçŸ¥UIæ›´æ”¹" class="headerlink" title="Threadå­çº¿ç¨‹é€šçŸ¥UIæ›´æ”¹"></a>Threadå­çº¿ç¨‹é€šçŸ¥UIæ›´æ”¹</h5><ol><li>é¦–å…ˆåœ¨å­çº¿ç¨‹ä¸­æ˜¯ä¸è¿è¡Œè¿›è¡ŒUIæ“ä½œï¼Œæƒ³è¦è¿›è¡ŒUIæ“ä½œï¼Œåªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œæ“ä½œã€‚</li><li>é‚£ä¹ˆï¼Œåœ¨å­çº¿ç¨‹ä¸­æƒ³è¦æ›´æ”¹UIï¼Œå°±åªèƒ½é€šè¿‡Handleræ¥è¿›è¡ŒUIæ“ä½œ</li></ol><ul><li>å…ˆä»‹ç»ä¸€ä¸‹Handler<ol><li><strong>Message</strong> :æ¶ˆæ¯ä½“ï¼Œå¯æºå¸¦ä¸€äº›ä¿¡æ¯ï¼Œåœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´è¿›è¡Œä¼ é€’æ•°æ®</li><li><strong>Handler</strong> :æ¶ˆæ¯ å‘é€/å¤„ç† è€…ï¼Œå¯é€šè¿‡Handler.sendMessage()æ¥å‘é€æ•°æ®ï¼Œä¹Ÿå¯ä»¥åœ¨handlerMesageä¸­å¤„ç†æ•°æ®</li><li><strong>MessageQueue</strong> :æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé‡Œé¢å­˜æ”¾ç­‰å¾…å¤„ç†çš„æ¶ˆæ¯</li><li><strong>Looper</strong> : MessageQueueçš„ç®¡å®¶ ç”¨æ¥å¼€å¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œä¸åœçš„æŸ¥çœ‹MessageQueueä¸­æ˜¯å¦è¿˜æœ‰ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å–å‡ºç»™Handlerè¿›è¡Œå¤„ç†ã€‚</li></ol></li></ul><ol start="3"><li>ä»£ç å±•ç¤º</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TextView textView;</span><br><span class="line">    <span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(<span class="meta">@NonNull</span> Message msg)</span> </span>&#123;</span><br><span class="line">            textView.setText((String) msg.obj);</span><br><span class="line">            <span class="comment">//åœ¨handleMessageä¸­æ˜¯å±äºä¸»çº¿ç¨‹</span></span><br><span class="line">            <span class="comment">//å°±å¯ä»¥ä»Messageä¸­å–å‡ºä¼ é€’çš„æ¶ˆæ¯ï¼Œèµ‹å€¼åˆ°TextViewä¸Šå»</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        textView = findViewById(R.id.title);</span><br><span class="line">        <span class="keyword">new</span> MyThread().start();</span><br><span class="line">        <span class="comment">//å¼€å¯çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">//åœ¨å­çº¿ç¨‹ä¸­æƒ³è¦æ›´æ”¹UIï¼Œé‚£ä¹ˆå°±åªèƒ½é€šçŸ¥Handleræ¥æ›´æ”¹UI</span></span><br><span class="line">            Message message = <span class="keyword">new</span> Message();</span><br><span class="line">            message.obj = <span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯&quot;</span>;</span><br><span class="line">            handler.sendMessage(message);</span><br><span class="line">            <span class="comment">//è¿™é‡Œå‘Handlerä¼ é€’äº†ä¸€ä¸ªMessageï¼ŒMessageé‡ŒåŒ…å«äº†ä¸€æ®µæ–‡å­—</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h3><ol><li>ä»‹ç»ï¼šç›¸æ¯”    Threadæ¥è¯´ï¼ŒAsyncTaskå°†æ–¹ä¾¿å¾ˆå¤šï¼Œä¸éœ€è¦å¤æ‚çš„é€šçŸ¥Handlerè¿›è¡ŒUIæ“ä½œï¼Œå…¨éƒ¨éƒ½å¯ä»¥åœ¨AsyncTaskä¸­å®Œæˆ</li><li>ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿AsyncTaskå¹¶ä¼ é€’3ä¸ªå‚æ•°å³å¯ï¼Œä¸‹é¢å°†ä»‹ç»AsyncTaskçš„3ä¸ªéœ€è¦é‡å†™çš„æ–¹æ³•<ul><li><strong>onPreExecute</strong>:æ­¤æ–¹æ³•å¤„äºä¸»çº¿ç¨‹ï¼Œå¯è¿›è¡Œä¸€äº›UIåˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚è¯´åˆå§‹åŒ–è¿›åº¦æ¡</li><li><strong>doInBackground</strong>:æ­¤æ–¹æ³•å¤„äºå­çº¿ç¨‹ï¼Œç”¨äºè¿›è¡Œä¸€äº›è€—æ—¶æ“ä½œ</li><li><strong>onProgressUpdate</strong>:æ­¤æ–¹æ³•å¤„äºä¸»çº¿ç¨‹ï¼Œå¯è¿›è¡ŒUIæ“ä½œï¼Œå¹¶ä¸”å¦‚æœè®¾ç½®äº†è¿”å›å€¼ï¼Œå°†ä¼šä¸åœçš„åœ¨doInBackgroundè¿è¡Œæ—¶è¿”å›ç»“æœ</li></ul></li><li>ä¸‹é¢å°†ä»¥ä¸‹è½½åŠŸèƒ½å¹¶ä¸”æ›´æ–°è¿›åº¦æ¡ä¸ºä¾‹</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTaskDome</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ProgressDialog progressDialog;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_async_task_dome); </span><br><span class="line">        progressDialog = <span class="keyword">new</span> ProgressDialog(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">new</span> Download().execute(<span class="string">&quot;ä¸‹è½½åœ°å€&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Download</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>, <span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPreExecute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            progressDialog.show();</span><br><span class="line">            <span class="comment">//åˆå§‹åŒ–è¿›åº¦æ¡</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> Boolean <span class="title">doInBackground</span><span class="params">(String... strings)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œå‡è£…åœ¨è¿›è¡Œä¸‹è½½</span></span><br><span class="line">            Uri uri = Uri.parse(strings[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Integer... integers)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œå¯¹è¿›åº¦æ¡è¿›è¡Œæ›´æ–°è¿›åº¦</span></span><br><span class="line">            progressDialog.setMessage(String.valueOf(integers[<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å­å°±å®Œæˆäº†åœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UI</p>]]></content>
      
      
      
        <tags>
            
            <tag> Thread </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Roomæ•°æ®åº“çš„ä½¿ç”¨</title>
      <link href="2020/11/21/Room%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2020/11/21/Room%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Roomæ•°æ®åº“çš„è¡¥å……</p><a id="more"></a><h2 id="å…³äºAndroidå®˜æ–¹çš„Roomæ•°æ®åº“æ¡†æ¶çš„ä½¿ç”¨"><a href="#å…³äºAndroidå®˜æ–¹çš„Roomæ•°æ®åº“æ¡†æ¶çš„ä½¿ç”¨" class="headerlink" title="å…³äºAndroidå®˜æ–¹çš„Roomæ•°æ®åº“æ¡†æ¶çš„ä½¿ç”¨"></a>å…³äºAndroidå®˜æ–¹çš„Roomæ•°æ®åº“æ¡†æ¶çš„ä½¿ç”¨</h2><h6 id="å…³äºRoom"><a href="#å…³äºRoom" class="headerlink" title="å…³äºRoom"></a>å…³äºRoom</h6><p> Roomæ˜¯ä¸€ä¸ªå¯¹è±¡å…³ç³»æ˜ å°„(ORM)åº“ã€‚RoomæŠ½è±¡äº†SQLiteçš„ä½¿ç”¨ï¼Œå¯ä»¥åœ¨å……åˆ†åˆ©ç”¨SQLiteçš„åŒæ—¶è®¿é—®æµç•…çš„æ•°æ®åº“ã€‚<br> Roomç”±ä¸‰ä¸ªé‡è¦çš„ç»„ä»¶ç»„æˆï¼šDatabaseã€Entityã€DAO</p><ul><li>Databaseï¼šåŒ…å«æ•°æ®åº“æŒæœ‰è€…ï¼Œå¹¶ä½œä¸ºä¸åº”ç”¨æŒä¹…å…³è”æ•°æ®çš„åº•å±‚è¿æ¥çš„ä¸»è¦è®¿é—®ç‚¹ã€‚è€Œä¸”Databaseå¯¹åº”çš„ç±»å¿…é¡»æ»¡è¶³ä¸‹é¢å‡ ä¸ªæ¡ä»¶ï¼š<br>Â 1. å¿…é¡»æ˜¯abstractç±»è€Œä¸”çš„extends RoomDatabaseã€‚<ol start="2"><li>å¿…é¡»åœ¨ç±»å¤´çš„æ³¨é‡Šä¸­åŒ…å«ä¸æ•°æ®åº“å…³è”çš„å®ä½“åˆ—è¡¨(Entityå¯¹åº”çš„ç±»)ã€‚</li><li>åŒ…å«ä¸€ä¸ªå…·æœ‰0ä¸ªå‚æ•°çš„æŠ½è±¡æ–¹æ³•ï¼Œå¹¶è¿”å›ç”¨@Daoæ³¨è§£çš„ç±»ã€‚</li><li>åœ¨è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡Room.databaseBuilder() æˆ–è€… Room.inMemoryDatabaseBuilder()è·å–Databaseå®ä¾‹ã€‚</li></ol></li><li>Entityï¼šä»£è¡¨æ•°æ®åº“ä¸­æŸä¸ªè¡¨çš„å®ä½“ç±»ã€‚</li><li>DAOï¼šåŒ…å«ç”¨äºè®¿é—®æ•°æ®åº“çš„æ–¹æ³•ã€‚</li></ul><h5 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def room_version &#x3D; &quot;2.2.5&quot;</span><br><span class="line">implementation &quot;androidx.room:room-runtime:$room_version&quot;</span><br><span class="line">annotationProcessor &quot;androidx.room:room-compiler:$room_version&quot;</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h5><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªBeanç±»ï¼Œç”¨æ¥åšä¸ºæ•°æ®åº“çš„è¡¨<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">@Entity(indices &#x3D; &#123;@Index(&quot;BookName&quot;)&#125;)</span><br><span class="line">public class BookBean &#123;</span><br><span class="line"></span><br><span class="line">    public BookBean()&#123; &#125;</span><br><span class="line"></span><br><span class="line">    public BookBean(String name,String autohor,Data data)&#123;</span><br><span class="line">        this.BookName &#x3D; name;</span><br><span class="line">        this.BookAuthor &#x3D; autohor;</span><br><span class="line">        this.data &#x3D; data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PrimaryKey(autoGenerate &#x3D; true)</span><br><span class="line">    private int BookId;</span><br><span class="line"></span><br><span class="line">    private String BookName;</span><br><span class="line">    private String BookAuthor;</span><br><span class="line">    private static Data data;</span><br><span class="line"></span><br><span class="line">    public int getBookId() &#123;</span><br><span class="line">        return BookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBookId(int bookId) &#123;</span><br><span class="line">        BookId &#x3D; bookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBookName() &#123;</span><br><span class="line">        return BookName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBookName(String bookName) &#123;</span><br><span class="line">        BookName &#x3D; bookName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBookAuthor() &#123;</span><br><span class="line">        return BookAuthor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBookAuthor(String bookAuthor) &#123;</span><br><span class="line">        BookAuthor &#x3D; bookAuthor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Data&#123;</span><br><span class="line">        private String userName;</span><br><span class="line">        private int userId;</span><br><span class="line"></span><br><span class="line">        public String getUserName() &#123;</span><br><span class="line">            return userName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setUserName(String userName) &#123;</span><br><span class="line">            this.userName &#x3D; userName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int getUserId() &#123;</span><br><span class="line">            return userId;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setUserId(int userId) &#123;</span><br><span class="line">            this.userId &#x3D; userId;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>@Entitydçš„æ³¨é‡Šä»£è¡¨æ•°æ®åº“ä¸­æŸä¸ªè¡¨çš„å®ä½“ç±»ã€‚é»˜è®¤æƒ…å†µä¸‹Roomä¼šæŠŠEntityé‡Œé¢æ‰€æœ‰çš„å­—æ®µå¯¹åº”åˆ°è¡¨ä¸Šçš„æ¯ä¸€åˆ—ã€‚å¦‚æœéœ€è¦åˆ¶å®šæŸä¸ªå­—æ®µä¸ä½œä¸ºè¡¨ä¸­çš„ä¸€åˆ—éœ€è¦æ·»åŠ @Ignoreæ³¨è§£ã€‚</li><li>@Index(â€œBookNameâ€)ä»£è¡¨è®¾ç½®æ•°æ®åº“ä¸­çš„ç´¢å¼•</li><li>@PrimaryKeyçš„æ³¨é‡Šä»£è¡¨æ•°æ®åº“ä¸­çš„ä¸»é”®</li><li>@PrimaryKeyçš„ï¼ˆautoGenerate = trueï¼‰è¡¨ç¤ºä¸»é”®è‡ªå¢</li></ul></li><li>æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºæ•°æ®åº“ç®¡ç†ç±»<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Database(entities &#x3D; &#123;BookBean.class&#125;, version &#x3D; 1)</span><br><span class="line">public abstract class AppDatabase extends RoomDatabase &#123;</span><br><span class="line">    public abstract BookDao userDao();</span><br><span class="line"></span><br><span class="line">    static final Migration MIGRATION_1_2 &#x3D; new Migration(1, 2) &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void migrate(SupportSQLiteDatabase database) &#123;</span><br><span class="line">           database.execSQL(&quot;ALTER TABLE bookBean ADD COLUMN  index_name&#39;BookName&#39; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>@Databaseè¡¨ç¤ºå½“å‰ç±»ä¸ºæ•°æ®åº“ç®¡ç†ç±»</li><li>entities = {BookBean.class}è¡¨ç¤ºæ•°æ®åº“ç›¸å…³çš„æ‰€æœ‰Entityå®ä½“ç±»ï¼Œä»–ä»¬ä¼šè½¬åŒ–æˆæ•°æ®åº“é‡Œé¢çš„è¡¨ã€‚</li><li>version = 1è¡¨ç¤ºå½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬ï¼ˆæ¯å½“æ•°æ®åº“æ›´æ–°æ—¶ï¼Œç‰ˆæœ¬å·ä¹Ÿè¦å¯¹åº”å¢åŠ ï¼‰</li><li>public abstract BookDao userDao() è¿™ä¸ªåˆ™æ˜¯å¯¹åº”æ•°æ®åº“çš„æ“ä½œç±»</li><li>static final Migration MIGRATION_1_2 = new Migration(1, 2) è¿™ä¸ªæ˜¯æŒ‡å½“æ•°æ®åº“å‡çº§æ—¶ï¼Œä»ç‰ˆæœ¬1å‡çº§åˆ°ç‰ˆæœ¬2çš„å‡çº§è¿‡ç¨‹</li></ul></li><li>ä¹‹åå°±æ˜¯åˆ›å»ºæ•°æ®åº“çš„æ“ä½œç±»<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Dao</span><br><span class="line">public interface BookDao &#123;</span><br><span class="line"></span><br><span class="line">    @Query(&quot;SELECT * FROM bookbean&quot;)</span><br><span class="line">    Flowable&lt;List&lt;BookBean&gt;&gt; getAll();</span><br><span class="line"></span><br><span class="line">    @Query(&quot;SELECT * FROM bookbean WHERE BookId IN (:userIds)&quot;)</span><br><span class="line">    List&lt;BookBean&gt; loadAllByIds(int[] userIds);</span><br><span class="line"></span><br><span class="line">    @Query(&quot;update bookbean set bookauthor &#x3D; :value&quot;)</span><br><span class="line">    void setBookAuthor(boolean value);</span><br><span class="line"></span><br><span class="line">    @Insert</span><br><span class="line">    Completable insertAll(BookBean... users);</span><br><span class="line"></span><br><span class="line">    @Delete</span><br><span class="line">    Completable delete(BookBean user);</span><br><span class="line"></span><br><span class="line">    @Update</span><br><span class="line">    Completable updateUsers(BookBean... users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>@Dao è¡¨ç¤ºè¿™ä¸ªç»„ä»¶ä»£è¡¨äº†ä½œä¸ºDAOçš„ç±»æˆ–è€…æ¥å£ã€‚DAOæ˜¯Roomçš„ä¸»è¦ç»„ä»¶ï¼Œè´Ÿè´£å®šä¹‰è®¿é—®æ•°æ®åº“çš„æ–¹æ³•ã€‚Roomä½¿ç”¨è¿‡ç¨‹ä¸­ä¸€èˆ¬ä½¿ç”¨æŠ½è±¡DAOç±»æ¥å®šä¹‰æ•°æ®åº“çš„CRUDæ“ä½œã€‚DAOå¯ä»¥æ˜¯ä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå¯ä»¥æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒå°†RoomDatabaseä½œä¸ºå…¶å”¯ä¸€å‚æ•°ã€‚Roomåœ¨ç¼–è¯‘æ—¶åˆ›å»ºæ¯ä¸ªDAOå®ã€‚</li><li>@Queryå¯¹åº”æ•°æ®åº“çš„æŸ¥è¯¢ï¼Œåæ¥æŸ¥è¯¢è¯­å¥</li><li>@Insertå¯¹åº”æ•°æ®åº“çš„æ’å…¥</li><li>@Deleteå¯¹åº”æ•°æ®åº“çš„åˆ é™¤</li><li>@Updateå¯¹åº”æ•°æ®åº“çš„æ›´æ–°ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šå°†æ²¡æœ‰æ¶‰åŠåˆ°çš„å€¼è¿›è¡Œé‡ç½®</li><li>Completableè¿”å›å€¼æ˜¯ä¸ºäº†å’ŒRxJavaä¸€èµ·ä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨RxJavaåˆ™å†™æˆvoidæˆ–è€…å¯¹åº”ç±»å‹</li><li>Flowableä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸è¿‡è¿™ä¸ªè¿”å›ç±»å‹æ˜¯æ”¯æŒèƒŒå‹</li></ul></li><li>åœ¨Activity/Fragmentä¸­ä½¿ç”¨<ol><li>é¦–å…ˆä¸ºäº†é˜²æ­¢é‡å¤åˆ›å»ºæ•°æ®åº“ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿Application<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class MyApplication extends Application &#123;</span><br><span class="line">    private static AppDatabase db;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        db &#x3D; Room.databaseBuilder(getApplicationContext(),</span><br><span class="line">                AppDatabase.class, &quot;database-name&quot;)</span><br><span class="line">                &#x2F;&#x2F;.addMigrations(MIGRATION_1_2)</span><br><span class="line">                .build();</span><br><span class="line">        &#x2F;&#x2F;.allowMainThreadQueries()&#x2F;&#x2F;å…è®¸åœ¨ä¸»çº¿ç¨‹ä¸­æŸ¥è¯¢</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static AppDatabase getDatabase()&#123;</span><br><span class="line">        return db;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>åœ¨éœ€è¦çš„Activity/Fragmentä¸­è·å–æ•°æ®åº“å®ä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line">   private ActivityMainBinding binding;</span><br><span class="line">   private AppDatabase db;</span><br><span class="line">   </span><br><span class="line">    @Override</span><br><span class="line">   protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">       super.onCreate(savedInstanceState);</span><br><span class="line">       binding &#x3D; DataBindingUtil.setContentView(this, R.layout.activity_main);</span><br><span class="line">       db &#x3D; MyApplication.getDatabase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="RxJava-Room"><a href="#RxJava-Room" class="headerlink" title="RxJava+Room"></a>RxJava+Room</h5>ä¸€èˆ¬æ¥è¯´å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œæ˜¯ä¸è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå› ä¸ºå½“è¿›è¡Œå¤§é‡æ•°æ®åº“æ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šå µå¡ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥é…åˆRxJavaæ¥ä½¿ç”¨</li></ol></li></ol><h5 id="æ·»åŠ ä¾èµ–-1"><a href="#æ·»åŠ ä¾èµ–-1" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; RxJava support for Room</span><br><span class="line">   implementation &quot;androidx.room:room-rxjava2:2.2.5&quot;</span><br><span class="line"></span><br><span class="line">   implementation &#39;io.reactivex.rxjava2:rxjava:2.0.6&#39;</span><br><span class="line">   implementation &#39;io.reactivex.rxjava2:rxandroid:2.0.1&#39;</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨RxJavaæ¥è¿›è¡Œæ•°æ®åº“æ“ä½œ"><a href="#ä½¿ç”¨RxJavaæ¥è¿›è¡Œæ•°æ®åº“æ“ä½œ" class="headerlink" title="ä½¿ç”¨RxJavaæ¥è¿›è¡Œæ•°æ®åº“æ“ä½œ"></a>ä½¿ç”¨RxJavaæ¥è¿›è¡Œæ•°æ®åº“æ“ä½œ</h5><ul><li>å¢<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Completable completable &#x3D; db.userDao().insertAll(new BookBean(&quot;HTML(&quot; + i + &quot;)&quot;, &quot;jjj&quot;, data));</span><br><span class="line">                  completable.subscribeOn(Schedulers.io())</span><br><span class="line">                          .subscribe(new CompletableObserver() &#123;</span><br><span class="line">                              @Override</span><br><span class="line">                              public void onSubscribe(Disposable d) &#123;&#125;</span><br><span class="line"></span><br><span class="line">                              @Override</span><br><span class="line">                              public void onComplete() &#123;</span><br><span class="line">                                  Log.e(&quot;why&quot;, &quot;onClick: æ’å…¥æˆåŠŸ&quot;);</span><br><span class="line">                              &#125;</span><br><span class="line"></span><br><span class="line">                              @Override</span><br><span class="line">                              public void onError(Throwable e) &#123;</span><br><span class="line">                                  Log.e(&quot;why&quot;, &quot;onClick: æ’å…¥å¤±è´¥&quot; + e);</span><br><span class="line">                              &#125;</span><br><span class="line">                          &#125;);</span><br></pre></td></tr></table></figure>ä¸Šè¿°æ“ä½œæ˜¯å¾€æ•°æ®åº“ä¸­æ·»åŠ äº†â€ä¸€æœ¬â€ä¹¦çš„ä¿¡æ¯</li><li>åˆ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Completable comparable &#x3D; db.userDao().delete(bean);</span><br><span class="line">                   comparable.subscribeOn(Schedulers.io())</span><br><span class="line">                           .subscribe(new CompletableObserver() &#123;</span><br><span class="line">                               @Override</span><br><span class="line">                               public void onSubscribe(Disposable d) &#123;</span><br><span class="line">                               &#125;</span><br><span class="line"></span><br><span class="line">                               @Override</span><br><span class="line">                               public void onComplete() &#123;</span><br><span class="line">                                   Log.e(&quot;why&quot;, &quot;onClick: åˆ é™¤æ•°æ®æˆåŠŸ&quot;);</span><br><span class="line">                               &#125;</span><br><span class="line"></span><br><span class="line">                               @Override</span><br><span class="line">                               public void onError(Throwable e) &#123;</span><br><span class="line">                                   Log.e(&quot;why&quot;, &quot;onClick: åˆ é™¤æ•°æ®å¤±è´¥&quot; + e);</span><br><span class="line">                               &#125;</span><br><span class="line">                           &#125;);</span><br></pre></td></tr></table></figure>ä¸Šè¿°æ“ä½œæ˜¯å¾€æ•°æ®åº“ä¸­åˆ é™¤äº†â€å…¨éƒ¨â€ä¹¦çš„ä¿¡æ¯</li><li>æ”¹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">for (BookBean bean : bookBean) &#123;</span><br><span class="line">                    bean.setBookName(&quot;JAVA&quot;);</span><br><span class="line">                    Completable completable &#x3D; db.userDao().updateUsers(bean);</span><br><span class="line">                    completable.subscribeOn(Schedulers.io())</span><br><span class="line">                            .subscribe(new CompletableObserver() &#123;</span><br><span class="line">                                @Override</span><br><span class="line">                                public void onSubscribe(Disposable d) &#123;</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                @Override</span><br><span class="line">                                public void onComplete() &#123;</span><br><span class="line">                                    Log.e(&quot;why&quot;, &quot;onClick: æ›´æ–°æ•°æ®æˆåŠŸ&quot;);</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                @Override</span><br><span class="line">                                public void onError(Throwable e) &#123;</span><br><span class="line">                                    Log.e(&quot;why&quot;, &quot;onClick: æ›´æ–°æ•°æ®å¤±è´¥&quot; + e);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>ä¸Šè¿°æ“ä½œæ˜¯å°†æŸ¥è¯¢åˆ°çš„æ•°æ®å¾ªç¯æ”¹å˜BookNameçš„å€¼ï¼Œåœ¨é€šè¿‡æ•°æ®åº“æ“ä½œæ¥æ›´æ–°â€å…¨éƒ¨â€æ•°æ®</li><li>æŸ¥<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.userDao().getAll()</span><br><span class="line">                       .subscribeOn(Schedulers.io())</span><br><span class="line">                       .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                       .subscribe(new Consumer&lt;List&lt;BookBean&gt;&gt;() &#123;</span><br><span class="line">                           @Override</span><br><span class="line">                           public void accept(List&lt;BookBean&gt; bookBeans) throws Exception &#123;</span><br><span class="line">                               bookBean &#x3D; bookBeans;</span><br><span class="line">                               for (BookBean bean : bookBeans) &#123;</span><br><span class="line">                                   Log.e(&quot;why&quot;, &quot;onClick: æŸ¥è¯¢æˆåŠŸ,æ•°æ®ä¸º&quot; + bean.toString());</span><br><span class="line">                               &#125;</span><br><span class="line">                           &#125;</span><br><span class="line">                       &#125;);</span><br></pre></td></tr></table></figure>ä¸Šè¿°æ“ä½œæ˜¯å°†æŸ¥è¯¢åˆ°çš„æ•°æ®â€å…¨éƒ¨â€ä¿å­˜èµ·æ¥</li></ul><blockquote><p>ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨å†…å®¹</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¿æ’­é€šçŸ¥å¼ºåˆ¶ä¸‹çº¿</title>
      <link href="2020/10/21/%E5%B9%BF%E6%92%AD%E9%80%9A%E7%9F%A5%E5%BC%BA%E5%88%B6%E4%B8%8B%E7%BA%BF/"/>
      <url>2020/10/21/%E5%B9%BF%E6%92%AD%E9%80%9A%E7%9F%A5%E5%BC%BA%E5%88%B6%E4%B8%8B%E7%BA%BF/</url>
      
        <content type="html"><![CDATA[<p>Androidå¹¿æ’­çš„ä½¿ç”¨</p><a id="more"></a><h2 id="å…³äºä½¿ç”¨å¹¿æ’­é€šçŸ¥å¼ºåˆ¶ä¸‹çº¿çš„åŠŸèƒ½"><a href="#å…³äºä½¿ç”¨å¹¿æ’­é€šçŸ¥å¼ºåˆ¶ä¸‹çº¿çš„åŠŸèƒ½" class="headerlink" title="å…³äºä½¿ç”¨å¹¿æ’­é€šçŸ¥å¼ºåˆ¶ä¸‹çº¿çš„åŠŸèƒ½"></a>å…³äºä½¿ç”¨å¹¿æ’­é€šçŸ¥å¼ºåˆ¶ä¸‹çº¿çš„åŠŸèƒ½</h2><h5 id="å…³äºåœ¨é‚£é‡Œåˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨"><a href="#å…³äºåœ¨é‚£é‡Œåˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨" class="headerlink" title="å…³äºåœ¨é‚£é‡Œåˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨"></a>å…³äºåœ¨é‚£é‡Œåˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨</h5><p>ä¾‹å­ï¼šä¸€ä¸ªè´¦å·å·²ç»ç™»å½•ï¼Œåœ¨å¦ä¸€ä¸ªæ‰‹æœºä¸Šå†ä¸€æ¬¡ç™»å½•è¿™ä¸ªè´¦å·ï¼Œè¿™æ—¶å€™å°±éœ€è¦æé†’ç”¨æˆ·â€œè´¦å·æœ‰åœ¨åˆ«å¤„ç™»å½•ï¼Œè¯·é‡æ–°ç™»å½•â€ï¼Œå¼ºåˆ¶ä¸‹çº¿ï¼Œè·³è½¬åˆ°ç™»å½•ç•Œé¢ã€‚</p><ul><li>ä¸ªäººè®¤ä¸ºåº”è¯¥åœ¨Baseç±»ä¸­åˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨ï¼Œå¹¶é”€æ¯ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å“åº”å¹¿æ’­</li><li>å¹¿æ’­ç±»å‹åº”è¯¥ä¸ºåŠ¨æ€æ·»åŠ </li></ul><p>ä¸‹é¢æˆ‘å°†åœ¨BaseActivityä¸­åˆ›å»º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">private JudgeLoginReceiver judgeLoginReceiver;</span><br><span class="line">public static String signInAction &#x3D; &quot;LOGIN.DilDil.ACTION&quot;;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">   protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">       super.onCreate(savedInstanceState);</span><br><span class="line">       onCreateView(savedInstanceState);</span><br><span class="line">   ...</span><br><span class="line">       initBroadcastReceiver();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   private void initBroadcastReceiver() &#123;</span><br><span class="line">       if (judgeLoginReceiver !&#x3D; null) &#123;</span><br><span class="line">           IntentFilter intentFilter &#x3D; new IntentFilter();</span><br><span class="line">           intentFilter.addAction(signInAction);</span><br><span class="line">           registerReceiver(judgeLoginReceiver, intentFilter);</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           judgeLoginReceiver &#x3D; new JudgeLoginReceiver();</span><br><span class="line">           IntentFilter intentFilter &#x3D; new IntentFilter();</span><br><span class="line">           intentFilter.addAction(signInAction);</span><br><span class="line">           registerReceiver(judgeLoginReceiver, intentFilter);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">    @Override</span><br><span class="line">   protected void onDestroy() &#123;</span><br><span class="line">       if (judgeLoginReceiver !&#x3D; null) &#123;</span><br><span class="line">           unregisterReceiver(judgeLoginReceiver);</span><br><span class="line">       &#125;</span><br><span class="line">       super.onDestroy();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘é¦–å…ˆåˆ›å»ºäº†è¦å“åº”çš„Actionï¼ˆsignInActionï¼‰ï¼Œä¹‹ååœ¨onCreateä¸­åˆå§‹åŒ–å¹¿æ’­ã€‚<br>åœ¨initBroadcastReceiverä¸­ï¼Œä¸ºäº†é˜²æ­¢åå¤åˆ›å»ºï¼Œäºæ˜¯åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ²¡æœ‰å°±åˆ›å»ºï¼Œæœ‰å°±ç›´æ¥æ³¨å†Œã€‚åˆ«å¿˜äº†è¦åœ¨onDestroyå–æ¶ˆæ³¨å†Œ</p><h5 id="æ¥ä¸‹æ¥è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥ç»§æ‰¿BroadcastReceiver"><a href="#æ¥ä¸‹æ¥è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥ç»§æ‰¿BroadcastReceiver" class="headerlink" title="æ¥ä¸‹æ¥è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥ç»§æ‰¿BroadcastReceiver"></a>æ¥ä¸‹æ¥è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç±»æ¥ç»§æ‰¿BroadcastReceiver</h5><p>é‚£ä¹ˆåˆ›å»ºä¸€ä¸ªåä¸ºJudgeLoginReceiverçš„ç±»æ¥ç»§æ‰¿BroadcastReceiver</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">private static class JudgeLoginReceiver extends BroadcastReceiver &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">            new MaterialDialog.Builder(context)</span><br><span class="line">                    .title(R.string.loginWarning)</span><br><span class="line">                    .content(R.string.thisAccountHasSigned)</span><br><span class="line">                    .positiveText(R.string.determine)</span><br><span class="line">                    .cancelable(false)</span><br><span class="line">                    .onPositive(new MaterialDialog.SingleButtonCallback() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) &#123;</span><br><span class="line">                            ApiService apiService &#x3D; ApiEngine.getInstance().getApiService();</span><br><span class="line">                            apiService.Logout()</span><br><span class="line">                                    .subscribeOn(Schedulers.io())</span><br><span class="line">                                    .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">                                    .subscribe(new Observer&lt;LogoutBean&gt;() &#123;</span><br><span class="line">                                        @Override</span><br><span class="line">                                        public void onSubscribe(@io.reactivex.annotations.NonNull Disposable d) &#123;</span><br><span class="line"></span><br><span class="line">                                        &#125;</span><br><span class="line"></span><br><span class="line">                                        @Override</span><br><span class="line">                                        public void onNext(@io.reactivex.annotations.NonNull LogoutBean logoutBean) &#123;</span><br><span class="line">                                            SharePreferenceUtil.getInstance(context).remove(&quot;cookie&quot;);</span><br><span class="line">                                            ActivityUtils.startActivity(LoginActivity.class);</span><br><span class="line">                                        &#125;</span><br><span class="line"></span><br><span class="line">                                        @Override</span><br><span class="line">                                        public void onError(@io.reactivex.annotations.NonNull Throwable e) &#123;</span><br><span class="line">                                            XToastUtils.error(R.string.networkError);</span><br><span class="line">                                        &#125;</span><br><span class="line"></span><br><span class="line">                                        @Override</span><br><span class="line">                                        public void onComplete() &#123;</span><br><span class="line"></span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç»§æ‰¿BroadcastReceiverä¹‹åéœ€è¦é‡å†™onReceiveæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å¤„ç†æ¥æ”¶åˆ°å¹¿æ’­ä¹‹åçš„è¡Œä¸ºã€‚<br>æˆ‘åœ¨onReceiveä¸­åˆ›å»ºäº†ä¸€ä¸ªæç¤ºæ¡†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">title æ˜¯æç¤ºæ¡†çš„æ ‡é¢˜</span><br><span class="line">content æ˜¯å†…å®¹</span><br><span class="line">positiveText æ˜¯ç¡®å®šæŒ‰é’®çš„æ–‡å­—</span><br><span class="line">cancelable æ˜¯æŒ‡æ˜¯å¦å¯ä»¥ç‚¹å‡»å¤–é¢é€€å‡º</span><br><span class="line">onPositive æ˜¯æŒ‡ç¡®å®æŒ‰é’®çš„ç‚¹å‡»ç›‘å¬</span><br><span class="line">ä¸å†™å–æ¶ˆæŒ‰é’®å°±é»˜è®¤æ²¡æœ‰å–æ¶ˆæŒ‰é’®</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘åœ¨ç‚¹å‡»äº‹ä»¶ä¸­è·å–Apiæ¥å£ï¼Œè°ƒç”¨äº†é€€å‡ºç™»å½•çš„æ–¹æ³•ï¼Œå¹¶å¤„ç†ç»“æœã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Function </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºDanmakuVideoPlayerçš„ä½¿ç”¨</title>
      <link href="2020/10/10/%E5%85%B3%E4%BA%8EDanmakuVideoPlayer%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2020/10/10/%E5%85%B3%E4%BA%8EDanmakuVideoPlayer%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬ä¸‰æ–¹è§†é¢‘æ’­æ”¾åº“çš„ä½¿ç”¨</p><a id="more"></a><h2 id="å…³äºDanmakuVideoPlayerçš„ä½¿ç”¨"><a href="#å…³äºDanmakuVideoPlayerçš„ä½¿ç”¨" class="headerlink" title="å…³äºDanmakuVideoPlayerçš„ä½¿ç”¨"></a>å…³äºDanmakuVideoPlayerçš„ä½¿ç”¨</h2><h5 id="ä»‹ç»DanmakuVideoPlayer"><a href="#ä»‹ç»DanmakuVideoPlayer" class="headerlink" title="ä»‹ç»DanmakuVideoPlayer"></a>ä»‹ç»DanmakuVideoPlayer</h5><ul><li><p>åŸºäºIJKPlayerï¼ˆå…¼å®¹ç³»ç»ŸMediaPlayerä¸EXOPlayer2ï¼‰ï¼Œå®ç°äº†å¤šåŠŸèƒ½çš„è§†é¢‘æ’­æ”¾å™¨<br>ï¼ˆåŒ…æ‹¬å¼¹å¹•ï¼‰</p><h5 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h5></li><li><p>Aã€ç›´æ¥å¼•å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å®Œæ•´ç‰ˆå¼•å…¥</span><br><span class="line">implementation &#39;com.shuyu:GSYVideoPlayer:7.1.6&#39;</span><br></pre></td></tr></table></figure></li><li><p>Bã€æ·»åŠ javaå’Œä½ æƒ³è¦çš„soæ”¯æŒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-java:7.1.6&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ˜¯å¦éœ€è¦ExoPlayeræ¨¡å¼</span><br><span class="line">implementation &#39;com.shuyu:GSYVideoPlayer-exo2:7.1.6&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ ¹æ®ä½ çš„éœ€æ±‚ijkæ¨¡å¼çš„so</span><br><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-armv5:7.1.6&#39;</span><br><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-armv7a:7.1.6&#39;</span><br><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-arm64:7.1.6&#39;</span><br><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-x64:7.1.6&#39;</span><br><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-x86:7.1.6&#39;</span><br></pre></td></tr></table></figure></li><li><p>æ”¯æŒå…¶ä»–æ ¼å¼åè®®çš„ï¼ˆmpegï¼Œrtsp, concatã€cryptoåè®®ï¼‰<br>Aã€Bæ™®é€šç‰ˆæœ¬æ”¯æŒ263/264/265ç­‰ï¼Œå¯¹äºmpegç¼–ç ä¼šæœ‰å£°éŸ³æ— ç”»é¢æƒ…å†µã€‚ C å¼•å…¥çš„soæ”¯æŒmpegç¼–ç å’Œå…¶ä»–è¡¥å……åè®®ï¼Œä½†æ˜¯soåŒ…ç›¸å¯¹å˜å¤§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-java:7.1.6&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ˜¯å¦éœ€è¦ExoPlayeræ¨¡å¼</span><br><span class="line">implementation &#39;com.shuyu:GSYVideoPlayer-exo2:7.1.6&#39;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ›´å¤šijkçš„ç¼–ç æ”¯æŒ</span><br><span class="line">implementation &#39;com.shuyu:gsyVideoPlayer-ex_so:7.1.6&#39;</span><br></pre></td></tr></table></figure></li></ul><h5 id="activity-fragmentä¸­ä½¿ç”¨"><a href="#activity-fragmentä¸­ä½¿ç”¨" class="headerlink" title="activity/fragmentä¸­ä½¿ç”¨"></a>activity/fragmentä¸­ä½¿ç”¨</h5><ul><li>åˆ›å»ºä¸€ä¸ªæ’­æ”¾å™¨ç±»ï¼Œç»§æ‰¿StandardGSYVideoPlayerï¼Œå¹¶ä¸”åˆ›å»ºæ’­æ”¾å™¨çš„å¸ƒå±€ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public class DanmakuVideoPlayer extends StandardGSYVideoPlayer &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>å¸ƒå±€æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;RelativeLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:background&#x3D;&quot;@android:color&#x2F;black&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;surface_container&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;thumbImage&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:scaleType&#x3D;&quot;centerCrop&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;å¼¹å¹•æ§ä»¶ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰</span><br><span class="line">    &lt;master.flame.danmaku.ui.widget.DanmakuView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;danmaku_view&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_above&#x3D;&quot;@+id&#x2F;layout_bottom&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;thumb&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_alignParentStart&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_alignParentLeft&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_alignParentTop&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_alignParentEnd&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_alignParentRight&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_alignParentBottom&#x3D;&quot;true&quot;</span><br><span class="line">        android:background&#x3D;&quot;#000000&quot;</span><br><span class="line">        android:scaleType&#x3D;&quot;fitCenter&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;åº•éƒ¨åŒºåŸŸï¼ˆåº•éƒ¨åŒºåŸŸæœ‰åˆ†æˆä¸¤å±‚ï¼Œä¸€å±‚è¿›åº¦æ¡ï¼Œä¸€å±‚æ’­æ”¾æ§åˆ¶ï¼‰</span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;layout_bottom&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_alignParentBottom&#x3D;&quot;true&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center_vertical&quot;</span><br><span class="line">        android:orientation&#x3D;&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;seekbar&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;35dp&quot;</span><br><span class="line">            android:gravity&#x3D;&quot;center_vertical&quot;</span><br><span class="line">            android:orientation&#x3D;&quot;horizontal&quot;</span><br><span class="line">            android:paddingLeft&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">            android:paddingRight&#x3D;&quot;@dimen&#x2F;dp_10&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;Video_SeekBar_play&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:src&#x3D;&quot;@mipmap&#x2F;play&quot;</span><br><span class="line">                android:visibility&#x3D;&quot;gone&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;SeekBar</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;progress&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;0dp&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:layout_gravity&#x3D;&quot;center_vertical&quot;</span><br><span class="line">                android:layout_weight&#x3D;&quot;1.0&quot;</span><br><span class="line">                android:background&#x3D;&quot;@null&quot;</span><br><span class="line">                android:max&#x3D;&quot;100&quot;</span><br><span class="line">                android:maxHeight&#x3D;&quot;4dp&quot;</span><br><span class="line">                android:minHeight&#x3D;&quot;4dp&quot;</span><br><span class="line">                android:paddingTop&#x3D;&quot;8dp&quot;</span><br><span class="line">                android:paddingBottom&#x3D;&quot;8dp&quot;</span><br><span class="line">                android:progressDrawable&#x3D;&quot;@drawable&#x2F;seekbar_color&quot;</span><br><span class="line">                android:thumb&#x3D;&quot;@mipmap&#x2F;seekbar_img&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;fullscreen&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_5&quot;</span><br><span class="line">                android:layout_marginRight&#x3D;&quot;@dimen&#x2F;dp_5&quot;</span><br><span class="line">                android:scaleType&#x3D;&quot;center&quot;</span><br><span class="line">                android:src&#x3D;&quot;@drawable&#x2F;crop_free_24&quot; &#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;Bottom_controller&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;25dp&quot;</span><br><span class="line">            android:layout_gravity&#x3D;&quot;center&quot;</span><br><span class="line">            android:layout_marginBottom&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">            android:orientation&#x3D;&quot;horizontal&quot;</span><br><span class="line">            android:paddingLeft&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">            android:paddingRight&#x3D;&quot;@dimen&#x2F;dp_10&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;Video_play&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_8&quot;</span><br><span class="line">                android:src&#x3D;&quot;@mipmap&#x2F;play&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                android:src&#x3D;&quot;@drawable&#x2F;skip_next_24&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;current&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                android:text&#x3D;&quot;00:00&quot;</span><br><span class="line">                android:textColor&#x3D;&quot;#ffffff&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;4dp&quot;</span><br><span class="line">                android:layout_marginRight&#x3D;&quot;4dp&quot;</span><br><span class="line">                android:text&#x3D;&quot;&#x2F;&quot;</span><br><span class="line">                android:textColor&#x3D;&quot;#ffffff&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;total&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:layout_marginRight&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                android:text&#x3D;&quot;00:00&quot;</span><br><span class="line">                android:textColor&#x3D;&quot;#ffffff&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;definition_off&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;50dp&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:gravity&#x3D;&quot;center&quot;</span><br><span class="line">                android:src&#x3D;&quot;@mipmap&#x2F;definition&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;com.gcssloop.widget.RCRelativeLayout</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;Re_video_cover&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;0dp&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_weight&#x3D;&quot;1&quot;</span><br><span class="line">                app:round_corner&#x3D;&quot;5dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;ImageView</span><br><span class="line">                    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                    android:alpha&#x3D;&quot;0.3&quot;</span><br><span class="line">                    android:src&#x3D;&quot;#fff&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;TextView</span><br><span class="line">                    android:id&#x3D;&quot;@+id&#x2F;send_danmaku&quot;</span><br><span class="line">                    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                    android:layout_centerVertical&#x3D;&quot;true&quot;</span><br><span class="line">                    android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_20&quot;</span><br><span class="line">                    android:gravity&#x3D;&quot;center|left&quot;</span><br><span class="line">                    android:paddingLeft&#x3D;&quot;@dimen&#x2F;dp_5&quot;</span><br><span class="line">                    android:text&#x3D;&quot;@string&#x2F;BulletScreenTips&quot;</span><br><span class="line">                    android:textColor&#x3D;&quot;#b1b0b5&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;&#x2F;com.gcssloop.widget.RCRelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;Double_speed&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;50dp&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;20dp&quot;</span><br><span class="line">                android:gravity&#x3D;&quot;center&quot;</span><br><span class="line">                android:text&#x3D;&quot;@string&#x2F;DoubleSpeed&quot;</span><br><span class="line">                android:textColor&#x3D;&quot;#ffffff&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;definition&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;50dp&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;20dp&quot;</span><br><span class="line">                android:gravity&#x3D;&quot;center&quot;</span><br><span class="line">                android:textColor&#x3D;&quot;#ffffff&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;&#x2F;LinearLayout&gt;</span><br><span class="line">    &lt;&#x2F;LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ProgressBar</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;bottom_progressbar&quot;</span><br><span class="line">        style&#x3D;&quot;?android:attr&#x2F;progressBarStyleHorizontal&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;1.5dp&quot;</span><br><span class="line">        android:layout_alignParentBottom&#x3D;&quot;true&quot;</span><br><span class="line">        android:max&#x3D;&quot;100&quot;</span><br><span class="line">        android:progressDrawable&#x3D;&quot;@drawable&#x2F;video_progress&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;back_tiny&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;24dp&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;24dp&quot;</span><br><span class="line">        android:layout_marginLeft&#x3D;&quot;6dp&quot;</span><br><span class="line">        android:layout_marginTop&#x3D;&quot;6dp&quot;</span><br><span class="line">        android:visibility&#x3D;&quot;gone&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;é¡¶éƒ¨åŒºåŸŸ(ç›¸åº”çš„æ§ä»¶åªèƒ½å†™åœ¨åä¸ºlayout_topçš„çˆ¶å¸ƒå±€ä¸‹é¢)</span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;layout_top&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:background&#x3D;&quot;@drawable&#x2F;video_title_bg&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center_vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;first_floor&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;@dimen&#x2F;dp_48&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;back&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;48dp&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;48dp&quot;</span><br><span class="line">            android:paddingLeft&#x3D;&quot;10dp&quot;</span><br><span class="line">            android:scaleType&#x3D;&quot;centerInside&quot;</span><br><span class="line">            android:src&#x3D;&quot;@drawable&#x2F;video_back&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;title&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">            android:layout_centerVertical&#x3D;&quot;true&quot;</span><br><span class="line">            android:layout_toRightOf&#x3D;&quot;@+id&#x2F;back&quot;</span><br><span class="line">            android:paddingLeft&#x3D;&quot;10dp&quot;</span><br><span class="line">            android:textColor&#x3D;&quot;@android:color&#x2F;white&quot;</span><br><span class="line">            android:textSize&#x3D;&quot;18sp&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;LinearLayout</span><br><span class="line">                    android:id&#x3D;&quot;@+id&#x2F;Sanlians&quot;</span><br><span class="line">                    android:layout_marginEnd&#x3D;&quot;@dimen&#x2F;dp_15&quot;</span><br><span class="line">                    android:layout_centerVertical&#x3D;&quot;true&quot;</span><br><span class="line">                    android:layout_alignParentEnd&#x3D;&quot;true&quot;</span><br><span class="line">                    android:gravity&#x3D;&quot;right|center_vertical&quot;</span><br><span class="line">                    android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                    android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                    android:orientation&#x3D;&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;ImageView</span><br><span class="line">                        android:id&#x3D;&quot;@+id&#x2F;Dm_like&quot;</span><br><span class="line">                        android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:src&#x3D;&quot;@mipmap&#x2F;like_while&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;ImageView</span><br><span class="line">                        android:id&#x3D;&quot;@+id&#x2F;Dm_coin&quot;</span><br><span class="line">                        android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_15&quot;</span><br><span class="line">                        android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:src&#x3D;&quot;@mipmap&#x2F;coin_while&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;ImageView</span><br><span class="line">                        android:id&#x3D;&quot;@+id&#x2F;Dm_forward&quot;</span><br><span class="line">                        android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_15&quot;</span><br><span class="line">                        android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:src&#x3D;&quot;@mipmap&#x2F;forward_while&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;ImageView</span><br><span class="line">                        android:id&#x3D;&quot;@+id&#x2F;Dm_more&quot;</span><br><span class="line">                        android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_20&quot;</span><br><span class="line">                        android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                        android:src&#x3D;&quot;@drawable&#x2F;more_vert_24&quot;&#x2F;&gt;</span><br><span class="line">                &lt;&#x2F;LinearLayout&gt;</span><br><span class="line">        &lt;&#x2F;RelativeLayout&gt;</span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;UPImage&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;@dimen&#x2F;dp_120&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;@dimen&#x2F;dp_30&quot;</span><br><span class="line">            android:layout_below&#x3D;&quot;@+id&#x2F;first_floor&quot;</span><br><span class="line">            android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_20&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:alpha&#x3D;&quot;0.5&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:background&#x3D;&quot;@drawable&#x2F;file_background_circular_grey&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;com.android.liuzhuang.rcimageview.CircleImageView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;up_img&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;@dimen&#x2F;dp_30&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;@dimen&#x2F;dp_30&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;up_name&quot;</span><br><span class="line">                android:layout_centerVertical&#x3D;&quot;true&quot;</span><br><span class="line">                android:gravity&#x3D;&quot;center_vertical&quot;</span><br><span class="line">                android:paddingRight&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                android:text&#x3D;&quot;UPä¸»åç§°&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;5dp&quot;</span><br><span class="line">                android:layout_toRightOf&#x3D;&quot;@+id&#x2F;up_img&quot;</span><br><span class="line">                android:textColor&#x3D;&quot;@color&#x2F;White&quot;</span><br><span class="line">                android:textSize&#x3D;&quot;16sp&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;&#x2F;RelativeLayout&gt;</span><br><span class="line">    &lt;&#x2F;RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;moe.codeest.enviews.ENDownloadView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;loading&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;28dp&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;28dp&quot;</span><br><span class="line">        android:layout_centerHorizontal&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_centerVertical&#x3D;&quot;true&quot;</span><br><span class="line">        android:visibility&#x3D;&quot;invisible&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;moe.codeest.enviews.ENPlayView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;start&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;60dp&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;60dp&quot;</span><br><span class="line">        android:layout_centerHorizontal&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_centerVertical&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_gravity&#x3D;&quot;center_vertical&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;small_close&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;30dp&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;30dp&quot;</span><br><span class="line">        android:paddingLeft&#x3D;&quot;10dp&quot;</span><br><span class="line">        android:paddingTop&#x3D;&quot;10dp&quot;</span><br><span class="line">        android:scaleType&#x3D;&quot;centerInside&quot;</span><br><span class="line">        android:src&#x3D;&quot;@drawable&#x2F;video_small_close&quot;</span><br><span class="line">        android:visibility&#x3D;&quot;gone&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;lock_screen&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;30dp&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;30dp&quot;</span><br><span class="line">        android:layout_alignParentRight&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_centerVertical&#x3D;&quot;true&quot;</span><br><span class="line">        android:layout_marginRight&#x3D;&quot;50dp&quot;</span><br><span class="line">        android:scaleType&#x3D;&quot;centerInside&quot;</span><br><span class="line">        android:src&#x3D;&quot;@drawable&#x2F;unlock&quot;</span><br><span class="line">        android:visibility&#x3D;&quot;gone&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;å°å›¾é¢„è§ˆ</span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;preview_layout&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;@dimen&#x2F;seek_bar_image&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;100dp&quot;</span><br><span class="line">        android:layout_above&#x3D;&quot;@+id&#x2F;layout_bottom&quot;</span><br><span class="line">        android:visibility&#x3D;&quot;gone&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;preview_image&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:background&#x3D;&quot;#000000&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;RelativeLayout&gt;</span><br><span class="line">&lt;&#x2F;RelativeLayout&gt;</span><br></pre></td></tr></table></figure>æ¬¡å¸ƒå±€åŒ…æ‹¬ é¡¶éƒ¨ã€æ’­æ”¾/æš‚åœæŒ‰é’®ã€åº•éƒ¨ã€å¼¹å¹•ã€ç”»é¢ã€‚å¯¹åº”çš„åŒºåŸŸæ§ä»¶åªèƒ½å†™åœ¨å¯¹åº”çš„åŒºåŸŸï¼Œ<br>å¦åˆ™åæœŸæ— æ³•æ§åˆ¶éšè—ä¸æ˜¾ç¤ºã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XUIçš„BaseRecyclerAdapter</title>
      <link href="2020/10/09/XUI%E7%9A%84BaseRecyclerAdapter/"/>
      <url>2020/10/09/XUI%E7%9A%84BaseRecyclerAdapter/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬ä¸‰æ–¹UIåº“çš„ä½¿ç”¨</p><a id="more"></a><h2 id="å…³äºXUIçš„BaseRecyclerAdapterçš„ä½¿ç”¨"><a href="#å…³äºXUIçš„BaseRecyclerAdapterçš„ä½¿ç”¨" class="headerlink" title="å…³äºXUIçš„BaseRecyclerAdapterçš„ä½¿ç”¨"></a>å…³äºXUIçš„BaseRecyclerAdapterçš„ä½¿ç”¨</h2><h6 id="æ­£å¸¸ä½¿ç”¨ï¼š"><a href="#æ­£å¸¸ä½¿ç”¨ï¼š" class="headerlink" title="æ­£å¸¸ä½¿ç”¨ï¼š"></a>æ­£å¸¸ä½¿ç”¨ï¼š</h6><ul><li>åˆ›å»ºä¸€ä¸ªé€‚é…å™¨æ¥ç»§æ‰¿BaseRecyclerAdapterï¼Œæƒ³è¦ä¼ å…¥å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯é€‚é…å™¨æ•°æ®ï¼‰  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class RecommendedVideoAdapter extends BaseRecyclerAdapter&lt;RecommendVideoBean.BeanData&gt;</span><br></pre></td></tr></table></figure></li><li>åˆ›å»ºæ„é€ æ–¹æ³•  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public RecommendedVideoAdapter(Context context,VideoChoiceDialog videoChoiceDialog) &#123;</span><br><span class="line">    this.videoChoiceDialog &#x3D; videoChoiceDialog;</span><br><span class="line">    mContext &#x3D; context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> å°†ä¸Šä¸‹æ–‡å¯¹è±¡ä¼ å…¥è¿›æ¥ï¼Œæ–¹ä¾¿ä¹‹åçš„ä½¿ç”¨</li><li>åœ¨bindDataä¸­å†™å¤„ç†æ•°æ®çš„æ“ä½œ  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Override</span><br><span class="line">protected void bindData(@NonNull RecyclerViewHolder holder, int position, RecommendVideoBean.BeanData item) &#123;</span><br><span class="line">    cover &#x3D; holder.findViewById(R.id.Re_cover);</span><br><span class="line">    play_volume &#x3D; holder.findViewById(R.id.Re_play_volume);</span><br><span class="line">    barrage_volume &#x3D; holder.findViewById(R.id.Re_barrage_volume);</span><br><span class="line">    Re_video &#x3D; holder.findViewById(R.id.Re_video_cover);</span><br><span class="line">    title &#x3D; holder.findViewById(R.id.Re_title);</span><br><span class="line">    more &#x3D; holder.findViewById(R.id.Re_more);</span><br><span class="line">    Re_video.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onClick(View v) &#123;</span><br><span class="line">            Intent intent &#x3D; new Intent(mContext, VideoActivity.class);</span><br><span class="line">            intent.putExtra(&quot;id&quot;, videoBean.getData().get(position).getId());</span><br><span class="line">            intent.putExtra(&quot;uid&quot;, videoBean.getData().get(position).getUid());</span><br><span class="line">            mContext.startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    if (item !&#x3D; null) &#123;</span><br><span class="line">        initData(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void initData(RecommendVideoBean.BeanData item) &#123;</span><br><span class="line">    Glide.with(mContext)</span><br><span class="line">            .load(item.getCover())</span><br><span class="line">            .into(cover);</span><br><span class="line">    play_volume.setText(item.getPlayNum() + &quot;&quot;);</span><br><span class="line">    barrage_volume.setText(item.getDanmunum() + &quot;&quot;);</span><br><span class="line">    title.setText(item.getTitle());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> åŒ…æ‹¬è·å–æ§ä»¶å’Œåˆå§‹åŒ–æ•°æ®<h6 id="åœ¨Avtivity-Fragmentä¸­çš„ä½¿ç”¨ï¼š"><a href="#åœ¨Avtivity-Fragmentä¸­çš„ä½¿ç”¨ï¼š" class="headerlink" title="åœ¨Avtivity/Fragmentä¸­çš„ä½¿ç”¨ï¼š"></a>åœ¨Avtivity/Fragmentä¸­çš„ä½¿ç”¨ï¼š</h6></li><li>åˆå§‹åŒ–<ol><li>è·å–RecyclerViewæ§ä»¶</li><li>è®¾ç½®RecyclerViewçš„æ’åˆ—æ–¹å¼</li><li>åˆ›å»ºé€‚é…å™¨å¯¹è±¡</li><li>RecyclerViewè®¾ç½®é€‚é…å™¨<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GridLayoutManager layoutManager1 &#x3D; new GridLayoutManager(getContext(), 2);</span><br><span class="line">      adapter &#x3D; new RecommendedVideoAdapter(getContext(), videoChoiceDialog);</span><br><span class="line">      binding.ReRecy.setLayoutManager(layoutManager1);</span><br><span class="line">      binding.ReRecy.setAdapter(adapter);</span><br></pre></td></tr></table></figure></li></ol></li><li>åŠ è½½æ•°æ®<br>ç›´æ¥è°ƒç”¨é€‚é…å™¨çš„åŠ è½½æ•°æ®çš„æ–¹æ³•ï¼Œåˆ·æ–°ä¹Ÿæ˜¯ä¸€æ ·<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adapter.loadMore(videoBean.getData());</span><br><span class="line">&#x2F;&#x2F;loadMoreä¸€èˆ¬æ˜¯ä¼ å…¥ä¸€ä¸ªlistï¼ˆåŠ è½½ï¼‰</span><br><span class="line">for (RecommendVideoBean.BeanData datum : videoBean.getData()) &#123;</span><br><span class="line">           adapter.add(0, datum);</span><br><span class="line">       &#125;</span><br><span class="line">&#x2F;&#x2F;addä¸€èˆ¬æ˜¯ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ˆåœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªï¼‰</span><br><span class="line">adapter.refresh(videoBean.getData());</span><br><span class="line">&#x2F;&#x2F;refreshå’ŒåŠ è½½å·®ä¸å¤šï¼ˆåˆ·æ–°ï¼‰</span><br></pre></td></tr></table></figure><h6 id="å‘"><a href="#å‘" class="headerlink" title="å‘"></a>å‘</h6></li><li>å¦‚æœæƒ³è¦æœ‰itemåŠ è½½æ—¶çš„åŠ¨ç”»ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨adapteråŠ è½½æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¸èƒ½ä½¿ç”¨ loadMore ï¼Œå¿…é¡»ä½¿ç”¨ add æ¥ä¸€ä¸ªä¸€ä¸ªæ·»åŠ ï¼Œå¦åˆ™æ˜¯æ²¡æœ‰åŠ¨ç”»çš„</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> View </tag>
            
            <tag> Recycler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SmartRefreshLayoutçš„ä½¿ç”¨</title>
      <link href="2020/09/22/SmartRefreshLayout%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2020/09/22/SmartRefreshLayout%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬ä¸‰æ–¹åˆ·æ–°åº“çš„ä½¿ç”¨</p><a id="more"></a><h1 id="SmartRefreshLayout"><a href="#SmartRefreshLayout" class="headerlink" title="SmartRefreshLayout"></a>SmartRefreshLayout</h1><p>æœ¬ç¼–å°†è®²è§£SmartRefreshLayoutçš„ä½¿ç”¨ï¼Œæ¥è¾¾æˆè¿›å…¥é¡µé¢æ—¶ï¼Œè°ƒç”¨è‡ªåŠ¨åŠ è½½æ¥åŠ è½½æ•°æ®çš„æ•ˆæœã€‚</p><h6 id="SmartRefreshLayoutçš„Xmlä½¿ç”¨ï¼š"><a href="#SmartRefreshLayoutçš„Xmlä½¿ç”¨ï¼š" class="headerlink" title="SmartRefreshLayoutçš„Xmlä½¿ç”¨ï¼š"></a>SmartRefreshLayoutçš„Xmlä½¿ç”¨ï¼š</h6><ul><li>SmartRefreshLayoutæ˜¯ä¸€ä¸ªçˆ¶ç±»ï¼Œå®ƒåªå…è®¸æœ‰ä¸€ä¸ªå­ç±»è¢«å®ƒåŒ…è£¹ï¼Œä¸èƒ½æœ‰ä¸¤ä¸ª</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.scwang.smartrefresh.layout.SmartRefreshLayout</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;swipe&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">        &lt;androidx.recyclerview.widget.RecyclerView</span><br><span class="line">              android:id&#x3D;&quot;@+id&#x2F;Hot_Recy&quot;</span><br><span class="line">              android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">              android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">              android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">              android:layout_marginTop&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">              android:layout_marginRight&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">              app:layout_behavior&#x3D;&quot;@string&#x2F;appbar_scrolling_view_behavior&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;com.scwang.smartrefresh.layout.SmartRefreshLayout&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±ç»™è¿™ä¸ªé¡µé¢æ·»åŠ äº†ä¸ªåˆ·æ–°åŠŸèƒ½ï¼ˆåŒ…æ‹¬ï¼Œä¸‹æ‹‰åˆ·æ–°ï¼Œä¸Šæ‹‰åŠ è½½ï¼‰</p><ul><li>æ¥ä¸‹æ¥å°±æ˜¯å¯¹SmartRefreshLayoutçš„å±æ€§è¿›è¡Œè®¾ç½®<ol><li>æ¨èè¿›è¡Œå…¨å±€è®¾ç½®ï¼Œåœ¨MyApplicationé‡Œè¿›è¡Œè®¾ç½®<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class MyApplication extends Application &#123;</span><br><span class="line">...</span><br><span class="line">static &#123;&#x2F;&#x2F;ä½¿ç”¨staticä»£ç æ®µå¯ä»¥é˜²æ­¢å†…å­˜æ³„æ¼</span><br><span class="line">    &#x2F;&#x2F;è®¾ç½®å…¨å±€é»˜è®¤é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼Œä¼šè¢«å…¶ä»–è®¾ç½®è¦†ç›–ï¼‰</span><br><span class="line">    SmartRefreshLayout.setDefaultRefreshInitializer(new DefaultRefreshInitializer() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void initialize(@NonNull Context context, @NonNull RefreshLayout layout) &#123;</span><br><span class="line">            &#x2F;&#x2F;å¼€å§‹è®¾ç½®å…¨å±€çš„åŸºæœ¬å‚æ•°ï¼ˆå¯ä»¥è¢«ä¸‹é¢çš„DefaultRefreshHeaderCreatorè¦†ç›–ï¼‰</span><br><span class="line">            layout.setEnableLoadMore(false);</span><br><span class="line">            layout.setDisableContentWhenRefresh(true);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;å…¨å±€è®¾ç½®é»˜è®¤çš„ Header</span><br><span class="line">    SmartRefreshLayout.setDefaultRefreshHeaderCreator(new DefaultRefreshHeaderCreator() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public RefreshHeader createRefreshHeader(Context context, RefreshLayout layout) &#123;</span><br><span class="line">            &#x2F;&#x2F;å¼€å§‹è®¾ç½®å…¨å±€çš„åŸºæœ¬å‚æ•°ï¼ˆè¿™é‡Œè®¾ç½®çš„å±æ€§åªè·Ÿä¸‹é¢çš„MaterialHeaderç»‘å®šï¼Œå…¶ä»–Headerä¸ä¼šç”Ÿæ•ˆï¼Œèƒ½è¦†ç›–DefaultRefreshInitializerçš„å±æ€§å’ŒXmlè®¾ç½®çš„å±æ€§ï¼‰</span><br><span class="line">            layout.setEnableHeaderTranslationContent(false);</span><br><span class="line">            return new MaterialHeader(context).setColorSchemeResources(R.color.Pink,R.color.While,R.color.While);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void onCreate() &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>æˆ‘è¿™é‡Œæ˜¯è®¾ç½®äº†SmartRefreshLayoutå®ƒçš„ä¸‹æ‹‰åˆ·æ–°æ ·å¼ï¼Œå¹¶ä¸”å–æ¶ˆäº†ä¸Šæ‹‰åŠ è½½ï¼Œä½†æ˜¯è¿™é‡Œè®¾ç½®çš„å±æ€§ä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œåˆ«çš„é¡µé¢å¦‚æœè¿›è¡Œè¦†å†™ï¼Œåˆ™ä¼šè¢«è¦†ç›–</li></ol></li></ul><h6 id="SmartRefreshLayoutçš„javaä»£ç ä½¿ç”¨ï¼š"><a href="#SmartRefreshLayoutçš„javaä»£ç ä½¿ç”¨ï¼š" class="headerlink" title="SmartRefreshLayoutçš„javaä»£ç ä½¿ç”¨ï¼š"></a>SmartRefreshLayoutçš„javaä»£ç ä½¿ç”¨ï¼š</h6><ul><li>é¦–å…ˆè·å–æ§ä»¶ï¼Œè¿™é‡Œå› ä¸ºå…¨ç¯‡éƒ½æ˜¯ä½¿ç”¨çš„DataBindingï¼Œæ‰€æœ‰å°±ä¸ç”¨è·å–æ§ä»¶äº†ï¼Œä¹‹åè®¾ç½®SmartRefreshLayoutçš„ä¸‹æ‹‰åˆ·æ–°ç›‘å¬ï¼Œåœ¨ç›‘å¬æ–¹æ³•é‡Œé¢å†™å…¥ä½ çš„åŠ è½½æ•°æ®çš„æ–¹æ³•ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">binding.swipe.setOnRefreshListener(new OnRefreshListener() &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onRefresh(@NonNull RefreshLayout refreshLayout) &#123;</span><br><span class="line">                initDatas();</span><br><span class="line">                isFirst &#x3D; false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>æˆ‘è¿™é‡Œæ˜¯è°ƒç”¨äº†åŠ è½½æ•°æ®çš„æ–¹æ³•ï¼Œå¹¶ä¸”å°†isFirstè®¾ç½®ä¸ºfalseï¼Œè¿™æ ·æ˜¯ç”¨æ¥åŒºåˆ†ç¬¬ä¸€æ¬¡åŠ è½½å’Œæ‰‹åŠ¨ä¸‹æ‹‰åŠ è½½</li><li>ä¹‹åè¿˜éœ€è¦åœ¨onCreateä¸­è®¾ç½®SmartRefreshLayoutè‡ªåŠ¨åˆ·æ–°ï¼Œè¿™æ ·åœ¨è¿›å…¥avtivity/Fragmentçš„æ—¶å€™å°±ä¼šè¿›è¡Œè‡ªåŠ¨çš„åˆ·æ–°ï¼Œå¹¶è°ƒç”¨åˆ·æ–°ç›‘å¬é‡Œè®¾ç½®çš„æ–¹æ³•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected void initData() &#123;</span><br><span class="line">        binding.swipe.autoRefresh();&#x2F;&#x2F;è‡ªåŠ¨åˆ·æ–°</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>è¿™æ ·åŸºæœ¬ä¸Šå°±å®Œæˆäº†æƒ³è¦çš„æ•ˆæœã€‚æ¥ä¸‹æ¥å°±ç»™å‡ºSmartRefreshLayoutçš„å±æ€§ã€‚</li><li>SmartRefreshLayoutå±æ€§ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">public class RefreshActivity extends Activity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        &#x2F;&#x2F;ä¸‹é¢ç¤ºä¾‹ä¸­çš„å€¼ç­‰äºé»˜è®¤å€¼</span><br><span class="line">        RefreshLayout refreshLayout &#x3D; (RefreshLayout)findViewById(R.id.refreshLayout);</span><br><span class="line">        refreshLayout.setPrimaryColorsId(R.color.colorPrimary, android.R.color.white);</span><br><span class="line">        refreshLayout.setDragRate(0.5f);&#x2F;&#x2F;æ˜¾ç¤ºä¸‹æ‹‰é«˜åº¦&#x2F;æ‰‹æŒ‡çœŸå®ä¸‹æ‹‰é«˜åº¦&#x3D;é˜»å°¼æ•ˆæœ</span><br><span class="line">        refreshLayout.setReboundDuration(300);&#x2F;&#x2F;å›å¼¹åŠ¨ç”»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line"></span><br><span class="line">        refreshLayout.setHeaderHeight(100);&#x2F;&#x2F;Headeræ ‡å‡†é«˜åº¦ï¼ˆæ˜¾ç¤ºä¸‹æ‹‰é«˜åº¦&gt;&#x3D;æ ‡å‡†é«˜åº¦ è§¦å‘åˆ·æ–°ï¼‰</span><br><span class="line">        refreshLayout.setHeaderHeightPx(100);&#x2F;&#x2F;åŒä¸Š-åƒç´ ä¸ºå•ä½ ï¼ˆV1.1.0åˆ é™¤ï¼‰</span><br><span class="line">        refreshLayout.setFooterHeight(100);&#x2F;&#x2F;Footeræ ‡å‡†é«˜åº¦ï¼ˆæ˜¾ç¤ºä¸Šæ‹‰é«˜åº¦&gt;&#x3D;æ ‡å‡†é«˜åº¦ è§¦å‘åŠ è½½ï¼‰</span><br><span class="line">        refreshLayout.setFooterHeightPx(100);&#x2F;&#x2F;åŒä¸Š-åƒç´ ä¸ºå•ä½ ï¼ˆV1.1.0åˆ é™¤ï¼‰</span><br><span class="line"></span><br><span class="line">        refreshLayout.setFooterHeaderInsetStart(0);&#x2F;&#x2F;è®¾ç½® Header èµ·å§‹ä½ç½®åç§»é‡ 1.0.5</span><br><span class="line">        refreshLayout.setFooterHeaderInsetStartPx(0);&#x2F;&#x2F;åŒä¸Š-åƒç´ ä¸ºå•ä½ 1.0.5 ï¼ˆV1.1.0åˆ é™¤ï¼‰</span><br><span class="line">        refreshLayout.setFooterFooterInsetStart(0);&#x2F;&#x2F;è®¾ç½® Footer èµ·å§‹ä½ç½®åç§»é‡ 1.0.5</span><br><span class="line">        refreshLayout.setFooterFooterInsetStartPx(0);&#x2F;&#x2F;åŒä¸Š-åƒç´ ä¸ºå•ä½ 1.0.5 ï¼ˆV1.1.0åˆ é™¤ï¼‰</span><br><span class="line"></span><br><span class="line">        refreshLayout.setHeaderMaxDragRate(2);&#x2F;&#x2F;æœ€å¤§æ˜¾ç¤ºä¸‹æ‹‰é«˜åº¦&#x2F;Headeræ ‡å‡†é«˜åº¦</span><br><span class="line">        refreshLayout.setFooterMaxDragRate(2);&#x2F;&#x2F;æœ€å¤§æ˜¾ç¤ºä¸‹æ‹‰é«˜åº¦&#x2F;Footeræ ‡å‡†é«˜åº¦</span><br><span class="line">        refreshLayout.setHeaderTriggerRate(1);&#x2F;&#x2F;è§¦å‘åˆ·æ–°è·ç¦» ä¸ HeaderHeight çš„æ¯”ç‡1.0.4</span><br><span class="line">        refreshLayout.setFooterTriggerRate(1);&#x2F;&#x2F;è§¦å‘åŠ è½½è·ç¦» ä¸ FooterHeight çš„æ¯”ç‡1.0.4</span><br><span class="line"></span><br><span class="line">        refreshLayout.setEnableRefresh(true);&#x2F;&#x2F;æ˜¯å¦å¯ç”¨ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½</span><br><span class="line">        refreshLayout.setEnableLoadMore(false);&#x2F;&#x2F;æ˜¯å¦å¯ç”¨ä¸Šæ‹‰åŠ è½½åŠŸèƒ½</span><br><span class="line">        refreshLayout.setEnableAutoLoadMore(true);&#x2F;&#x2F;æ˜¯å¦å¯ç”¨åˆ—è¡¨æƒ¯æ€§æ»‘åŠ¨åˆ°åº•éƒ¨æ—¶è‡ªåŠ¨åŠ è½½æ›´å¤š</span><br><span class="line">        refreshLayout.setEnablePureScrollMode(false);&#x2F;&#x2F;æ˜¯å¦å¯ç”¨çº¯æ»šåŠ¨æ¨¡å¼</span><br><span class="line">        refreshLayout.setEnableNestedScroll(false);&#x2F;&#x2F;æ˜¯å¦å¯ç”¨åµŒå¥—æ»šåŠ¨</span><br><span class="line">        refreshLayout.setEnableOverScrollBounce(true);&#x2F;&#x2F;æ˜¯å¦å¯ç”¨è¶Šç•Œå›å¼¹</span><br><span class="line">        refreshLayout.setEnableScrollContentWhenLoaded(true);&#x2F;&#x2F;æ˜¯å¦åœ¨åŠ è½½å®Œæˆæ—¶æ»šåŠ¨åˆ—è¡¨æ˜¾ç¤ºæ–°çš„å†…å®¹</span><br><span class="line">        refreshLayout.setEnableHeaderTranslationContent(true);&#x2F;&#x2F;æ˜¯å¦ä¸‹æ‹‰Headerçš„æ—¶å€™å‘ä¸‹å¹³ç§»åˆ—è¡¨æˆ–è€…å†…å®¹</span><br><span class="line">        refreshLayout.setEnableFooterTranslationContent(true);&#x2F;&#x2F;æ˜¯å¦ä¸Šæ‹‰Footerçš„æ—¶å€™å‘ä¸Šå¹³ç§»åˆ—è¡¨æˆ–è€…å†…å®¹</span><br><span class="line">        refreshLayout.setEnableLoadMoreWhenContentNotFull(true);&#x2F;&#x2F;æ˜¯å¦åœ¨åˆ—è¡¨ä¸æ»¡ä¸€é¡µæ—¶å€™å¼€å¯ä¸Šæ‹‰åŠ è½½åŠŸèƒ½</span><br><span class="line">        refreshLayout.setEnableFooterFollowWhenLoadFinished(false);&#x2F;&#x2F;æ˜¯å¦åœ¨å…¨éƒ¨åŠ è½½ç»“æŸä¹‹åFooterè·Ÿéšå†…å®¹1.0.4</span><br><span class="line">        refreshLayout.setEnableOverScrollDrag(false);&#x2F;&#x2F;æ˜¯å¦å¯ç”¨è¶Šç•Œæ‹–åŠ¨ï¼ˆä»¿è‹¹æœæ•ˆæœï¼‰1.0.4</span><br><span class="line"></span><br><span class="line">        refreshLayout.setEnableScrollContentWhenRefreshed(true);&#x2F;&#x2F;æ˜¯å¦åœ¨åˆ·æ–°å®Œæˆæ—¶æ»šåŠ¨åˆ—è¡¨æ˜¾ç¤ºæ–°çš„å†…å®¹ 1.0.5</span><br><span class="line">        refreshLayout.srlEnableClipHeaderWhenFixedBehind(true);&#x2F;&#x2F;æ˜¯å¦å‰ªè£Headerå½“æ—¶æ ·å¼ä¸ºFixedBehindæ—¶1.0.5</span><br><span class="line">        refreshLayout.srlEnableClipFooterWhenFixedBehind(true);&#x2F;&#x2F;æ˜¯å¦å‰ªè£Footerå½“æ—¶æ ·å¼ä¸ºFixedBehindæ—¶1.0.5</span><br><span class="line"></span><br><span class="line">        refreshLayout.setDisableContentWhenRefresh(false);&#x2F;&#x2F;æ˜¯å¦åœ¨åˆ·æ–°çš„æ—¶å€™ç¦æ­¢åˆ—è¡¨çš„æ“ä½œ</span><br><span class="line">        refreshLayout.setDisableContentWhenLoading(false);&#x2F;&#x2F;æ˜¯å¦åœ¨åŠ è½½çš„æ—¶å€™ç¦æ­¢åˆ—è¡¨çš„æ“ä½œ</span><br><span class="line"></span><br><span class="line">        refreshLayout.setOnMultiPurposeListener(new SimpleMultiPurposeListener());&#x2F;&#x2F;è®¾ç½®å¤šåŠŸèƒ½ç›‘å¬å™¨</span><br><span class="line">        refreshLayout.setScrollBoundaryDecider(new ScrollBoundaryDecider());&#x2F;&#x2F;è®¾ç½®æ»šåŠ¨è¾¹ç•Œåˆ¤æ–­</span><br><span class="line">        refreshLayout.setScrollBoundaryDecider(new ScrollBoundaryDeciderAdapter());&#x2F;&#x2F;è‡ªå®šä¹‰æ»šåŠ¨è¾¹ç•Œ</span><br><span class="line"></span><br><span class="line">        refreshLayout.setRefreshHeader(new ClassicsHeader(context));&#x2F;&#x2F;è®¾ç½®Header</span><br><span class="line">        refreshLayout.setRefreshFooter(new ClassicsFooter(context));&#x2F;&#x2F;è®¾ç½®Footer</span><br><span class="line">        refreshLayout.setRefreshContent(new View(context));&#x2F;&#x2F;è®¾ç½®åˆ·æ–°Contentï¼ˆç”¨äºéxmlå¸ƒå±€ä»£æ›¿addViewï¼‰1.0.4</span><br><span class="line"></span><br><span class="line">        refreshLayout.autoRefresh();&#x2F;&#x2F;è‡ªåŠ¨åˆ·æ–°</span><br><span class="line">        refreshLayout.autoLoadMore();&#x2F;&#x2F;è‡ªåŠ¨åŠ è½½</span><br><span class="line">        refreshLayout.autoRefreshAnimationOnly();&#x2F;&#x2F;è‡ªåŠ¨åˆ·æ–°ï¼Œåªæ˜¾ç¤ºåŠ¨ç”»ä¸æ‰§è¡Œåˆ·æ–°</span><br><span class="line">        refreshLayout.autoLoadMoreAnimationOnly();&#x2F;&#x2F;è‡ªåŠ¨åŠ è½½ï¼Œåªæ˜¾ç¤ºåŠ¨ç”»ä¸æ‰§è¡ŒåŠ è½½</span><br><span class="line">        refreshLayout.autoRefresh(400);&#x2F;&#x2F;å»¶è¿Ÿ400æ¯«ç§’åè‡ªåŠ¨åˆ·æ–°</span><br><span class="line">        refreshLayout.autoLoadMore(400);&#x2F;&#x2F;å»¶è¿Ÿ400æ¯«ç§’åè‡ªåŠ¨åŠ è½½</span><br><span class="line">        refreshLayout.finishRefresh();&#x2F;&#x2F;ç»“æŸåˆ·æ–°</span><br><span class="line">        refreshLayout.finishLoadMore();&#x2F;&#x2F;ç»“æŸåŠ è½½</span><br><span class="line">        refreshLayout.finishRefresh(3000);&#x2F;&#x2F;å»¶è¿Ÿ3000æ¯«ç§’åç»“æŸåˆ·æ–°</span><br><span class="line">        refreshLayout.finishLoadMore(3000);&#x2F;&#x2F;å»¶è¿Ÿ3000æ¯«ç§’åç»“æŸåŠ è½½</span><br><span class="line">        refreshLayout.finishRefresh(false);&#x2F;&#x2F;ç»“æŸåˆ·æ–°ï¼ˆåˆ·æ–°å¤±è´¥ï¼‰</span><br><span class="line">        refreshLayout.finishLoadMore(false);&#x2F;&#x2F;ç»“æŸåŠ è½½ï¼ˆåŠ è½½å¤±è´¥ï¼‰</span><br><span class="line">        refreshLayout.finishLoadMoreWithNoMoreData();&#x2F;&#x2F;å®ŒæˆåŠ è½½å¹¶æ ‡è®°æ²¡æœ‰æ›´å¤šæ•°æ® 1.0.4</span><br><span class="line">        refreshLayout.closeHeaderOrFooter();&#x2F;&#x2F;å…³é—­æ­£åœ¨æ‰“å¼€çŠ¶æ€çš„ Header æˆ–è€… Footerï¼ˆ1.1.0ï¼‰</span><br><span class="line">        refreshLayout.resetNoMoreData();&#x2F;&#x2F;æ¢å¤æ²¡æœ‰æ›´å¤šæ•°æ®çš„åŸå§‹çŠ¶æ€ 1.0.4ï¼ˆ1.1.0åˆ é™¤ï¼‰</span><br><span class="line">        refreshLayout.setNoMoreData(false);&#x2F;&#x2F;æ¢å¤æ²¡æœ‰æ›´å¤šæ•°æ®çš„åŸå§‹çŠ¶æ€ 1.0.5</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¾èµ–æ³¨å…¥</title>
      <link href="2020/09/21/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"/>
      <url>2020/09/21/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>ä¾èµ–æ³¨å…¥å’¯</p><a id="more"></a><h1 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h1><h6 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h6><p>ä¾èµ–æ³¨å…¥æ˜¯å®ç°ç¨‹åºè§£è€¦çš„ä¸€ç§æ–¹å¼ã€‚å¦‚æœé€šè¿‡ç™¾åº¦æœç´¢å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹ç­”æ¡ˆï¼š<br>æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼Œè‹±æ–‡ç¼©å†™ä¸ºIoCï¼‰æ˜¯ä¸€ä¸ªé‡è¦çš„é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ³•åˆ™æ¥å‰Šå‡è®¡ç®—æœºç¨‹åºçš„è€¦åˆé—®é¢˜.æ§åˆ¶åè½¬ä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§°DIï¼‰å’Œä¾èµ–æŸ¥æ‰¾ï¼ˆDependency Lookupï¼‰ã€‚ä¾èµ–æ³¨å…¥åº”ç”¨æ¯”è¾ƒå¹¿æ³›ã€‚</p><h6 id="ä¸ªäººç†è§£ï¼š"><a href="#ä¸ªäººç†è§£ï¼š" class="headerlink" title="ä¸ªäººç†è§£ï¼š"></a>ä¸ªäººç†è§£ï¼š</h6><p>åœ¨ç¨‹åºä¸­ï¼Œä¸€ä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•éœ€è¦ä¾èµ–å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­ä¿å­˜å…¶æ‰€ä¾èµ–å¯¹è±¡çš„å®ä¾‹ï¼Œç”Ÿæˆä¾èµ–å¯¹è±¡çš„æ–¹å¼ä¸å†è¯¥å¯¹è±¡ä¸­é€šè¿‡newåˆ›å»ºï¼Œè€Œæ˜¯è°ƒç”¨è€…å¤–éƒ¨åˆ›å»ºä¾èµ–å¯¹è±¡ï¼Œé€šè¿‡ä¸€å®šçš„æ–¹å¼è¿›è¡Œä¼ å…¥ã€‚</p><h6 id="ä¾èµ–æ³¨å…¥çš„ä¸‰ç§å®ç°æ–¹å¼ï¼ˆåŸç”Ÿæ–¹å¼ï¼‰ï¼š"><a href="#ä¾èµ–æ³¨å…¥çš„ä¸‰ç§å®ç°æ–¹å¼ï¼ˆåŸç”Ÿæ–¹å¼ï¼‰ï¼š" class="headerlink" title="ä¾èµ–æ³¨å…¥çš„ä¸‰ç§å®ç°æ–¹å¼ï¼ˆåŸç”Ÿæ–¹å¼ï¼‰ï¼š"></a>ä¾èµ–æ³¨å…¥çš„ä¸‰ç§å®ç°æ–¹å¼ï¼ˆåŸç”Ÿæ–¹å¼ï¼‰ï¼š</h6><ol><li>æ„é€ æ–¹æ³•æ³¨å…¥ è¯¥æ–¹å¼æ˜¯é€šè¿‡æ„é€ æ–¹æ³•å°†å…¶æ‰€ä¾èµ–çš„å¤–éƒ¨ç±»å¯¹è±¡ä¼ å…¥è¿›æ¥ï¼Œæ˜¯æˆ‘è®¤ä¸ºçš„æœ€ç®€å•çš„æ–¹å¼ã€‚å…¶å®ç°æ–¹å¼å¦‚ä¸‹ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„ä»£ç ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Classes &#123;</span><br><span class="line">&#x2F;&#x2F; ä¾èµ–ç±»</span><br><span class="line">private Boy boy;</span><br><span class="line">&#x2F;**</span><br><span class="line">* æ„é€ æ–¹æ³•æ³¨å…¥ï¼Œé€šè¿‡æ„é€ æ–¹æ³•ä¼ å…¥è¯¥å¯¹è±¡</span><br><span class="line">* @param boy</span><br><span class="line">*&#x2F;</span><br><span class="line">public Classes(Boy boy) &#123;</span><br><span class="line">this.boy &#x3D; boy;</span><br><span class="line">&#125;</span><br><span class="line">public void run() &#123;</span><br><span class="line">boy.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>Setter æ³¨å…¥ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> public class Classes &#123;</span><br><span class="line">&#x2F;&#x2F;....</span><br><span class="line">private Boy boy;</span><br><span class="line"></span><br><span class="line">public void setBoy(Boy boy)&#123;</span><br><span class="line">    this.boy &#x3D; boy;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>æ¥å£æ–¹å¼ æ¥å£æ–¹å¼æ˜¯å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£ä¸­å£°æ˜ä¸€ä¸ªæ³¨å…¥çš„æ–¹æ³•ï¼Œè€Œéœ€è¦æ³¨å…¥çš„ç±»å®ç°è¯¥æ¥å£ï¼Œå®ç°æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚å®šä¹‰æ¥å£ï¼Œå£°æ˜æ³¨å…¥æ–¹æ³•:</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public interface BoyInjection &#123;</span><br><span class="line">void inject(Boy boy); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Classes implements BoyInjection &#123;</span><br><span class="line"> &#x2F;&#x2F;.... private Boy boy; </span><br><span class="line">@Override public void inject(Boy boy) &#123; </span><br><span class="line">&#x2F;&#x2F;å®ç°æ¥å£ä¸­çš„æ–¹æ³• this.boy &#x3D; boy; </span><br><span class="line">&#125; </span><br><span class="line">&#x2F;&#x2F;....</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h6 id="Android-Dagger2ä¾èµ–æ³¨å…¥"><a href="#Android-Dagger2ä¾èµ–æ³¨å…¥" class="headerlink" title="Android Dagger2ä¾èµ–æ³¨å…¥:"></a>Android Dagger2ä¾èµ–æ³¨å…¥:</h6><ul><li>å¼•å…¥ä¾èµ–åº“:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compile &#39;com.google.dagger:dagger:2.11&#39;</span><br><span class="line"> annotationProcessor &#39;com.google.dagger:dagger-compiler:2.11&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç‰ˆæœ¬å·ä»¥å®˜ç½‘ä¸ºå‡†ï¼š<a href="https://github.com/google/dagger">https://github.com/google/dagger</a> </p><ul><li>åˆ›å»ºä¸€ä¸ªå¯¹è±¡:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class A &#123;</span><br><span class="line">    public void eat() &#123;</span><br><span class="line">        System.out.print(&quot;åƒé¥­äº†&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºMouduleï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ç¬¬ä¸€æ­¥ æ·»åŠ @Module æ³¨è§£</span><br><span class="line">@Module</span><br><span class="line">public class MainModule &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºå…·ä½“çš„ç¤ºä¾‹:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ç¬¬ä¸€æ­¥ æ·»åŠ @Module æ³¨è§£</span><br><span class="line">@Module</span><br><span class="line">public class MainModule &#123;</span><br><span class="line">    &#x2F;&#x2F;ç¬¬äºŒæ­¥ ä½¿ç”¨Provider æ³¨è§£ å®ä¾‹åŒ–å¯¹è±¡</span><br><span class="line">    @Provides</span><br><span class="line">    A providerA() &#123;   &#x2F;&#x2F; providerAåªæ˜¯ä¸ªåç§°</span><br><span class="line">        return new A();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªComponent:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ç¬¬ä¸€æ­¥ æ·»åŠ @Component</span><br><span class="line">&#x2F;&#x2F;ç¬¬äºŒæ­¥ æ·»åŠ module</span><br><span class="line">@Component(modules &#x3D; &#123;MainModule.class&#125;)  &#x2F;&#x2F;ä¸åˆšåˆšåˆ›å»ºçš„Mouduleè¿æ¥èµ·æ¥</span><br><span class="line">public interface MainComponent &#123;</span><br><span class="line">    &#x2F;&#x2F;ç¬¬ä¸‰æ­¥  å†™ä¸€ä¸ªæ–¹æ³• ç»‘å®šActivity &#x2F;Fragment</span><br><span class="line">    void inject(MainActivity activity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¹‹åRebuild Projectä¸€ä¸‹ï¼ŒMake Projectä¹Ÿè¡Œï¼Œä¹‹åç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºå‡ ä¸ªç±»ï¼Œç”¨æ¥ä¸activityè¿æ¥ã€‚(è¿™ä¸€æ­¥æ“ä½œå¯èƒ½ä¼šè¦ç­‰å¾…å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œ10åˆ†é’Ÿå·¦å³)</p></blockquote><ul><li>å°†Componentä¸Activity/Fragmentç»‘å®šå…³ç³»:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line">    &#x2F;***</span><br><span class="line">     * ç¬¬äºŒæ­¥  ä½¿ç”¨Inject æ³¨è§£ï¼Œè·å–åˆ°A å¯¹è±¡çš„å®ä¾‹</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Inject  &#x2F;&#x2F;è®°å¾—åœ¨éœ€è¦çš„å‚æ•°å‰åŠ @Inject</span><br><span class="line">A a;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        &#x2F;***</span><br><span class="line">         * ç¬¬ä¸€æ­¥ æ·»åŠ ä¾èµ–å…³ç³»</span><br><span class="line">         *&#x2F;</span><br><span class="line">        &#x2F;&#x2F;ç¬¬ä¸€ç§æ–¹å¼ä¸Activity&#x2F;Fragmentè¿›è¡Œç»‘å®š</span><br><span class="line">        DaggerMainConponent.create().inject(this);</span><br><span class="line">        &#x2F;&#x2F;ç¬¬äºŒç§æ–¹å¼ä¸Activity&#x2F;Fragmentè¿›è¡Œç»‘å®š</span><br><span class="line">        DaggerMainConponent.builder().build().inject(this);</span><br><span class="line">        &#x2F;***</span><br><span class="line">         * ç¬¬ä¸‰æ­¥  è°ƒç”¨A å¯¹è±¡çš„æ–¹æ³•</span><br><span class="line">         *&#x2F;</span><br><span class="line">        a.eat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åå°±å¯ä»¥äº†ï¼Œæ¥ä¸‹æ¥ä»‹ç»Dagger2çš„å•ä¾‹æ¨¡å¼.</p><h6 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼:"></a>å•ä¾‹æ¨¡å¼:</h6><p>@Singleton è¿™ä¸ªæ³¨é‡Šå¯ä»¥ä½¿Daggerè¿›å…¥å•ä¾‹æ¨¡å¼ï¼Œè¦åœ¨Mouduleå’ŒComponentçš„ä¸Šæ–¹æ·»åŠ ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Module</span><br><span class="line">public class ActivityModule &#123;</span><br><span class="line">    @Singleton</span><br><span class="line">    @Provides</span><br><span class="line">    Student privadeStu()&#123;</span><br><span class="line">        return new Student();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Singleton</span><br><span class="line">@Component(modules &#x3D; &#123;ActivityModule.class&#125;)</span><br><span class="line">public interface ActivityComponent &#123;</span><br><span class="line">    void inject(MainActivity mainActivity);</span><br><span class="line">    void inject(UserActivity userActivity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ @Singletonå°±å˜æˆå•ä¾‹äº†ï¼Œåœ¨MainActivityé‡Œ å£°æ˜ä¸¤ä¸ªStudentä¸åŒåå­—çš„å¯¹è±¡åˆ†åˆ«æ‰“å°ä»–çš„åœ°å€ï¼Œä½ ä¼šå‘ç°åœ°å€æ˜¯ä¸€æ ·çš„<br>ä½†æ˜¯ä½ å†æ–°å»ºç«‹ä¸€ä¸ªActivity å†æ¬¡å£°æ˜ Student stu ï¼Œæ³¨å…¥å¯¹è±¡ï¼Œä½ ä¼šå‘ç°è¿™æ—¶å€™ åœ°å€å°±ä¸ä¸€æ ·äº†ã€‚å› ä¸ºæŒæœ‰çš„å¯¹è±¡æ˜¯Activityã€‚<br>åˆ°æ­¤å·²ç»èƒ½åœ¨ä¸€ä¸ªActivityé‡Œï¼Œå£°æ˜ä¸¤ä¸ªå¯¹è±¡å˜é‡ï¼Œç”¨@Injectæ³¨å…¥ï¼Œå¾—åˆ°çš„æ˜¯ åŒä¸€ä¸ªå¯¹è±¡</p><h6 id="Singletonçš„åˆ†æ"><a href="#Singletonçš„åˆ†æ" class="headerlink" title="@Singletonçš„åˆ†æ:"></a>@Singletonçš„åˆ†æ:</h6><p>æ¥ä¸‹æ¥æˆ‘è¦æ¨ç¿»åˆšæ‰è¯´çš„@Singletonï¼Œçœ‹åˆ°è‹±æ–‡Singleton æ˜¯å•ä¾‹çš„æ„æ€ï¼Œåœ¨Dagger2é‡Œä»–å°±æ˜¯ä¸ªå‘½åçš„ä¸€ä¸ªæ³¨è§£è€Œå·²<br>ä»–å«ä»€ä¹ˆåå­—éƒ½è¡Œ @ABCã€@ABBã€@ABCCï¼Œéƒ½è¡Œã€‚ç‚¹å¼€Singletonï¼ˆctrl+Bï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Scope   &#x2F;&#x2F;ä½œç”¨åŸŸçš„æ³¨é‡Šï¼Œä»£è¡¨ç€è¢«åŒ…æ‹¬çš„éƒ½æ˜¯åœ¨ä¸€ä¸ªä½œç”¨åŸŸä¹‹ä¸­</span><br><span class="line">@Documented</span><br><span class="line">@Retention(RUNTIME)</span><br><span class="line">public @interface Singleton &#123;&#125;</span><br></pre></td></tr></table></figure><p>Singleton ç”¨äº†@Scopeï¼ˆä½œç”¨åŸŸï¼‰ æ ‡è®°ã€‚ ä¹Ÿå°±æ˜¯è¯´è¢« @ScopeåŒ…è£¹çš„Component éƒ½æ˜¯åœ¨ä¸€ä¸ªä½œç”¨åŸŸé‡Œçš„ï¼Œ ä½œç”¨åŸŸï¼ä¸å«å•ä¾‹<br>å¥½ é‚£ç›´æ¥ç”¨ScopeåŒ…è£¹Componentã€‚ç¼–è¯‘å™¨æç¤º ç›´æ¥Removeäº†è¿™ä¸ªæ³¨è§£ã€‚å› ä¸ºä»–çš„ç›®æ ‡æ˜¯ @Target(ANNOTATION_TYPE) è¿™ä¸ªè¡¨ç¤ºè¿™ä¸ªScopeåªç”¨äºæ³¨è§£ï¼Œä¸èƒ½ç”¨åœ¨ ç±»ä¸Šé¢</p><h6 id="é‚£æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ³¨è§£ï¼š"><a href="#é‚£æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ³¨è§£ï¼š" class="headerlink" title="é‚£æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ³¨è§£ï¼š"></a>é‚£æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ³¨è§£ï¼š</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Scope</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface ActivityScope &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠåˆšæ‰åŠ @Singletonçš„åœ°æ–¹å…¨æ¢æˆ@ActivityScope</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Module</span><br><span class="line">public class ActivityModule &#123;</span><br><span class="line">    @ActivityScope</span><br><span class="line">    @Provides</span><br><span class="line">    Student privadeStu()&#123;</span><br><span class="line">        return new Student();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@ActivityScope</span><br><span class="line">@Component(modules &#x3D; &#123;ActivityModule.class&#125;)</span><br><span class="line">public interface ActivityComponent &#123;</span><br><span class="line">    void inject(MainActivity mainActivity);</span><br><span class="line">    void inject(UserActivity userActivity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ä¸¤ä¸ªå¯¹è±¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tag: com.mydagger.bean.Student@96575e0</span><br><span class="line">tag: com.mydagger.bean.Student@96575e0</span><br></pre></td></tr></table></figure><p>åˆšæ‰è¯´äº†æŒæœ‰å¯¹è±¡çš„æ˜¯Activityï¼Œé‚£åªèƒ½åœ¨ä¸€ä¸ªActivityä¸­å®ç°å•ä¾‹ï¼Œé‚£è¦å…¨å±€å•ä¾‹æ€ä¹ˆåšå‘¢ï¼Ÿ<br>é€šå¸¸è¦å…¨å±€ä½¿ç”¨çš„å¯¹è±¡ï¼Œè¦ä¹ˆå†™ä¸ªstaticçš„ç±»ï¼Œè¦ä¹ˆApplicationã€‚æˆ‘ä»¬ç›´æ¥Application</p><ul><li><p>å…¨å±€å•ä¾‹:</p><ol><li><p>å…ˆå®šä¹‰ä¸ªå…¨å±€çš„æ³¨è§£ï¼Œåˆšè®²äº†åå­—æ— æ‰€è°“(è¿™é‡Œè¦åˆ›å»ºç¬¬äºŒä¸ªçš„æ³¨è§£æ˜¯å› ä¸ºï¼Œä¸€ä¸ªæ³¨è§£åªèƒ½ä½œç”¨åˆ°ä¸€ä¸ªä½œç”¨åŸŸï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸èƒ½ä¸ç­‰ä¸‹è¦åˆ›å»ºçš„çš„å¦ä¸€ä¸ªComponentçš„æ³¨è§£ç›¸åŒ)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> @Scope  &#x2F;&#x2F;ä½œç”¨åŸŸçš„æ„æ€</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface AppScope &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@ActivityScope</span><br><span class="line">&#x2F;&#x2F;å…ˆç»‘å®šè‡ªèº«çš„Moduleï¼Œåœ¨ç»‘å®šè¦ä¾èµ–çš„Component</span><br><span class="line">@Component(modules &#x3D; &#123;ActivityModule.class&#125;,dependencies &#x3D; AppComponent.class)</span><br><span class="line">public interface ActivityComponent &#123;</span><br><span class="line">    &#x2F;&#x2F;ç¬¬ä¸€ä¸ªactivityçš„ç»‘å®šæ–¹æ³•ï¼ˆXXXActivityå°±æ˜¯å¡«å†™ä½ è‡ªå·±çš„activityçš„åå­—ï¼‰</span><br><span class="line">void inject(XXXActivity testActivity);</span><br><span class="line">&#x2F;&#x2F;ç¬¬äºŒä¸ªactivityçš„ç»‘å®šæ–¹æ³•</span><br><span class="line">    void inject(XXXActivity testActivity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¢åŠ äº†ä¸€ä¸ª dependenciesï¼ˆä¾èµ–ï¼‰ï¼Œå½“å‰æ˜¯ActivityComponent ä¾èµ– AppComponent<br>æ–°å»ºä¸€ä¸ª AppComponent, è¿æ¥ä¸€ä¸ªModuleï¼Œæä¾›ä¸€ä¸ªæ–¹æ³• æä¾› ç»™ MainActivity @Injectä½¿ç”¨<br>è¿˜æœ‰å°±æ˜¯dependenciesåªæ˜¯ä¾èµ–ä¸å¦ä¸€ä¸ªComponentï¼Œæ¯ä¸ªComponentéƒ½å¿…é¡»è¦æœ‰ä¸€ä¸ªä¸åŒçš„Modulesï¼ˆModulesä¸­çš„beanç±»ä¸èƒ½é‡å¤ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ³¨æ„è¿™é‡Œçš„æ³¨è§£ä¸ä¸Šé¢æ³¨è§£ä¸åŒï¼ˆå°½ç®¡æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†ä¹Ÿä¸èƒ½ä¸€æ ·ï¼‰</span><br><span class="line">@AppScope</span><br><span class="line">@Component(modules &#x3D; &#123;AppModule.class&#125;)</span><br><span class="line">public interface AppComponent &#123;</span><br><span class="line">&#x2F;&#x2F;è¿™é‡Œè¦é‡æ–°åˆ›å»ºä¸€ä¸ªSchoolç±»(è¿™é‡Œå†™çš„æ–¹æ³•è¦ä¸Moduleä¸­çš„ç±»ä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™)</span><br><span class="line">    School getSchool();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><p>æ–°å»º AppModule, æä¾›ä¸€ä¸ªæ–¹æ³• ç”¨AppScopeå’ŒProvidesæ ‡è®°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Module</span><br><span class="line">public class AppModule &#123;</span><br><span class="line">&#x2F;&#x2F;è¿™é‡Œçš„æ³¨è§£è¦ä¸Componentç›¸åŒ</span><br><span class="line">    @AppScope</span><br><span class="line">    @Provides</span><br><span class="line">    School provideSchool()&#123;   &#x2F;&#x2F;ä¹Ÿæ˜¯è¿”å›ä¸ä¸Šä¸€ä¸ªModuleä¸ä¸€æ ·çš„Beanç±»</span><br><span class="line">        return  new School();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­ç‚¹ç»¿é”¤å­ç¼–è¯‘ä¿®æ”¹Application</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªè‡ªèº«çš„å•ä¾‹ç±»</span><br><span class="line">public static Application app;</span><br><span class="line">&#x2F;&#x2F;åœ¨åˆ›å»ºä¸€ä¸ªComponentç±»</span><br><span class="line">AppComponent applicationComponent;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void onCreate() &#123;</span><br><span class="line">super.onCreate();</span><br><span class="line">&#x2F;&#x2F;è·å–è‡ªèº«çš„å®ä¾‹</span><br><span class="line">app &#x3D; this;</span><br><span class="line">&#x2F;&#x2F;åœ¨onCreateä¸­è¿›è¡Œè·å–Component</span><br><span class="line">    applicationComponent &#x3D; DaggerAppComponent</span><br><span class="line">            .builder()</span><br><span class="line">&#x2F;&#x2F;æ¯æ¬¡è°ƒç”¨ç³»ç»Ÿåˆ›å»ºçš„Componentç±»è¿›è¡Œç»‘å®šçš„æ—¶å€™éƒ½è¦ç»‘å®šå±äºè‡ªå·±çš„Moduleç±»</span><br><span class="line">            .appModule(new AppModule())</span><br><span class="line">            .build();</span><br><span class="line">&#x2F;&#x2F;å› ä¸ºè¿™ä¸ªComponentæ˜¯ç»™ä¸Šä¸€ä¸ªComponentï¼ˆMainComponentï¼‰è¿›è¡Œä¾èµ–çš„ï¼Œä¹Ÿå°±æ˜¯æ‰©å±•ï¼Œæ‰€ä»¥æ²¡æœ‰å†™ç»‘å®šçš„æ–¹æ³•&#125;</span><br><span class="line"></span><br><span class="line">public static Application getInstance()&#123;</span><br><span class="line">&#x2F;&#x2F;è¿”å›è‡ªèº«çš„å®åˆ—</span><br><span class="line">    return app;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿”å›ä¸€ä¸ªApplicationçš„å®ä¾‹å¯¹è±¡ã€‚å®šä¸€ä¸ªAppComponentï¼ˆè¿™ä¸ªæ˜¯å‡†å¤‡ç»™DaggerActivityComponentä¾èµ–çš„ï¼‰ä¹Ÿæ˜¯Daggerç”Ÿæˆçš„ä»£ç ã€‚é“¾å¼ç¼–ç¨‹è¿›è¡Œbuild<br>å¢åŠ ä¸€ä¸ªSchoolç±» å’ŒStudentç±»ä¸€æ · ç”¨@Injectä¿®é¥°æ„é€ å‡½æ•°ã€‚<br>ä¿®æ”¹MainActivityï¼Œå¢åŠ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Inject</span><br><span class="line">School school;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨onCreateåé¢å¢åŠ ï¼ˆä¸activityå’ŒFragmemtè¿›è¡Œç»‘å®šï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DaggerActivityComponent.builder()</span><br><span class="line">&#x2F;&#x2F;ç»‘å®šä¾èµ–Componentï¼ˆé€šè¿‡Applicationè·å–æ—©å°±åˆ›å»ºå¥½çš„Componentï¼‰</span><br><span class="line">.appComponent(Application.getInstance().applicationComponent)</span><br><span class="line">&#x2F;&#x2F;ç»‘å®šè‡ªèº«çš„Module</span><br><span class="line">    .activityModule(new ActivityModule())</span><br><span class="line">.build()</span><br><span class="line">&#x2F;&#x2F;ç»‘å®šActivity</span><br><span class="line">    .inject(this);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒè¡ŒDaggerActivityComponent ä¾èµ–äº Applicationçš„ AppComponent è¿™æ ·å°±è¿›è¡Œäº†å…³è”<br>åˆ°æ­¤ å…¨å±€å•ä¾‹ æå®šï¼Œæµ‹è¯•ä¸€ä¸‹ å†™ä¸¤ä¸ªActivity å£°æ˜ç›¸åŒçš„å¯¹è±¡å°±ä¼šå‘ç° ä¸¤ä¸ªå¯¹è±¡åœ°å€ ä¸€æ ·çš„ï¼ˆåˆ›å»ºçš„ç¬¬äºŒä¸ªactivity/Fragmentä¸­ä¹Ÿè¦è¿›è¡ŒComponentç»‘å®šï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tag: com.mydagger.bean.School@393c7e3</span><br><span class="line">tag: com.mydagger.bean.School@393c7e3</span><br></pre></td></tr></table></figure><ul><li>æ‰©å±•:<br>é€šå¸¸ä¼šé¡¹ç›®ä¸­ä½¿ç”¨MVP å¢åŠ ç½‘ç»œé…ç½®ç­‰ éœ€è¦å…¨å±€å•ä¾‹çš„å†…å®¹ï¼Œå¯ä»¥ç»§ç»­å»ºç±»ï¼ˆModuleï¼‰è¿›è¡Œæ‰©å±•,å¾—åˆ°å•ä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@AppScope</span><br><span class="line">@Component(modules &#x3D; &#123;AppModule.class,BModule.class....&#125;)</span><br><span class="line">public interface AppComponent &#123;</span><br><span class="line">    School getSchool();</span><br><span class="line">    &#x2F;&#x2F;è¿™é‡Œéœ€è¦ç»§ç»­æä¾›æ–¹æ³•ï¼Œç»™Activity è¿›è¡Œå¯¹è±¡çš„ @Inject    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">applicationComponent &#x3D; DaggerAppComponent</span><br><span class="line">        .builder()</span><br><span class="line">        .appModule(new AppModule())......</span><br><span class="line">        .build();</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Context </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CoordinatorLayoutçš„ä½¿ç”¨</title>
      <link href="2020/09/21/CoordinatorLayout%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>2020/09/21/CoordinatorLayout%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>å…³äºAndroidä¸­çš„CoordinatorLayoutçš„ä½¿ç”¨</p><a id="more"></a><h1 id="CoordinatorLayoutçš„ä½¿ç”¨"><a href="#CoordinatorLayoutçš„ä½¿ç”¨" class="headerlink" title="CoordinatorLayoutçš„ä½¿ç”¨"></a>CoordinatorLayoutçš„ä½¿ç”¨</h1><h4 id="æœ¬ç¯‡æ˜¯è®²è§£CoordinatorLayoutçš„ä½¿ç”¨ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥æ›¿ä»£NestedScrollViewï¼Œä½¿ç”¨CoordinatorLayoutæ¥è¾¾åˆ°NestedScrollViewåµŒå¥—æ»‘åŠ¨çš„æ•ˆæœ"><a href="#æœ¬ç¯‡æ˜¯è®²è§£CoordinatorLayoutçš„ä½¿ç”¨ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥æ›¿ä»£NestedScrollViewï¼Œä½¿ç”¨CoordinatorLayoutæ¥è¾¾åˆ°NestedScrollViewåµŒå¥—æ»‘åŠ¨çš„æ•ˆæœ" class="headerlink" title="æœ¬ç¯‡æ˜¯è®²è§£CoordinatorLayoutçš„ä½¿ç”¨ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥æ›¿ä»£NestedScrollViewï¼Œä½¿ç”¨CoordinatorLayoutæ¥è¾¾åˆ°NestedScrollViewåµŒå¥—æ»‘åŠ¨çš„æ•ˆæœ"></a>æœ¬ç¯‡æ˜¯è®²è§£CoordinatorLayoutçš„ä½¿ç”¨ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥æ›¿ä»£NestedScrollViewï¼Œä½¿ç”¨CoordinatorLayoutæ¥è¾¾åˆ°NestedScrollViewåµŒå¥—æ»‘åŠ¨çš„æ•ˆæœ</h4><h6 id="è®²è§£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨CoordinatorLayoutï¼š"><a href="#è®²è§£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨CoordinatorLayoutï¼š" class="headerlink" title="è®²è§£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨CoordinatorLayoutï¼š"></a>è®²è§£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨CoordinatorLayoutï¼š</h6><ul><li>NestedScrollViewè§’åº¦:<ol><li>é¦–å…ˆä¸€èˆ¬æƒ³è¦åµŒå¥—æ»‘åŠ¨çš„åœ°æ–¹éƒ½æ˜¯åµŒå¥—RecyclerViewæ¥è¿›è¡Œå±å¹•æ»‘åŠ¨ï¼Œä½†æ˜¯ä½¿ç”¨NestedScrollViewåµŒå¥—RecyclerViewä¼šé€ æˆå½“è¿›å…¥é¡µé¢çš„æ—¶å€™ï¼ŒRecyclerViewä¼šä¸€æ¬¡æ€§å…¨éƒ¨å±•å¼€ã€‚RecyclerViewä¼šå¤±å»å¤ç”¨æ€§ã€‚åœ¨ä¸€äº›RecyclerViewæ¡ç›®æ•°é‡ä¸å¤šçš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šé€ æˆå¤šå¤§çš„å°è±¡ï¼Œä½†å¤±å»å¤ç”¨æ€§ä¼šåˆ°æ—¶å€™RecyclerViewæ»‘å‡ºå±å¹•å¤–æ— æ³•è¢«å›æ”¶ï¼Œæ•°é‡ä¸€æ—¦è¿‡å¤šå°±ä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚</li></ol></li><li>CoordinatorLayoutè§’åº¦ï¼š<ol><li>ä½¿ç”¨CoordinatorLayoutåµŒå¥—RecyclerViewä¹Ÿå¯ä»¥è¾¾åˆ°è·Ÿéšå±å¹•ä¸€èµ·æ»‘åŠ¨çš„æ•ˆæœï¼Œå¹¶ä¸ä¼šé€ æˆä»€ä¹ˆæ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸ä¼šä¸¢å¤±ç‰¹æ€§ã€‚</li></ol></li></ul><h6 id="è®²è§£å¦‚ä½•ä½¿ç”¨CoordinatorLayoutåµŒå¥—RecyclerViewï¼š"><a href="#è®²è§£å¦‚ä½•ä½¿ç”¨CoordinatorLayoutåµŒå¥—RecyclerViewï¼š" class="headerlink" title="è®²è§£å¦‚ä½•ä½¿ç”¨CoordinatorLayoutåµŒå¥—RecyclerViewï¼š"></a>è®²è§£å¦‚ä½•ä½¿ç”¨CoordinatorLayoutåµŒå¥—RecyclerViewï¼š</h6><p>é¦–å…ˆCoordinatorLayoutæ˜¯è¦ä¸AppBarLayoutä¸€èµ·ä½¿ç”¨æ‰èƒ½åšå‡ºè®¸å¤šæ•ˆæœã€‚</p><ul><li><p>AppBarLayoutï¼š<br>  1.AppBarLayoutç”¨æ¥è§„åˆ’éœ€è¦è¦æ»‘å‡ºå±å¹•çš„æ§ä»¶ï¼Œè¢«AppBarLayoutåŒ…è£¹çš„æ§ä»¶éœ€è¦æ·»åŠ ï¼ˆlayout_scrollFlags=â€scrollâ€ï¼‰çš„å±æ€§</p><blockquote><p>layout_scrollFlags=â€scrollâ€ï¼šå½“å®ƒæ»šåŠ¨çš„æ—¶å€™ï¼ŒAppBarLayoutä¼šå›è°ƒè§¦å‘å†…éƒ¨è®¾ç½®äº†layout_scrollFlags=â€â€çš„æ§ä»¶çš„æ»šåŠ¨è¡Œä¸ºã€‚<br>scrollï¼šè·Ÿéšå±å¹•ä¸€èµ·æ»‘åŠ¨<br>enterAlwaysï¼šä½¿ç”¨enterAlwaysï¼Œå¿…é¡»è¦å¸¦ä¸Šscroll,å¦åˆ™æ²¡æœ‰æ•ˆæœï¼ŒåŒæ ·ä½¿ç”¨åé¢å“ªä¸€ä¸ªéƒ½è¦æœ‰scroll;ä½¿ç”¨è¦ä¸¤ä¸ªä¸€å—ä½¿ç”¨,enterAlwayså†³å®šå‘ä¸‹æ»šåŠ¨æ—¶Scrolling Viewå’ŒChild Viewä¹‹é—´çš„æ»šåŠ¨ä¼˜å…ˆçº§é—®é¢˜ã€‚<br>enterAlwaysCollapsedï¼šè¿™é‡Œæ¶‰åŠåˆ°Child Viewçš„é«˜åº¦å’Œæœ€å°é«˜åº¦ï¼Œå‘ä¸‹æ»šåŠ¨æ—¶ï¼Œ<br>Child Viewå…ˆå‘ä¸‹æ»šåŠ¨æœ€å°é«˜åº¦å€¼ï¼Œç„¶åScrolling Viewå¼€å§‹æ»šåŠ¨ï¼Œåˆ°è¾¾è¾¹ç•Œæ—¶ï¼ŒChild Viewå†å‘ä¸‹æ»šåŠ¨ï¼Œç›´è‡³æ˜¾ç¤ºå®Œå…¨ã€‚</p></blockquote></li><li><p>ä»£ç ä½¿ç”¨ï¼š</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;com.google.android.material.appbar.AppBarLayout</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;appbar&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">            app:elevation&#x3D;&quot;0dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;com.youth.banner.Banner</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;Re_banner&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;200dp&quot;</span><br><span class="line">                android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                android:layout_marginTop&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                android:layout_marginRight&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                app:banner_indicator_gravity&#x3D;&quot;right&quot;</span><br><span class="line">                app:banner_indicator_marginBottom&#x3D;&quot;@dimen&#x2F;dp_7&quot;</span><br><span class="line">                app:banner_indicator_marginRight&#x3D;&quot;@dimen&#x2F;dp_15&quot;</span><br><span class="line">                app:banner_indicator_normal_color&#x3D;&quot;@color&#x2F;White&quot;</span><br><span class="line">                app:banner_indicator_selected_color&#x3D;&quot;@color&#x2F;Pink&quot;</span><br><span class="line">                app:layout_scrollFlags&#x3D;&quot;scroll&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;&#x2F;com.google.android.material.appbar.AppBarLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;androidx.recyclerview.widget.RecyclerView</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;Re_recy&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">            android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_5&quot;</span><br><span class="line">            android:layout_marginTop&#x3D;&quot;@dimen&#x2F;dp_5&quot;</span><br><span class="line">            android:layout_marginRight&#x3D;&quot;@dimen&#x2F;dp_5&quot;</span><br><span class="line">            app:layout_behavior&#x3D;&quot;@string&#x2F;appbar_scrolling_view_behavior&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span><br></pre></td></tr></table></figure><p> è¿™é‡Œå°±æ˜¯æ˜¯å“ŸCoordinatorLayouåµŒå¥—RecyclerViewï¼Œå°†å¤´éƒ¨çš„Bannerè®¾ç½®layout_scrollFlags=â€scrollâ€ï¼Œå®ƒå°†ä¼šè·Ÿéšå±å¹•ä¸€èµ·æ»‘åŠ¨ï¼Œæ»‘å‡ºå±å¹•å¤–ï¼Œè€ŒRecyclerViewè®¾ç½®çš„layout_behavior=â€@string/appbar_scrolling_view_behaviorâ€å°†ä¼šæŠŠViewè®¾ç½®åœ¨AppBarLayoutçš„ä¸‹æ–¹ï¼Œå¹¶ä¸”ä¸ä¼šéšç€å±å¹•çš„æ»‘åŠ¨è€Œæ»‘å‡ºå±å¹•ä¹‹å¤–ã€‚</p></li></ul><h6 id="CoordinatorLayouå¸é™„æ•ˆæœï¼š"><a href="#CoordinatorLayouå¸é™„æ•ˆæœï¼š" class="headerlink" title="CoordinatorLayouå¸é™„æ•ˆæœï¼š"></a>CoordinatorLayouå¸é™„æ•ˆæœï¼š</h6><ul><li><p>CollapsingToolbarLayout</p><ol><li><p>å¸é™„æ•ˆæœæ˜¯éœ€è¦CoordinatorLayoutä¸CollapsingToolbarLayoutä¸€åŒä½¿ç”¨ï¼Œå¹¶ä¸”CollapsingToolbarLayoutè®¾ç½®layout_scrollFlags=â€scroll|snapâ€ï¼Œä»£è¡¨è¢«CollapsingToolbarLayoutåŒ…è£¹çš„å†…å®¹æ˜¯éœ€è¦å¸é™„åˆ°å±å¹•é¡¶éƒ¨çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;TV_nestSc&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:background&#x3D;&quot;#FFFFFF&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;com.google.android.material.appbar.AppBarLayout</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;appbar&quot;</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">            app:elevation&#x3D;&quot;0dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;com.google.android.material.appbar.CollapsingToolbarLayout</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;coll_layout&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                android:fitsSystemWindows&#x3D;&quot;true&quot;</span><br><span class="line">                app:layout_scrollFlags&#x3D;&quot;scroll|snap&quot;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;RelativeLayout</span><br><span class="line">                    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                    android:layout_height&#x3D;&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;LinearLayout</span><br><span class="line">                        android:id&#x3D;&quot;@+id&#x2F;Sy_text&quot;</span><br><span class="line">                        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                        android:layout_height&#x3D;&quot;@dimen&#x2F;dp_35&quot;</span><br><span class="line">                        android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_15&quot;</span><br><span class="line">                        android:layout_marginTop&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                        android:layout_marginRight&#x3D;&quot;@dimen&#x2F;dp_15&quot;</span><br><span class="line">                        android:layout_weight&#x3D;&quot;1&quot;</span><br><span class="line">                        android:background&#x3D;&quot;@drawable&#x2F;file_background_radius_30_while_gray&quot;</span><br><span class="line">                        android:gravity&#x3D;&quot;center_vertical&quot;</span><br><span class="line">                        android:orientation&#x3D;&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;ImageView</span><br><span class="line">                            android:layout_width&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                            android:layout_height&#x3D;&quot;@dimen&#x2F;dp_24&quot;</span><br><span class="line">                            android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_15&quot;</span><br><span class="line">                            android:src&#x3D;&quot;@drawable&#x2F;search_24_while&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;TextView</span><br><span class="line">                            android:layout_width&#x3D;&quot;0dp&quot;</span><br><span class="line">                            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">                            android:layout_marginLeft&#x3D;&quot;@dimen&#x2F;dp_5&quot;</span><br><span class="line">                            android:layout_weight&#x3D;&quot;1&quot;</span><br><span class="line">                            android:text&#x3D;&quot;æŸ¥æ‰¾ç²¾å½©åŠ¨æ€å†…å®¹&quot;</span><br><span class="line">                            android:textColor&#x3D;&quot;#c1bfc0&quot;</span><br><span class="line">                            android:textSize&#x3D;&quot;16sp&quot; &#x2F;&gt;</span><br><span class="line">                    &lt;&#x2F;LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;TextView</span><br><span class="line">                        android:id&#x3D;&quot;@+id&#x2F;xian_2&quot;</span><br><span class="line">                        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                        android:layout_height&#x3D;&quot;@dimen&#x2F;dp_1&quot;</span><br><span class="line">                        android:layout_below&#x3D;&quot;@+id&#x2F;Sy_text&quot;</span><br><span class="line">                        android:layout_marginTop&#x3D;&quot;@dimen&#x2F;dp_10&quot;</span><br><span class="line">                        android:background&#x3D;&quot;#e7e7e7&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">                &lt;&#x2F;RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">            &lt;&#x2F;com.google.android.material.appbar.CollapsingToolbarLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;&#x2F;com.google.android.material.appbar.AppBarLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">            android:animateLayoutChanges&#x3D;&quot;true&quot;</span><br><span class="line">            android:orientation&#x3D;&quot;vertical&quot;</span><br><span class="line">            app:layout_behavior&#x3D;&quot;@string&#x2F;appbar_scrolling_view_behavior&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;androidx.recyclerview.widget.RecyclerView</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;Recy_dynamic&quot;</span><br><span class="line">                android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">                android:background&#x3D;&quot;#f4f4f4&quot; &#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span><br></pre></td></tr></table></figure><p>å¸é™„æ•ˆæœå°±æ˜¯åœ¨æ»‘åŠ¨å±å¹•çš„æ—¶å€™ï¼Œè¢«CollapsingToolbarLayoutåŒ…è£¹çš„å†…å®¹åœ¨æ¥è¿‘å±å¹•é¡¶ç«¯çš„æ—¶å€™ä¼šæœ‰ä¸ªå¸é™„æ•ˆæœï¼Œä¹‹åå°±ä¼šä¸€ç›´å¸åœ¨å±å¹•é¡¶ç«¯ï¼Œé™¤éä¸‹æ»‘è„±ç¦»ã€‚</p></li></ol></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> View </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MVP è®¾è®¡æ¨¡å¼</title>
      <link href="2020/09/18/MVP-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>2020/09/18/MVP-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>è®²è§£è®¾è®¡æ¨¡å¼</p><a id="more"></a><h3 id="MVP-è®¾è®¡æ¨¡å¼"><a href="#MVP-è®¾è®¡æ¨¡å¼" class="headerlink" title="MVP è®¾è®¡æ¨¡å¼"></a>MVP è®¾è®¡æ¨¡å¼</h3><h5 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h5><p>MVPæ˜¯æœ‰MVCæ¼”å˜è€Œæ¥çš„ï¼Œå› ä¸ºåœ¨Androidä¸­ç”¨MVCæ¥å†™çš„æ—¶å€™ï¼ŒActivityåˆ°åº•æ˜¯Viewå±‚è¿˜æ˜¯Controllerå±‚çœŸçš„æ˜¯å‚»å‚»åˆ†ä¸å»æ¸…æ¥šï¼Œæ‰€ä»¥åŸºæœ¬å®ƒå°±æŠŠè¿™ä¸¤å±‚çš„æ´»éƒ½è‡ªå·±ä¸€ä¸ªäººå¹²äº†ï¼Œè¿™æ ·ä¸€æ¥Activityä¸Šçš„ä»£ç é‡ä¼šéå¸¸å¤§ï¼ŒControllerå±‚å’ŒViewå±‚æ²¡æœ‰å®ç°è§£è€¦åˆ†ç¦»å¼€æ¥ï¼Œå¦‚æœåé¢è¿™ä¸¤å±‚ä»£ç å…¶ä¸­ä¸€å±‚å‡ºäº†é—®é¢˜ä½ å°±å¯èƒ½ä¸¤å±‚éƒ½çš„ä¿®æ”¹ï¼Œä»£ç æ˜¯æ²¡ä»€ä¹ˆé‡ç”¨æ€§å¯è¨€çš„ã€‚è€ŒMVPçš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜çš„ï¼ŒMVPæ¨¡å¼å°†Controllerçš„å·¥ä½œæŠ½å–å‡ºæ¥äº¤ç»™Presenterå±‚ï¼ŒPresenterå±‚è´Ÿè´£æ§åˆ¶å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä½œä¸ºä¸­é—´å±‚å»ºç«‹èµ·Modelå±‚å’ŒViewå±‚çš„è”ç³»ï¼Œä»è€Œå®ç°ä¸‰å±‚äº¤äº’ã€‚è¿™ä¹ˆè¯´ç¡®å®æŒºéš¾è®©äººç†è§£çš„ï¼Œä¸‹é¢å°±é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä¾‹å­ä¸­å¤¹æ‚ç€è§£é‡Šè®©æˆ‘ä»¬æŒæ¡MVPçš„ç”¨æ³•å§ã€‚</p><h5 id="å±æ€§ï¼šï¼ˆæˆ‘å°±æ‹¿ç™»å½•æ¥å½“ä½œä¾‹å­ï¼‰"><a href="#å±æ€§ï¼šï¼ˆæˆ‘å°±æ‹¿ç™»å½•æ¥å½“ä½œä¾‹å­ï¼‰" class="headerlink" title="å±æ€§ï¼šï¼ˆæˆ‘å°±æ‹¿ç™»å½•æ¥å½“ä½œä¾‹å­ï¼‰"></a>å±æ€§ï¼šï¼ˆæˆ‘å°±æ‹¿ç™»å½•æ¥å½“ä½œä¾‹å­ï¼‰</h5><ul><li>Modelå±‚ï¼šåˆ›å»ºç”¨äºä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„å®ä½“ç±»Userï¼ˆå°±æ˜¯userbeanï¼‰ç™»å½•çš„æ—¶å€™ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå»ºè®®ä¹Ÿä¿å­˜åˆ°æœ¬åœ°ä¸€ä»½</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class User &#123;</span><br><span class="line">    private String username;  &#x2F;&#x2F;ç”¨æˆ·çš„è´¦å·</span><br><span class="line">    private String password;  &#x2F;&#x2F;ç”¨æˆ·çš„å¯†ç </span><br><span class="line"></span><br><span class="line">    public String getUsername() &#123;</span><br><span class="line">        return username;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setUsername(String username) &#123;</span><br><span class="line">        this.username &#x3D; username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPassword() &#123;</span><br><span class="line">        return password;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setPassword(String password) &#123;</span><br><span class="line">        this.password &#x3D; password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>ç»“æœå›è°ƒæ¥å£ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œç”¨æ¥é€šçŸ¥ç™»å½•æ˜¯å¦æˆåŠŸï¼ˆæˆåŠŸçš„è¯ï¼Œå°±å¯ä»¥æŠŠè·å–åˆ°çš„userbeanä¼ é€’ä¸‹å»ï¼‰æˆ–è€… å¤±è´¥</li><li>ä»£ç å±•ç¤ºï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    public interface OnLoginListener &#123;</span><br><span class="line">    &#x2F;&#x2F;ç™»å½•æˆåŠŸçš„å›è°ƒ</span><br><span class="line">    void loginSuccess(User user);  &#x2F;&#x2F;ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·ä¿¡æ¯ä¼ é€’è¿›å»</span><br><span class="line">    &#x2F;&#x2F;ç™»å½•å¤±è´¥çš„å›è°ƒ</span><br><span class="line">    void loginFailed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>å®šä¹‰ä¸šåŠ¡æ¥å£:</p><ol><li>è¿™é‡ŒæŠ½å‡ºä¸€ä¸ªæ¥å£çš„ç›®çš„æ˜¯ä¸ºäº†é™ä½ä¸€å±‚è€¦åˆå’Œä¾¿äºå¤ç”¨ã€‚æ¯”å¦‚åŒä¸€ä¸ªç½‘ç»œè¯·æ±‚ä¸šåŠ¡ä½ å¯ä»¥æœ‰OkHttpçš„å®ç°ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æœ‰Retrofitçš„å®ç°ï¼Œè¿™æ ·ä¸€æ¥å°±å¯ä»¥æ–¹ä¾¿çš„åšåˆ°ç½‘ç»œæ¡†æ¶çš„æ›¿æ¢ï¼Œå½“ç„¶ä½ è¿˜å¯ä»¥æœ‰ä¸åŒå†…å®¹çš„å®ç°ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†ç™»å½•çš„è¿™ä¸ªåŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œæˆä¸ºä¸€ä¸ªæ¥å£ï¼Œæ–¹ä¾¿å¤ç”¨ã€‚</li><li>ä»£ç å±•ç¤ºï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    public interface UserLogin&#123;</span><br><span class="line">    &#x2F;&#x2F;ç™»å½•æ–¹æ³•</span><br><span class="line">public void login(String username, String password, OnLoginListener loginListener);</span><br><span class="line">&#x2F;&#x2F;è¿™é‡Œå°±ä¼ å…¥ç”¨æˆ·è¾“å…¥çš„è´¦å·ï¼Œå¯†ç ï¼Œåœ¨ä¼ å…¥ä¸€ä¸ªç™»å½•çŠ¶å†µåˆ¤æ–­çš„æ¥å£</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>å…·ä½“Modelçš„å®ç°ç±»:<br><br>åˆ›å»ºä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œæ¥å®ç°UserLoginçš„æ¥å£ï¼Œæ¥å®ç°é‡Œé¢çš„æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class UserGo implements UserLogin &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void login(final String username, final String password, final OnLoginListener loginListener) &#123;</span><br><span class="line">        &#x2F;&#x2F;æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚è€—æ—¶æ“ä½œ</span><br><span class="line">        new Thread() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                &#x2F;&#x2F;æ¨¡æ‹Ÿäº†è€—æ—¶                </span><br><span class="line">                try &#123;</span><br><span class="line">                    Thread.sleep(2000);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F;æ¨¡æ‹Ÿç™»å½•æˆåŠŸ</span><br><span class="line">                if (&quot;luoqiang&quot;.equals(username) &amp;&amp; &quot;108&quot;.equals(password)) &#123;</span><br><span class="line">                    User user &#x3D; new User();</span><br><span class="line">                    user.setUsername(username);</span><br><span class="line">                    user.setPassword(password);</span><br><span class="line">                    loginListener.loginSuccess(user);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    loginListener.loginFailed();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Viewå±‚:</p><ol><li><p>Viewå±‚ä¸å…³å¿ƒæ•°æ®ï¼Œä¸å…³å¿ƒé€»è¾‘å¤„ç†ï¼åªå…³å¿ƒå’Œç”¨æˆ·çš„äº¤äº’ï¼Œé‚£ä¹ˆè¿™ä¸ªç™»å½•ç•Œé¢åº”è¯¥æœ‰çš„æ“ä½œå°±æ˜¯ï¼šä»è¾“å…¥æ¡†è·å–ç”¨æˆ·åï¼Œè·å–å¯†ç ï¼Œæ¸…é™¤ç”¨æˆ·åï¼Œæ¸…é™¤å¯†ç ï¼Œç™»å½•ç½‘ç»œè¯·æ±‚æ—¶æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œéšè—è¿›åº¦æ¡ï¼Œç™»å½•æˆåŠŸè·³è½¬åˆ°å¯¹åº”ç•Œé¢ï¼Œç™»å½•å¤±è´¥æç¤ºã€‚æ¥ä¸‹æ¥å®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><blockquote><p>è¿™é‡Œå¹¶æ²¡æœ‰å°†activityæ¥ç›´æ¥å½“ä½œViewå±‚ï¼ŒåŸå› ä¹Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿å¤ç”¨ï¼Œé‚£ä¸ªFragment/Activityéœ€è¦ç”¨åˆ°ç™»å½•ï¼Œå°±å®ç°è¿™ä¸ªæ¥å£å°±è¡Œäº†ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    public interface UserLoginView &#123;</span><br><span class="line">        String getUserName();</span><br><span class="line">        &#x2F;&#x2F;è·å–ç”¨æˆ·è¾“å…¥çš„è´¦å·</span><br><span class="line">        String getPassword();</span><br><span class="line">        &#x2F;&#x2F;è·å–ç”¨æˆ·è¾“å…¥çš„å¯†ç </span><br><span class="line">        void clearUserName();</span><br><span class="line">        &#x2F;&#x2F;æ¸…é™¤ç”¨æˆ·è¾“å…¥çš„è´¦å·</span><br><span class="line">        void clearPassword();</span><br><span class="line">        &#x2F;&#x2F;æ¸…é™¤ç”¨æˆ·è¾“å…¥çš„å¯†ç </span><br><span class="line">        void showLoading();</span><br><span class="line">        &#x2F;&#x2F;æ˜¾ç¤ºåŠ è½½ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘éƒ½ä¼šåœ¨BaseActivity&#x2F;BaseFragmentä¸­å®ç°Loadingçš„æ˜¾ç¤ºå’Œéšè—ï¼Œè¿™é‡Œå°±æ²¡å¿…è¦åœ¨å†™ï¼‰</span><br><span class="line">        void hideLoading();</span><br><span class="line">        &#x2F;&#x2F;éšè—åŠ è½½</span><br><span class="line">        void toMainActivity(User user);</span><br><span class="line">        &#x2F;&#x2F;è·³è½¬åˆ°ä¸»é¡µï¼Œé¡ºä¾¿ä¼ é€’ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">        void showFaileTips();</span><br><span class="line">        &#x2F;&#x2F;ç™»å½•å¤±è´¥çš„æç¤º</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å…·ä½“çš„ç”¨æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">    public class UserLoginActivity extends AppCompatActivity implements UserLoginView &#123;</span><br><span class="line">    private EditText mEtUsername, mEtPassword;</span><br><span class="line">    private Button mBtnLogin, mBtnClear;</span><br><span class="line">    private ProgressBar mPbLoading;</span><br><span class="line">    private UserLoginPresenter mUserLoginPresenter;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">&#x2F;&#x2F;å…³äºPresenterå±‚ï¼Œéƒ½å¯ä»¥å†™åœ¨BaseActivtiy&#x2F;BaseFragmentä¸­ï¼Œæ²¡å¿…è¦å†™åœ¨Activityä¸­</span><br><span class="line">        mUserLoginPresenter &#x3D; new UserLoginPresenter(this);</span><br><span class="line">        &#x2F;&#x2F;è·å–Presenterå±‚</span><br><span class="line">        initViews();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initViews() &#123;</span><br><span class="line">        mEtUsername &#x3D; findViewById(R.id.et_username);</span><br><span class="line">        mEtPassword &#x3D; findViewById(R.id.et_password);</span><br><span class="line">        mBtnClear &#x3D; findViewById(R.id.btn_clear);</span><br><span class="line">        mBtnLogin &#x3D; findViewById(R.id.btn_login);</span><br><span class="line">        mPbLoading &#x3D; findViewById(R.id.pb_loading);</span><br><span class="line">        mBtnLogin.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                mUserLoginPresenter.login();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mBtnClear.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                mUserLoginPresenter.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getUserName() &#123;</span><br><span class="line">        return mEtUsername.getText().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getPassword() &#123;</span><br><span class="line">        return mEtPassword.getText().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void clearUserName() &#123;</span><br><span class="line">        mEtUsername.setText(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void clearPassword() &#123;</span><br><span class="line">        mEtPassword.setText(&quot;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void showLoading() &#123;</span><br><span class="line">        mPbLoading.setVisibility(View.VISIBLE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void hideLoading() &#123;</span><br><span class="line">        mPbLoading.setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void toMainActivity(User user) &#123;</span><br><span class="line">        Toast.makeText(this, &quot;è·³è½¬åˆ°ç™»å½•æˆåŠŸé¡µé¢&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void showFaileTips() &#123;</span><br><span class="line">        Toast.makeText(this, &quot;ç™»å½•å¤±è´¥&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">        super.onDestroy();</span><br><span class="line">        &#x2F;&#x2F;ä¸ºäº†é˜²æ­¢å†…å­˜æ³„æ¼ï¼Œè§£ç»‘Presenterå±‚å¯¹Viewå±‚çš„å¼•ç”¨ï¼Œè¿™é‡Œçš„å°†Presenterå±‚ç½®ä¸ºç©ºå¯ä»¥åœ¨BaseActivity&#x2F;BaseFragmentä¸­è¿›è¡Œæ“ä½œ</span><br><span class="line">        mUserLoginPresenter.detachView();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li><li><p>Presenterå±‚:</p><ol><li>Presenterçš„ä½œç”¨å°±æ˜¯ä»Viewå±‚è·å–ç”¨æˆ·çš„è¾“å…¥ï¼Œä¼ é€’åˆ°Modelå±‚è¿›è¡Œå¤„ç†ï¼Œç„¶åå›è°ƒç»™Viewå±‚ï¼Œè¾“å‡ºç»™ç”¨æˆ·ï¼</li><li>Presenterä¸€èˆ¬æ¥è¯´ï¼Œå°±æ˜¯å°†Viewå’ŒModeé›†åˆåœ¨ä¸€èµ·ï¼Œè¿›è¡Œæ“ä½œ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">    public class UserLoginPresenter &#123;</span><br><span class="line">    private UserGo userGo;</span><br><span class="line">    private UserLoginView userLoginView;</span><br><span class="line">    private Handler mHandler &#x3D; new Handler();</span><br><span class="line">    &#x2F;&#x2F;å¯¹åº”è§†å›¾é¡µé¢é”€æ¯çš„æ ‡å¿—ä½,å½“è§†å›¾é”€æ¯åå›è°ƒå°±ä¸éœ€è¦å¤„ç†äº†</span><br><span class="line">    private boolean destroyFlag;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;Presenterå¿…é¡»è¦èƒ½æ‹¿åˆ°Viewå’ŒModelçš„å®ç°ç±»</span><br><span class="line">    public UserLoginPresenter(IUserLoginView userLoginView) &#123;</span><br><span class="line">        this.userLoginView &#x3D; userLoginView;</span><br><span class="line">        this. userGo &#x3D; new UserGo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void login() &#123;</span><br><span class="line">        userLoginView.showLoading();</span><br><span class="line">        userGo.login(userLoginView.getUserName(), userLoginView.getPassword(), new OnLoginListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void loginSuccess(final User user) &#123;</span><br><span class="line">                if (!destroyFlag) &#123; &#x2F;&#x2F;Viewå±‚é”€æ¯åä¸éœ€è¦å¤„ç†çš„åˆ¤æ–­</span><br><span class="line">                    &#x2F;&#x2F;éœ€è¦åœ¨UIçº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">                    mHandler.post(new Runnable() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void run() &#123;</span><br><span class="line">                            userLoginView.toMainActivity(user);</span><br><span class="line">                            userLoginView.hideLoading();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void loginFailed() &#123;</span><br><span class="line">                if (!destroyFlag) &#123; &#x2F;&#x2F;Viewå±‚é”€æ¯åä¸éœ€è¦å¤„ç†çš„åˆ¤æ–­</span><br><span class="line">                    &#x2F;&#x2F;éœ€è¦åœ¨UIçº¿ç¨‹æ‰§è¡Œ</span><br><span class="line">                    mHandler.post(new Runnable() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void run() &#123;</span><br><span class="line">                            userLoginView.showFaileTips();</span><br><span class="line">                            userLoginView.hideLoading();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void clear() &#123;</span><br><span class="line">        userLoginView.clearUserName();</span><br><span class="line">        userLoginView.clearPassword();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;è§£ç»‘è§†å›¾</span><br><span class="line">    public void detachView() &#123;</span><br><span class="line">        destroyFlag &#x3D; true;</span><br><span class="line">        this.userLoginView &#x3D; null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> MVP </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
