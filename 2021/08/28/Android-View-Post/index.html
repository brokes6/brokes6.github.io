<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  
  
  
  <meta name="description" content="å­¦ä¹ æ–°æŠ€æœ¯, æ€»ç»“çŸ¥è¯†, åˆ†äº«å–œé—»ä¹è§ä¹‹äº‹">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    Android-View.Post |
    
    Fuxinboåšå®¢</title>
  
  <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Fuxinboåšå®¢" type="application/atom+xml">
</head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-Android-View-Post" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h1 class="article-title" itemprop="name">
  Android-View.Post
</h1>



    </header>
    

    
    <div class="article-meta">
      <a href="/2021/08/28/Android-View-Post/" class="article-date">
  <time datetime="2021-08-28T15:58:00.000Z" itemprop="datePublished">2021-08-28</time>
</a>
      
    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
      
      <p>æœ¬ç¯‡å°†ä»‹ç»Androidä¸­çš„åç¨‹</p>
<a id="more"></a>
<h1 id="View-Post"><a href="#View-Post" class="headerlink" title="View.Post"></a>View.Post</h1><blockquote>
<p>Androidæºç å‰–æ</p>
</blockquote>
<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.post&#123;</span><br><span class="line">    notifyAnimState(listener,ANIM_STATE_END)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ˜¯ä¸èƒ½è¿›è¡ŒUIæ“ä½œçš„ï¼Œé‚£ä¹ˆæƒ³è¦åœ¨å­çº¿ç¨‹ä¸­è¿›è¡ŒUIæ“ä½œï¼Œæˆ–è€…åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¸€äº›æ“ä½œæƒ³è¦å»¶è¿Ÿå¤„ç†ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ã€‚ç­”æ¡ˆå°±æ˜¯éƒ½å¯ä»¥ä½¿ç”¨Handleræ¥è§£å†³ï¼Œä½†æ˜¯è¯´å®è¯å†™Handlerè¿˜æ˜¯æœ‰ç‚¹éº»çƒ¦ï¼Œè¿˜å¾—æ³¨æ„å†…å­˜æ³„æ¼é—®é¢˜ã€‚æ‰€ä»¥å°±å¯ä»¥ä½¿ç”¨<code>View.post()</code>æˆ–è€…<code>View.postDelay()</code>æ¥æ›¿ä»£Handler</p>
<p>ä½†æ˜¯ç”¨å½’ç”¨ï¼Œéš¾é“å°±ä¸å¥½å¥‡<code>View.post</code>ä¸ºä»€ä¹ˆå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­æ“ä½œUIï¼Œä¸ºä»€ä¹ˆå¯ä»¥è§£å†³åœ¨<code>Activity</code>çš„<code>OnCreate()</code>é‡Œè°ƒç”¨<code>View.post()</code>æ¥è§£å†³è·å–Viewé«˜å®½ä¸º0çš„é—®é¢˜ã€‚æ‰€ä»¥æ¥ä¸‹æ¥å°†é€šè¿‡æŸ¥çœ‹æºç æ¥è§£ç­”ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜</p>
<h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><h4 id="View"><a href="#View" class="headerlink" title="View#"></a>View#</h4><blockquote>
<p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewä¸­</p>
</blockquote>
<h5 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> AttachInfo attachInfo = mAttachInfo;</span><br><span class="line">    <span class="keyword">if</span> (attachInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> attachInfo.mHandler.post(action);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Postpone the runnable until we know on which thread it needs to run.</span></span><br><span class="line">    <span class="comment">// Assume that the runnable will be successfully placed after attach.</span></span><br><span class="line">    getRunQueue().post(action);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä¸æ˜¯å¥½å¥‡ä¸ºä»€ä¹ˆ<code>View.post()</code>å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­æ“ä½œUIå—ï¼Œå…¶å®è·Ÿæˆ‘ä»¬æƒ³çš„å·®ä¸å¤šï¼Œ<code>post</code>å†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨<code>Handler</code>æ¥å®ç°çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ç»§ç»­çœ‹çœ‹Androidæ˜¯æ€ä¹ˆå°è£…çš„</p>
<p>posté‡Œçš„ä»£ç è¿˜æ˜¯è›®å°‘çš„ï¼Œæˆ‘ä»¬æ…¢æ…¢æ¥åˆ†æï¼š</p>
<ol>
<li><p>é¦–å…ˆå°†æˆå‘˜å˜é‡<code>mAttachInfo</code>èµ‹å€¼ç»™<code>attachInfo</code>ï¼Œå†åˆ¤æ–­<code>attachInfo</code>æ˜¯å¦ä¸ºç©º(ä¹Ÿå°±æ˜¯åˆ¤æ–­<code>mAttachInfo</code>æ˜¯å¦ä¸ºç©º)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> AttachInfo attachInfo = mAttachInfo;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœ<code>attachInfo</code>ä¸ä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨<code>Handler.post()</code>å°†<code>Runnable</code>ä¼ è¿›å»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">  	...</span><br><span class="line">      <span class="keyword">if</span> (attachInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> attachInfo.mHandler.post(action);</span><br><span class="line">      &#125;</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<p><code>Runnable</code>å°±æ˜¯ä¸ªæ¥å£ï¼Œå®ç°äº†<code>Runnable</code>æ¥å£çš„ç±»ï¼Œç§°ä¸º <strong>çº¿ç¨‹è¾…åŠ©ç±»</strong>ï¼›<code>Thread</code>ç±»æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹ç±»ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆè¿˜æ˜¯æƒ³è¦é€šè¿‡<code>Thread</code>æ¥åˆ›å»ºçº¿ç¨‹å¹¶æŠŠ<strong>çº¿ç¨‹è¾…åŠ©ç±»</strong>ä¼ å…¥è¿›å»</p>
</blockquote>
<ol start="3">
<li><p>å¦‚æœ<code>attachInfo</code>ä¸ºç©ºçš„è¯ï¼Œåˆ™æ‰§è¡Œä»é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªå€¼æ¥æ‰§è¡Œ<code>Post</code>ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡è¿™ä¸ªé˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸ªä»€ä¹ˆé˜Ÿåˆ—ï¼Œå…ˆç»§ç»­å¾€ä¸‹çœ‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">      getRunQueue().post(action);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€ç»ˆè¿”å›Trueï¼Œè¡¨ç¤ºæ‰§è¡Œå®Œæˆ</p>
</li>
</ol>
<p><code>View.post()</code>é‡Œçš„ä»£ç å·²ç»çœ‹å®Œäº†ï¼Œä½†æ˜¯åˆå¤šå‡ºäº†å‡ ä¸ªæ–°é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯<code>mAttachInfo</code>åˆ°åº•æ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼Œéœ€è¦ä»€ä¹ˆæ¡ä»¶ã€‚<code>getRunQueue</code>åˆæ˜¯å•¥ï¼Œé‚£ä¹ˆä¹Ÿå°±åªèƒ½ç»§ç»­å¾€ä¸‹æ·±å…¥äº†</p>
<h5 id="mAttachInfo"><a href="#mAttachInfo" class="headerlink" title="mAttachInfo"></a>mAttachInfo</h5><p>æˆ‘ä»¬ç›´æ¥åœ¨<code>Android Studio</code>ä½¿ç”¨<code>Ctrl + F</code>æ¥è¿›è¡ŒæŸ¥æ‰¾ï¼Œåœ¨æœç´¢çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ç‚¹å°æŠ€å·§ï¼Œæœç´¢<code>mAttachInfo =</code> (ç­‰å·å‰åéƒ½æœ‰ç©ºæ ¼)ã€‚è¿™æ ·å°±å¯ä»¥ç›´æ¥æŸ¥åˆ°ä¸¤å¤„èµ‹å€¼æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchAttachedToWindow</span><span class="params">(AttachInfo info, <span class="keyword">int</span> visibility)</span> </span>&#123;</span><br><span class="line">        mAttachInfo = info;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">     mAttachInfo = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤å¤„åˆ†åˆ«å¯¹åº”äº†èµ‹å€¼å’Œç½®ç©ºï¼Œåˆšå¥½æ˜¯åœ¨å¯¹åº”çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå†…ã€‚æ¥ä¸‹æ¥å°±ç»§ç»­äº†è§£<code>dispatchAttachedToWindow</code>å’Œ<code>dispatchDetachedFromWindow</code>åˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™åœ¨å“ªé‡Œè¢«è°ƒç”¨äº†</p>
<p>å¥½å§ğŸ˜›ï¼Œå…¶å®å¯ä»¥å…ˆä¸ç”¨ç®¡å®ƒä»¬ä¸¤ä¸ªåœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨äº†ï¼Œè‡³å°‘åœ¨ç°åœ¨çœ‹æ¥ï¼Œåœ¨<code>Activity.onCreate()</code>çš„æ—¶å€™<code>dispatchAttachedToWindow</code>è¿˜æ˜¯æ²¡æœ‰è¢«è°ƒç”¨çš„ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨<code>onCreate()</code>é‡Œæ‰§è¡Œ<strong>View.post</strong>é‡Œçš„æ“ä½œä»ç„¶å¯ä»¥ä¿è¯æ˜¯åœ¨<code>View</code>çš„é«˜å®½è®¡ç®—å®Œæ¯•çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿé‚£ä¹ˆåŸå› åªå¯èƒ½åœ¨å¦ä¸€ä¸ª<code>return</code>é‡Œäº†<code>getRunQueue.post</code></p>
<h5 id="getRunQueue"><a href="#getRunQueue" class="headerlink" title="getRunQueue"></a>getRunQueue</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> HandlerActionQueue <span class="title">getRunQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mRunQueue == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mRunQueue = <span class="keyword">new</span> HandlerActionQueue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mRunQueue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>getRunQueue</code>å°±æ˜¯è¿”å›<code>HandlerActionQueue</code>ï¼Œå¤–éƒ¨ç¡®å®å°±æ˜¯è°ƒç”¨<code>HandlerActionQueue.post</code>ï¼Œç»§ç»­æ·±å…¥</p>
<h4 id="HandlerActionQueue"><a href="#HandlerActionQueue" class="headerlink" title="HandlerActionQueue#"></a>HandlerActionQueue#</h4><blockquote>
<p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºHandlerActionQueueä¸­</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerActionQueue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HandlerAction[] mActions; <span class="comment">// è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªHandlerActionæ•°ç»„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCount; <span class="comment">// è¿˜æœ‰ä¸€ä¸ªè®¡æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Runnable action)</span> </span>&#123;</span><br><span class="line">        postDelayed(action, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postDelayed</span><span class="params">(Runnable action, <span class="keyword">long</span> delayMillis)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> HandlerAction handlerAction = <span class="keyword">new</span> HandlerAction(action, delayMillis);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;<span class="comment">// åŠ é”ï¼ŒåŒæ­¥è¿›è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (mActions == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mActions = <span class="keyword">new</span> HandlerAction[<span class="number">4</span>];<span class="comment">// å¦‚æœä¸ºç©ºï¼Œåˆ™åˆ›å»ºé»˜è®¤å¤§å°ä¸º4çš„æ•°ç»„</span></span><br><span class="line">            &#125;</span><br><span class="line">            mActions = GrowingArrayUtils.append(mActions, mCount, handlerAction);</span><br><span class="line">            mCount++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>GrowingArrayUtilsï¼šä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨æ‰©å±•çš„Arrayå·¥å…·ç±»</p>
</blockquote>
<p><code>HandlerActionQueue.post</code>å†…éƒ¨åˆ™æ˜¯è°ƒç”¨äº†<code>postDelayed()</code>ï¼Œ<code>postDelayed()</code>å†…éƒ¨åˆ™æ˜¯å°†<code>Runnable</code>å’Œ<code>long</code>ä½œä¸ºå‚æ•°åˆ›å»ºä¸€ä¸ª<code>HandlerAction</code>ï¼Œä¹‹åå†æ·»åŠ åˆ°<code>mActions</code>æ•°ç»„ä¸­å»ï¼Œé‚£å°±é¡ºä¾¿çœ‹ä¸€ä¸‹<code>HandlerAction</code></p>
<h5 id="HandlerAction"><a href="#HandlerAction" class="headerlink" title="HandlerAction"></a>HandlerAction</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Runnable action;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> delay;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HandlerAction</span><span class="params">(Runnable action, <span class="keyword">long</span> delay)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.action = action;</span><br><span class="line">        <span class="keyword">this</span>.delay = delay;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(Runnable otherAction)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> otherAction == <span class="keyword">null</span> &amp;&amp; action == <span class="keyword">null</span></span><br><span class="line">                || action != <span class="keyword">null</span> &amp;&amp; action.equals(otherAction);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è›®ç®€å•çš„ä¸€ä¸ªç±»ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯æŠŠ<code>View.post</code>ä¼ å…¥çš„<code>Runnable</code>ä¿å­˜èµ·æ¥ï¼Œå¦‚æœæ˜¯<code>postDelay()</code>ï¼Œé‚£å°±ä¹ŸæŠŠå»¶è¿Ÿæ—¶é—´ç”¨<code>delay</code>ä¿å­˜èµ·æ¥</p>
<p>ç°åœ¨æˆ‘ä»¬å›åˆ°ä¸Šå±‚ï¼Œæ¢³ç†ä¸€ä¸‹ã€‚æˆ‘ä»¬ä¸€å¼€å§‹è°ƒç”¨çš„<code>View.post</code>ä¼ å…¥çš„<code>Runnable</code>ï¼Œåœ¨ä¼ åˆ°<code>HandlerActionQueue</code>é‡Œä¼šåŒ…è£…æˆ<code>HanlderAction</code>ï¼Œç„¶åå†ç¼“å­˜èµ·æ¥ã€‚å†<code>HanlderActionQueue</code>å†…éƒ¨åˆ›å»ºäº†ä¸ªé»˜è®¤å¤§å°ä¸º4çš„<code>HanlderAction</code>æ•°ç»„ï¼Œå½“æ•°ç»„ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±ä¼šé€šè¿‡<code>GrowingArrayUtils.append()</code>æ¥è¿›è¡Œæ‰©å±•ã€‚</p>
<h5 id="æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š"><a href="#æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š" class="headerlink" title="æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š"></a>æ€»ç»“å¤§æ¦‚æµç¨‹ï¼š</h5><p><code>Activity.onCreate</code> â€“&gt; è°ƒç”¨<code>View.post()</code> â€“&gt; è¿˜æ²¡è¿›è¡Œ<code>dispatchAttachedToWindow</code>  â€“&gt; <code>HandlerActionQueue</code>ä¿å­˜åˆ°æ•°ç»„ä¸­</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™è¿™äº›å­˜å‚¨èµ·æ¥çš„<code>Runnable</code>æ¥ä¼šè¢«æ‰§è¡Œå‘¢ï¼Œè¿™åˆå¾—å›åˆ°<code>HandlerActionQueue</code>è¿™é‡Œäº†</p>
<h5 id="executeActions"><a href="#executeActions" class="headerlink" title="executeActions"></a>executeActions</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeActions</span><span class="params">(Handler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> HandlerAction[] actions = mActions;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, count = mCount; i &lt; count; i++) &#123; <span class="comment">// å…¨éƒ¨éå†å‡ºæ¥ï¼Œç„¶ååŠ åˆ°Handleré‡Œé¢å»</span></span><br><span class="line">            <span class="keyword">final</span> HandlerAction handlerAction = actions[i];</span><br><span class="line">            handler.postDelayed(handlerAction.action, handlerAction.delay);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mActions = <span class="keyword">null</span>;</span><br><span class="line">        mCount = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>HandlerActionQueue</code>é‡Œé¢ï¼Œæœ‰ä¸€ä¸ª<code>executeActions</code>çš„è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ç”¨æ¥å¤„ç†<code>HandlerAction</code>çš„ã€‚è¿˜è¦ä¸€ä¸ªä¸»è¦çš„åœ°æ–¹å°±æ˜¯è¿™äº›è¢«ç¼“å­˜çš„<code>Runnable</code>ä¹Ÿéƒ½æ˜¯è¢«<strong>Handler</strong>å¤„ç†çš„ï¼Œé‚£ä¹ˆè¿™ä¸ª<strong>Hanlder</strong>æ˜¯å“ªé‡Œæ¥çš„å‘¢</p>
<h4 id="View-1"><a href="#View-1" class="headerlink" title="View#"></a>View#</h4><blockquote>
<p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewä¸­</p>
</blockquote>
<h5 id="dispatchAttachedToWindow"><a href="#dispatchAttachedToWindow" class="headerlink" title="dispatchAttachedToWindow"></a>dispatchAttachedToWindow</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchAttachedToWindow</span><span class="params">(AttachInfo info, <span class="keyword">int</span> visibility)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Transfer all pending runnables.</span></span><br><span class="line">       <span class="keyword">if</span> (mRunQueue != <span class="keyword">null</span>) &#123;</span><br><span class="line">           mRunQueue.executeActions(info.mHandler);</span><br><span class="line">           mRunQueue = <span class="keyword">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä»£ç ä¸­å¾ˆæ¸…æ™°çš„å°±å¯ä»¥çœ‹åˆ°ï¼Œåªè¦<code>mRunQueue</code>ä¸ä¸ºç©ºï¼Œåœ¨æ‰§è¡Œ<code>dispatchAttachedToWindow</code>çš„æ—¶å€™å°±ä¼šå»è¿è¡Œ</p>
<h5 id="å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š"><a href="#å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š" class="headerlink" title="å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š"></a>å†æ¬¡æ€»ç»“å¤§æ¦‚æµç¨‹ğŸ‰ï¼š</h5><p><code>Activity.onCreate</code> â€“&gt; è°ƒç”¨<code>View.post()</code> â€“&gt; è¿˜æ²¡è¿›è¡Œ<code>dispatchAttachedToWindow</code>  â€“&gt; ä½¿ç”¨<code>HandlerActionQueue</code>å°†<code>Runnable</code>ä¿å­˜åˆ°æ•°ç»„ä¸­ â€“&gt; <code>View.dispatchAttachedToWindow</code>è¢«æ‰§è¡Œ â€“&gt; <code>mRunQueue</code>ä¸ä¸ºç©º â€“&gt; <code>mRunQueue.executeActions()</code>è¿è¡Œè¢«å‚¨å­˜çš„<code>Runnable</code> â€”&gt;ç”±äº<code>View.dispatchAttachedToWindow</code>è¢«æ‰§è¡Œï¼Œ<code>mAttachInfo</code>ä¸ä¸ºç©ºï¼Œåˆ™å‰©ä¸‹çš„éƒ½äº¤ç»™<code>mAttachInfo.mHandler</code></p>
<p>å›¾ç‰‡æµç¨‹ï¼š</p>
<p><img src="https://fu-bucket-key.oss-cn-shenzhen.aliyuncs.com/img/image-20210730143624882.png" alt="image-20210730143624882"></p>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å›ç­”ä¸€å¼€å§‹æçš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è§£å†³åœ¨<code>Activity</code>çš„<code>OnCreate()</code>é‡Œè°ƒç”¨<code>View.post()</code>æ¥è§£å†³è·å–<code>View</code>é«˜å®½ä¸º0çš„é—®é¢˜ã€‚ç­”æ¡ˆå°±æ˜¯Viewå…ˆä¼šå°†ä¼ å…¥è¿›æ¥çš„<code>Runnable</code>éƒ½ç¼“å­˜èµ·æ¥ï¼Œç­‰åˆ°<code>dispatchAttachedToWindow</code>  æ‰§è¡Œï¼Œåœ¨å…ˆå°†ç¼“å­˜èµ·æ¥çš„<code>Runnable</code>éå†è¿è¡Œï¼Œä¹‹åçš„å°±æ­£å¸¸äº¤ç»™<code>mAttachInfo.mHandler</code>ã€‚æœ€åæˆ‘ä»¬å°±åªç”¨ææ¸…æ¥š<code>mAttachInfo</code>æ˜¯åœ¨å“ªé‡Œåˆå§‹åŒ–çš„å’Œä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨<code>dispatchAttachedToWindow</code> </p>
<p>é€šè¿‡æŸ¥è¯¢ï¼Œä¼šåœ¨<code>ViewRootlmpl.performTraversals()</code>å’Œ<code>ViewGroup.addViewInner()</code>é‡Œè¢«è°ƒç”¨</p>
<h4 id="ViewGroup"><a href="#ViewGroup" class="headerlink" title="ViewGroup#"></a>ViewGroup#</h4><blockquote>
<p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewGroup ä¸­</p>
</blockquote>
<p>å’±ä»¬å…ˆæ¥çœ‹<code>ViewGroup</code>ï¼Œåœ¨<code>ViewGroup</code>çš„<code>addViewInner()</code>æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨åˆ°<code>dispatchAttachedToWindow</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addViewInner</span><span class="params">(View child, <span class="keyword">int</span> index, LayoutParams params,<span class="keyword">boolean</span> preventRequestLayout)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    AttachInfo ai = mAttachInfo;</span><br><span class="line">		   ...</span><br><span class="line">            child.dispatchAttachedToWindow(mAttachInfo, (mViewFlags&amp;VISIBILITY_MASK));</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>addViewInner()</code>æ˜¯<code>ViewGroup</code>åœ¨æ·»åŠ <code>View</code>æ—¶å†…éƒ¨çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯å½“<code>ViewGroup.addView()</code>çš„æ—¶å€™ï¼Œå¦‚æœ<code>mAttachInfo</code>ä¸ä¸ºç©ºï¼Œåˆ™ä¼šå»è°ƒç”¨å­ç±»çš„<code>dispatchAttachedToWindow()</code>ï¼Œå¹¶å°†è‡ªèº«çš„<code>AttachInfo</code>ä¼ å…¥è¿‡å»ã€‚ç„¶åå­<code>View</code>åˆ™ä¼šå°†ä¼ é€’è¿‡æ¥çš„<code>mAttachInfo</code>èµ‹å€¼ç»™è‡ªå·±çš„<code>AttachInfo</code></p>
<p>é‚£ä¹ˆ<code>ViewGroup</code>çš„<code>AttachInfo</code>æ˜¯é‚£æ¥çš„å‘¢ï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥ï¼Œæœ€ç»ˆæ‰¾åˆ°çš„ç»“æœéå¸¸Amazedå•Šï¼ã€‚<code>ViewGroup</code>æ˜¯ç»§æ‰¿<code>View</code>çš„ï¼Œ<code>ViewGroup</code>ä¸­çš„<code>AttachInfo</code>æ˜¯ç›´æ¥ä½¿ç”¨<code>View</code>ä¸­<code>AttachInfo</code>ï¼Œå¯ä»¥å¾ˆç‰›ï¼Œç›´æ¥ç»•å›æ¥äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> <span class="keyword">implements</span> <span class="title">Drawable</span>.<span class="title">Callback</span>, <span class="title">KeyEvent</span>.<span class="title">Callback</span>,<span class="title">AccessibilityEventSource</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    AttachInfo mAttachInfo;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>ViewGroup</code>å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ª<code>dispatchAttachedToWindow</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">dispatchAttachedToWindow</span><span class="params">(AttachInfo info, <span class="keyword">int</span> visibility)</span> </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">super</span>.dispatchAttachedToWindow(info, visibility);</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">          <span class="keyword">final</span> View child = children[i];</span><br><span class="line">          child.dispatchAttachedToWindow(info,</span><br><span class="line">                  combineVisibility(visibility, child.getVisibility()));</span><br><span class="line">      &#125;</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„<code>dispatchAttachedToWindow</code>ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨<code>View.dispatchAttachedToWindow</code>ï¼ˆ<code>View</code>ä¸­çš„<code>AttachInfo</code>ä¹Ÿæ˜¯åœ¨è¿™ä¸ªæ—¶å€™è¢«èµ‹å€¼çš„ï¼‰ï¼Œæ¥ç€éå†æ‰€æœ‰å­ç±»ï¼Œè°ƒç”¨å­ç±»çš„<code>dispatchAttachedToWindow</code>ï¼Œå¹¶ä¼ å…¥è‡ªèº«çš„<code>AttachInfo</code>ã€‚ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±ç›´æ¥è¿›å…¥å¾ªç¯äº†â€¦ æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å»çœ‹çœ‹<code>ViewRootlmpl</code>ï¼Œå¸Œæœ›é‚£é‡Œä¼šæœ‰ç­”æ¡ˆ</p>
<h4 id="ViewRootlmpl"><a href="#ViewRootlmpl" class="headerlink" title="ViewRootlmpl#"></a>ViewRootlmpl#</h4><blockquote>
<p>ä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½å¤„äºViewRootlmplä¸­</p>
</blockquote>
<h5 id="performTraversals"><a href="#performTraversals" class="headerlink" title="performTraversals()"></a>performTraversals()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">performTraversals</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="keyword">final</span> View host = mView; <span class="comment">//è¿™é‡Œçš„Viewæ˜¯Activityä¸­çš„DecorView</span></span><br><span class="line"> ...</span><br><span class="line"> <span class="keyword">if</span> (mFirst) &#123;</span><br><span class="line"> 	...</span><br><span class="line"> 	host.dispatchAttachedToWindow(mAttachInfo, <span class="number">0</span>);</span><br><span class="line"> 	mAttachInfo.mTreeObserver.dispatchOnWindowAttachedChange(<span class="keyword">true</span>);</span><br><span class="line"> 	dispatchApplyInsets(host);</span><br><span class="line"> 	...</span><br><span class="line"> &#125;</span><br><span class="line"> mFirst = <span class="keyword">false</span>;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>performTraversals()</code>è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥é€šçŸ¥<code>Activity</code>çš„<code>View</code>æ ‘æ¥å¼€å§‹æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ã€‚è€Œ<code>DecorView</code>å°±æ˜¯<code>Activity</code>çš„æ ¹å¸ƒå±€ï¼Œ<code>View</code>æ ‘çš„èµ·ç‚¹ï¼Œæ˜¯ä¸€ä¸ª<code>FrameLayout</code>(æ˜¯ä¸€ä¸ª<code>ViewGroup</code>)ã€‚æ‰€ä»¥å°±æ˜¯åœ¨è¿™é‡Œç¬¬ä¸€æ¬¡å°†<code>mAttachInfo</code>ä¼ ç»™äº†<code>DecorView</code>ä¸­çš„æ‰€æœ‰å­ç±»</p>
<p>å¯ä»¥äº†ï¼Œç°åœ¨åªç”¨æ‰¾åˆ°<code>mAttachInfo</code>æ˜¯åœ¨å“ªé‡Œè¿›è¡Œçš„åˆå§‹åŒ–å°±å¯ä»¥äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ViewRootImpl</span><span class="params">(Context context, Display display, IWindowSession session,<span class="keyword">boolean</span> useSfChoreographer)</span> </span>&#123;</span><br><span class="line"> ...   </span><br><span class="line"> mAttachInfo = <span class="keyword">new</span> View.AttachInfo(mWindowSession, mWindow, display, <span class="keyword">this</span>, mHandler, <span class="keyword">this</span>,context);</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°äº†ï¼Œåœ¨<code>ViewRootImpl</code>çš„ä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª<code>AttachInfo</code>ã€‚æ‰€ä»¥è¯´<code>ViewRootImpl</code>æ˜¯<code>AttachInfo</code>çš„å¼€å¤´ï¼Œ<code>AttachInfo</code>æ˜¯ä»è¿™é‡Œå¼€å§‹å¾€ä¸‹ä¼ é€’çš„</p>
<p>ä½†åˆæœ‰ä¸€ä¸ªå°é—®é¢˜å‡ºç°äº†ï¼Œé‚£å°±æ˜¯åˆ›å»º<code>AttachInfo</code>ä¸­æ”¾å…¥çš„å‚æ•°<code>mHandler</code>ï¼Œ<code>mHandler</code>æ˜¯é‚£æ¥çš„å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ViewRootHandler mHandler = <span class="keyword">new</span> ViewRootHandler();</span><br></pre></td></tr></table></figure>

<p><code>mHandler</code>æ˜¯åœ¨å†…éƒ¨è¢«åˆ›å»ºçš„ï¼Œåˆå› ä¸º<code>ViewRootImpl</code>æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œåˆ›å»ºçš„<code>Handler</code>ä¼šè‡ªåŠ¨çš„è·å–å½“å‰çº¿ç¨‹çš„<code>Looper</code>ï¼Œæ‰€ä»¥ä¹Ÿå°±å¯ä»¥å›ç­”ä¸€å¼€å§‹æ‰€é—®çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨<code>View.post</code>æ¥æ›´æ–°<code>ui</code>ï¼Œå› ä¸ºå†…éƒ¨çš„<code>Handler</code>å§‹ç»ˆéƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šçš„</p>
<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>å½“è°ƒç”¨<code>View.post</code>çš„æ—¶å€™ï¼Œ<code>View</code>å†…éƒ¨ä¼šå…ˆåˆ¤æ–­æ˜¯å¦è°ƒç”¨è¿‡<code>dispatchAttachedToWindow</code>ï¼Œä¹Ÿå°±æ˜¯<code>mAttachInfo</code>æ˜¯å¦ä¸ºç©ºã€‚ä¸ºç©ºçš„è¯ï¼Œåˆ™ä¼šå…ˆå°†ä¼ å…¥è¿›æ¥çš„<code>Runnable</code>é€šè¿‡è°ƒç”¨<code>HandlerActionQueue</code>å°è£…æˆ<code>HandlerAction</code>ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œç­‰å¾…<code>dispatchAttachedToWindow</code>è¢«æ‰§è¡Œã€‚å½“<code>dispatchAttachedToWindow</code>è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ™ä¼šå…ˆå°†å­˜å‚¨åœ¨<code>HandlerActionQueue</code>é‡Œçš„æ•°ç»„ä¸­çš„<code>HandlerAction</code>æå–å‡ºæ¥è¿è¡Œï¼Œä¹‹åçš„<code>Runnable</code>éƒ½å°†ç›´æ¥è°ƒç”¨<code>mAttachInfo.post()</code>æ¥è¿è¡Œ</p>
<p>å…³äº<code>mAttachInfo</code>çš„æµç¨‹ï¼šä¸€å¼€å§‹<code>ViewRootlmpl</code>é€šçŸ¥<code>Activity</code>æ ¹<code>View</code>å¼€å§‹æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ã€‚ä¹Ÿå°±æ˜¯é€šçŸ¥<code>Activity.DevorView</code>å»è¿›è¡Œæµ‹é‡ä¼šè°ƒç”¨<code>view.dispatchAttachedToWindow()</code>çš„æ–¹æ³•ï¼Œå°†è‡ªèº«çš„<code>mAttachInfo</code>ä¼ ç»™æ ¹<code>View</code>ã€‚è€Œæ ¹<code>View</code>(<code>DevorView</code>)æ˜¯ä¸€ä¸ª<code>ViewGroup</code>ï¼Œæ‰€ä»¥åœ¨<code>ViewGroup</code>çš„<code>dispatchAttachedToWindow</code>åˆä¼šéå†å­<code>View</code>ï¼Œé€šè¿‡è°ƒç”¨å­<code>View</code>çš„<code>dispatchAttachedToWindow</code>å°†<code>mAttachInfo</code>ä¼ é€’ç»™æ¯ä¸ªå­<code>View</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/28/Android-View-Post/" data-id="cksvyy5t4000t3wme0raae51i" class="article-share-link">
        åˆ†äº«
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/View/" rel="tag">View</a></li></ul>

    </footer>

  </div>

  
  
<nav class="article-nav">
  
  
  <a href="/2021/08/28/Material-Design-Navigation/" class="article-nav-link">
    <strong class="article-nav-caption">åä¸€ç¯‡</strong>
    <div class="article-nav-title">Material Design - Navigation</div>
  </a>
  
</nav>

  

  
  
<div class="vcomments" id="vcomments"></div>

<script src="https://unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  new Valine({
    el: '#vcomments',
    appId: 'TikGGR5AGLNjsKeqDK5xAx6b-gzGzoHsz',
    appKey: 'uehuRLLYmGdERs7oCOpzh5Sk',
    notify: 'false',
    verify: 'true',
    avatar: 'mp',
    pageSize: '10',
    placeholder: 'è¯·è¾“å…¥...'
  })
</script>

  
  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>Fuxinboåšå®¢ &copy; 2021</li>
      
        <li>äº¬ICPå¤‡17054916å·-2</li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="Fuxinboåšå®¢"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="æœç´¢">
        <i class="fe fe-search"></i>
        æœç´¢
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>





<script src="/js/tocbot.min.js"></script>


<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>